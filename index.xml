<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>BGBiaoçš„SREäººç”Ÿ</title>
    <link>https://bgbiao.top/</link>
    <description>Recent content on BGBiaoçš„SREäººç”Ÿ</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sun, 28 Jun 2020 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="https://bgbiao.top/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Traefikä¸­çš„502-500çŠ¶æ€ç å¼‚å¸¸æ’æŸ¥</title>
      <link>https://bgbiao.top/post/traefik%E4%B8%AD%E7%9A%84502-500%E7%8A%B6%E6%80%81%E7%A0%81%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/</link>
      <pubDate>Sun, 28 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/traefik%E4%B8%AD%E7%9A%84502-500%E7%8A%B6%E6%80%81%E7%A0%81%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“åœ¨Kubernetesé›†ç¾¤ä¸­é€šå¸¸ä¼šä½¿ç”¨Ingressæ–¹æ¡ˆæ¥ç»Ÿä¸€ä»£ç†é›†ç¾¤å†…éƒ¨çš„æµé‡ï¼Œè€Œå¸¸ç”¨çš„Ingressæ–¹æ¡ˆä¸º&lt;a href=&#34;https://docs.traefik.io/&#34;&gt;traefik&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34;&gt;nginx&lt;/a&gt;ï¼Œå’Œä¼ ç»Ÿçš„Nginxä½œä¸ºä¼ä¸šå†…éƒ¨çš„åå‘ä»£ç†ä»¥åŠè´Ÿè½½è®¾å¤‡ä¸€æ ·ï¼Œåœ¨ä¸åŒçš„åœºæ™¯ä¸‹å¯èƒ½éœ€è¦ä¸“æœ‰çš„é…ç½®æ‰èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå¦åˆ™ä¼šå‡ºç°å¥‡å¥‡æ€ªæ€ªçš„å¼‚å¸¸çŠ¶æ€ç ã€‚æœ¬ç¯‡æ–‡ç« ä¸€èµ·æ¥çœ‹ä¸‹ï¼Œæˆ‘ä»¬åœ¨&lt;code&gt;traefik&lt;/code&gt;ä¸­é‡åˆ°çš„500å’Œ502å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;ä¸€-å‰è¨€&#34;&gt;ä¸€ã€å‰è¨€&lt;/h3&gt;

&lt;p&gt;åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹å‡ ä¸ªåœ¨Nginxä½œä¸ºåå‘ä»£ç†å·¥å…·ä¸­ç»å¸¸é‡åˆ°çš„å‡ ä¸ªå¼‚å¸¸çŠ¶æ€ç ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;499: å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚é€šå¸¸ä¸ºä¸€æ¬¡è¯·æ±‚æœªåœ¨å®¢æˆ·ç«¯æŒ‡å®šæ—¶é—´å†…è¿”å›ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå®¢æˆ·ç«¯æ— æ•°æ®è¿”å›(åœ¨Nginxä¸­ä¼šè®°å½•499)ã€‚ä¸€èˆ¬æ˜¯&lt;code&gt;å®¢æˆ·ç«¯è¶…æ—¶&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚æœåŠ¡å™¨é‡åˆ°æœªçŸ¥é”™è¯¯å¯¼è‡´æ— æ³•å®Œæˆè¯·æ±‚å¤„ç†ï¼Œé€šå¸¸ç”±äºåç«¯ä¸šåŠ¡é€»è¾‘å¼‚å¸¸å¯¼è‡´(æœ¬èº«Bug)&lt;/li&gt;
&lt;li&gt;502: ç½‘å…³é”™è¯¯ã€‚é€šå¸¸ä¸ºç½‘å…³æœªä»ä¸Šæ¸¸æœåŠ¡ä¸­è·å–æœŸæœ›çš„å“åº”(&lt;code&gt;ä¸Šæ¸¸æœªè¿”å›æ•°æ®æˆ–æœªæŒ‰ç…§åè®®çº¦å®šè¿”å›æ•°æ®&lt;/code&gt;)ï¼Œç½‘å…³æ„Ÿè§‰è‡ªå·±æ²¡ç”¨äº†ï¼Œè¿”å›äº†ç½‘å…³é”™è¯¯ã€‚ä¸€èˆ¬æ˜¯&lt;code&gt;åç«¯æœåŠ¡å™¨å®•æœº&lt;/code&gt;æˆ–&lt;code&gt;ä¸šåŠ¡é€»è¾‘è¶…æ—¶&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;504: ç½‘å…³è¶…æ—¶ã€‚è¡¨ç¤ºç½‘å…³æ²¡æœ‰åŠæ—¶ä»ä¸Šæ¸¸è·å–å“åº”æ•°æ®ã€‚ä¸€èˆ¬æ˜¯Nginxç½‘å…³ä½œä¸ºå®¢æˆ·ç«¯å»å‘ä¸Šæ¸¸æœåŠ¡è¯·æ±‚å“åº”çš„è¿‡ç¨‹ä¸­ï¼ŒNginxç½‘å…³è¶…æ—¶å¯¼è‡´ï¼Œä½†æ­¤æ—¶å¯¹äºä¸Šæ¸¸æœåŠ¡å™¨æ¥å°†ï¼Œå®ƒä¼šç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°ç»“æŸã€‚(&lt;code&gt;Nginxç½‘å…³ä½œä¸ºå®¢æˆ·ç«¯æ—¶çš„è¶…æ—¶&lt;/code&gt;)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# 499 çš„å®é™…æƒ…å†µå°±æ˜¯ï¼Œå®¢æˆ·ç«¯æŒ‡å®šè¶…æ—¶æ—¶é—´ä¸ºNç§’ï¼Œä½†æ˜¯è¯¥è¯·æ±‚åœ¨æœåŠ¡ç«¯å®é™…éœ€è¦æ‰§è¡ŒMç§’(M&amp;gt;Nç§’)ï¼Œå®¢æˆ·ç«¯ç­‰çš„ä¸è€çƒ¦äº†å°±å…³é—­äº†
# å¯¹äº499çŠ¶æ€æ¥è®²ï¼Œè§£å†³æ–¹å¼æ˜¯ä¼˜åŒ–åç«¯ä»£ç é€»è¾‘æˆ–è€…ä¿®æ”¹nginxå‚æ•°
$ cat nginx.conf
proxy_ignore_client_abort    on;
$ curl -i -m 3 http://127.0.0.1/hello.php


# 502çš„å®é™…æƒ…å†µé€šå¸¸æ˜¯Nginxç½‘å…³åç«¯çš„æœåŠ¡å™¨ç›´æ¥å®•æœºäº†(æ‰€ä»¥å°±æ‹¿ä¸åˆ°ä¸Šæ¸¸çš„å“åº”äº†)
# å½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸Šæ¸¸æœåŠ¡å™¨çœŸæ­£çš„æ‰§è¡Œé€»è¾‘è¶…è¿‡äº†ä¸Šæ¸¸æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´é™åˆ¶(æ¯”å¦‚php-fpm.confè®¾ç½®request_terminate_timeout5sï¼Œä½†æ˜¯å®é™…çš„ä¸šåŠ¡é€»è¾‘éœ€è¦7sæ‰èƒ½å®Œæˆ)ï¼Œæ­¤æ—¶ä¸Šæ¸¸æœåŠ¡å™¨ç«¯å‡ºç°`ä¸šåŠ¡é€»è¾‘è¶…æ—¶`ï¼Œç»™Nginxç½‘å…³è¿”å›äº†å¼‚å¸¸çš„æ•°æ®é€ æˆçš„
# 502æ—¶åç«¯çš„å‡ ç§é”™è¯¯æ—¥å¿—
recv() failed (104: Connection reset by peer) while reading response header from upstream
upstream prematurely closed connection while reading response header from upstream
connect() failed (111: Connection refused) while connecting to upstream
# æ•´ä½“æ¥è¯´502å‡ºç°çš„é—®é¢˜é€šå¸¸æ˜¯å› ä¸ºåç«¯æŒ‚äº†ï¼Œæˆ–è€…å› ä¸ºåç«¯è´Ÿè½½å¤ªé«˜ï¼Œæš‚æ—¶ä¸å¯å“åº”
# å¯ä»¥åœ¨nginxä¾§å¢åŠ proxy_read_timeoutæ¥æš‚æ—¶ç¼“è§£
$ cat nginx.conf
proxy_read_timeout  20s;

# 504çš„å®é™…æƒ…å†µå°±æ˜¯å®¢æˆ·ç«¯-&amp;gt;Nginx-&amp;gt;Backendï¼Œåœ¨è¿‡ç¨‹ä¸­Nginxéœ€è¦ä½œä¸ºå®¢æˆ·ç«¯è®¿é—®BackendæœåŠ¡ï¼Œä½†æ˜¯åœ¨Backendè¿˜æ²¡ç”¨æ‰§è¡Œå®Œæˆæ—¶ï¼ŒNginxé¦–å…ˆè¶…è¿‡äº†è‡ªå·±çš„å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°504çš„å¼‚å¸¸(ä½†æ˜¯å¯¹äºå®¢æˆ·ç«¯æ¥è¯´è¿”å›ä»€ä¹ˆå‘¢?)
# å¯¹äº504åœºæ™¯è€Œè¨€ï¼Œé€šå¸¸çš„åšæ³•å°±æ˜¯ä¼˜åŒ–Backendçš„é€»è¾‘ï¼Œé€‚å½“å‡å°‘æ‰§è¡Œæ—¶é—´ï¼›å¦å¤–ä¹Ÿå¯ä»¥é€‚å½“çš„å¢åŠ Nginxä½œä¸ºå®¢æˆ·ç«¯æ—¶çš„è¶…æ—¶æ—¶é—´
# è¦çŸ¥é“ï¼Œå½“Nginxä½œä¸ºå®¢æˆ·ç«¯æ—¶ï¼Œæ˜¯ä»¥ä¸€ä¸ªProxyçš„è§’è‰²å­˜åœ¨çš„ï¼Œé…ç½®å¦‚ä¸‹å‚æ•°å³å¯
$ cat nginx.conf
uwsgi_connect_timeout 5;
uwsgi_send_timeout 5;
uwsgi_read_timeout 5;
fastcgi_read_timeout 5;
fastcgi_send_timeout 5;
proxy_connect_timeout      90;
proxy_send_timeout         90;
proxy_read_timeout         90;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;äºŒ-traefikä¸­è¯¡å¼‚çš„500å’Œ502&#34;&gt;äºŒã€traefikä¸­è¯¡å¼‚çš„500å’Œ502&lt;/h3&gt;

&lt;h4 id=&#34;traefikåœ¨kubernetesé›†ç¾¤ä¸­çš„éƒ¨ç½²é…ç½®&#34;&gt;traefikåœ¨Kubernetesé›†ç¾¤ä¸­çš„éƒ¨ç½²é…ç½®&lt;/h4&gt;

&lt;p&gt;æˆ‘ä»¬å½“å‰é›†ç¾¤çš„traefikçš„é…ç½®å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# traefikçš„configmapé…ç½®æ–‡ä»¶
$ cat traefik-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: traefik-config
  namespace: kube-system
data:
  traefik.toml: |
    defaultEntryPoints = [&amp;#34;http&amp;#34;,&amp;#34;https&amp;#34;]
    debug = false
    logLevel = &amp;#34;INFO&amp;#34;

    InsecureSkipVerify = true
    [entryPoints]
      [entryPoints.http]
      address = &amp;#34;:80&amp;#34;
      compress = true
      [entryPoints.https]
      address = &amp;#34;:443&amp;#34;
        [entryPoints.https.tls]
    [web]
      address = &amp;#34;:8080&amp;#34;
    [kubernetes]
    [metrics]
      [metrics.prometheus]
      buckets=[0.1,0.3,1.2,5.0]
      entryPoint = &amp;#34;traefik&amp;#34;
    [ping]
    entryPoint = &amp;#34;http&amp;#34;

# traefikçš„DaemonSeté…ç½®
$ cat traefik-ds-v1.7.16.yaml
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: traefik-ingress-controller
  namespace: kube-system
---
kind: DaemonSet
apiVersion: extensions/v1beta1
metadata:
  name: traefik-ingress-controller
  namespace: kube-system
  labels:
    k8s-app: traefik-ingress-lb
spec:
  template:
    metadata:
      labels:
        k8s-app: traefik-ingress-lb
        name: traefik-ingress-lb
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-role.kubernetes.io/master
                operator: DoesNotExist
      serviceAccountName: traefik-ingress-controller
      terminationGracePeriodSeconds: 30
      hostNetwork: true
      containers:
      - image: traefik:v1.7.16
        name: traefik-ingress-lb
        ports:
        - name: http
          containerPort: 80
          hostPort: 80
        - name: admin
          containerPort: 8080
        securityContext:
          capabilities:
            drop:
            - ALL
            add:
            - NET_BIND_SERVICE
        args:
        - --api
        - --kubernetes
        - --logLevel=INFO
        - --traefikLog.filePath=/logdata/traefik.log
        - --configfile=/config/traefik.toml
        - --accesslog.filepath=/logdata/access.log
        - --accesslog.bufferingsize=100
        volumeMounts:
        - mountPath: /config
          name: config
        - mountPath: /logdata
          name: access-log
      volumes:
      - configMap:
          name: traefik-config
        name: config
      - name: access-log
        hostPath:
          path: /opt/logs/ingress/
---
kind: Service
apiVersion: v1
metadata:
  name: traefik-ingress-service
  namespace: kube-system
  labels:
    k8s-app: traefik-ingress-lb
spec:
  selector:
    k8s-app: traefik-ingress-lb
  ports:
    - protocol: TCP
      port: 80
      name: web
    - protocol: TCP
      port: 8080
      name: admin&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;pythonçš„å¯¹å¤–apiæ¥å£&#34;&gt;Pythonçš„å¯¹å¤–APIæ¥å£&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æ¥å£å¯¹å¤–çš„ingress
$ kubectl  get ingress -n s-data
NAME                     HOSTS                    ADDRESS   PORTS   AGE
data-api.bgbiao.cn   data-api.bgbiao.cn             80      236d
ops.bgbiao.cn       ops.bgbiao.cn                 80      236d

# æµ‹è¯•å¯¹å¤–æ¥å£
$ curl data-api.bgbiao.cn  -i
HTTP/1.1 401 Unauthorized
Access-Control-Allow-Headers: Content-Type, X-TOKEN
Access-Control-Allow-Origin: *
Content-Length: 58
Content-Type: application/json
Vary: Accept-Encoding
Date: Sun, 28 Jun 2020 14:55:00 GMT

# æ¥å£éœ€è¦ç™»å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹ç™»å½•æ¥å£è¿›è¡Œå‹æµ‹æ¥æ¨¡æ‹Ÿé—®é¢˜
$ curl -X POST  --data &amp;#39;@/root/login.json&amp;#39; -H &amp;#39;Content-type:application/json&amp;#39; http://data-api.bgbiao.cn/account/users/login/   -i
HTTP/1.1 200 OK
Access-Control-Allow-Headers: Content-Type, X-TOKEN
Access-Control-Allow-Origin: *
Content-Length: 250
Content-Type: application/json
Vary: Accept-Encoding
Date: Sun, 28 Jun 2020 14:56:33 GMT&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;è¯¡å¼‚çš„500å’Œ502&#34;&gt;è¯¡å¼‚çš„500å’Œ502&lt;/h4&gt;

&lt;p&gt;åœ¨æœåŠ¡éƒ¨ç½²å®Œæˆåï¼Œä¸€åˆ‡çš†æ­£å¸¸ï¼Œä½†æ˜¯ç®€å•å‹æµ‹åå‘ç°æœåŠ¡å‡ºç°éƒ¨åˆ†è¯·æ±‚å¤±è´¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# ä½¿ç”¨abå·¥å…·è¿›è¡Œå‹æµ‹
# ç”±å‹æµ‹ç»“æœå¯ä»¥å‘ç°ï¼Œ20ä¸ªå¹¶å‘å…±å‹æµ‹200ä¸ªè¯·æ±‚ï¼ŒæœŸé—´å‡ºç°äº†7æ¬¡å¤±è´¥è¯·æ±‚
$ ab -c 20 -n 200   -T &amp;#39;application/json&amp;#39; -p /root/login.json http://data-api.bgbiao.cn/account/users/login/
...
Benchmarking data-api.bgbiao.cn (be patient)
Completed 100 requests
Completed 200 requests
Finished 200 requests


Server Software:
Server Hostname:        data-api.bgbiao.cn
Server Port:            80

Document Path:          /account/users/login/
Document Length:        250 bytes

Concurrency Level:      20
Time taken for tests:   1.340 seconds
Complete requests:      200
Failed requests:        7
   (Connect: 0, Receive: 0, Length: 7, Exceptions: 0)
Write errors:           0
Non-2xx responses:      7
Total transferred:      91371 bytes
Total body sent:        46400
HTML transferred:       48387 bytes
Requests per second:    149.21 [#/sec] (mean)
Time per request:       134.035 [ms] (mean)
Time per request:       6.702 [ms] (mean, across all concurrent requests)
Transfer rate:          66.57 [Kbytes/sec] received
                        33.81 kb/s sent
                        100.38 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        1    1   0.1      1       1
Processing:     2  116  27.8    114     179
Waiting:        2  116  27.8    114     179
Total:          3  117  27.8    116     180

Percentage of the requests served within a certain time (ms)
  50%    116
  66%    121
  75%    125
  80%    129
  90%    154
  95%    167
  98%    173
  99%    175
 100%    180 (longest request)


# å°†å‹æµ‹ç»“æœä¿å­˜åˆ°æ–‡æœ¬ä¸­è¿›è¡Œç®€å•åˆ†æ
# ç®€å•åˆ†æåœ¨200ä¸ªå‹æµ‹è¯·æ±‚ä¸­ï¼Œæœ‰4ä¸ªè¯·æ±‚å¤±è´¥ï¼Œåˆ†åˆ«ä¸º2æ¬¡500é”™è¯¯å’Œ2æ¬¡502é”™è¯¯
$ ab -v 10 -c 20 -n 200   -T &amp;#39;application/json&amp;#39; -p /root/login.json http://data-api.bgbiao.cn/account/users/login/  &amp;gt; ab-log.txt
$ cat ab-log.txt | grep HTTP | sort| uniq -c
    196 HTTP/1.0 200 OK
      2 HTTP/1.0 500 Internal Server Error
      2 HTTP/1.0 502 Bad Gateway
      1 POST /account/users/login/ HTTP/1.0&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;traefikä¸­500å’Œ502é—®é¢˜æ’æŸ¥&#34;&gt;traefikä¸­500å’Œ502é—®é¢˜æ’æŸ¥&lt;/h4&gt;

&lt;p&gt;å‰é¢æˆ‘ä»¬æåˆ°äº†åœ¨Nginxçš„åœºæ™¯ä¸­çš„500å’Œ502çŠ¶æ€ç çš„åŸå› ä»¥åŠç›¸å…³çš„è§£å†³æ–¹å¼ï¼Œé‚£ä¹ˆåœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œtraefikèµ·åˆ°çš„ä½œç”¨å’ŒNginxçš„ä½œç”¨ä¹Ÿæ˜¯ç›¸ä¼¼çš„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº†é›†ç¾¤å†…çš„traefikçš„é…ç½®ä¿¡æ¯ï¼Œå¯¹äºSREæ¥è®²ï¼Œä»»ä½•ç”Ÿäº§çš„æœåŠ¡éƒ½å¿…é¡»æœ‰ç›¸å…³çš„å¯è§‚æµ‹æ€§æ•°æ®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿé»˜è®¤å°†traefikçš„è®¿é—®æ—¥å¿—å’Œè¿›ç¨‹æ—¥å¿—è¿›è¡Œäº†æŒä¹…åŒ–(åˆ†åˆ«å¯¹åº”&lt;code&gt;access.logå’Œtraefik.log&lt;/code&gt;)ï¼ŒåŒæ—¶ä¹Ÿæš´éœ²äº†traefikçš„prometheusçš„metricsæ¥å£ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºä¸Šé¢çš„å‹æµ‹è¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨è®¿é—®æ—¥å¿—é‡ŒæŠ“åˆ°äº†å¦‚ä¸‹çš„å¼‚å¸¸æ—¥å¿—:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ tail -f access.log | grep data-api.bgbiao.cn | grep -v &amp;#39;HTTP/1.0&amp;#34; 200&amp;#39;
192.168.0.23 - - [28/Jun/2020:14:57:38 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122267376 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.41.8:8080&amp;#34; 0ms
192.168.0.23 - - [28/Jun/2020:14:57:38 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122267385 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.26.9:8080&amp;#34; 1ms
192.168.0.23 - - [28/Jun/2020:14:57:38 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122267410 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.41.8:8080&amp;#34; 1ms
192.168.0.23 - - [28/Jun/2020:14:57:38 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122267418 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.41.8:8080&amp;#34; 1ms
192.168.0.23 - - [28/Jun/2020:14:57:38 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122267484 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.26.9:8080&amp;#34; 1ms
192.168.0.23 - - [28/Jun/2020:14:57:38 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 502 11 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122267518 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.26.9:8080&amp;#34; 1ms
192.168.0.23 - - [28/Jun/2020:14:57:39 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122267550 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.26.9:8080&amp;#34; 4ms
192.168.0.23 - - [28/Jun/2020:15:02:06 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 502 11 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122272696 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.41.8:8080&amp;#34; 2ms
192.168.0.23 - - [28/Jun/2020:15:02:06 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 502 11 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122272711 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.41.8:8080&amp;#34; 1ms
192.168.0.23 - - [28/Jun/2020:15:02:06 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122272836 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.26.9:8080&amp;#34; 0ms
192.168.0.23 - - [28/Jun/2020:15:02:06 +0000] &amp;#34;POST /account/users/login/ HTTP/1.0&amp;#34; 500 21 &amp;#34;-&amp;#34; &amp;#34;ApacheBench/2.3&amp;#34; 122272837 &amp;#34;data-api.bgbiao.cn/&amp;#34; &amp;#34;http://20.0.41.8:8080&amp;#34; 0ms&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œå’Œæˆ‘ä»¬å‹æµ‹ç»“æœé‡Œå¤±è´¥è¯·æ±‚çš„çŠ¶æ€ç ç›¸åŒï¼Œéƒ½æ˜¯&lt;code&gt;500&lt;/code&gt;å’Œ&lt;code&gt;502&lt;/code&gt;ï¼Œè™½ç„¶æ•°é‡ä¸Šä¸æ­¢4ä¸ªï¼Œä½†è¿™æš‚æ—¶ä¸å¤ªé‡è¦ã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸å¯¹äºå¤§å¤šæ•°äººæ¥è®²ï¼Œåœ¨ä»£ç†å±‚çœ‹åˆ°500æˆ–è€…502éƒ½ä¼šä¸‹æ„è¯†çš„æƒ³ï¼Œè‚¯å®šæ˜¯ä¸Šæ¸¸æœåŠ¡çš„é—®é¢˜ï¼Œä¸è¿‡è¿™ç§çŒœæµ‹ä¹Ÿèƒ½å¾ˆå¿«è¿›è¡Œæ’é™¤ï¼Œæ’é™¤çš„æ–¹æ³•åŸºæœ¬å¦‚ä¸‹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨å‹æµ‹å‡ºç°500å’Œ502æœŸé—´ï¼ŒæŒç»­å»è®¿é—®ä¸Šæ¸¸æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åŒæ ·çš„å‹æµ‹å‚æ•°ç›´æ¥å‹ä¸Šæ¸¸æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;å°†ä¸Šæ¸¸æœåŠ¡éƒ¨ç½²åœ¨ç‹¬ç«‹çš„ECSä¸Šå¹¶ä½¿ç”¨åŒæ ·å‚æ•°è¿›è¡Œå‹æµ‹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç»è¿‡ä¸Šè¿°ä¸‰ç§æ–¹å¼çš„æµ‹è¯•åï¼Œæˆ‘ä»¬åŸºæœ¬æ’é™¤äº†ä¸Šæ¸¸æœåŠ¡çš„é—®é¢˜ï¼Œå› æ­¤æ­£å¼æ€€ç–‘traefikæœ¬èº«æ˜¯å¦æœ‰æ€§èƒ½æˆ–è€…å…¶ä»–å‚æ•°ä¸Šçš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹traefkiä¸­çš„æ—¥å¿—çº§åˆ«ä¸º&lt;code&gt;DEBUG&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ cat traefik-ds-v1.7.6.yaml
....
        args:
        - --api
        - --kubernetes
        - --logLevel=DEBUG
....&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç„¶ååœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹ç›¸å…³ä¿¡æ¯:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# 500ç›¸å…³çš„æ—¥å¿—
time=&amp;#34;2020-06-28T15:35:05Z&amp;#34; level=debug msg=&amp;#34;&amp;#39;500 Internal Server Error&amp;#39; caused by: http: server closed idle connection&amp;#34;
time=&amp;#34;2020-06-28T15:35:05Z&amp;#34; level=debug msg=&amp;#34;vulcand/oxy/forward/http: Round trip: http://20.0.26.9:8080, code: 500, Length: 21, duration: 1.486276ms&amp;#34;

# 502ç›¸å…³çš„æ—¥å¿—
time=&amp;#34;2020-06-28T15:35:05Z&amp;#34; level=debug msg=&amp;#34;&amp;#39;502 Bad Gateway&amp;#39; caused by: EOF&amp;#34;
time=&amp;#34;2020-06-28T15:35:05Z&amp;#34; level=debug msg=&amp;#34;vulcand/oxy/forward/http: Round trip: http://20.0.26.9:8080, code: 502, Length: 11, duration: 1.530677ms&amp;#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä¸Šé¢çš„500ä¿¡æ¯ï¼Œå¤§æ¦‚å¯ä»¥çœ‹å‡ºæ¥æ˜¯traefikçš„æœåŠ¡è¿›ç¨‹ä¸»åŠ¨å…³é—­äº†ç©ºé—²é“¾æ¥å¯¼è‡´çš„ï¼Œè€Œä¸‹é¢çš„502æ˜¯å› ä¸ºEOFï¼Œæ„Ÿè§‰åƒæ˜¯æ²¡æœ‰è¯»å–å®Œå“åº”æ•°æ®ï¼Œå°±è¢«æ–­å¼€äº†ï¼Œå¯¼è‡´traefikè¿”å›502ã€‚é€šå¸¸è¿™ç§æƒ…å†µåœ¨Nginxä¸­å¾ˆå¸¸è§ï¼Œä¹Ÿå¾ˆå®¹æ˜“è°ƒæ•´ç›¸å…³çš„é…ç½®å‚æ•°(æ–‡ç« å¼€å§‹æœ‰æåˆ°)ï¼Œä½†æ˜¯traefikçš„éƒ¨ç½²æ¨¡å¼ä»¥åŠå‚æ•°è°ƒæ•´ï¼Œè¿˜æ˜¯éœ€è¦èŠ±å¿ƒæ€å»çœ‹ç›¸å…³æ–‡æ¡£çš„ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶ååœ¨githubä¸Šå»ç¿»traefikç›¸å…³çš„issuesï¼Œå‘ç°è¯¥é—®é¢˜æ›¾ç»å‡ºç°è¿‡å¾ˆå¤šæ¬¡ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containous/traefik/issues/4481&#34;&gt;Traefik return 500 internal error - no 500 on backend&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containous/traefik/issues/3237&#34;&gt;Sporadic 502 response only when running through traefik&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸€ä¸ªæ˜¯500çš„issuesï¼Œä¸€ä¸ªæ˜¯502çš„issuesï¼Œä½†é€šå¸¸è¿™ä¸¤ä¸ªé—®é¢˜éƒ½æ˜¯æˆåŒå‡ºç°çš„ã€‚&lt;/p&gt;

&lt;h4 id=&#34;500å’Œ502é—®é¢˜è§£å†³æ–¹æ¡ˆ&#34;&gt;500å’Œ502é—®é¢˜è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;

&lt;p&gt;åœ¨ä¸Šé¢ç¬¬ä¸€ä¸ªissueä¸­æåˆ°ï¼Œtraefikåœ¨httpçš„åå‘ä»£ç†åŠŸèƒ½ä¸­é»˜è®¤å¼€å¯äº†httpçš„keep-aliveåŠŸèƒ½ï¼Œä½†æ˜¯pythonçš„åº”ç”¨ä¸­æœªå¼€å¯httpçš„keep-aliveï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šé¢çš„æµ‹è¯•ç¨‹åºå…¶å®ä¹Ÿæ˜¯ä½¿ç”¨çš„pythonå¼€å‘çš„ï¼Œå…ˆå¯¹è¯¥å‚æ•°è¿›è¡Œè°ƒæ•´ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# åœ¨uwsgi.iniä¸­å¢åŠ keep-aliveå‚æ•°å³å¯
$ cat uwsgi.ini
[uwsgi]
http = 0.0.0.0:8080
http-keepalive = 1
chdir = /opt/app/
wsgi-file = /opt/app/main.py
callable = app
stats = 0.0.0.0:8081
processes = 2
threads = 10

# é‡å¯åº”ç”¨åï¼Œå†æ¬¡è¿›è¡Œå‹æµ‹
# ä¹‹å‰å‡ºç°çš„502å’Œ500é”™è¯¯åŸºæœ¬éƒ½æ¶ˆå¤±äº†
# å¹¶å‘200ï¼Œå…±1ä¸‡ä¸ªè¯·æ±‚ï¼Œå¤±è´¥çš„è¯·æ±‚æ•°ä¸º0ï¼Œæ€»è€—æ—¶1min(qpsæ‰åˆ°160ğŸ˜¸)
$ ab  -c 200 -n 10000   -T &amp;#39;application/json&amp;#39; -p /root/login.json http://data-api.bgbiao.cn/account/users/login/
....
....

Concurrency Level:      200
Time taken for tests:   59.323 seconds
Complete requests:      10000
Failed requests:        0
Write errors:           0
Total transferred:      4670000 bytes
Total body sent:        2320000
HTML transferred:       2500000 bytes
Requests per second:    168.57 [#/sec] (mean)
Time per request:       1186.454 [ms] (mean)
Time per request:       5.932 [ms] (mean, across all concurrent requests)
Transfer rate:          76.88 [Kbytes/sec] received
                        38.19 kb/s sent
                        115.07 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        1    3  38.6      1    1035
Processing:   101  942 1457.7    857   32684
Waiting:      101  942 1457.7    857   32684
Total:        102  945 1458.0    861   32685

# p99è¾¾åˆ°7.3s
Percentage of the requests served within a certain time (ms)
  50%    861
  66%   1033
  75%   1136
  80%   1191
  90%   1886
  95%   2281
  98%   4209
  99%   7399
 100%  32685 (longest request)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;é€šè¿‡å¯¹ä¸šåŠ¡å±‚çš„httpçš„keep-aliveå‚æ•°çš„å¼€å¯ï¼Œæ¥æš‚æ—¶è§£å†³äº†500å’Œ502çš„é—®é¢˜ï¼Œé‚£èƒ½å¦é€šè¿‡traefikå±‚çš„å‚æ•°æ¥ä¼˜åŒ–è¯¥é—®é¢˜å‘¢ï¼Œä¸Šé¢ç¬¬äºŒä¸ªissueä¸­å…¶å®ä¹Ÿæåˆ°äº†ã€‚&lt;/p&gt;

&lt;p&gt;å³ï¼Œé€šè¿‡ä¿®æ”¹traefikçš„å¦‚ä¸‹å‡ ä¸ªå‚æ•°ï¼Œå¹¶é‡æ–°éƒ¨ç½²æ•´ä¸ªtraefiké›†ç¾¤å³å¯:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å…³é—­traefikçš„keep-aliveå‚æ•°ï¼Œå‚æ•°é»˜è®¤ä¸º200ï¼Œå¦‚æœå‚æ•°ä¸º0ï¼Œåˆ™ä½¿ç”¨goæ ‡å‡†åº“ä¸­çš„DefaultMaxIdleConnsPerHostå‚æ•°
# keep-aliveä¸»è¦æ˜¯ç”¨æ¥å¤ç”¨é“¾æ¥æ¥å‡å°‘open filesçš„ï¼Œä½†æ˜¯å¯¹äºå¤§é‡çš„çŸ­è¿æ¥æ¥å°†è¿™ç§é“¾æ¥å¤ç”¨å°±å¯èƒ½å‡ºç°ä¸Šè¿°æƒ…å†µ
--maxidleconnsperhost=-1 
# å³é€šè¿‡è®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œå¢åŠ ç©ºé—²é“¾æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå¢åŠ è½¬å‘å“åº”çš„è¶…æ—¶æ—¶é—´,é»˜è®¤æ˜¯0æ¬¡
--retry.attempts=10
# è¯¥å‚æ•°å·²ç»æ›¿æ¢ä¸º--respondingtimeouts.idletimeoutå‚æ•°äº†ï¼Œé»˜è®¤ä¸º3m0s
--idletimeout=60s
# é»˜è®¤æ˜¯0s
--forwardingtimeouts.responseheadertimeout=60s

# traefik ç©ºé—²é“¾æ¥è¶…æ—¶
$ ./traefik --help | grep idletimeout
    --idletimeout                                 (Deprecated) maximum amount of time an idle (keep-alive) connection will remain  (default &amp;#34;0s&amp;#34;)
    --respondingtimeouts.idletimeout              IdleTimeout is the maximum amount duration an idle (keep-alive) connection will  (default &amp;#34;3m0s&amp;#34;)

# å“åº”è¶…æ—¶ç›¸å…³å‚æ•°
 $ ./traefik --help | grep respondingtimeouts
    --respondingtimeouts                          Timeouts for incoming requests to the Traefik instance                           (default &amp;#34;true&amp;#34;)
    --respondingtimeouts.idletimeout              IdleTimeout is the maximum amount duration an idle (keep-alive) connection will  (default &amp;#34;3m0s&amp;#34;)
    --respondingtimeouts.readtimeout              ReadTimeout is the maximum duration for reading the entire request, including    (default &amp;#34;0s&amp;#34;)
    --respondingtimeouts.writetimeout             WriteTimeout is the maximum duration before timing out writes of the response.   (default &amp;#34;0s&amp;#34;)


# è½¬å‘çš„è¶…æ—¶
$ ./traefik --help | grep forwardingtimeouts
    --forwardingtimeouts                          Timeouts for requests forwarded to the backend servers                           (default &amp;#34;true&amp;#34;)
    --forwardingtimeouts.dialtimeout              The amount of time to wait until a connection to a backend server can be         (default &amp;#34;30s&amp;#34;)
    --forwardingtimeouts.responseheadertimeout    The amount of time to wait for a server&amp;#39;s response headers after fully writing   (default &amp;#34;0s&amp;#34;)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æœ€ç»ˆä¿®æ”¹åçš„traefikçš„å‚æ•°å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè€ƒè™‘æ˜¯å¦è¦å…³é—­keep-alive å³å¢åŠ å‚æ•°: --maxidleconnsperhost=-1
        - --api
        - --kubernetes
        - --logLevel=INFO
        - --traefikLog.filePath=/logdata/traefik.log
        - --configfile=/config/traefik.toml
        - --accesslog.filepath=/logdata/access.log
        - --accesslog.bufferingsize=100
        - --forwardingtimeouts.responseheadertimeout=60s
        - --respondingtimeouts.idletimeout=180s
        - --retry.attempts=10
        - --idletimeout=180s&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;ä¸‰-slbä¸­è¯¡å¼‚çš„503&#34;&gt;ä¸‰ã€SLBä¸­è¯¡å¼‚çš„503&lt;/h3&gt;

&lt;p&gt;åœ¨å‘ç°åŸŸåç›´æ¥è§£æåˆ°traefikèŠ‚ç‚¹ä¸Šä¸å†å‡ºç°502å’Œ500åï¼Œæˆ‘ä»¬å°†traefikçš„èŠ‚ç‚¹è´Ÿè½½åˆ°æŸäº‘çš„å†…ç½‘slbä¸­ï¼Œä½†æ˜¯åˆå¼€å§‹å‡ºç°äº†è¯¡å¼‚çš„503é—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# client-&amp;gt;ali-slb-&amp;gt;traefik-&amp;gt;pods
$ ab -v 10 -c 200 -n 2000   -T &amp;#39;application/json&amp;#39; -p postfile.json http://data-api.soulapp.cn/get_doc &amp;gt; slb-log.txt
$ cat slb-log.txt | grep  &amp;#39;HTTP/1.1 200&amp;#39; | wc -l
1322
$ cat slb-log.txt | grep  &amp;#39;HTTP/1.1 503&amp;#39; | wc -l
678


# client-&amp;gt;traefik-&amp;gt;pods
$ ab -v 10 -c 200 -n 2000   -T &amp;#39;application/json&amp;#39; -p postfile.json http://data-api.c.bgbiao.cn/get_doc &amp;gt; traefik-log.txt
Completed 200 requests
Completed 400 requests
Completed 600 requests
Completed 800 requests
Completed 1000 requests
Completed 1200 requests
Completed 1400 requests
Completed 1600 requests
Completed 1800 requests
Completed 2000 requests
Finished 2000 requests

$ cat traefik-log.txt  | grep  &amp;#39;HTTP/1.0 200&amp;#39; | wc -l
2000&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&#34;https://help.aliyun.com/knowledge_detail/102765.html?spm=5176.2000002.0.0.1f9641e8ymfAas&#34;&gt;é˜¿é‡Œäº‘TPS-503&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Golangä¸­å¤„ç†ç‰ˆæœ¬ä¿¡æ¯</title>
      <link>https://bgbiao.top/post/golang-version/</link>
      <pubDate>Fri, 26 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/golang-version/</guid>
      
        <description>&lt;h2 id=&#34;golangä¸­çš„ç‰ˆæœ¬ä¿¡æ¯ç®¡ç†&#34;&gt;Golangä¸­çš„ç‰ˆæœ¬ä¿¡æ¯ç®¡ç†&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ä¸€äº›Golangå†™çš„ç¨‹åºä¸­ï¼Œé»˜è®¤ä¼šæœ‰&lt;code&gt;version&lt;/code&gt;æˆ–&lt;code&gt;-v&lt;/code&gt;ç›¸å…³çš„å‚æ•°æ¥è¾“å‡ºè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿™äº›ç‰ˆæœ¬ä¿¡æ¯é‡Œå¯èƒ½åŒ…å«è½¯ä»¶ç‰ˆæœ¬ï¼Œgitä¸­çš„commitè®°å½•ï¼Œæ„å»ºæ—¶é—´ã€æ„å»ºç¯å¢ƒç­‰ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯éƒ½æ˜¯å¦‚ä½•åœ¨Golangç¨‹åºä¸­è¿›è¡Œç»´æŠ¤å’Œç®¡ç†çš„å‘¢ï¼Ÿè¯·çœ‹ğŸ‘‡.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„Golangå¼€å‘çš„ç¨‹åºæ˜¯è¿™æ ·è¾“å‡ºç‰ˆæœ¬ç›¸å…³ä¿¡æ¯çš„:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# k8sçš„å®¢æˆ·ç«¯ç¨‹åºç‰ˆæœ¬
$ kubectl version -o json --client
{
  &amp;#34;clientVersion&amp;#34;: {
    &amp;#34;major&amp;#34;: &amp;#34;1&amp;#34;,
    &amp;#34;minor&amp;#34;: &amp;#34;10&amp;#34;,
    &amp;#34;gitVersion&amp;#34;: &amp;#34;v1.10.11&amp;#34;,
    &amp;#34;gitCommit&amp;#34;: &amp;#34;637c7e288581ee40ab4ca210618a89a555b6e7e9&amp;#34;,
    &amp;#34;gitTreeState&amp;#34;: &amp;#34;clean&amp;#34;,
    &amp;#34;buildDate&amp;#34;: &amp;#34;2018-11-26T14:38:32Z&amp;#34;,
    &amp;#34;goVersion&amp;#34;: &amp;#34;go1.9.3&amp;#34;,
    &amp;#34;compiler&amp;#34;: &amp;#34;gc&amp;#34;,
    &amp;#34;platform&amp;#34;: &amp;#34;darwin/amd64&amp;#34;
  }
}

# dockerçš„å®¢æˆ·ç«¯ç¨‹åºç‰ˆæœ¬
$ docker version
Client: Docker Engine - Community
 Version:           18.09.2
 API version:       1.39
 Go version:        go1.10.8
 Git commit:        6247962
 Built:             Sun Feb 10 04:12:39 2019
 OS/Arch:           darwin/amd64
 Experimental:      false

# minioçš„å®¢æˆ·ç«¯ç¨‹åºç‰ˆæœ¬
$ minio --version
minio version RELEASE.2020-04-10T03-34-42Z&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ç‰ˆæœ¬è¾“å‡ºè®°å½•ä¸­æˆ‘ä»¬å…¶å®å¯ä»¥çœ‹å‡ºï¼Œç‰ˆæœ¬ä¿¡æ¯ä¸­ä¸ä»…è®°å½•äº†åŸºæœ¬çš„æ„å»ºç¯å¢ƒå’Œç‰ˆæœ¬ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜è®°å½•äº†commitIdï¼Œæ‰€ä»¥è¿™äº›ä¿¡æ¯åº”è¯¥æ˜¯åœ¨buildæ—¶åŠ¨æ€ä¼ å…¥åˆ°ç¨‹åºä¸­çš„ï¼Œå¤§æ¦‚çŒœæµ‹ä¸€ä¸‹åº”è¯¥å°±æ˜¯æå‰åœ¨ç¨‹åºçš„versionç›¸å…³ä»£ç ä¸­é¢„ç•™å¥½ç‰ˆæœ¬ç›¸å…³çš„å˜é‡ï¼Œç„¶ååœ¨æ„å»ºçš„æ—¶å€™å¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œä»¥æ­¤æ¥å®ç°å˜é‡çš„åŠ¨æ€æ³¨å…¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å°è¯•ç‰›åˆ€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å¤§æ¦‚çŒœæµ‹åï¼ŒæŸ¥çœ‹åˆ°ç›¸å…³æ–‡æ¡£ä¸­æœ‰è¯´æ˜å¯ä»¥åœ¨æ„å»ºæ—¶ä½¿ç”¨å‚æ•°&lt;code&gt;-ldflags -X importpath.name=value&lt;/code&gt;æ¥åŠ¨æ€æ³¨å…¥å˜é‡ã€‚åœ¨å®˜æ–¹ç¨³å®š&lt;a href=&#34;https://golang.org/cmd/link/&#34;&gt;link&lt;/a&gt;ä¸­æœ‰è¯¦ç»†è¯´æ˜:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;-X importpath.name=value
	Set the value of the string variable in importpath named name to value.
	This is only effective if the variable is declared in the source code either uninitialized
	or initialized to a constant string expression. -X will not work if the initializer makes
	a function call or refers to other variables.
	Note that before Go 1.5 this option took two separate arguments.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å¤§æ¦‚æ„æ€å°±æ˜¯: å¯ä»¥è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡å€¼ç»™importpathè·¯å¾„ä¸‹çš„nameã€‚è€Œä¸”ä»…å½“å­—ç¬¦ä¸²å˜é‡åœ¨æºç ä¸­æ²¡æœ‰åˆå§‹åŒ–æˆ–åˆå§‹åŒ–æˆå¸¸é‡å­—ç¬¦ä¸²è¡¨è¾¾å¼æ—¶æ‰æœ‰æ•ˆã€‚å¦‚æœåˆå§‹åŒ–å˜é‡è°ƒç”¨äº†å‡½æ•°æˆ–è€…å¼•ç”¨äº†å…¶ä»–å˜é‡ï¼Œ&lt;code&gt;-X&lt;/code&gt;å‚æ•°ä¹Ÿä¸ä¼šå·¥ä½œã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‚æ•°ç»™æºç ä¸­åŠ¨æ€ä¼ å…¥ä¸€äº›ç®€å•çš„å­—ç¬¦ä¸²å˜é‡ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç®€å•è¯•ç”¨ä¸€ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cat&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; 
&lt;span class=&#34;nx&#34;&gt;cat&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;		&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buildTime&lt;/span&gt;	&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;osArch&lt;/span&gt;		&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Version: %s\nBuilt: %s\nOS/Arch: %s\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buildTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;osArch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ç›´æ¥è¿è¡Œ&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;run&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Built&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;OS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Arch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ä½¿ç”¨&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ldflags&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;X&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;importpath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nameå‚æ•°æ³¨å…¥å˜é‡&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;run&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ldflags&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-X &amp;#39;main.version=0.1&amp;#39; -X &amp;#39;main.buildTime=2020-06-26&amp;#39; -X &amp;#39;main.osArch=darwin/amd64&amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.1&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Built&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2020&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mo&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;26&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;OS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Arch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;darwin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amd64&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ä½¿ç”¨å‚æ•°ç¼–è¯‘åˆ°äºŒè¿›åˆ¶ç¨‹åºä¸­&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;build&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ldflags&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-X &amp;#39;main.version=0.1&amp;#39; -X &amp;#39;main.buildTime=2020-06-26&amp;#39; -X &amp;#39;main.osArch=darwin/amd64&amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Golang&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.1&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Built&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2020&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mo&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;26&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;OS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Arch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;darwin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amd64&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å¦‚ä¸Šç¤ºä¾‹ä¸­ç®€å•æ¼”ç¤ºäº†ï¼Œå¦‚ä½•åœ¨æ„å»ºæ—¶ï¼Œç»™ç¨‹åºæ³¨å…¥ä¸€äº›ç‰ˆæœ¬ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ¯æ¬¡å‘ç‰ˆæ—¶ï¼Œå°±å¯ä»¥æ ¹æ®å½“å‰çš„ç‰ˆæœ¬ã€ç¯å¢ƒã€æ„å»ºç­‰ä¿¡æ¯ä¸ºç¨‹åºæ³¨å…¥ä¸€ä¸ªè¯¦ç»†çš„ç‰ˆæœ¬ä¿¡æ¯äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é¡¹ç›®ä¸­ä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šé¢åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ç”¨æ¥æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨&lt;code&gt;-ldflags -X importpath.name=value&lt;/code&gt;å‚æ•°æ¥ç»™ç¨‹åºåŠ¨æ€æ³¨å…¥ä¸€äº›å˜é‡å€¼ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦ç»´æŠ¤ä¸€ä¸ªç›¸å¯¹å…¨é¢å’Œé€šç”¨çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥ä¸€èµ·çœ‹çœ‹é¡¹ç›®ä¸­å¤§æ¦‚ä¼šå¦‚ä½•ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;é¦–å…ˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;åœ¨é¡¹ç›®ä¸­ç»´æŠ¤ä¸€ä¸ªversion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;goçš„æ–‡ä»¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ç”¨äºå®šä¹‰ç‰ˆæœ¬ç›¸å…³çš„ä¿¡æ¯&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cat&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utils&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utils&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gitBranch&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gitTag&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gitCommit&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gitTreeState&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buildDate&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Info&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;version&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;GitBranch&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;gitBranch&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;GitTag&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;gitTag&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;GitCommit&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;gitCommit&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;GitTreeState&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;gitTreeState&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;BuildDate&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;buildDate&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;GoVersion&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;goVersion&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;Compiler&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;compiler&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;Platform&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;platform&amp;#34;`&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;info&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GitCommit&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Info&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;GitBranch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;gitBranch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;GitTag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;gitTag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;GitCommit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;gitCommit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;GitTreeState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gitTreeState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;BuildDate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;buildDate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;GoVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;Compiler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Compiler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;Platform&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s/%s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GOOS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GOARCH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ç„¶åå¯ä»¥åœ¨mainç¨‹åºä¸­&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å¯¹versionå­å‘½ä»¤çš„è¾“å‡ºè°ƒç”¨utils&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å‡½æ•°&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cat&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;

	&lt;span class=&#34;s&#34;&gt;&amp;#34;version/utils&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utils&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Version: %s\nGitBranch: %s\nCommitId: %s\nBuild Date: %s\nGo Version: %s\nOS/Arch: %s\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GitBranch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GitCommit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;BuildDate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GoVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Platform&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Version(hard code): %s\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;build&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ldflags&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-X &amp;#39;version/utils.version=0.1&amp;#39; -X &amp;#39;version/utils.gitBranch=test&amp;#39; -X &amp;#39;version/utils.gitTag=test&amp;#39; -X &amp;#39;version/utils.gitCommit=test&amp;#39; -X &amp;#39;version/utils.buildDate=2020-06-26&amp;#39; -X &amp;#39;version/utils.osArch=darwin/amd64&amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; 

&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;span class=&#34;nf&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hard&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.1&lt;/span&gt;


&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.1&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;GitBranch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;test&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;CommitId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;test&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Build&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2020&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mo&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;26&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;go1&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.14&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;OS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Arch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;darwin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amd64&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å¯¹ç¨‹åºä¸­çš„ç‰ˆæœ¬ä¿¡æ¯è¿›è¡ŒåŠ¨æ€ç»´æŠ¤å’Œç®¡ç†äº†ï¼Œä½†æ˜¯æ¯æ¬¡æ‰‹åŠ¨ç»´æŠ¤ç‰ˆæœ¬ä¿¡æ¯è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤å¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨è„šæœ¬æˆ–è€…&lt;code&gt;Makefile&lt;/code&gt;æ¥å¯¹æ„å»ºå‚æ•°è¿›è¡Œç»Ÿä¸€ç®¡ç†.&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å†å¢åŠ &lt;code&gt;Makefile&lt;/code&gt;æ¥ç®¡ç†å‚æ•°.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ cat Makefile 
.PHONY: list vet fmt default clean
all: list vet fmt default clean
BINARY=&amp;#34;version&amp;#34;
VERSION=0.0.1
BUILD=`date +%F`
SHELL := /bin/bash
BASEDIR = $(shell pwd)

# build with verison infos
versionDir=&amp;#34;version/utils&amp;#34;
gitTag=$(shell if [ &amp;#34;`git describe --tags --abbrev=0 2&amp;gt;/dev/null`&amp;#34; != &amp;#34;&amp;#34; ];then git describe --tags --abbrev=0; else git log --pretty=format:&amp;#39;%h&amp;#39; -n 1; fi)
gitBranch=$(shell git rev-parse --abbrev-ref HEAD)
buildDate=$(shell TZ=Asia/Shanghai date +%FT%T%z)
gitCommit=$(shell git rev-parse --short HEAD)
gitTreeState=$(shell if git status|grep -q &amp;#39;clean&amp;#39;;then echo clean; else echo dirty; fi)

ldflags=&amp;#34;-s -w -X ${versionDir}.gitTag=${gitTag} -X ${versionDir}.buildDate=${buildDate} -X ${versionDir}.gitCommit=${gitCommit} -X ${versionDir}.gitTreeState=${gitTreeState} -X ${versionDir}.version=${VERSION} -X ${versionDir}.gitBranch=${gitBranch}&amp;#34;


default:
	@echo &amp;#34;build the ${BINARY}&amp;#34;
	@GOOS=linux GOARCH=amd64 go build -ldflags ${ldflags} -o  build/${BINARY}.linux  -tags=jsoniter
	@go build -ldflags ${ldflags} -o  build/${BINARY}.mac  -tags=jsoniter
	@echo &amp;#34;build done.&amp;#34;



# æ„å»ºæµ‹è¯•
$ make default
build the version
build done.

$ ./build/version.mac
Version(hard code): 0.1

$ ./build/version.mac version
Version: 0.0.1
GitBranch: master
CommitId: c1702a8
Build Date: 2020-06-27T13:32:42+0800
Go Version: go1.14
OS/Arch: darwin/amd64 &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç»†å¿ƒçš„å°ä¼™ä¼´ä»¬æœ‰æ²¡æœ‰å‘ç°ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„ç‰ˆæœ¬è¾“å‡ºä¿¡æ¯å’Œå‰é¢&lt;code&gt;docker&lt;/code&gt;ä»¥åŠ&lt;code&gt;kubectl&lt;/code&gt;ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯æœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢ç›¸ä¼¼äº†ï¼Œå…¶å®ç›®å‰å¤§å¤šæ•°ä½¿ç”¨Golangå¼€æºçš„ç¨‹åºåŸºæœ¬ä¸Šä¹Ÿéƒ½æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼æ¥ç®¡ç†ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯çš„ï¼Œæ¯”å¦‚&lt;code&gt;kubectl&lt;/code&gt;ä¸­çš„versionå‘½ä»¤:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/kubectl/blob/master/pkg/cmd/version/version.go#L38&#34;&gt;kubectl-version&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/apimachinery/blob/master/pkg/version/types.go&#34;&gt;kubernetes-apimachinery&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œæˆ‘æ”¾åˆ°äº†&lt;a href=&#34;https://github.com/goops-top/version&#34;&gt;go-version&lt;/a&gt;ä¸­äº†ï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥å»çœ‹çœ‹ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Kafkaè¿ç»´ç¥å™¨ä¹‹gokafka</title>
      <link>https://bgbiao.top/post/gokafka/</link>
      <pubDate>Fri, 26 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/gokafka/</guid>
      
        <description>&lt;h2 id=&#34;kafkaè¿ç»´ç¥å™¨&#34;&gt;Kafkaè¿ç»´ç¥å™¨&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;åœ¨Kafkaé›†ç¾¤è¿ç»´è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå€Ÿç”¨ä¸€äº›å¼€æºå·¥å…·æ¥å®Œæˆkafkaçš„æ—¥å¸¸è¿ç»´éœ€æ±‚å’Œç›¸å…³é—®é¢˜æ’æŸ¥ï¼Œæ¥ä¸‹æ¥ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„kafkaè¿ç»´ç¥å™¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;kafka-manager&#34;&gt;kafka-manager&lt;/h3&gt;

&lt;p&gt;ç”±é›…è™å¼€æºçš„kafkaé›†ç¾¤ç®¡ç†å·¥å…·ï¼Œä¸è¿‡ç°åœ¨å·²ç»æ”¹åä¸º&lt;a href=&#34;https://github.com/yahoo/CMAK&#34;&gt;CMAK&lt;/a&gt;äº†(è¯´æ˜kafkaçš„è¿ç»´ç—›ç‚¹è¿˜æ˜¯è›®å¤šçš„ï¼Œé¡¹ç›®è¿˜å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…)ï¼Œæ ¸å¿ƒåŠŸèƒ½å¦‚ä¸‹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¤šé›†ç¾¤ç®¡ç†&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç¬æ—¶ç›‘æ§(topics, brokers, å‰¯æœ¬åˆ†å¸ƒï¼Œåˆ†åŒºåˆ†å¸ƒç­‰)&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆå‰¯æœ¬é€‰ä¸¾&lt;/li&gt;
&lt;li&gt;ä¸»é¢˜ï¼Œåˆ†åŒºï¼Œå‰¯æœ¬ç®¡ç†(ä¸»é¢˜åˆ›å»ºå’Œå‚æ•°è°ƒæ•´ï¼Œå‰¯æœ¬åˆ†é…ç­‰)&lt;/li&gt;
&lt;li&gt;Brokerå’ŒTopicçº§åˆ«çš„metricsç›‘æ§&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ¶ˆè´¹è€…åŸºæœ¬ä¿¡æ¯ç®¡ç†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æºç ç¼–è¯‘
$ ./sbt clean dist

# docker å®‰è£…
$ docker run -itd --name kafka-manager -e KAFKA_ZK_CLUSTER=&amp;#34;zk-1:2181,zk-2:2181&amp;#34; -P      bgbiao/kafka-manager:2.0.0.2 
# è‡ªå®šä¹‰ç«¯å£
$ docker run -itd --name kafka-manager -e KAFKA_ZK_CLUSTER=&amp;#34;zk-1:2181,zk-2:2181&amp;#34; -P      bgbiao/kafka-manager:2.0.0.2 -Dhttp.port=8080 &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg6v0rydqhj30xu0kkdhd.jpg&#34; alt=&#34;kafka-cluster&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg6v0uopt4j30v90epac2.jpg&#34; alt=&#34;kafka-topic&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg6v1kai7sj30w50oc429.jpg&#34; alt=&#34;kafka-topic-info&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg6v1ziityj30k708kt9i.jpg&#34; alt=&#34;kafka-consumer&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg6v2i5kt5j30qe0pxgpq.jpg&#34; alt=&#34;kafka-consumer-info&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg6v34efi2j31rm0nbtdv.jpg&#34; alt=&#34;kafka-broker&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg6v3ivpuqj31bi0u0dnn.jpg&#34; alt=&#34;kafka-broker-info&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;kafkacat&#34;&gt;kafkacat&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/edenhill/kafkacat&#34;&gt;kafkacat&lt;/a&gt;æ˜¯ä¸€ä¸ªéJVMçš„å‘½ä»¤è¡Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œå¯ä»¥å¿«é€Ÿçš„å¯¹kafkaæ¶ˆæ¯è¿›è¡Œç”Ÿäº§å’Œæ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# mac å®‰è£…
$ brew install kafkacat 

# docker å®‰è£…
# å®˜æ–¹ä»…æ”¯æŒDebianå’ŒopenSUSEç³»åˆ—
# å¦‚ä¸‹é•œåƒæ”¯æŒåœ¨CentOSç³»åˆ—çš„ç¯å¢ƒä¸­ä½¿ç”¨
$ docker pull bgbiao/kafkacat &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æ¶ˆè´¹è€…æ¨¡å¼
$ kafkacat -b localhost:9092 -t mysql_users
% Auto-selecting Consumer mode (use -P or -C to override)
{&amp;#34;uid&amp;#34;:1,&amp;#34;name&amp;#34;:&amp;#34;Cliff&amp;#34;,&amp;#34;locale&amp;#34;:&amp;#34;en_US&amp;#34;,&amp;#34;address_city&amp;#34;:&amp;#34;St Louis&amp;#34;,&amp;#34;elite&amp;#34;:&amp;#34;P&amp;#34;}
{&amp;#34;uid&amp;#34;:2,&amp;#34;name&amp;#34;:&amp;#34;Nick&amp;#34;,&amp;#34;locale&amp;#34;:&amp;#34;en_US&amp;#34;,&amp;#34;address_city&amp;#34;:&amp;#34;Palo Alto&amp;#34;,&amp;#34;elite&amp;#34;:&amp;#34;G&amp;#34;}
[...]

# ç”Ÿäº§è€…æ¨¡å¼
# é»˜è®¤æ˜¯ä»¥æ¢è¡Œç¬¦æ¥å†³å®šä¸€æ¡æ¶ˆæ¯(-D å¯ä»¥æŒ‡å®šåˆ†éš”ç¬¦)
# é»˜è®¤ä»stdinæ¥è¯»å–æ¶ˆæ¯
$ kafkacat -b localhost:9092 -t new_topic -P
test

# ä»æ–‡ä»¶ä¸­è¯»å–æ¶ˆæ¯
# -lå‚æ•°ç”¨æ¥æŒ‡å®šå°†æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªè¡Œä½œä¸ºä¸€ä¸ªæ¶ˆæ¯è¿›è¡Œå‘é€ï¼Œå¦‚æœæ²¡æœ‰è¯¥å‚æ•°ï¼Œæ•´ä¸ªæ–‡æœ¬å°†ä¼šä»¥ä¸€ä¸ªæ¶ˆæ¯å‘é€(å¯¹äºäºŒè¿›åˆ¶çš„æ•°æ®æ¯”è¾ƒ
æœ‰ç”¨)
# -T å‚æ•°å¯ä»¥ç”¨äºå›æ˜¾åˆ°stdout
$ kafkacat -b localhost:9092 -t &amp;lt;my_topic&amp;gt; -T -P -l /tmp/msgs


# å¯ä»¥æŒ‡å®šæ¶ˆæ¯çš„keyï¼Œä½¿ç”¨-Kå‚æ•°
$ kafkacat -b localhost:9092 -t keyed_topic -P -K:
1:foo
2:bar

$ kafkacat -b localhost:9092 -t keyed_topic -C -f &amp;#39;Key: %k\nValue: %s\n&amp;#39;
Key: 1
Value: foo
Key: 2
Value: bar

# è®¾ç½®partition
$ kafkacat -b localhost:9092 -t partitioned_topic -P -K: -p 1
1:foo

$ kafkacat -b localhost:9092 -t partitioned_topic -P -K: -p 2
2:bar

$ kafkacat -b localhost:9092 -t partitioned_topic -P -K: -p 3
3:wibble


# å…ƒæ•°æ®ç›‘å¬æ¨¡å¼
# å…ƒæ•°æ®çš„ç›‘å¬æ¨¡å¼å¯ä»¥ä½¿ç”¨`-L`å‚æ•°ï¼Œä¼šæ˜¾ç¤ºå½“å‰kafkaé›†ç¾¤çš„çŠ¶æ€ä»¥åŠä¸»é¢˜ï¼Œåˆ†åŒºï¼Œå‰¯æœ¬ï¼Œä»¥åŠISRä¿¡æ¯ã€‚
# `-J`å‚æ•°ä¼šä»¥jsonæ ¼å¼è¿›è¡Œè¾“å‡º
$ kafkacat -b localhost:9092 -L

$ kafkacat -b mybroker -L -J



# dockeræ–¹å¼ç®€å•ä½¿ç”¨
# ä»æ ‡å‡†è¾“å…¥ç”Ÿäº§æ•°æ®
$ docker run --rm bgbiao/kafkacat kafkacat -b kafka-broker:9092 -t test-biao -P &amp;lt;&amp;lt;EOF
&amp;gt; ssabdkgjf
&amp;gt; asfgnh
&amp;gt; wertnh
&amp;gt; waer
&amp;gt; awegrtn
&amp;gt; 2020-04-26
&amp;gt; end time
&amp;gt; EOF

# ä»æŒ‡å®štopicæ¥æ”¶æ•°æ®
$ docker run -it --rm bgbiao/kafkacat kafkacat -b kafka-broker:9092 -t test-biao -C -f &amp;#39;\nKey (%K bytes): %k\t\nValue (%S bytes): %s\n\Partition: %p\tOffset: %o\n--\n&amp;#39;

Key (-1 bytes):
Value (13 bytes): test kafkacat
Partition: 0	Offset: 11
--
% Reached end of topic test-biao [0] at offset 12

Key (-1 bytes):
Value (18 bytes): 2020-04-26 endtime
Partition: 1	Offset: 8
--
% Reached end of topic test-biao [1] at offset 9

Key (-1 bytes):
Value (7 bytes): overlay
Partition: 2	Offset: 6
--
% Reached end of topic test-biao [2] at offset 7&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¦‚æœæƒ³è¦æŠŠdockeré•œåƒä¸­çš„&lt;code&gt;kafkacat&lt;/code&gt;äºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´å‡ºæ¥ä½¿ç”¨ï¼Œä»…éœ€è¦åœ¨å½“å‰ç¯å¢ƒä¸­å®‰è£…&lt;code&gt;librdkafka-devel&lt;/code&gt;å³å¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;gokafka&#34;&gt;gokafka&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/goops-top/gokafka&#34;&gt;gokafka&lt;/a&gt;ä¹Ÿæ˜¯ä¸€ä¸ªéJVMçš„kafkaè¿ç»´ç®¡ç†å·¥å…·ï¼Œä¸ä»…å¯ä»¥è¿›è¡Œç®€å•çš„æ¶ˆæ¯æ¨¡æ‹Ÿç”Ÿäº§ï¼Œè€Œä¸”å¯ä»¥å¯¹æŒ‡å®štopicè¿›è¡Œæ¶ˆæ¯é¢„è§ˆï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒkafkaé›†ç¾¤çš„å¸¸è§çš„è¿ç»´ç®¡ç†æ“ä½œ.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¿«é€Ÿå¼€å§‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ git clone https://github.com/goops-top/gokafka.git
$ cd gokafka
$ go build -o build/goops-kafka

$ ./build/goops-kafka
goops-kafka: A kafka tools with golang that can operate the kafka for describe,create,update and so on.

 Note: Without the jvm,so you must be specify the [--broker or --cluster and the Value must be in --config entry.]

Usage:
  gokafka [command]

Available Commands:
  consumer    consumer  a topic message data with specified kafka-cluster.
  create      create the kafka topic with some base params in specify kafka-cluster.
  describe    describe the kafka some info (cluster,topic,broker,loginfo)
  help        Help about any command
  init        init the gokafka some default config.
  list        list the kafka some info (cluster,topic,broker)
  producer    producer  a topic message data with specified kafka-cluster.
  version     print version info of goops-kafka tool

Flags:
      --broker string    æŒ‡å®šbrokeråœ°å€
      --cluster string   æŒ‡å®šé›†ç¾¤
      --config string    æŒ‡å®šé…ç½®æ–‡ä»¶(default is $HOME/.goops-kafka)
  -h, --help             help for gokafka

Use &amp;#34;gokafka [command] --help&amp;#34; for more information about a command.

# ä½¿ç”¨makeç¼–è¯‘
# ä¼šè‡ªåŠ¨ç”Ÿæˆmacå’Œlinuxå‘è¡Œç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶
$ make default&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;ç®€å•ä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æŸ¥çœ‹å·¥å…·ç‰ˆæœ¬
$ ./build/gokafka.mac version
Version: 0.0.1
GitBranch: master
CommitId: 445f935
Build Date: 2020-06-26T18:49:48+0800
Go Version: go1.14
OS/Arch: darwin/amd64

# åˆå§‹åŒ–é…ç½®æ–‡ä»¶
# gokafka é‡‡ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼å¿«é€Ÿç®¡ç†å¤šä¸ªkafkaé›†ç¾¤
$ ./build/gokafka.mac  init
gokafka config init ok.

# åœ¨ç”¨æˆ·å®¶ç›®å½•ä¸‹ç”Ÿæˆé›†ç¾¤é…ç½®æ–‡ä»¶
$ cat ~/.goops-kafka

app: gokafka
spec:
  clusters:
  - name: test-kafka
    version: V2_5_0_0
    brokers:
    - 10.0.0.1:9092
    - 10.0.0.2:9092
    - 10.0.0.3:9092
  - name: dev-kafka
    version: V1_0_0_0
    brokers:
    - 192.168.0.22:9092
    - 192.168.0.23:9092
    - 192.168.0.24:9092

# ä¹Ÿå¯ä»¥ä½¿ç”¨--config æ¥æŒ‡å®šé›†ç¾¤é…ç½®æ–‡ä»¶
$ ./build/gokafka.mac  --config ./kafka-cluster.yaml version
Version: 0.0.1
GitBranch: master
CommitId: 445f935
Build Date: 2020-06-26T18:53:25+0800
Go Version: go1.14
OS/Arch: darwin/amd64

# æŸ¥çœ‹é…ç½®æ–‡ä»¶ä¸­çš„é›†ç¾¤è¯¦æƒ…
$ ./build/gokafka.mac  list cluster
cluster:test-kafka version:V2_5_0_0 connector_brokers:[10.0.0.1:9092]
cluster:dev-kafka version:V1_0_0_0 connector_brokers:[192.168.0.22:9092]

./build/gokafka.mac  list cluster --config ./kafka-cluster.yaml
cluster:log-kafka version:V2_5_0_0 connector_brokers:[log-kafka-1.bgbiao.cn:9092]

# æ³¨æ„: å½“ä½¿ç”¨é›†ç¾¤é…ç½®æ–‡ä»¶ç®¡ç†é›†ç¾¤æ—¶ï¼Œéœ€è¦ä½¿ç”¨--clusterå…¨å±€å‚æ•°æŒ‡å®šæ“ä½œçš„ç›®æ ‡é›†ç¾¤
# å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šbrokerè¿›è¡Œæ“ä½œ
$ ./build/gokafka.mac  --cluster dev-kafka describe broker
controller: 3
brokers num: 3
broker list: [2 1 3]
id:2		 broker:192.168.0.22:9092
id:1		 broker:192.168.0.23:9092
id:3		 broker:192.168.0.24:9092

$ ./build/gokafka.mac  --broker 10.0.0.1:9092  describe broker
controller: 3
brokers num: 3
broker list: [2 1 3]
id:2		 broker:192.168.0.22:9092
id:1		 broker:192.168.0.23:9092
id:3		 broker:192.168.0.24:9092&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;å¸¸ç”¨åŠŸèƒ½&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;98
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# 1.åˆ›å»ºtopic
# å¯ä»¥æŒ‡å®šåˆ†åŒºå’Œå‰¯æœ¬æ•°
$ ./build/gokafka.mac  --cluster dev-kafka create --topic test-bgbiao-1
true


# 2.æŸ¥çœ‹topic
$ ./build/gokafka.mac  --cluster dev-kafka list topic --topic-list test-bgbiao-1
Topic:test-bgbiao-1	PartNum:3	Replicas:3	Config:
Topic-Part:test-bgbiao-1-2	ReplicaAssign:[1 3 2]
Topic-Part:test-bgbiao-1-1	ReplicaAssign:[2 1 3]
Topic-Part:test-bgbiao-1-0	ReplicaAssign:[3 2 1]

# 3.è·å–topicçš„åˆ†åŒºå’Œå‰¯æœ¬çŠ¶æ€
$ ./build/gokafka.mac  --cluster dev-kafka describe  topic --topic-list test-bgbiao-1
Topic-Part:test-bgbiao-1-2	Leader:1	Replicas:[1 3 2]	ISR:[1 3 2]	OfflineRep:[]
Topic-Part:test-bgbiao-1-1	Leader:2	Replicas:[2 1 3]	ISR:[2 1 3]	OfflineRep:[]
Topic-Part:test-bgbiao-1-0	Leader:3	Replicas:[3 2 1]	ISR:[3 2 1]	OfflineRep:[]

# 4.å‘topicä¸­ç”Ÿäº§æ¶ˆæ¯
$ ./build/gokafka.mac  --cluster dev-kafka producer --topic test-bgbiao-1 --msg &amp;#34;Hello, BGBiao.&amp;#34;
INFO[0000] Produce msg:Hello, BGBiao. to topic:test-bgbiao-1
INFO[0000] topic:test-bgbiao-1 send ok with offset:0

$ ./build/gokafka.mac  --cluster dev-kafka producer --topic test-bgbiao-1 --msg &amp;#34;Nice to meet you.&amp;#34;
INFO[0000] Produce msg:Nice to meet you. to topic:test-bgbiao-1
INFO[0000] topic:test-bgbiao-1 send ok with offset:0

# 5.æ¶ˆè´¹æ¶ˆæ¯(gokafkaä¸­åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„æ¶ˆè´¹ç»„ç”¨æ¥é¢„è§ˆæ¶ˆæ¯)
# åœ¨ç»ˆç«¯è¿›è¡Œå®æ—¶æ¶ˆè´¹ï¼Œctrl+c å¯å–æ¶ˆ
$ ./build/gokafka.mac  --cluster dev-kafka consumer --topic test-bgbiao-1
INFO[0000] Sarama consumer up and running!...
INFO[0004] part:2 offset:0
msg: Nice to meet you.
INFO[0004] part:1 offset:0
msg: Hello, BGBiao.

# 6.æŸ¥çœ‹é›†ç¾¤çš„brokeråˆ—è¡¨ä»¥åŠcontroller
$ ./build/gokafka.mac  --cluster dev-kafka describe broker
controller: 3
brokers num: 3
broker list: [2 1 3]
id:2		 broker:192.168.0.23:9092
id:1		 broker:192.168.0.22:9092
id:3		 broker:192.168.0.24:9092

# 7.æŸ¥çœ‹topicçš„æ—¥å¿—å¤§å°
$ ./build/gokafka.mac  --cluster dev-kafka describe loginfo --topic-list test-bgbiao-1
topic:test-bgbiao-1
172.16.32.23:9092
logdir:/soul/data/kafka/kafka-logs
topic-part		log-size(M)		offset-lag
----------		-----------		----------
test-bgbiao-1-0		0		0
test-bgbiao-1-1		0		0
test-bgbiao-1-2		0		0
172.16.32.22:9092
logdir:/soul/data/kafka/kafka-logs
topic-part		log-size(M)		offset-lag
----------		-----------		----------
test-bgbiao-1-0		0		0
test-bgbiao-1-1		0		0
test-bgbiao-1-2		0		0
172.16.32.24:9092
logdir:/soul/data/kafka/kafka-logs
topic-part		log-size(M)		offset-lag
----------		-----------		----------
test-bgbiao-1-0		0		0
test-bgbiao-1-1		0		0
test-bgbiao-1-2		0		0

# 8.åˆ—å‡ºkafkaé›†ç¾¤çš„æ¶ˆè´¹è€…ç»„
$ ./build/gokafka.mac  --cluster dev-kafka list  consumer-g | grep -i gokafka
GoKafka

# 9.æŸ¥çœ‹æ¶ˆè´¹è€…ç»„è¯¦ç»†ä¿¡æ¯
# å› ä¸ºä¸Šé¢æˆ‘ä»¬åœæ­¢äº†æ¶ˆè´¹ï¼Œè¯¥æ¶ˆè´¹è€…ç»„å½“å‰æ˜¯ç©ºçš„
$ ./build/gokafka.mac  --cluster dev-kafka describe consumer-g --consumer-group-list GoKafka
--------------------------------------------------------------------------------------------
consumer-group:GoKafka consumer-state:Empty

# æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæœ‰å®é™…æ¶ˆè´¹çŠ¶æ€çš„æ¶ˆè´¹è€…ç»„
# å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸‹çš„å…¨éƒ¨æ¶ˆè´¹è€…çº¿ç¨‹ä»¥åŠæ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆè´¹çš„å¯¹åº”çš„topicåˆ—è¡¨
$ ./build/gokafka.mac  --cluster dev-kafka describe consumer-g --consumer-group-list group-sync
--------------------------------------------------------------------------------------------
consumer-group:group-sync consumer-state:Stable
consumer-id					consumer-ip			topic-list
consumer-1-a9437739-e5cb-4b41-a9d3-2640b9878965	/172.16.64.207		[sync-dev]
consumer-1-92eb690b-d327-468b-8990-9c21e1ee405d	/172.16.32.235		[sync-dev]


# 10. è¿˜å¯ä»¥æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹è€…ç»„æ¶ˆè´¹æŸä¸ªtopicçš„æ—¥å¿—è¯¦æƒ…
$ ./build/gokafka.mac  --cluster dev-kafka describe consumer-group-offset --group group-sync --topic sync-dev
sync-dev
topic-part:sync-dev-0 log-offsize:98
topic-part:sync-dev-1 log-offsize:0
topic-part:sync-dev-2 log-offsize:340
topic-part:sync-dev-3 log-offsize:261&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Kafkaåœ¨Zookeeperä¸­çš„å­˜å‚¨ç»“æ„</title>
      <link>https://bgbiao.top/post/kafka%E5%9C%A8zookeeper%E4%B8%AD%E7%9A%84%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/</link>
      <pubDate>Sun, 21 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/kafka%E5%9C%A8zookeeper%E4%B8%AD%E7%9A%84%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè‡ªä»Kafkaè¯ç”Ÿä¹‹é™…ï¼Œå°±ä¸€ç›´ä½¿ç”¨ZookeeperæœåŠ¡æ¥è¿›è¡Œkafkaé›†ç¾¤çš„å…ƒæ•°æ®å’ŒçŠ¶æ€ç®¡ç†ï¼Œè™½ç„¶åœ¨&lt;a href=&#34;https://cwiki.apache.org/confluence/display/KAFKA/KIP-500%3A+Replace+ZooKeeper+with+a+Self-Managed+Metadata+Quorum&#34;&gt;KIP-500&lt;/a&gt;ä¸­æœ‰æè®®æœªæ¥å°†ç§»é™¤Zookeeperçš„ä¾èµ–ï¼Œä½¿ç”¨Raftåè®®æ¥å®ç°æ–°çš„å…ƒæ•°æ®å’ŒçŠ¶æ€ç®¡ç†ï¼Œä½†åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å¯¹kafkaé›†ç¾¤çš„æ•´ä¸ªå…ƒæ•°æ®å’ŒçŠ¶æ€æœ‰ä¸€å®šç†è§£ï¼Œæ‰èƒ½æ›´å¥½çš„ç»´æŠ¤å’Œä¿éšœkafkaé›†ç¾¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;åœ¨kafkaé›†ç¾¤ä¸­ï¼ŒZooKeeperé›†ç¾¤ç”¨äº&lt;code&gt;å­˜æ”¾é›†ç¾¤å…ƒæ•°æ®&lt;/code&gt;ã€&lt;code&gt;æˆå‘˜ç®¡ç†&lt;/code&gt;ã€&lt;code&gt;Controller é€‰ä¸¾&lt;/code&gt;ï¼Œä»¥åŠå…¶ä»–ä¸€äº›&lt;code&gt;ç®¡ç†ç±»ä»»åŠ¡&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;å­˜æ”¾å…ƒæ•°æ®&lt;/code&gt;: æ˜¯æŒ‡ä¸»é¢˜åˆ†åŒºçš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨ ZooKeeper ä¸­ï¼Œä¸”ä»¥å®ƒä¿å­˜çš„æ•°æ®ä¸ºæƒå¨ï¼Œå…¶ä»–â€œäººâ€ éƒ½è¦ä¸å®ƒä¿æŒå¯¹é½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;æˆå‘˜ç®¡ç†&lt;/code&gt;: æ˜¯æŒ‡ Broker èŠ‚ç‚¹çš„æ³¨å†Œã€æ³¨é”€ä»¥åŠå±æ€§å˜æ›´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Controller é€‰ä¸¾&lt;/code&gt;: æ˜¯æŒ‡é€‰ä¸¾é›†ç¾¤ Controllerï¼Œè€Œå…¶ä»–ç®¡ç†ç±»ä»»åŠ¡åŒ…æ‹¬ä½†ä¸é™äºä¸»é¢˜åˆ é™¤ã€å‚æ•°é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;zookeeperæœåŠ¡&#34;&gt;ZookeeperæœåŠ¡&lt;/h3&gt;

&lt;p&gt;åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹ZookeeperæœåŠ¡æœ‰ä¸€å®šçš„äº†è§£ã€‚åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼ŒZookeeperæœ‰å¦‚ä¸‹èƒ½åŠ›:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é…ç½®ç®¡ç†: å…¶å®å°±æ˜¯å•çº¯çš„K/Vå­˜å‚¨ï¼Œå¯ä»¥ç”¨æ¥é…ç½®çš„å­˜å‚¨å’Œç®¡ç†ï¼Œå®ç°å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿç»„ä»¶çš„é›†ä¸­å¼çš„é…ç½®ç®¡ç†&lt;/li&gt;
&lt;li&gt;å‘½å: å‘½ä»¤ç©ºé—´ç®¡ç†ï¼Œåœ¨zookeeperä¸­é…ç½®å¯é€šè¿‡ä¸åŒçš„æ ¹è·¯å¾„æ¥å®ç°ç®€å•çš„å‘½åç©ºé—´éš”ç¦»(ç®€å•çš„chrootéš”ç¦»)&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼çš„åŒæ­¥æœåŠ¡: å¯ä¿è¯åˆ†å¸ƒå¼çš„åŒæ­¥&lt;/li&gt;
&lt;li&gt;åˆ†ç»„æœåŠ¡: å¯ä»¥å°†ä¸€ç»„æœåŠ¡é…ç½®è¿›è¡Œåˆ†ç»„ç®¡ç†ï¼Œå…¶å®åœ¨Dubboçš„æ³¨å†Œä¸­å¿ƒä¸­ï¼Œå°±æ˜¯ä½¿ç”¨åˆ†ç»„å’Œå‘½åæ¥ç»Ÿä¸€è¿›è¡Œç”Ÿäº§è€…çš„æ³¨å†Œå’Œå‘ç°&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg095r9zy2j30go0553z6.jpg&#34; alt=&#34;Zookeeperæ¶æ„&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨Zookeeperä¸­æ‰€æœ‰çš„å‘½åç©ºé—´å’Œæ–‡ä»¶ç³»ç»Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„&lt;code&gt;è·¯å¾„&lt;/code&gt;ï¼Œå¦‚ä¸‹å›¾:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg09dvjkrnj30ca071mxh.jpg&#34; alt=&#34;zookeeperå†…éƒ¨å­˜å‚¨ç»“æ„&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºä»€ä¹ˆZookeeperæœåŠ¡å¯ä»¥æ»¡è¶³é…ç½®ç®¡ç†å’Œåè°ƒæœåŠ¡å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸ºå®ƒçš„èŠ‚ç‚¹å±æ€§ï¼Œé€šå¸¸ä¹Ÿæ˜¯ç»å¸¸å¯èƒ½ä¼šå¿½ç•¥çš„é—®é¢˜ï¼Œå³åœ¨Zookeeperä¸­å­˜åœ¨ä¸¤ç§èŠ‚ç‚¹: &lt;code&gt;æŒä¹…èŠ‚ç‚¹&lt;/code&gt;å’Œ&lt;code&gt;ä¸´æ—¶èŠ‚ç‚¹&lt;/code&gt;ï¼ŒèŠ‚ç‚¹ä¹Ÿç§°ä¹‹ä¸º&lt;code&gt;znode&lt;/code&gt;ï¼Œè€Œznodeæœ¬èº«é™¤äº†æ•°æ®ä¹‹å¤–ï¼Œè¿˜ä¼šå­˜å‚¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ•°æ®å˜æ›´çš„ç‰ˆæœ¬å·&lt;/li&gt;
&lt;li&gt;ACLå˜æ›´çš„ç‰ˆæœ¬å·&lt;/li&gt;
&lt;li&gt;æ—¶é—´æˆ³&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¯æ¬¡znodeä¸­çš„æ•°æ®æœ‰å˜æ›´ï¼Œç‰ˆæœ¬å·éƒ½ä¼šé€’å¢ï¼Œå¹¶ä¸”clientåœ¨å‘znodeè·å–æ•°æ®æ—¶ï¼Œä¸ä»…ä¼šè·å–å®é™…æ•°æ®ï¼Œè€Œä¸”ä¼šè·å–åˆ°æ•°æ®çš„ç‰ˆæœ¬ï¼Œè¿™åœ¨æ•´ä¸ªé…ç½®ç®¡ç†é¢†åŸŸä¼šç›¸å½“æœ‰ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å‰é¢è¯´åˆ°çš„&lt;code&gt;æŒä¹…èŠ‚ç‚¹&lt;/code&gt;åªè¦znodeåˆ›å»ºåï¼Œä¾¿ä¸€ç›´ä¼šå­˜åœ¨ï¼Œè¿™ç§èŠ‚ç‚¹ä¸»è¦ç”¨äºé…ç½®çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œåªè¦zookeeperé›†ç¾¤æ•´ä½“å¯ç”¨ï¼Œé‚£è¯¥èŠ‚ç‚¹ä¹Ÿä¸€ç›´å¯ç”¨(åŠæ—¶é›†ç¾¤å¼‚å¸¸åæ¢å¤ï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨)ï¼›è€Œ&lt;code&gt;ä¸´æ—¶èŠ‚ç‚¹&lt;/code&gt; éšç€æŸä¸ªåˆ›å»º znode çš„ä¼šè¯çš„å¼€å§‹ï¼Œè¢«åˆ›å»ºï¼Œè€Œä¸€æ—¦è¿™ä¸ªä¼šè¯è¢«æ’¤é™¤æ‰ï¼Œè¿™ä¸ª znode å°±ä¼šè‡ªåŠ¨è¢« ZooKeeper åˆ é™¤ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äº&lt;code&gt;ä¸´æ—¶èŠ‚ç‚¹&lt;/code&gt;æ¥è®²ï¼Œç»å¸¸ä¼šè¢«ç”¨åœ¨å¦‚ä¸‹åœºæ™¯:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;dubboä¸­çš„æœåŠ¡æ³¨å†Œ&lt;/li&gt;
&lt;li&gt;å…¶ä»–åˆ†å¸ƒå¼æœåŠ¡ä¸­çš„leaderé€‰ä¸¾&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è€ŒçœŸæ­£ä½¿å¾—Zookeeperåœ¨Javaè¯­è¨€ç”Ÿæ€ä¸­æœ‰å¦‚æ­¤å¤§å½±å“è¿˜ä¾èµ–äºå¦å¤–ä¸€ä¸ªåŠŸèƒ½: &lt;code&gt;watches&lt;/code&gt;ï¼ŒClient å¯ä»¥å¯¹æŸä¸ª znode è®¾ç½®&lt;code&gt;watch&lt;/code&gt; å½“è¿™ä¸ª znode æœ‰å˜æ›´çš„æ—¶å€™ï¼Œå°±ä¼šäº§ç”Ÿ&lt;code&gt;watch&lt;/code&gt; äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šç”± ZooKeeper é€šçŸ¥è‡³ Client, å³æ˜¯ Client ä¼šæ”¶åˆ°æ¥è‡ª Server çš„é€šçŸ¥ï¼Œå¯ä»¥å®ç°æ•°æ®çš„åŠ¨æ€å˜æ›´ã€‚(ä¹‹æ‰€ä»¥è¯´æ˜¯Javaè¯­è¨€ç”Ÿæ€ï¼Œæ˜¯å› ä¸ºåœ¨äº‘åŸç”Ÿé¢†åŸŸï¼ŒEtcdå‡ ä¹æ˜¯Zookeeperçš„æ›¿ä»£å“ï¼Œä¸åŒçš„æ˜¯å®ƒæ˜¯Golangè¯­è¨€ç”Ÿæ€ä½“ç³»ä¸­çš„)&lt;/p&gt;

&lt;h3 id=&#34;kafkaé›†ç¾¤æ•°æ®åœ¨zookeeperçš„å­˜å‚¨&#34;&gt;kafkaé›†ç¾¤æ•°æ®åœ¨zookeeperçš„å­˜å‚¨&lt;/h3&gt;

&lt;p&gt;å‰é¢å¯¹ZookeeperæœåŠ¡è¿›è¡Œäº†å¤§æ¦‚çš„è¯´æ˜,æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹kafkaçš„é›†ç¾¤æ•°æ®åœ¨zookeeperä¸­æ˜¯å¦‚ä½•å­˜å‚¨å’Œåˆ†å¸ƒçš„ã€‚&lt;/p&gt;

&lt;p&gt;é“¾æ¥zk:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å‰é¢è¯´åˆ°zookeeperæ”¯æŒå‘½åç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªzookeeperé›†ç¾¤æ¥ç®¡ç†å¤šä¸ªkafkaé›†ç¾¤
# åªéœ€è¦åœ¨å¯åŠ¨kafkaæ—¶æŒ‡å®šzkçš„chrootç¯å¢ƒï¼Œæ¯”å¦‚/kafka åœ¨zookeeperä¸­å°†å­˜å‚¨åç§°ä¸º`kafka`çš„é›†ç¾¤çš„ç›¸å…³æ•°æ®
sh-4.2# sh zkCli.sh -server 127.0.0.1:2181
Connecting to 127.0.0.1:2181
....
[zk: 127.0.0.1:2181(CONNECTED) 0] ls /
[kafka, zookeeper]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æŸ¥çœ‹kafkaæ•°æ®å­˜å‚¨ç»“æ„:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;[zk: 127.0.0.1:2181(CONNECTED) 1] ls /kafka
[admin, brokers, cluster, config, consumers, controller, controller_epoch, isr_change_notification, latest_producer_id_block, log_dir_event_notification]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;kafkaå…ƒæ•°æ®å­˜å‚¨ç›®å½•&lt;/strong&gt;
- admin: å­˜å‚¨ç®¡ç†å‘˜æ¥å£æ“ä½œçš„ç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦ä¸ºtopicåˆ é™¤äº‹ä»¶ï¼Œåˆ†åŒºè¿ç§»äº‹ä»¶ï¼Œä¼˜å…ˆå‰¯æœ¬é€‰ä¸¾ï¼Œä¿¡æ¯(ä¸€èˆ¬ä¸ºä¸´æ—¶èŠ‚ç‚¹)
- brokers: ä¸»è¦å­˜å‚¨brokerç›¸å…³çš„ä¿¡æ¯ï¼ŒbrokerèŠ‚ç‚¹ä»¥åŠèŠ‚ç‚¹ä¸Šçš„topicç›¸å…³ä¿¡æ¯
- cluster: å­˜å‚¨kafkaé›†ç¾¤ä¿¡æ¯
- config: å­˜å‚¨brokerï¼Œclientï¼Œtopicï¼Œuserä»¥åŠchangerç›¸å…³çš„é…ç½®ä¿¡æ¯
- consumers: å­˜æ”¾æ¶ˆè´¹è€…ç›¸å…³ä¿¡æ¯(ä¸€èˆ¬ä¸ºç©º)
- controller: ç”¨äºå­˜æ”¾æ§åˆ¶èŠ‚ç‚¹ä¿¡æ¯(æ³¨æ„: è¯¥èŠ‚ç‚¹æ˜¯ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œç”¨äºcontrollerèŠ‚ç‚¹æ³¨å†Œ)
- controller_epoch: ç”¨äºå­˜æ”¾controllerèŠ‚ç‚¹å½“å‰çš„å¹´é¾„
- isr_change_notification: ç”¨äºå­˜å‚¨isrçš„å˜æ›´é€šçŸ¥(ä¸´æ—¶èŠ‚ç‚¹ï¼Œå½“æœ‰isrè¿›è¡Œå˜åŠ¨æ—¶ï¼Œä¼šç”¨äºäº‹ä»¶é€šçŸ¥ï¼Œå¯è¿›è¡Œwatchè·å–é›†ç¾¤isrçŠ¶æ€å˜æ›´)
- latest_producer_id_block:  è¯¥èŠ‚ç‚¹ç”¨äºå­˜å‚¨å¤„ç†äº‹åŠ¡ç›¸å…³çš„pidèŒƒå›´
- log_dir_event_notification: æ—¥å¿—ç›®å½•äº‹ä»¶é€šçŸ¥&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;adminç›®å½•ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;[zk: 127.0.0.1:2181(CONNECTED) 2] ls /kafka/admin
[delete_topics]
[zk: 127.0.0.1:2181(CONNECTED) 3] ls /kafka/admin/delete_topics
[]
[zk: 127.0.0.1:2181(CONNECTED) 4] get  /kafka/admin/delete_topics
null&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;brokersç›®å½•ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# brokerå’Œtopicåˆ—è¡¨æ•°æ®
[zk: 127.0.0.1:2181(CONNECTED) 5] ls /kafka/brokers
[ids, seqid, topics]

# è¡¨ç¤ºå½“å‰é›†ç¾¤æœ‰3ä¸ªèŠ‚ç‚¹
[zk: 127.0.0.1:2181(CONNECTED) 6] ls /kafka/brokers/ids
[1, 2, 3]
[zk: 127.0.0.1:2181(CONNECTED) 7] ls /kafka/brokers/seqid
[]
# è¡¨ç¤ºé›†ç¾¤å½“å‰çš„topicä¿¡æ¯
[zk: 127.0.0.1:2181(CONNECTED) 8] ls /kafka/brokers/topics
[__consumer_offsets, appjsonlog_heartbeat, nginx_log,ingress_log ]

# brokerè¯¦æƒ…
[zk: 127.0.0.1:2181(CONNECTED) 10] get  /kafka/brokers/ids/1
{&amp;#34;listener_security_protocol_map&amp;#34;:{&amp;#34;PLAINTEXT&amp;#34;:&amp;#34;PLAINTEXT&amp;#34;},&amp;#34;endpoints&amp;#34;:[&amp;#34;PLAINTEXT://10.0.0.1:9092&amp;#34;],&amp;#34;jmx_port&amp;#34;:9999,&amp;#34;host&amp;#34;:&amp;#34;10.0.0.1&amp;#34;,&amp;#34;timestamp&amp;#34;:&amp;#34;1588925944886&amp;#34;,&amp;#34;port&amp;#34;:9092,&amp;#34;version&amp;#34;:4}

# topicè¯¦æƒ…
[zk: 127.0.0.1:2181(CONNECTED) 11] get  /kafka/brokers/topics/__consumer_offsets
{&amp;#34;version&amp;#34;:2,&amp;#34;partitions&amp;#34;:{&amp;#34;1&amp;#34;:[2,1,3],&amp;#34;0&amp;#34;:[3,2,1],&amp;#34;2&amp;#34;:[1,2,3],&amp;#34;adding_replicas&amp;#34;:{},&amp;#34;removing_replicas&amp;#34;:{}}


[zk: localhost:2181(CONNECTED) 3] ls /brokers/topics/__consumer_offsets
[partitions]
[zk: localhost:2181(CONNECTED) 4] ls /brokers/topics/__consumer_offsets/partitions
[0, 1, 2]

# æŸ¥çœ‹topicæŸä¸ªåˆ†åŒºçš„çŠ¶æ€è¯¦æƒ…
[zk: localhost:2181(CONNECTED) 6] ls /brokers/topics/__consumer_offsets/partitions/1
[state]
[zk: localhost:2181(CONNECTED) 7] ls /brokers/topics/__consumer_offsets/partitions/1/state
[]
[zk: localhost:2181(CONNECTED) 8] get  /brokers/topics/__consumer_offsets/partitions/1/state
{&amp;#34;controller_epoch&amp;#34;:3,&amp;#34;leader&amp;#34;:1,&amp;#34;version&amp;#34;:1,&amp;#34;leader_epoch&amp;#34;:12,&amp;#34;isr&amp;#34;:[3,1]}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;clusterç›®å½•ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;[zk: 127.0.0.1:2181(CONNECTED) 5] get   /kafka/cluster/id
{&amp;#34;version&amp;#34;:&amp;#34;1&amp;#34;,&amp;#34;id&amp;#34;:&amp;#34;5C-JZf4vRdqKzlca7Lv7pA&amp;#34;}
cZxid = 0x100000018
ctime = Fri Mar 30 22:21:07 CST 2018
mZxid = 0x100000018
mtime = Fri Mar 30 22:21:07 CST 2018
pZxid = 0x100000018
cversion = 0
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 45
numChildren = 0&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;configç›®å½•ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;[zk: 127.0.0.1:2181(CONNECTED) 12] ls /kafka/config
[brokers, changes, clients, topics, users]

# éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconfigç›®å½•ç”¨æ¥å­˜æ”¾å„ç§å®ä½“çš„é…ç½®ï¼Œç”¨äºä½¿ç”¨kafkaç›¸å…³å·¥å…·å¯¹å®ä½“è¿›è¡Œçš„é…ç½®å˜æ›´å­˜å‚¨
# å› æ­¤ï¼Œä¸€èˆ¬åœ¨kafkaé›†ç¾¤è¿è¡Œåï¼Œå¦‚ä¸è®¾ç½®ç›¸å…³åŠ¨æ€å‚æ•°ï¼Œè¯¥ç›®å½•ä¸‹çš„é…ç½®ä¸€èˆ¬ä¸ºç©º
[zk: 127.0.0.1:2181(CONNECTED) 19] ls /kafka/config/brokers
[]
[zk: 127.0.0.1:2181(CONNECTED) 20] ls /kafka/config/changes
[]
[zk: 127.0.0.1:2181(CONNECTED) 21] ls /kafka/config/clients
[]
[zk: 127.0.0.1:2181(CONNECTED) 22] ls /kafka/config/topics
[__consumer_offsets]
[zk: 127.0.0.1:2181(CONNECTED) 23] ls /kafka/config/users
[]

# å¯ä»¥çœ‹åˆ°ï¼Œå­˜å‚¨æ¶ˆè´¹è€…åç§»é‡çš„topicåœ¨é…ç½®ä¸­
# æ˜¯å› ä¸ºè¯¥topicæœ‰ä¸€äº›é¢å¤–çš„topicçº§åˆ«å‚æ•°
# å¦‚æœæˆ‘ä»¬å¯¹topicå‚æ•°æœ‰è¿‡åŠ¨æ€å˜æ›´ï¼Œå°†ä¼šåœ¨è¿™é‡Œå­˜å‚¨
[zk: 127.0.0.1:2181(CONNECTED) 24] get /kafka/config/topics/__consumer_offsets
{&amp;#34;version&amp;#34;:1,&amp;#34;config&amp;#34;:{&amp;#34;segment.bytes&amp;#34;:&amp;#34;104857600&amp;#34;,&amp;#34;compression.type&amp;#34;:&amp;#34;producer&amp;#34;,&amp;#34;cleanup.policy&amp;#34;:&amp;#34;compact&amp;#34;}}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;controllerç›®å½•ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å¯ä»¥çœ‹åˆ°å½“å‰broker-1ä¸ºé›†ç¾¤çš„controllerèŠ‚ç‚¹
[zk: 127.0.0.1:2181(CONNECTED) 30] get  /kafka/controller
{&amp;#34;version&amp;#34;:1,&amp;#34;brokerid&amp;#34;:1,&amp;#34;timestamp&amp;#34;:&amp;#34;1588833869354&amp;#34;}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;controller_epoch ç›®å½•ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å¯ä»¥çœ‹åˆ°controllerçš„å¹´é¾„æ˜¯2ï¼Œè¯´æ˜controllerç»å†è¿‡2æ¬¡å˜æ›´äº†
[zk: 127.0.0.1:2181(CONNECTED) 32] get  /kafka/controller_epoch
2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»–å‡ ä¸ªç›®å½•ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å­˜å‚¨äº‹åŠ¡ç›¸å…³çš„pidèŒƒå›´æ•°æ®
# brokerå¯åŠ¨æ—¶æå‰é¢„åˆ†é…ä¸€æ®µ PIDï¼Œå½“å‰æ˜¯ 0~999ï¼Œå³æå‰åˆ†é…å‡º 1000 ä¸ª PID æ¥
# ä¸€æ—¦ PID è¶…è¿‡äº† 999ï¼Œåˆ™ç›®å‰ä¼šæŒ‰ç…§ 1000 çš„æ­¥é•¿é‡æ–°åˆ†é…
# é›†ç¾¤ä¸­æ‰€æœ‰ broker å¯åŠ¨æ—¶éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªå« TransactionCoordinator çš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶èƒ½å¤Ÿæ‰§è¡Œé¢„åˆ†é… PID å—å’Œåˆ†é… PID çš„å·¥ä½œï¼Œè€Œæ‰€æœ‰ broker éƒ½ä½¿ç”¨ /latest_producer_id_block èŠ‚ç‚¹æ¥ä¿å­˜ PID å—

[zk: 127.0.0.1:2181(CONNECTED) 37] get  /kafka/latest_producer_id_block
{&amp;#34;version&amp;#34;:1,&amp;#34;broker&amp;#34;:1,&amp;#34;block_start&amp;#34;:&amp;#34;19000&amp;#34;,&amp;#34;block_end&amp;#34;:&amp;#34;19999&amp;#34;}


[zk: 127.0.0.1:2181(CONNECTED) 39] ls /kafka/isr_change_notification
[]
[zk: 127.0.0.1:2181(CONNECTED) 40] get  /kafka/isr_change_notification
null

[zk: 127.0.0.1:2181(CONNECTED) 41] ls /kafka/log_dir_event_notification
[]
[zk: 127.0.0.1:2181(CONNECTED) 42] get  /kafka/log_dir_event_notification
null&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªkafkaå…ƒæ•°æ®åœ¨zookeeperé›†ç¾¤ä¸­çš„æ•´ä½“å­˜å‚¨ç»“æ„ï¼Œä¸‹é¢é™„ä¸Šä¸€å¼ kafkaçš„å…ƒæ•°æ®å­˜å‚¨ç»“æ„å›¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;kafkaå…ƒæ•°æ®åœ¨zkä¸­çš„åˆ†å¸ƒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gg0a21u6coj31am0u0tlf.jpg&#34; alt=&#34;kafkaåœ¨zookeeperä¸­çš„å­˜å‚¨ç»“æ„&#34; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>ä¸€æ–‡å¸®ä½ ç†è§£æ•´ä¸ªSREè¿ç»´ä½“ç³»</title>
      <link>https://bgbiao.top/post/sre%E8%BF%90%E7%BB%B4%E4%BD%93%E7%B3%BB/</link>
      <pubDate>Fri, 19 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/sre%E8%BF%90%E7%BB%B4%E4%BD%93%E7%B3%BB/</guid>
      
        <description>

&lt;blockquote&gt;
&lt;p&gt;SREè¿ç»´ä½“ç³»çš„æ„å»ºå’Œå·¥ä½œèŒè´£åˆ’åˆ†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;å¯è§‚æµ‹æ€§ç³»ç»Ÿ&#34;&gt;å¯è§‚æµ‹æ€§ç³»ç»Ÿ&lt;/h4&gt;

&lt;p&gt;åœ¨ä»»ä½•æœ‰ä¸€å®šè§„æ¨¡çš„ä¼ä¸šå†…éƒ¨ï¼Œä¸€æ—¦æ¨è¡Œèµ·æ¥æ•´ä¸ªSREçš„è¿ç»´æ¨¡å¼ï¼Œé‚£ä¹ˆå¯¹äºå¯è§‚æµ‹æ€§ç³»ç»Ÿçš„å»ºè®¾å°†å˜å¾—å°¤ä¸ºé‡è¦ï¼Œè€Œåœ¨æ•´ä¸ªå¯è§‚æµ‹æ€§ç³»ç»Ÿä¸­ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåˆ†ä¸ºå¦‚ä¸‹ä¸‰ä¸ªæ–¹é¢:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æŒ‡æ ‡ç›‘æ§ï¼šå³å„ç§æŒ‡æ ‡ç›‘æ§ï¼Œæ¯”å¦‚åŸºç¡€èµ„æºæŒ‡æ ‡ï¼ŒæœåŠ¡æ€§èƒ½æŒ‡æ ‡ï¼Œä¸šåŠ¡çš„è°ƒç”¨æŒ‡æ ‡ã€‚&lt;/li&gt;
&lt;li&gt;æ—¥å¿—ï¼šå„ç§è®¾å¤‡ä»¥åŠæœåŠ¡çš„è¿è¡Œæ—¥å¿—ç›‘æ§ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨é“¾ï¼šä¸šåŠ¡å±‚é¢çš„è°ƒç”¨é“¾åˆ†æï¼Œé€šå¸¸åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸®åŠ©è¿è¥ã€å¼€å‘ä»¥åŠè¿ç»´äººå‘˜å¿«é€Ÿè¯†åˆ«æ•´ä½“è°ƒç”¨çš„ç“¶é¢ˆç‚¹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸€æ•´å¥—çš„å¯è§‚æµ‹ç³»ç»Ÿï¼Œå®ƒèƒ½ç¡®ä¿ä½ æ´å¯Ÿç³»ç»Ÿï¼Œè·Ÿè¸ªç³»ç»Ÿçš„å¥åº·çŠ¶æ€ã€å¯ç”¨æ€§ä»¥åŠç³»ç»Ÿå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºæ•´ä¸ªå¯è§‚æµ‹ç³»ç»Ÿçš„å»ºè®¾ï¼Œéœ€è¦æ³¨æ„å¦‚ä¸‹ä¸¤ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ç¡®å®šè´¨é‡æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Œå¹¶ç¡®ä¿ç³»ç»ŸæŒç»­é€¼è¿‘æˆ–ä¿æŒåœ¨è´¨é‡æ ‡å‡†æé™èŒƒå›´å†…&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ç³»ç»Ÿåœ°å…³æ³¨è¿™é¡¹å·¥ä½œâ€”è€Œä¸åº”è¯¥åªæ˜¯éšæœºåœ°æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿ&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨æ•´ä¸ªä¼ä¸šçº§å¯è§‚æµ‹ç³»ç»Ÿä¸­ï¼Œæˆ‘è®¤ä¸ºè‡³å°‘åº”è¯¥åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªç‰¹å¾ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å®Œå¤‡æŒ‡æ ‡é‡‡é›†: å¯ä»¥å¯¹æ¥ä¼ä¸šå†…å¤§éƒ¨åˆ†çš„è®¾å¤‡ä¸æŠ€æœ¯æ ˆç›¸åº”çš„ç›‘æ§æŒ‡æ ‡ï¼›åŒæ—¶ï¼Œæ”¯æŒå¸¸è§è®¾å¤‡çš„ç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼Œå¯ä»¥å¿«é€Ÿæ¥å…¥ç›‘æ§è®¾å¤‡å’ŒæŒ‡æ ‡ï¼Œé¿å…æ‰€æœ‰è®¾å¤‡ç›‘æ§éƒ½æ˜¯ä»å¤´æ„å»ºï¼›å¯¹äºæ—¥å¿—æ•°æ®çš„é‡‡é›†æ”¯æŒ&lt;/li&gt;
&lt;li&gt;æµ·é‡è®¾å¤‡æ”¯æŒ: ä¼ä¸šITç³»ç»Ÿæ•°é‡å’Œè§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œå› æ­¤ç›‘æ§ç³»ç»Ÿæ¯”ä»¥å‰éœ€è¦ç›‘æ§æµ·é‡è®¾å¤‡ç›‘æ§ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§æ•°æ®å­˜å‚¨å’Œåˆ†æ: ç›‘æ§æ•°æ®æ˜¯è¿ç»´åˆ†æã€è¿ç»´è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–çš„åŸºç¡€ï¼Œå› æ­¤æµ·é‡ç›‘æ§æ•°æ®å­˜å‚¨ä»¥åŠåŸºäºç›‘æ§æ•°æ®çš„å¯è§†åŒ–åˆ†ææ˜¯ä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„åŸºæœ¬èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯è§‚æµ‹ç³»ç»Ÿæ˜¯æ•´ä¸ªè¿ç»´ä½“ç³»çš„åŸºç¡€ï¼Œå®ƒéœ€è¦æä¾›æ•´ä¸ªè¿ç»´ä½“ç³»çš„æ•°æ®åŒ–æ”¯æŒã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œä¸€ä¸ªä¼ä¸šçº§çš„å¯è§‚æµ‹æ€§ç³»ç»Ÿåº”è¯¥æ˜¯å¹³å°åŒ–çš„ã€‚ä¸€æ–¹é¢å¯ä»¥é€šè¿‡é…ç½®æˆ–è€…å¼€å‘å®ç°æ›´å¤š &lt;code&gt;è¿ç»´æŒ‡æ ‡&lt;/code&gt;çš„æ¥å…¥ï¼›å¦ä¸€æ–¹é¢ï¼Œäº¦å¯å¯¹æ¥æ›´å¤šçš„&lt;code&gt;ä¸“ä¸šè¿ç»´å·¥å…·&lt;/code&gt;ï¼Œæ•´åˆå¹¶æ‰“é€šå¤šå…ƒçš„è¿ç»´æ•°æ®ï¼Œä¸ºæ›´å¤šè¿ç»´åœºæ™¯æä¾›æ•°æ®æœåŠ¡ã€‚ä»æ•´ä½“ä¸Šï¼Œå¯è§‚æµ‹æ€§ç³»ç»Ÿä¸ºä¼ä¸šè¿ç»´æä¾›äº†ä¸€ä¸ª&lt;code&gt;æ•°æ®åŸºç¡€&lt;/code&gt;ï¼Œè®©æˆ‘ä»¬å¯¹&lt;code&gt;äº‹æ•…å“åº”ä»¥åŠå®¹é‡é¢„æµ‹&lt;/code&gt;ç­‰æ–¹é¢æ›´å¤šä½¿ç”¨æ•°æ®è€Œéå‡­å€Ÿä»¥å¾€ç»éªŒå’Œæ‹è„‘è¢‹åšå‡ºå†³ç­–ã€‚&lt;/p&gt;

&lt;h4 id=&#34;æ•…éšœå“åº”&#34;&gt;æ•…éšœå“åº”&lt;/h4&gt;

&lt;p&gt;å¦‚æœæœ‰ä»€ä¹ˆä¸œè¥¿å‡ºäº†æ•…éšœï¼Œè¯¥å¦‚ä½•æé†’å¤§å®¶å¹¶åšå‡ºå›åº”ï¼Ÿå·¥å…·å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå›½ä¸ºå®ƒå¯ä»¥å®šä¹‰æé†’äººç±»çš„è§„åˆ™ã€‚&lt;/p&gt;

&lt;p&gt;æ•…éšœå“åº”æ˜¯å»ºç«‹åœ¨&lt;code&gt;ä½¿ç”¨å¯è§‚æµ‹æ€§ç³»ç»Ÿæ„å»ºçš„æ•°æ®&lt;/code&gt;ä¹‹ä¸Šï¼Œå¹¶å€ŸåŠ©åé¦ˆå¾ªç¯ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬åŠ å¼ºå¯¹æœåŠ¡çš„ç›‘æ§ã€‚&lt;/p&gt;

&lt;p&gt;æ•…éšœå“åº”é€šå¸¸åŒ…å«å¦‚ä¸‹å‡ ä¸ªåŠ¨ä½œ:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å…³æ³¨: ä¸è®ºæ˜¯ä¸»åŠ¨å‘ç°ç“¶é¢ˆç‚¹æˆ–å¼‚å¸¸ç‚¹ï¼Œè¿˜æ˜¯é€šè¿‡å¯è§‚æµ‹æ€§ç³»ç»Ÿè¢«åŠ¨æš´éœ²ç“¶é¢ˆç‚¹ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥è¿›è¡Œä¸»åŠ¨å…³æ³¨&lt;/li&gt;
&lt;li&gt;äº¤æµ: åŠæ—¶å°†è§‚å¯Ÿåˆ°é£é™©ç‚¹é€šçŸ¥åˆ°ç›¸å…³æ–¹ï¼Œå¹¶å‘ŠçŸ¥å½±å“é¢ä»¥åŠç›¸å…³çš„è¡¥æ•‘æªæ–½&lt;/li&gt;
&lt;li&gt;æ¢å¤: ä¸‰æ–¹è¾¾æˆä¸€è‡´åï¼Œæ ¹æ®è¡¥æ•‘æªæ–½è¿›è¡Œä¿®å¤ç›¸å…³é£é™©ç‚¹å’Œå¼‚å¸¸ç‚¹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨å‰æœŸæ•´ä¸ªå¯è§‚æµ‹æ€§ç³»ç»Ÿèƒ½å¤Ÿåšå¥½ï¼Œé€šå¸¸æ•…éšœåº”å½“å§‹äºä¸€ä¸ªç®€å•çš„å‘Šè­¦ä¿¡æ¯æˆ–ä¸€ä¸ªæŠ¥éšœç”µè¯ï¼Œå› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¯è§‚æµ‹ç³»ç»Ÿåšçš„è¶³å¤Ÿå¥½ä»…èƒ½èµ·åˆ°è¿½æº¯å’Œæ’æŸ¥çš„ä½œç”¨ï¼Œä½†æ˜¯æ— æ³•èµ·åˆ°åŠæ—¶å‘ç°çš„ä½œç”¨ï¼Œæ­¤æ—¶å°±éœ€è¦ä¾èµ–äºå„ä¸ªè§‚æµ‹æ•°æ®è¿›è¡Œè®¡ç®—å’Œè¯„ä¼°å‘Šè­¦ï¼Œä»¥åŠæ—¶å°†ç›¸å…³çš„å‘Šè­¦é€šçŸ¥åˆ°ç›¸å…³äººï¼Œä»¥æš´éœ²é£é™©ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;å‘Šè­¦åªæ˜¯æ•´ä¸ªæ•…éšœå“åº”çš„ç¬¬ä¸€ä¸ªç¯èŠ‚ï¼Œè§£å†³çš„æ˜¯æ•…éšœå¦‚ä½•å‘ç°çš„é—®é¢˜ï¼Œè€Œå¤§å¤šæ•°çš„æ•…éšœå“åº”å·¥ä½œéƒ½æ˜¯å…³äºå®šä¹‰å¤„ç†ç­–ç•¥å’Œæä¾›åŸ¹è®­çš„ï¼Œä»¥ä¾¿äººä»¬åœ¨æ”¶åˆ°è­¦æŠ¥æ—¶çŸ¥é“è¯¥æ€ä¹ˆåšï¼Œé€šå¸¸è¿™éƒ¨åˆ†æ›´å¤šçš„æ˜¯è¿‡å»å†å²ç»éªŒå’Œè¿ç»´ç»å†çš„æ€»ç»“å’Œæ²‰æ·€ï¼ŒåŒ…æ‹¬ç»éªŒçš„ä¸€äº›æŠ½è±¡å’Œå·¥å…·åŒ–æ²‰æ·€ï¼Œä»¥ä¿è¯æ•…éšœå“åº”çš„æ•ˆç‡å’Œæ™®éåŒ–(å³ä¸ä¾èµ–äººä¸ºç»éªŒ)ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå¯¹äºæ•´ä¸ªå‘Šè­¦ç³»ç»Ÿæ¥è¯´ï¼Œéœ€è¦ç¡®ä¿çš„æ˜¯å‘Šè­¦çš„æœ‰æ•ˆæ€§ï¼Œå¦åˆ™ï¼Œæ•´ä¸ªæŠ¥è­¦ç³»ç»Ÿå¾ˆæœ‰å¯èƒ½æ²¦è½ä¸ºåƒåœ¾æ•°æ®åˆ¶é€ æœºï¼Œå‘Šè­¦æœ‰æ•ˆæ€§æ„å‘³ç€éœ€è¦æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªéœ€æ±‚:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å‘Šè­¦åŠæ—¶æ€§: ç³»ç»Ÿæœ‰é—®é¢˜éœ€è¦åŠæ—¶é€šè¿‡å‘Šè­¦ä¿¡æ¯å‘ŠçŸ¥è¿ç»´å¤„ç†äººå‘˜åŠæ—¶å¤„ç†å‘Šè­¦;&lt;/li&gt;
&lt;li&gt;å‘Šè­¦å‡†ç¡®æ€§: åªè¦æœ‰å‘Šè­¦ä¿¡æ¯ç³»ç»Ÿå¿…ç„¶å‡ºç°é—®é¢˜(å¯¹äºå¾ˆå¤šä¼ä¸šå¯èƒ½å­˜åœ¨å¤§é‡çš„æ— ç”¨å‘Šè­¦ï¼Œæ¯”å¦‚ç£ç›˜é—®é¢˜ï¼Œmemç­‰ç›¸å…³é—®é¢˜ï¼Œå½“ç„¶è¿™é‡Œæ¶‰åŠåˆ°äº†è‡ªåŠ¨åŒ–ã€ä¸šåŠ¡å½¢æ€ã€å‘Šè­¦é˜ˆå€¼çš„é—®é¢˜);&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨æ•´ä¸ªè¿ç»´è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå‘ç°æœ‰å¤§é‡çš„æ— å…³ç´§è¦çš„å‘Šè­¦ä¿¡æ¯ï¼Œè®©è¿ç»´äººå‘˜çš„æ³¨æ„åŠ›è¿·å¤±åœ¨å‘Šè­¦æµ·æ´‹å½“ä¸­ï¼Œè€Œé€šå¸¸éè¿ç»´é¢†åŸŸçš„é¢†å¯¼ä¼šå…³æ³¨æ•´ä¸ªå‘Šè­¦çš„å“åº”ç¨‹åº¦ï¼Œå› æ­¤ï¼ŒæŠ‘åˆ¶å’Œæ¶ˆé™¤æ— æ•ˆçš„å‘Šè­¦ï¼Œè®©è¿ç»´äººå‘˜ä¸è¢«å‘Šè­¦é£æš´æ‰€åæ²¡ï¼Œä¹Ÿæ˜¯å‘Šè­¦ç®¡ç†ä¸­é‡ç‚¹å»ºè®¾çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸æƒ…å†µï¼Œåœ¨æˆ‘ä»¬çš„å„ä¸ªå¯è§‚æµ‹ç³»ç»Ÿæ„å»ºå®Œæˆåï¼Œå¯ä»¥é€šè¿‡æ•´åˆåˆ°ç›‘æ§å¹³å°ä¸­çš„å„ç§ç›‘æ§æ•°æ®ï¼Œåº”ç”¨è¶‹åŠ¿é¢„æµ‹ã€çŸ­å‘¨æœŸæ£€æµ‹ã€é—´æ­‡æ€§æ¢å¤ã€åŸºçº¿åˆ¤æ–­ã€é‡å¤å‹ç¼©ç­‰ç®—æ³•å’Œæ‰‹æ®µå®ç°å‘Šè­¦å‹ç¼©æ”¶æ•›ï¼Œå¼ºåŒ–å‘Šè­¦çš„æœ‰æ•ˆæ€§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfxkaxxf68j30u00dhjtx.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åŒæ—¶ï¼Œé¢å‘ä¸€çº¿çš„è¿ç»´äººå‘˜ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®åŒä¸€ä¸ªç³»ç»Ÿæˆ–è®¾å¤‡çš„å¤šä¸ªç›‘æ§æŒ‡æ ‡è¿›è¡Œç»¼åˆæ€§å»ºæ¨¡å’Œåˆ†æï¼Œæ±‡æ€»æˆä¸€ä¸ªå¥åº·åº¦çš„åˆ†å€¼ï¼Œç»™äºˆä¸€çº¿è¿ç»´äººå‘˜ç³»ç»Ÿçš„åŸºäºå¥åº·åº¦çš„ç³»ç»Ÿåˆ†å±‚è¯„ä»·ä½“ç³»ï¼ŒçœŸå®ã€ç›´è§‚åæ˜ ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ï¼Œå®ç°é—®é¢˜å¿«é€Ÿå®šç•Œã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚ï¼Œé€šè¿‡åŸºç¡€èµ„æºçš„å¤šä¸ªæŒ‡æ ‡è¿›è¡Œç»¼åˆåŠ æƒè®¡ç®—æ¥æ•´ä½“è¯„ä¼°è¯¥èµ„æºçš„åˆ©ç”¨ç‡ï¼›é€šè¿‡ä¸€ä¸ªåº”ç”¨å…³è”çš„å…¨éƒ¨èµ„æºçš„èµ„æºåˆ©ç”¨ç‡ä»¥åŠåº”ç”¨çš„è¿ç»´æ¶æ„æ•´ä½“å»ºæ¨¡åˆ†ææ¥è®¡ç®—ä¸€ä¸ªåˆ†å€¼æ¥æ•´ä½“è¯„ä¼°è¯¥åº”ç”¨çš„å¥åº·ç¨‹åº¦ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹å¦‚æœåšå¾—æˆç†Ÿä¸€äº›ï¼Œå¯ä»¥æ ¹æ®å†…éƒ¨å·²æœ‰çš„è§£å†³æ–¹æ¡ˆå’Œå‘Šè­¦è¿›è¡Œé—­ç¯æ‰“é€šï¼Œä¸€ä¸ªç®€å•çš„åœºæ™¯å°±æ˜¯ï¼Œå½“ç£ç›˜æ»¡æ—¶ï¼Œå‘Šè­¦ä¼šé¦–å…ˆè§¦å‘ä¸€æ¬¡æ ‡å‡†åŒ–çš„ç£ç›˜å·¡æ£€ï¼Œå¹¶è¿›è¡Œç›¸å…³çš„å¯ä¸¢å¼ƒæ•°æ®çš„åˆ é™¤ï¼Œå¦‚æœä¾ç„¶æ— æ³•è§£å†³è¯¥æŠ¥è­¦ï¼Œä¸‹æ¬¡å¯ç›´æ¥å…³è”åˆ°ä¸€çº¿è¿ç»´è¿›è¡Œäººå·¥å¹²é¢„ï¼Œä¹‹åè¿›è¡Œæ ‡å‡†åŒ–ç»éªŒæ€»ç»“ã€‚&lt;/p&gt;

&lt;h4 id=&#34;æ•…éšœå¤ç›˜&#34;&gt;æ•…éšœå¤ç›˜&lt;/h4&gt;

&lt;p&gt;æ•…éšœå¤ç›˜å°±æ˜¯å¯¹äºè¿‡å»çš„ä¸€äº›æœåŠ¡å¼‚å¸¸å’ŒæœåŠ¡ä¸­æ–­æƒ…å†µè¿›è¡Œå›é¡¾å’Œæ€»ç»“ï¼Œä»¥ç¡®ä¿ç›¸åŒé—®é¢˜ä¸‹æ¬¡ä¸ä¼šå†å‡ºç°ã€‚ä¸ºäº†è®©å¤§å®¶å›¢ç»“åä½œï¼Œæˆ‘ä»¬å¸Œæœ›å»ºç«‹ä¸€ç§æ— æŒ‡è´£ã€é€æ˜çš„äº‹åæ–‡åŒ–ã€‚ä¸ªäººä¸åº”è¯¥å®³æ€•äº‹æ•…ï¼Œè€Œæ˜¯ç¡®ä¿¡å¦‚æœäº‹æ•…å‘ç”Ÿï¼Œå›¢é˜Ÿå°†ä¼šå“åº”å’Œæ”¹è¿›ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;p&gt;å¤‡æ³¨: å…¶å®åœ¨å›½å†…çš„SREæ–‡åŒ–ä¸­ï¼Œä¸€èˆ¬åªæœ‰å¯¹å¤§å‹ï¼Œå¯¹ä¸šåŠ¡æœ‰é‡å¤§å½±å“çš„äº‹æ•…æ‰ä¼šè¿›è¡Œå¤ç›˜ï¼Œä½†å®é™…ä¸Šå¦‚æœåœ¨æ—¶é—´å’Œç»å†å…è®¸çš„æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€èˆ¬çš„æ™®é€šäº‹æ•…ä¹Ÿåº”è¯¥åœ¨å°èŒƒå›´è¿›è¡Œå¤ç›˜ï¼Œæ­£æ‰€è°“å¤§çš„æ•…éšœéƒ½æ˜¯ä»ä¸æ–­çš„å°é—®é¢˜ä¸€ç‚¹ä¸€ç‚¹ç§¯ç´¯çš„ã€‚å¦å¤–ï¼Œå…¶å®å¯¹äºè¿ç»´ç›¸å…³çš„ä¸ªäººè€Œè¨€ï¼Œæˆ‘ä»¬ä¹Ÿåº”å½“åŠæ—¶çš„è¿›è¡Œå°æ•…éšœå¤ç›˜ï¼Œä»¥ä¸æ–­åŠ å¼ºä¸ªäººçš„æ•…éšœå¤„ç†å’Œä¿®å¤èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘è®¤ä¸ºSREçš„ä¸€ä¸ªå…³é”®å…±è¯†æ­£æ˜¯æ‰¿è®¤äº†ç³»ç»Ÿçš„ä¸å®Œç¾æ€§ï¼Œè¿½æ±‚æ°¸ä¸åœæœºçš„ç³»ç»Ÿæ˜¯ä¸ç°å®çš„ã€‚åŸºäºä¸å®Œç¾ç³»ç»Ÿï¼Œæˆ‘ä»¬æ— å¯é¿å…è¦é¢å¯¹å’Œç»å†ç³»ç»Ÿæ•…éšœä¸å¤±è´¥ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬é‡è¦çš„å¹¶éæ‰¾åˆ°ä¸ºè¿™ä¸ªæ•…éšœè´£ä»»çš„è¿™ä¸ªäººæˆ–è€…é‚£ä¸ªäººï¼Œè€Œæ˜¯æ›´åº”è¯¥åˆ›æ ¹é—®åº•åœ°å¤ç›˜è¿™ä¸ªæ•…éšœå’Œå¤±è´¥çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•é¿å…å†æ¬¡å‡ºç°ç›¸åŒçš„æ•…éšœã€‚ç³»ç»Ÿå¯é æ€§æ˜¯æ•´ä¸ªå›¢é˜Ÿå…±åŒå¥‹æ–—çš„æ–¹å‘ï¼Œä»å¤±è´¥ä¸­å¿«é€Ÿæ¢å¤å¹¶å¸å–æ•™è®­ï¼Œæ¯ä¸ªäººæ”¾å¿ƒåœ°æå‡ºé—®é¢˜ï¼Œåº”å¯¹åœæœºï¼Œå¹¶åŠªåŠ›æ”¹è¿›ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;p&gt;å¤‡æ³¨: é€šå¸¸å¾ˆå¤šä¼ä¸šå†…éƒ¨åœ¨æ•…éšœå¤ç›˜è¿‡ç¨‹ä¸­ï¼Œç›¸å…³äººå‘˜å¯èƒ½å°†æ•…éšœå’Œå¤±è´¥çš„æ ¹å› è¿½æº¯ ä¸ç»æ„é—´ å½“åšäº†æ•…éšœå®šè´£å’Œä¸€ç³»åˆ—çš„æƒ©ç½šæªæ–½ï¼Œé€šè¿‡ä¸€äº›æƒ©æˆ’æªæ–½æ¥å¼ºè¡Œçº¦å®šæ•…éšœçš„å‘ç”Ÿï¼Œè¿™ç§æ–¹å¼å¾€å¾€æ˜¯éå¸¸ä¸å¯å–çš„ï¼Œè¯•æƒ³æ¯ä¸ªäººéƒ½ä¸æƒ³å‡ºç°äº‹æ•…ï¼Œè¦ä¹ˆæ˜¯è®¤çŸ¥ä¹‹å¤–ï¼Œè¦ä¹ˆæ˜¯è§„åˆ™ç¼ºé™·ï¼Œæ°¸è¿œæ²¡æœ‰ä¸€ä¸ªäººæ˜çŸ¥ä¼šæœ‰æ•…éšœè€Œååå»åˆ¶é€ æ•…éšœçš„ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦ç‰¢è®°çš„æ˜¯: &lt;code&gt;æ•…éšœæ˜¯æˆ‘ä»¬å¯ä»¥ä»ä¸­å­¦ä¹ çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯è®©äººå®³æ€•å’Œç¾è€»çš„äº‹æƒ…ï¼&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ—¥å¸¸è¿ç»´è¿‡ç¨‹ä¸­ï¼Œå‡ºç°æ•…éšœç­‰äº‹æ•…å¯¹äºæˆ‘ä»¬è€Œè¨€å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¤ç›˜å­¦ä¹ æœºä¼šã€‚é€šè¿‡å†å²ç›‘æ§æ•°æ®ï¼Œåˆ†æäº‹æ•…å…¶ä¸­çš„æ ¹æœ¬åŸå› ï¼Œåˆ¶å®šåç»­åº”å¯¹ç­–ç•¥ï¼Œå¹¶ä¸”é€šè¿‡è¿ç»´å¹³å°å°†è¿™äº›åº”å¯¹ç­–ç•¥ç¼–è¾‘æˆæ ‡å‡†åŒ–ã€å¯é‡ç”¨ã€è‡ªåŠ¨åŒ–çš„è¿ç»´åº”ç”¨åœºæ™¯ï¼Œä¸ºåç»­ç›¸åŒé—®é¢˜çš„å¤„ç†æä¾›æ ‡å‡†ä¸”å¿«æ·çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ­£æ˜¯äº‹åå›é¡¾è¿™ä¸ªè¿‡ç¨‹æœ€çœŸå®çš„ä»·å€¼ä½“ç°ã€‚&lt;/p&gt;

&lt;h4 id=&#34;æµ‹è¯•ä¸å‘å¸ƒ&#34;&gt;æµ‹è¯•ä¸å‘å¸ƒ&lt;/h4&gt;

&lt;p&gt;æµ‹è¯•ä¸å‘å¸ƒå¯¹äºæ•´ä¸ªç¨³å®šæ€§å’Œå¯é æ€§çš„ä¸»è¦å‡ºäºä¸€ä¸ªé¢„é˜²çš„ä½œç”¨ï¼Œé¢„é˜²æ˜¯æŒ‡å°è¯•é™åˆ¶å‘ç”Ÿçš„äº‹æ•…æ•°é‡ï¼Œå¹¶ç¡®ä¿åœ¨å‘å¸ƒæ–°ä»£ç æ—¶åŸºç¡€æ¶æ„å’ŒæœåŠ¡èƒ½å¤Ÿä¿æŒç¨³å®šã€‚&lt;/p&gt;

&lt;p&gt;ä½œä¸ºä¸€ä¸ªé•¿æœŸä»äº‹è¿ç»´å·¥ä½œçš„äººï¼Œå¯èƒ½å†…å¿ƒä¸­æœ€ä¸ºææƒ§çš„è«è¿‡äºæ–°åº”ç”¨ç‰ˆæœ¬å‘å¸ƒã€‚å› ä¸ºé™¤äº†ç¡¬ä»¶å’Œç½‘ç»œè®¾å¤‡æŸåè¿™ä¸ªå±äºå¤©ç¾çº§åˆ«çš„æ¦‚ç‡äº‹ä»¶å¤–ï¼Œæ–°åº”ç”¨ç‰ˆæœ¬å‘å¸ƒçš„ç¬¬äºŒå¤©é€šå¸¸æ˜¯åœæœºä¸äº‹æ•…çš„é«˜å±æœŸã€‚æ‰€ä»¥ï¼Œå¯¹äºä¸€äº›é‡çº§è¾ƒå¤§çš„äº§å“é€šå¸¸ä¼šåœ¨èŠ‚å‡æ—¥ä»¥åŠé‡è¦æ´»åŠ¨å‰å¤•è¿›è¡Œå°ç½‘æ“ä½œï¼Œä»¥é¿å…æ–°ç‰ˆæœ¬ä¸Šçº¿è€Œå¯¼è‡´çš„ä¸šåŠ¡bugå‡ºç°ã€‚&lt;/p&gt;

&lt;p&gt;è€Œæµ‹è¯•æ˜¯åœ¨æˆæœ¬å’Œé£é™©ä¹‹é—´æ‰¾åˆ°é€‚å½“çš„å¹³è¡¡æ´»åŠ¨ã€‚å¦‚æœè¿‡äºå†’é™©ï¼Œä½ ä»¬å¯èƒ½å°±ä¼šç–²äºåº”ä»˜ç³»ç»Ÿå¤±è´¥ï¼›åè¿‡æ¥è¯´ï¼Œå¦‚æœä½ å¤ªä¿å®ˆï¼Œä½ å°±ä¸èƒ½è¶³å¤Ÿå¿«åœ°å‘å¸ƒæ–°ä¸œè¥¿ï¼Œè®©ä¼ä¸šåœ¨å¸‚åœºä¸Šç”Ÿå­˜ä¸‹æ¥ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨é”™è¯¯é¢„ç®—æ¯”è¾ƒå¤šï¼ˆå³åœ¨ä¸€æ®µæ—¶é—´å†…æ•…éšœå¯¼è‡´ç³»ç»Ÿåœæœºæ—¶é•¿è¾ƒå°‘ï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‚å½“å‡å°‘æµ‹è¯•èµ„æºå¹¶æ”¾å®½ç³»ç»Ÿä¸Šçº¿çš„æµ‹è¯•å’Œæ¡ä»¶ï¼Œè®©ä¸šåŠ¡å¯ä»¥æœ‰æ›´å¤šçš„åŠŸèƒ½ä¸Šçº¿ï¼Œä»¥ä¿æŒä¸šåŠ¡çš„æ•æ€ï¼›åœ¨é”™è¯¯é¢„ç®—æ¯”è¾ƒå°‘ï¼ˆå³åœ¨ä¸€æ®µæ—¶é—´å†…æ•…éšœå¯¼è‡´ç³»ç»Ÿåœæœºæ—¶é•¿è¾ƒå¤šï¼‰çš„æƒ…å†µä¸‹ï¼Œåˆ™è¦å¢åŠ æµ‹è¯•èµ„æºå¹¶æ”¶ç´§ç³»ç»Ÿä¸Šçº¿çš„æµ‹è¯•ï¼Œè®©ç³»ç»Ÿçš„æ½œåœ¨é£é™©å¾—åˆ°æ›´å¤šæœ‰æ•ˆçš„é‡Šæ”¾ï¼Œé¿å…ç³»ç»Ÿåœæœºä¿æŒç³»ç»Ÿçš„ç¨³æ€ã€‚è¿™ç§æ•æ€ä¸ç¨³æ€ä¹‹é—´çš„å¹³è¡¡ï¼Œéœ€è¦æ•´ä¸ªè¿ç»´ä¸å¼€å‘å›¢é˜Ÿæ¥å…±åŒæ‰¿æ‹…ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†æµ‹è¯•å¤–ï¼Œåº”ç”¨å‘å¸ƒä¹Ÿæ˜¯ä¸€é¡¹è¿ç»´å›¢é˜Ÿé€šå¸¸è¦æ‰¿æ‹…çš„è´£ä»»ã€‚SREçš„ä¸€ä¸ªåŸåˆ™æ˜¯å°†ä¸€åˆ‡å¯ä»¥é‡å¤æ€§åŠ³åŠ¨ä»£ç åŒ–å’Œå·¥å…·åŒ–ï¼›æ­¤å¤–ï¼Œåº”ç”¨å‘å¸ƒçš„å¤æ‚ç¨‹åº¦å¾€å¾€ä¸ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦æˆæ­£æ¯”ã€‚å› æ­¤åœ¨åº”ç”¨ç³»ç»Ÿä¸Šè§„æ¨¡ä¼ä¸šï¼Œå¾€å¾€å·²ç»ç€æ‰‹åŸºäºè‡ªåŠ¨åŒ–æ¡†æ¶æ„å»ºè‡ªåŠ¨åŒ–çš„åº”ç”¨å‘å¸ƒè¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfxl3eouisj30u00c8dhq.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡è‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæµæ°´çº¿å®ç°éƒ¨ç½²çš„è¿‡ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œï¼ˆå¦‚ç¼–è¯‘æ‰“åŒ…ã€æµ‹è¯•å‘å¸ƒã€ç”Ÿäº§å‡†å¤‡ã€å‘Šè­¦å±è”½ã€æœåŠ¡åœæ­¢ã€æ•°æ®åº“æ‰§è¡Œã€åº”ç”¨éƒ¨ç½²ã€æœåŠ¡é‡å¯ç­‰ï¼‰å…¨éƒ¨è‡ªåŠ¨åŒ–ã€‚&lt;/p&gt;

&lt;h4 id=&#34;å®¹é‡è§„åˆ’&#34;&gt;å®¹é‡è§„åˆ’&lt;/h4&gt;

&lt;p&gt;å®¹é‡è§„åˆ’æ˜¯å…³äºé¢„æµ‹æœªæ¥å’Œå‘ç°ç³»ç»Ÿæé™çš„ï¼Œå®¹é‡è§„åˆ’ä¹Ÿæ˜¯ä¸ºäº†ç¡®ä¿ç³»ç»Ÿå¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»å¾—åˆ°å®Œå–„å’Œå¢å¼ºã€‚&lt;/p&gt;

&lt;p&gt;è§„åˆ’çš„ä¸»è¦ç›®æ ‡æ˜¯ç®¡ç†é£é™©å’ŒæœŸæœ›ï¼Œå¯¹äºå®¹é‡è§„åˆ’ï¼Œæ¶‰åŠåˆ°å°†å®¹é‡æ‰©å±•åˆ°æ•´ä¸ªä¸šåŠ¡ï¼›æ‰€å…³æ³¨çš„æœŸæœ›æ˜¯äººä»¬åœ¨çœ‹åˆ°ä¸šåŠ¡å¢é•¿æ—¶æœŸæœ›æœåŠ¡å¦‚ä½•å“åº”ã€‚é£é™©æ˜¯åœ¨é¢å¤–çš„åŸºç¡€è®¾æ–½ä¸ŠèŠ±è´¹æ—¶é—´å’Œé‡‘é’±æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;å®¹é‡è§„åˆ’é¦–å…ˆæ˜¯å¯¹æœªæ¥é¢„æµ‹æ€§çš„åˆ†æä¸åˆ¤æ–­ï¼Œå…¶é¢„æµ‹çš„åŸºç¡€æ­£æ˜¯æµ·é‡çš„è¿ç»´æ•°æ®ã€‚å› æ­¤ï¼Œå®¹é‡è§„åˆ’é™¤äº†æœ‰ç›¸åº”çš„æ¶æ„å’Œè§„åˆ’å›¢é˜Ÿå¤–ï¼Œä¸€ä¸ªå…¨é¢çš„è¿ç»´æ•°æ®ä¸­å¿ƒæ˜¯å®ç°ç³»ç»Ÿå®¹é‡è§„åˆ’çš„å¿…é¡»è®¾æ–½ã€‚&lt;/p&gt;

&lt;p&gt;å®¹é‡è¶‹åŠ¿é¢„è­¦å’Œåˆ†æå°†ç»¼åˆåœ°ä»å„ç§è¿ç»´ç›‘æ§ã€æµç¨‹ç®¡ç†ç­‰æ•°æ®æºä¸­æ”¶é›†ã€æ•´ç†ã€æ¸…æ´—å¹¶ç»“æ„åŒ–åœ°å­˜å‚¨å„ç§è¿ç»´æ•°æ®ï¼Œå°†è¿™äº›æ¥è‡ªäºå„ç§å·¥å…·çš„è¿ç»´æ•°æ®æ‰“é€šèåˆå¹¶ä¸”æ„å»ºå„ç§æ•°æ®ä¸»é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;åº”ç”¨è¿™äº›æ•°æ®ä¸»é¢˜çš„æ•°æ®ç”¨äºå¸®åŠ©è¿ç»´äººå‘˜å¯¹é—®é¢˜è¿›è¡Œè¯„ä¼°ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å½“å‰çš„å®¹é‡æ˜¯å¤šå°‘&lt;/li&gt;
&lt;li&gt;ä½•æ—¶è¾¾åˆ°å®¹é‡æé™&lt;/li&gt;
&lt;li&gt;åº”è¯¥å¦‚ä½•æ›´æ”¹å®¹é‡&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå®¹é‡è§„åˆ’&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿ç»´å¹³å°é™¤äº†å¯ä»¥æä¾›å¿…è¦çš„æ•°æ®æ”¯æŒå¤–ï¼Œè¿˜éœ€è¦æä¾›å¿…è¦çš„æ•°æ®å¯è§†åŒ–æ”¯æŒèƒ½åŠ›ã€‚è¿ç»´æ•°æ®å¯è§†åŒ–æä¾›äº†ä¸€äº›å¿…è¦çš„èƒ½åŠ›ä¿éšœè¿ç»´äººå‘˜å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨å…¶ä¸­çš„è¿ç»´æ•°æ®è¯„ä¼°å®¹é‡ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œè¿ç»´å¹³å°éœ€è¦æœ‰æå¼ºçš„æ•°æ®æ£€ç´¢èƒ½åŠ›ã€‚è¿ç»´å¹³å°å­˜å‚¨ç€æµ·é‡çš„è¿ç»´æ•°æ®ï¼Œè¿ç»´äººå‘˜ä¸ºäº†å°è¯•å»ºç«‹å’ŒéªŒè¯ä¸€ä¸ªæ¢ç´¢æ€§åœºæ™¯çš„æ—¶å€™ï¼Œå¾€å¾€å¤šæ¬¡åå¤æ£€ç´¢å’ŒæŸ¥è¯¢ç‰¹å®šæ•°æ®ã€‚å¦‚æœè¿ç»´æ•°æ®åˆ†æå¹³å°çš„æ•°æ®æŸ¥è¯¢å¾ˆæ…¢æˆ–è€…æŸ¥è¯¢è§’åº¦å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œè¿ç»´äººå‘˜å»ºç«‹åœºæ™¯çš„æ—¶é—´å°±ä¼šæ‹–å¾—å¾ˆé•¿ç”šè‡³è¿›è¡Œä¸ä¸‹å»ã€‚å› æ­¤ï¼Œè¿ç»´äººå‘˜å¯é€šè¿‡å¹³å°å¯ä»¥å®ç°å…³é”®å­—ã€ç»Ÿè®¡å‡½æ•°ã€å•æ¡ä»¶ã€å¤šæ¡ä»¶ã€æ¨¡ç³Šå¤šç»´åº¦æŸ¥æ‰¾åŠŸèƒ½ï¼Œä»¥åŠå®ç°æµ·é‡æ•°æ®ç§’çº§æŸ¥è¯¢ï¼Œæ‰èƒ½æ›´æœ‰æ•ˆå¸®åŠ©è¿ç»´äººå‘˜æ›´ä¾¿æ·åˆ†ææ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;å…¶äºŒï¼Œå¹³å°éœ€è¦å¼ºå¤§çš„æ•°æ®å¯è§†åŒ–èƒ½åŠ›ã€‚äººä»¬å¸¸è¯´â€œåƒè¨€ä¸‡è¯­ä¸åŠä¸€å›¾â€ï¼Œè¿ç»´äººå‘˜ç»å¸¸ä¼šé€šè¿‡å„ç³»ç»Ÿçš„è¿ç»´æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æå¹¶ç”Ÿæˆå„ç±»å®æ—¶æŠ¥è¡¨ï¼Œå¯¹å„ç±»è¿ç»´æ•°æ®ï¼ˆå¦‚åº”ç”¨æ—¥å¿—ã€äº¤æ˜“æ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ï¼‰è¿›è¡Œå¤šç»´åº¦ã€å¤šè§’åº¦æ·±å…¥åˆ†æã€é¢„æµ‹åŠå¯è§†åŒ–å±•ç°ï¼Œå°†ä»–ä»¬åˆ†æçš„é¢„æµ‹ç»“æœå’Œç»éªŒå‘ä»–äººè¡¨è¾¾å’Œæ¨å¹¿ã€‚&lt;/p&gt;

&lt;h4 id=&#34;è‡ªåŠ¨åŒ–å·¥å…·å¼€å‘&#34;&gt;è‡ªåŠ¨åŒ–å·¥å…·å¼€å‘&lt;/h4&gt;

&lt;p&gt;SREä¸ä»…æ¶‰åŠè¿è¥ï¼Œè¿˜æ¶‰åŠè½¯ä»¶å¼€å‘ï¼Œå½“ç„¶è¿™éƒ¨åˆ†æŒ‡çš„æ˜¯å’Œè¿ç»´ä»¥åŠSREé¢†åŸŸç›¸å…³çš„å·¥å…·å’Œå¹³å°å¼€å‘ã€‚åœ¨Googleçš„SREä½“ç³»ä¸­ï¼ŒSREå·¥ç¨‹å¸ˆå°†èŠ±è´¹å¤§çº¦ä¸€åŠçš„æ—¶é—´æ¥å¼€å‘æ–°çš„å·¥å…·å’ŒæœåŠ¡ï¼Œè¿™äº›å·¥å…·çš„ä¸€éƒ¨åˆ†ç”¨äºè‡ªåŠ¨åŒ–ä¸€äº›æ‰‹åŠ¨ä»»åŠ¡ï¼Œè€Œå…¶ä»–éƒ¨åˆ†ç”¨äºæ¥ä¸æ–­å¡«è¡¥å’Œä¿®å¤æ•´ä¸ªSREä½“ç³»å†…éƒ¨çš„å…¶ä»–ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡ç¼–å†™ä»£ç æŠŠè‡ªå·±å’Œå…¶ä»–äººä»é‡å¤çš„å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ï¼Œå¦‚æœæˆ‘ä»¬ä¸éœ€è¦äººç±»æ¥å®Œæˆä»»åŠ¡ï¼Œé‚£ä¹ˆå°±ç¼–å†™ä»£ç ï¼Œè¿™æ ·äººç±»å°±ä¸éœ€è¦å‚ä¸å…¶ä¸­äº†ã€‚&lt;/p&gt;

&lt;p&gt;SREä»å†…å¿ƒä¸Šé„™è§†é‡å¤æ€§çš„å·¥ä½œï¼Œå°†ä»åŸæœ‰çš„äººå·¥åŠ è¢«åŠ¨å“åº”ï¼Œè½¬å˜ä¸º&lt;code&gt;æ›´é«˜æ•ˆã€æ›´ä¸ºè‡ªåŠ¨åŒ–&lt;/code&gt;çš„è¿ç»´ä½“ç³»ã€‚&lt;/p&gt;

&lt;p&gt;è‡ªåŠ¨åŒ–è¿ç»´æ¡†æ¶:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfxlg6x4l2j30u00cogoj.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·çš„ä¼˜åŠ¿å’Œå¿…è¦æ€§:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æé«˜æ•ˆç‡: ç”±ç¨‹åºè‡ªåŠ¨åŒ–æ“ä½œï¼Œæœ‰æ•ˆåœ°é™ä½è¿ç»´äººåŠ›èµ„æºçš„æŠ•å…¥ï¼Œä¹Ÿè®©è¿ç»´äººå‘˜çš„ç²¾åŠ›å¾—ä»¥é‡Šæ”¾å¹¶æŠ•å‘æ›´ä¸ºé‡è¦çš„é¢†åŸŸã€‚&lt;/li&gt;
&lt;li&gt;æ“ä½œçš„æ ‡å‡†åŒ–: å°†åŸæ¥è®¸å¤šå¤æ‚ã€æ˜“é”™çš„æ‰‹å·¥æ“ä½œå®ç°ç»Ÿä¸€è¿ç»´æ“ä½œå…¥å£ï¼Œå®ç°è¿ç»´æ“ä½œç™½å±åŒ–ï¼Œæå‡è¿ç»´æ“ä½œçš„å¯ç®¡ç†æ€§ï¼›åŒæ—¶ï¼Œå‡å°‘ç”±äºè¿ç»´äººå‘˜æƒ…ç»ªå¸¦æ¥æ‰‹å·¥è¯¯æ“ä½œï¼Œé¿å…â€œä»åˆ åº“åˆ°è·‘è·¯â€è¿™æ ·çš„æ‚²å‰§çš„å‘ç”Ÿã€‚&lt;/li&gt;
&lt;li&gt;è¿ç»´ç»éªŒèƒ½åŠ›çš„ä¼ æ‰¿: è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·å°†åŸæ¥è®¸å¤šè¿ç»´å›¢é˜Ÿç§¯ç´¯çš„ç»éªŒä»¥ä»£ç æ–¹å¼æ€»ç»“ä¸ºå„ç§è¿ç»´å·¥å…·ï¼Œå®ç°è‡ªåŠ¨åŒ–å’Œç™½å±åŒ–çš„è¿ç»´æ“ä½œã€‚è¿ç»´å›¢é˜Ÿçš„åæ¥è€…ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç»§æ‰¿ã€é‡å¤ä½¿ç”¨å¹¶ä¼˜åŒ–å®ƒä»¬ã€‚è¿™ç§ä»£ç åŒ–çš„å·¥ä½œä¼ æ‰¿ï¼Œå°†ä¸ªäººèƒ½åŠ›è½¬å˜ä¸ºå›¢é˜Ÿèƒ½åŠ›ï¼Œå¹¶å‡å°‘äººå‘˜æµåŠ¨å¸¦æ¥å¯¹å·¥ä½œçš„å½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ„å»ºè‡ªåŠ¨åŒ–è¿ç»´ä½“ç³»å°±å¿…é¡»ä»¥&lt;code&gt;è¿ç»´åœºæ™¯&lt;/code&gt;ä¸ºåŸºç¡€ï¼Œè¿™äº›è¿ç»´åœºæ™¯æ˜¯åœ¨æœ¬ä¼ä¸šå†…åå¤è¿­ä»£å’Œæ‰“é€ ï¼Œæ˜¯ä¼ä¸šä¸­æœ€å¸¸ç”¨çš„è¿ç»´åœºæ™¯ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚å¸¸è§çš„è¿ç»´åœºæ™¯ï¼šè½¯ä»¶å®‰è£…éƒ¨ç½²ã€åº”ç”¨å‘å¸ƒäº¤ä»˜ã€èµ„äº§ç®¡ç†ã€å‘Šè­¦è‡ªåŠ¨å¤„ç†ã€æ•…éšœåˆ†æã€èµ„æºç”³è¯·ã€è‡ªåŠ¨åŒ–å·¡æ£€ç­‰ç­‰ã€‚å› æ­¤ï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–è¿ç»´ä½“ç³»å»ºè®¾æ—¶ä¹Ÿåº”æ”¯æŒå¤šç§ä¸åŒç±»å‹çš„è‡ªåŠ¨åŒ–ä½œä¸šé…ç½®èƒ½åŠ›ï¼Œé€šè¿‡ç®€å•çš„è„šæœ¬å¼€å‘ã€åœºæ™¯é…ç½®å’Œå¯è§†åŒ–å®šåˆ¶æµç¨‹å®ç°æ›´å¤šè¿ç»´åœºæ™¯çš„å®ç°ã€‚&lt;/p&gt;

&lt;h4 id=&#34;ç”¨æˆ·ä½“éªŒ&#34;&gt;ç”¨æˆ·ä½“éªŒ&lt;/h4&gt;

&lt;p&gt;ç”¨æˆ·ä½“éªŒè¿™ä¸€å±‚è¦è¯´çš„æ˜¯ï¼Œä½œä¸ºSREæ¥è®²ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥ä¿è¯ä¸šåŠ¡çš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§æ‰æ˜¯æœ€ç»ˆç›®æ ‡ã€‚è¿™ä¸ªæ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„è¿ç»´äººå‘˜æ˜¯ä¸ä¼šå…³æ³¨è¿™ä¸€ç‚¹çš„ï¼Œå› ä¸ºå¤§å®¶é€šå¸¸åªä¼šè€ƒè™‘åˆ°æˆ‘åº•å±‚è¿ç»´çš„ç³»ç»Ÿæˆ–åº•å±‚èµ„æºæ˜¯å¦ç¨³å®šï¼Œä½†å®é™…ä¸Šæ•´ä¸ªä¸šåŠ¡çš„ç¨³å®šæ‰æ˜¯SREéœ€è¦å…³å¿ƒçš„é—®é¢˜ï¼Œè€Œä¸šåŠ¡çš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§é€šå¸¸éœ€è¦ç«™åœ¨ç”¨æˆ·çš„è§’åº¦æ¥æ¨¡æ‹Ÿå’Œè¡¡é‡æ•´ä½“çš„å¯ç”¨æ€§å’Œå¯é æ€§ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å‰é¢æåˆ°çš„æ‰€æœ‰SREç›¸å…³çš„å·¥ä½œèŒƒç•´ï¼Œæ— è®ºæ˜¯ç›‘æ§ã€äº‹æ•…å“åº”ã€å›é¡¾ã€æµ‹è¯•ä¸å‘å¸ƒã€å®¹é‡è§„åˆ’ä»¥åŠæ„å»ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œæ— ééƒ½æ˜¯ä¸ºäº†æä¾›æ›´å¥½çš„ç³»ç»Ÿç”¨æˆ·ä¸šåŠ¡ä½“éªŒè€ŒæœåŠ¡çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿ç»´çš„è¿‡ç¨‹ä¸­æ— ä¸éœ€è¦æ³¨æ„å…³æ³¨ç³»ç»Ÿçš„ç”¨æˆ·ä½“éªŒã€‚&lt;/p&gt;

&lt;p&gt;è€Œåœ¨å®é™…è¿ç»´å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¾€å¾€å¯ä»¥é€šè¿‡åº”ç”¨æ—¥å¿—ã€ç›‘æ§æ•°æ®ã€ä¸šåŠ¡æ‹”æµ‹ç­‰ä¸šåŠ¡ç›¸å…³çš„ç”¨æˆ·ä½“éªŒä¿¡æ¯ã€‚åœ¨è¿ç»´æ•°æ®å¹³å°ä¸­ï¼Œé€šè¿‡è¿™äº›ç”¨æˆ·ä½“éªŒç›‘æµ‹æ•°æ®ä¹‹é—´çš„å…³è”å’Œä¸²è”ï¼Œé‡ç°ç”¨æˆ·çš„æœ€ç»ˆä¸šåŠ¡è°ƒç”¨é“¾è·¯ä»¥åŠå„åº”ç”¨ç¯èŠ‚å¯¹æ€§èƒ½æ•°æ®çš„å…³ç³»ã€‚æœ€ç»ˆå½¢æˆä»ä¸šåŠ¡ç”¨æˆ·ä½“éªŒæ•°æ®å…¥æ‰‹ï¼Œé€æ­¥å®ç°ç³»ç»Ÿè¿è¡ŒçŠ¶æ€æ•°æ®ã€è®¾å¤‡è¿è¡ŒçŠ¶æ€æ•°æ®é“¾è·¯çš„æ‰“é€šï¼Œè®©è¿ç»´ä½“ç³»å®ç°ä»¥æœ€ç»ˆç”¨æˆ·ä½“éªŒä¸ºä¸­å¿ƒçš„ç›®æ ‡ã€‚&lt;/p&gt;

&lt;p&gt;è¿™äº›ç”¨æˆ·ä½“éªŒçš„ä¿¡æ¯ï¼Œå¯¹äºè¿ç»´å›¢é˜ŸæŒæ¡å®¢æˆ·æ•´ä½“çš„ç”¨æˆ·ä½“éªŒæƒ…å†µã€ç³»ç»Ÿå¯ç”¨æ€§çš„ç›‘æµ‹ä»¥åŠç³»ç»Ÿé’ˆå¯¹æ€§çš„ä¼˜åŒ–æä¾›ç€æ— å¯æ›¿ä»£çš„ä½œç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®ï¼ŒSREè¿ç»´ä½“ç³»æ›´ä¸ºå¼ºè°ƒä»¥ç”¨æˆ·çš„ä½“éªŒä¸ºæ ¸å¿ƒï¼Œä»¥è‡ªåŠ¨åŒ–å’Œè¿ç»´æ•°æ®ä¸ºæ‰‹æ®µï¼Œå®ç°åº”ç”¨ä¸šåŠ¡è¿ç»­æ€§ä¿éšœï¼Œä»è¿™ä¸ªç‚¹å‡ºå‘ï¼Œæˆ‘ä»¬ä¼šå‘ç°å’Œä»¥å¾€çš„ä¼ ç»Ÿè¿ç»´è¿˜æ˜¯æœ‰å¾ˆå¤§çš„åŒºåˆ«çš„ï¼Œæˆ‘ä»¬ä¸å†ä»…ä»…æ˜¯å•çº¯çš„å®‰è£…å’Œéƒ¨ç½²å·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ç³»åˆ—çš„æŠ€æœ¯æ‰‹æ®µæ¥ä¸æ–­ä¿éšœä¸Šå±‚ä¸šåŠ¡çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>kafkaä¸­å…³äºHW(High Watermark)å’ŒLeader Epochçš„è®¨è®º</title>
      <link>https://bgbiao.top/post/kafka%E9%AB%98%E6%B0%B4%E4%BD%8D%E5%92%8Cleader-epoch%E7%9A%84%E8%AE%A8%E8%AE%BA/</link>
      <pubDate>Mon, 15 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/kafka%E9%AB%98%E6%B0%B4%E4%BD%8D%E5%92%8Cleader-epoch%E7%9A%84%E8%AE%A8%E8%AE%BA/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“åœ¨kafkaä¸­æœ‰ä¸€ä¸ªåè¯å«åšHW(High Watermark)ï¼Œä½†æ˜¯å…·ä½“è¿™ä¸ªé«˜æ°´ä½æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸‹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;kafkaä¸­çš„é«˜æ°´ä½çš„ä½œç”¨:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å®šä¹‰æ¶ˆæ¯å¯è§æ€§ï¼Œå³ç”¨æ¥æ ‡è¯†åˆ†åŒºä¸‹çš„å“ªäº›æ¶ˆæ¯æ˜¯å¯ä»¥è¢«æ¶ˆè´¹è€…æ¶ˆè´¹çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¸®åŠ© Kafka å®Œæˆå‰¯æœ¬åŒæ­¥&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfva86hzzrj31bc0h6go3.jpg&#34; alt=&#34;kafkaé«˜æ°´ä½ä»¥åŠæ¶ˆæ¯æäº¤å›¾&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨kafkaçš„æŸä¸ªtopicä¸­ï¼Œåˆ†åŒºå’Œå‰¯æœ¬éƒ½æœ‰HWçš„æ¦‚å¿µï¼Œè€Œåˆ†åŒºçš„HWæ˜¯æ‰€æœ‰å‰¯æœ¬HWçš„æœ€å°å€¼ï¼Œä¹Ÿæ˜¯æ¶ˆè´¹è€…èƒ½å¤Ÿæ¶ˆè´¹åˆ°æœ€å¤§æ¶ˆæ¯ã€‚(å³: æ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹å·²ç»æäº¤çš„æ¶ˆæ¯)&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œä½ç§»å€¼ç­‰äºé«˜æ°´ä½çš„æ¶ˆæ¯ä¹Ÿå±äºæœªæäº¤æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;code&gt;é«˜æ°´ä½ä¸Šçš„æ¶ˆæ¯æ˜¯ä¸èƒ½è¢«æ¶ˆè´¹è€…æ¶ˆè´¹&lt;/code&gt;çš„ã€‚&lt;/p&gt;

&lt;p&gt;å›¾ä¸­è¿˜æœ‰ä¸€ä¸ªæ—¥å¿—æœ«ç«¯ä½ç§»çš„æ¦‚å¿µï¼Œå³ Log End Offsetï¼Œç®€å†™æ˜¯ LEOã€‚å®ƒè¡¨ç¤ºå‰¯æœ¬å†™å…¥ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ä½ç§»å€¼ã€‚æ³¨æ„ï¼Œæ•°å­— 15 æ‰€åœ¨çš„æ–¹æ¡†æ˜¯è™šçº¿ï¼Œè¿™å°±è¯´æ˜ï¼Œè¿™ä¸ªå‰¯æœ¬å½“å‰åªæœ‰ 15 æ¡æ¶ˆæ¯ï¼Œä½ç§»å€¼æ˜¯ä» 0 åˆ° 14ï¼Œä¸‹ä¸€æ¡æ–°æ¶ˆæ¯çš„ä½ç§»æ˜¯ 15ã€‚æ˜¾ç„¶ï¼Œä»‹äºé«˜æ°´ä½å’Œ LEO ä¹‹é—´çš„æ¶ˆæ¯å°±å±äºæœªæäº¤æ¶ˆæ¯ã€‚è¿™ä¹Ÿä»ä¾§é¢å‘Šè¯‰äº†æˆ‘ä»¬ä¸€ä¸ªé‡è¦çš„äº‹å®ï¼Œé‚£å°±æ˜¯ï¼š&lt;code&gt;åŒä¸€ä¸ªå‰¯æœ¬å¯¹è±¡ï¼Œå…¶é«˜æ°´ä½å€¼ä¸ä¼šå¤§äº LEO å€¼&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é«˜æ°´ä½æ›´æ–°æœºåˆ¶&#34;&gt;é«˜æ°´ä½æ›´æ–°æœºåˆ¶&lt;/h3&gt;

&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº†æ¯ä¸ªå‰¯æœ¬å¯¹è±¡éƒ½ä¿å­˜äº†ä¸€ç»„é«˜æ°´ä½å€¼å’Œ LEO å€¼ï¼Œä½†å®é™…ä¸Šï¼Œåœ¨ Leader å‰¯æœ¬æ‰€åœ¨çš„ Broker ä¸Šï¼Œè¿˜ä¿å­˜äº†å…¶ä»– Follower å‰¯æœ¬çš„ LEO å€¼ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvb7on0vpj316f0u0dju.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒBroker 0 ä¸Šä¿å­˜äº†æŸåˆ†åŒºçš„ Leader å‰¯æœ¬å’Œæ‰€æœ‰ Follower å‰¯æœ¬çš„ LEO å€¼ï¼Œè€Œ Broker 1 ä¸Šä»…ä»…ä¿å­˜äº†è¯¥åˆ†åŒºçš„æŸä¸ª Follower å‰¯æœ¬ã€‚Kafka æŠŠ Broker 0 ä¸Šä¿å­˜çš„è¿™äº› Follower å‰¯æœ¬åˆç§°ä¸º&lt;code&gt;è¿œç¨‹å‰¯æœ¬&lt;/code&gt; Remote Replicaï¼‰ã€‚Kafka å‰¯æœ¬æœºåˆ¶åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæ›´æ–° Broker 1 ä¸Š Follower å‰¯æœ¬çš„é«˜æ°´ä½å’Œ LEO å€¼ï¼ŒåŒæ—¶ä¹Ÿä¼šæ›´æ–° Broker 0 ä¸Š Leader å‰¯æœ¬çš„é«˜æ°´ä½å’Œ LEO ä»¥åŠæ‰€æœ‰è¿œç¨‹å‰¯æœ¬çš„ LEOï¼Œä½†å®ƒä¸ä¼šæ›´æ–°è¿œç¨‹å‰¯æœ¬çš„é«˜æ°´ä½å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘åœ¨å›¾ä¸­æ ‡è®°ä¸ºç°è‰²çš„éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºä»€ä¹ˆè¦åœ¨ Broker 0 ä¸Šä¿å­˜è¿™äº›è¿œç¨‹å‰¯æœ¬å‘¢ï¼Ÿå…¶å®ï¼Œå®ƒä»¬çš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œ&lt;code&gt;å¸®åŠ© Leader å‰¯æœ¬ç¡®å®šå…¶é«˜æ°´ä½ï¼Œä¹Ÿå°±æ˜¯åˆ†åŒºé«˜æ°´ä½&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½åœ°è®°å¿†è¿™äº›å€¼è¢«æ›´æ–°çš„æ—¶æœºï¼Œæˆ‘åšäº†ä¸€å¼ è¡¨æ ¼ã€‚åªæœ‰ææ¸…æ¥šäº†æ›´æ–°æœºåˆ¶ï¼Œæˆ‘ä»¬æ‰èƒ½å¼€å§‹è®¨è®º Kafka å‰¯æœ¬æœºåˆ¶çš„åŸç†ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•ä½¿ç”¨é«˜æ°´ä½æ¥æ‰§è¡Œå‰¯æœ¬æ¶ˆæ¯åŒæ­¥çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvb9nilwvj30h60fogo4.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åˆ¤æ–­Leader å‰¯æœ¬ä¿æŒåŒæ­¥çš„æ¡ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è¿œç¨‹ Follower å‰¯æœ¬åœ¨ ISR ä¸­&lt;/li&gt;
&lt;li&gt;Follower å‰¯æœ¬ LEO å€¼è½åäº Leader å‰¯æœ¬ LEO å€¼çš„æ—¶é—´ï¼Œä¸è¶…è¿‡ Broker ç«¯å‚æ•° replica.lag.time.max.ms çš„å€¼ã€‚å¦‚æœä½¿ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå°±æ˜¯ä¸è¶…è¿‡ 10 ç§’&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¹ä¸€çœ‹ï¼Œè¿™ä¸¤ä¸ªæ¡ä»¶å¥½åƒæ˜¯ä¸€å›äº‹ï¼Œå› ä¸ºç›®å‰æŸä¸ªå‰¯æœ¬èƒ½å¦è¿›å…¥ ISR å°±æ˜¯é ç¬¬ 2 ä¸ªæ¡ä»¶åˆ¤æ–­çš„ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œä¼šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼šå³ Follower å‰¯æœ¬å·²ç» â€œè¿½ä¸Šâ€ äº† Leader çš„è¿›åº¦ï¼Œå´ä¸åœ¨ ISR ä¸­ï¼Œæ¯”å¦‚æŸä¸ªåˆšåˆšé‡å¯å›æ¥çš„å‰¯æœ¬ã€‚å¦‚æœ Kafka åªåˆ¤æ–­ç¬¬ 1 ä¸ªæ¡ä»¶çš„è¯ï¼Œå°±å¯èƒ½å‡ºç°æŸäº›å‰¯æœ¬å…·å¤‡äº† â€œè¿›å…¥ ISRâ€ çš„èµ„æ ¼ï¼Œä½†å´å°šæœªè¿›å…¥åˆ° ISR ä¸­çš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œåˆ†åŒºé«˜æ°´ä½å€¼å°±å¯èƒ½è¶…è¿‡ ISR ä¸­å‰¯æœ¬ LEOï¼Œè€Œé«˜æ°´ä½ &amp;gt; LEO çš„æƒ…å½¢æ˜¯ä¸è¢«å…è®¸çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å‰¯æœ¬åŒæ­¥æœºåˆ¶è§£æ&#34;&gt;å‰¯æœ¬åŒæ­¥æœºåˆ¶è§£æ&lt;/h3&gt;

&lt;p&gt;å‰¯æœ¬åŒæ­¥çš„å…¨è¿‡ç¨‹:&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæ˜¯åˆå§‹çŠ¶æ€ã€‚ä¸‹é¢è¿™å¼ å›¾ä¸­çš„ remote LEO å°±æ˜¯åˆšæ‰çš„è¿œç¨‹å‰¯æœ¬çš„ LEO å€¼ã€‚åœ¨åˆå§‹çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰å€¼éƒ½æ˜¯ 0ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvbgu2idsj30nd03awet.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å½“ç”Ÿäº§è€…ç»™ä¸»é¢˜åˆ†åŒºå‘é€ä¸€æ¡æ¶ˆæ¯åï¼ŒçŠ¶æ€å˜æ›´ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvbh4glr3j30nd07wwf7.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ­¤æ—¶ï¼ŒLeader å‰¯æœ¬æˆåŠŸå°†æ¶ˆæ¯å†™å…¥äº†æœ¬åœ°ç£ç›˜ï¼Œæ•… LEO å€¼è¢«æ›´æ–°ä¸º 1ã€‚&lt;/p&gt;

&lt;p&gt;Follower å†æ¬¡å°è¯•ä» Leader æ‹‰å–æ¶ˆæ¯ã€‚å’Œä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡æœ‰æ¶ˆæ¯å¯ä»¥æ‹‰å–äº†ï¼Œå› æ­¤çŠ¶æ€è¿›ä¸€æ­¥å˜æ›´ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvbhh5e15j30nc08a3z8.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ—¶ï¼ŒFollower å‰¯æœ¬ä¹ŸæˆåŠŸåœ°æ›´æ–° LEO ä¸º 1ã€‚æ­¤æ—¶ï¼ŒLeader å’Œ Follower å‰¯æœ¬çš„ LEO éƒ½æ˜¯ 1ï¼Œä½†å„è‡ªçš„é«˜æ°´ä½ä¾ç„¶æ˜¯ 0ï¼Œè¿˜æ²¡æœ‰è¢«æ›´æ–°ã€‚&lt;code&gt;å®ƒä»¬éœ€è¦åœ¨ä¸‹ä¸€è½®çš„fetch requestä¸­è¢«æ›´æ–°&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvbi5gvykj30nu0cft9w.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ–°ä¸€è½®çš„æ‹‰å–è¯·æ±‚ä¸­ï¼Œç”±äºä½ç§»å€¼æ˜¯ 0 çš„æ¶ˆæ¯å·²ç»æ‹‰å–æˆåŠŸï¼Œå› æ­¤ Follower å‰¯æœ¬è¿™æ¬¡è¯·æ±‚æ‹‰å–çš„æ˜¯ä½ç§»å€¼ =1 çš„æ¶ˆæ¯ã€‚Leader å‰¯æœ¬æ¥æ”¶åˆ°æ­¤è¯·æ±‚åï¼Œæ›´æ–°è¿œç¨‹å‰¯æœ¬ LEO ä¸º 1ï¼Œç„¶åæ›´æ–° Leader é«˜æ°´ä½ä¸º 1ã€‚åšå®Œè¿™äº›ä¹‹åï¼Œå®ƒä¼šå°†å½“å‰å·²æ›´æ–°è¿‡çš„é«˜æ°´ä½å€¼ 1 å‘é€ç»™ Follower å‰¯æœ¬ã€‚Follower å‰¯æœ¬æ¥æ”¶åˆ°ä»¥åï¼Œä¹Ÿå°†è‡ªå·±çš„é«˜æ°´ä½å€¼æ›´æ–°æˆ 1ã€‚è‡³æ­¤ï¼Œä¸€æ¬¡å®Œæ•´çš„æ¶ˆæ¯åŒæ­¥å‘¨æœŸå°±ç»“æŸäº†ã€‚äº‹å®ä¸Šï¼ŒKafka å°±æ˜¯åˆ©ç”¨è¿™æ ·çš„æœºåˆ¶ï¼Œå®ç°äº† Leader å’Œ Follower å‰¯æœ¬ä¹‹é—´çš„åŒæ­¥ã€‚&lt;/p&gt;

&lt;h3 id=&#34;leader-epoch-ç™»åœº&#34;&gt;Leader Epoch ç™»åœº&lt;/h3&gt;

&lt;p&gt;ä»åˆšæ‰çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒFollower å‰¯æœ¬çš„é«˜æ°´ä½æ›´æ–°éœ€è¦ä¸€è½®é¢å¤–çš„æ‹‰å–è¯·æ±‚æ‰èƒ½å®ç°ã€‚å¦‚æœæŠŠä¸Šé¢é‚£ä¸ªä¾‹å­æ‰©å±•åˆ°å¤šä¸ª Follower å‰¯æœ¬ï¼Œæƒ…å†µå¯èƒ½æ›´ç³Ÿï¼Œä¹Ÿè®¸éœ€è¦å¤šè½®æ‹‰å–è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒLeader å‰¯æœ¬é«˜æ°´ä½æ›´æ–°å’Œ Follower å‰¯æœ¬é«˜æ°´ä½æ›´æ–°åœ¨æ—¶é—´ä¸Šæ˜¯å­˜åœ¨é”™é…çš„ã€‚è¿™ç§é”™é…æ˜¯å¾ˆå¤š â€œæ•°æ®ä¸¢å¤±â€ æˆ– â€œæ•°æ®ä¸ä¸€è‡´â€ é—®é¢˜çš„æ ¹æºã€‚åŸºäºæ­¤ï¼Œç¤¾åŒºåœ¨ 0.11 ç‰ˆæœ¬æ­£å¼å¼•å…¥äº† Leader Epoch æ¦‚å¿µï¼Œæ¥è§„é¿å› é«˜æ°´ä½æ›´æ–°é”™é…å¯¼è‡´çš„å„ç§ä¸ä¸€è‡´é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€è°“ Leader Epochï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥è®¤ä¸ºæ˜¯ &lt;code&gt;Leader ç‰ˆæœ¬&lt;/code&gt;ã€‚å®ƒç”±ä¸¤éƒ¨åˆ†æ•°æ®ç»„æˆã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Epochã€‚ä¸€ä¸ªå•è°ƒå¢åŠ çš„ç‰ˆæœ¬å·ã€‚æ¯å½“å‰¯æœ¬é¢†å¯¼æƒå‘ç”Ÿå˜æ›´æ—¶ï¼Œéƒ½ä¼šå¢åŠ è¯¥ç‰ˆæœ¬å·ã€‚å°ç‰ˆæœ¬å·çš„ Leader è¢«è®¤ä¸ºæ˜¯è¿‡æœŸ Leaderï¼Œä¸èƒ½å†è¡Œä½¿ Leader æƒåŠ›&lt;/li&gt;
&lt;li&gt;èµ·å§‹ä½ç§»ï¼ˆStart Offsetï¼‰ã€‚Leader å‰¯æœ¬åœ¨è¯¥ Epoch å€¼ä¸Šå†™å…¥çš„é¦–æ¡æ¶ˆæ¯çš„ä½ç§»&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ Leader Epochã€‚å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ª Leader Epoch&lt;0, 0&gt; å’Œ &lt;1, 120&gt;ï¼Œé‚£ä¹ˆï¼Œç¬¬ä¸€ä¸ª Leader Epoch è¡¨ç¤ºç‰ˆæœ¬å·æ˜¯ 0ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ Leader ä»ä½ç§» 0 å¼€å§‹ä¿å­˜æ¶ˆæ¯ï¼Œä¸€å…±ä¿å­˜äº† 120 æ¡æ¶ˆæ¯ã€‚ä¹‹åï¼ŒLeader å‘ç”Ÿäº†å˜æ›´ï¼Œç‰ˆæœ¬å·å¢åŠ åˆ° 1ï¼Œæ–°ç‰ˆæœ¬çš„èµ·å§‹ä½ç§»æ˜¯ 120ã€‚&lt;/p&gt;

&lt;p&gt;Kafka Broker ä¼šåœ¨å†…å­˜ä¸­ä¸ºæ¯ä¸ªåˆ†åŒºéƒ½ç¼“å­˜ Leader Epoch æ•°æ®ï¼ŒåŒæ—¶å®ƒè¿˜ä¼šå®šæœŸåœ°å°†è¿™äº›ä¿¡æ¯æŒä¹…åŒ–åˆ°ä¸€ä¸ª checkpoint æ–‡ä»¶ä¸­ã€‚å½“ Leader å‰¯æœ¬å†™å…¥æ¶ˆæ¯åˆ°ç£ç›˜æ—¶ï¼ŒBroker ä¼šå°è¯•æ›´æ–°è¿™éƒ¨åˆ†ç¼“å­˜ã€‚å¦‚æœè¯¥ Leader æ˜¯é¦–æ¬¡å†™å…¥æ¶ˆæ¯ï¼Œé‚£ä¹ˆ Broker ä¼šå‘ç¼“å­˜ä¸­å¢åŠ ä¸€ä¸ª Leader Epoch æ¡ç›®ï¼Œå¦åˆ™å°±ä¸åšæ›´æ–°ã€‚è¿™æ ·ï¼Œæ¯æ¬¡æœ‰ Leader å˜æ›´æ—¶ï¼Œæ–°çš„ Leader å‰¯æœ¬ä¼šæŸ¥è¯¢è¿™éƒ¨åˆ†ç¼“å­˜ï¼Œå–å‡ºå¯¹åº”çš„ Leader Epoch çš„èµ·å§‹ä½ç§»ï¼Œä»¥é¿å…æ•°æ®ä¸¢å¤±å’Œä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œå®ƒå±•ç¤ºçš„æ˜¯ Leader Epoch æ˜¯å¦‚ä½•é˜²æ­¢æ•°æ®ä¸¢å¤±çš„ã€‚è¯·å…ˆçœ‹ä¸‹å›¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvbnxpmjcj30x30u0q75.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œå•çº¯ä¾èµ–é«˜æ°´ä½æ˜¯æ€ä¹ˆé€ æˆæ•°æ®ä¸¢å¤±çš„ã€‚å¼€å§‹æ—¶ï¼Œå‰¯æœ¬ A å’Œå‰¯æœ¬ B éƒ½å¤„äºæ­£å¸¸çŠ¶æ€ï¼ŒA æ˜¯ Leader å‰¯æœ¬ã€‚æŸä¸ªä½¿ç”¨äº†é»˜è®¤ acks è®¾ç½®çš„ç”Ÿäº§è€…ç¨‹åºå‘ A å‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼ŒA å…¨éƒ¨å†™å…¥æˆåŠŸï¼Œæ­¤æ—¶ Kafka ä¼šé€šçŸ¥ç”Ÿäº§è€…è¯´ä¸¤æ¡æ¶ˆæ¯å…¨éƒ¨å‘é€æˆåŠŸã€‚ç°åœ¨æˆ‘ä»¬å‡è®¾ Leader å’Œ Follower éƒ½å†™å…¥äº†è¿™ä¸¤æ¡æ¶ˆæ¯ï¼Œè€Œä¸” Leader å‰¯æœ¬çš„é«˜æ°´ä½ä¹Ÿå·²ç»æ›´æ–°äº†ï¼Œä½† Follower å‰¯æœ¬é«˜æ°´ä½è¿˜æœªæ›´æ–° â€”â€” è¿™æ˜¯å¯èƒ½å‡ºç°çš„ã€‚è¿˜è®°å¾—å§ï¼ŒFollower ç«¯é«˜æ°´ä½çš„æ›´æ–°ä¸ Leader ç«¯æœ‰æ—¶é—´é”™é…ã€‚å€˜è‹¥æ­¤æ—¶å‰¯æœ¬ B æ‰€åœ¨çš„ Broker å®•æœºï¼Œå½“å®ƒé‡å¯å›æ¥åï¼Œå‰¯æœ¬ B ä¼šæ‰§è¡Œæ—¥å¿—æˆªæ–­æ“ä½œï¼Œå°† LEO å€¼è°ƒæ•´ä¸ºä¹‹å‰çš„é«˜æ°´ä½å€¼ï¼Œä¹Ÿå°±æ˜¯ 1ã€‚è¿™å°±æ˜¯è¯´ï¼Œä½ç§»å€¼ä¸º 1 çš„é‚£æ¡æ¶ˆæ¯è¢«å‰¯æœ¬ B ä»ç£ç›˜ä¸­åˆ é™¤ï¼Œæ­¤æ—¶å‰¯æœ¬ B çš„åº•å±‚ç£ç›˜æ–‡ä»¶ä¸­åªä¿å­˜æœ‰ 1 æ¡æ¶ˆæ¯ï¼Œå³ä½ç§»å€¼ä¸º 0 çš„é‚£æ¡æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;å½“æ‰§è¡Œå®Œæˆªæ–­æ“ä½œåï¼Œå‰¯æœ¬ B å¼€å§‹ä» A æ‹‰å–æ¶ˆæ¯ï¼Œæ‰§è¡Œæ­£å¸¸çš„æ¶ˆæ¯åŒæ­¥ã€‚å¦‚æœå°±åœ¨è¿™ä¸ªèŠ‚éª¨çœ¼ä¸Šï¼Œå‰¯æœ¬ A æ‰€åœ¨çš„ Broker å®•æœºäº†ï¼Œé‚£ä¹ˆ Kafka å°±åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½è®©å‰¯æœ¬ B æˆä¸ºæ–°çš„ Leaderï¼Œæ­¤æ—¶ï¼Œå½“ A å›æ¥åï¼Œéœ€è¦æ‰§è¡Œç›¸åŒçš„æ—¥å¿—æˆªæ–­æ“ä½œï¼Œå³å°†é«˜æ°´ä½è°ƒæ•´ä¸ºä¸ B ç›¸åŒçš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 1ã€‚è¿™æ ·æ“ä½œä¹‹åï¼Œä½ç§»å€¼ä¸º 1 çš„é‚£æ¡æ¶ˆæ¯å°±ä»è¿™ä¸¤ä¸ªå‰¯æœ¬ä¸­è¢«æ°¸è¿œåœ°æŠ¹æ‰äº†ã€‚è¿™å°±æ˜¯è¿™å¼ å›¾è¦å±•ç¤ºçš„æ•°æ®ä¸¢å¤±åœºæ™¯ã€‚&lt;/p&gt;

&lt;p&gt;ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸ªåœºæ™¯å‘ç”Ÿçš„å‰ææ˜¯ Broker ç«¯å‚æ•° &lt;code&gt;min.insync.replicas è®¾ç½®ä¸º 1&lt;/code&gt;ã€‚æ­¤æ—¶ä¸€æ—¦æ¶ˆæ¯è¢«å†™å…¥åˆ° Leader å‰¯æœ¬çš„ç£ç›˜ï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯ â€œå·²æäº¤çŠ¶æ€â€ï¼Œä½†ç°æœ‰çš„æ—¶é—´é”™é…é—®é¢˜å¯¼è‡´ Follower ç«¯çš„é«˜æ°´ä½æ›´æ–°æ˜¯æœ‰æ»åçš„ã€‚å¦‚æœåœ¨è¿™ä¸ªçŸ­æš‚çš„æ»åæ—¶é—´çª—å£å†…ï¼Œæ¥è¿å‘ç”Ÿ Broker å®•æœºï¼Œé‚£ä¹ˆè¿™ç±»æ•°æ®çš„ä¸¢å¤±å°±æ˜¯ä¸å¯é¿å…çš„ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•åˆ©ç”¨ Leader Epoch æœºåˆ¶æ¥è§„é¿è¿™ç§æ•°æ®ä¸¢å¤±ã€‚æˆ‘ä¾ç„¶ç”¨å›¾çš„æ–¹å¼æ¥è¯´æ˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfvbp51hefj319g0u0wj2.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœºæ™¯å’Œä¹‹å‰å¤§è‡´æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡å¼•ç”¨ Leader Epoch æœºåˆ¶åï¼ŒFollower å‰¯æœ¬ B é‡å¯å›æ¥åï¼Œéœ€è¦å‘ A å‘é€ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚å»è·å– Leader çš„ LEO å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯¥å€¼ä¸º 2ã€‚å½“è·çŸ¥åˆ° Leader LEO=2 åï¼ŒB å‘ç°è¯¥ LEO å€¼ä¸æ¯”å®ƒè‡ªå·±çš„ LEO å€¼å°ï¼Œè€Œä¸”ç¼“å­˜ä¸­ä¹Ÿæ²¡æœ‰ä¿å­˜ä»»ä½•èµ·å§‹ä½ç§»å€¼ &amp;gt; 2 çš„ Epoch æ¡ç›®ï¼Œå› æ­¤ B æ— éœ€æ‰§è¡Œä»»ä½•æ—¥å¿—æˆªæ–­æ“ä½œã€‚è¿™æ˜¯å¯¹é«˜æ°´ä½æœºåˆ¶çš„ä¸€ä¸ªæ˜æ˜¾æ”¹è¿›ï¼Œå³å‰¯æœ¬æ˜¯å¦æ‰§è¡Œæ—¥å¿—æˆªæ–­ä¸å†ä¾èµ–äºé«˜æ°´ä½è¿›è¡Œåˆ¤æ–­ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨ï¼Œå‰¯æœ¬ A å®•æœºäº†ï¼ŒB æˆä¸º Leaderã€‚åŒæ ·åœ°ï¼Œå½“ A é‡å¯å›æ¥åï¼Œæ‰§è¡Œä¸ B ç›¸åŒçš„é€»è¾‘åˆ¤æ–­ï¼Œå‘ç°ä¹Ÿä¸ç”¨æ‰§è¡Œæ—¥å¿—æˆªæ–­ï¼Œè‡³æ­¤ä½ç§»å€¼ä¸º 1 çš„é‚£æ¡æ¶ˆæ¯åœ¨ä¸¤ä¸ªå‰¯æœ¬ä¸­å‡å¾—åˆ°ä¿ç•™ã€‚åé¢å½“ç”Ÿäº§è€…ç¨‹åºå‘ B å†™å…¥æ–°æ¶ˆæ¯æ—¶ï¼Œå‰¯æœ¬ B æ‰€åœ¨çš„ Broker ç¼“å­˜ä¸­ï¼Œä¼šç”Ÿæˆæ–°çš„ Leader Epoch æ¡ç›®ï¼š[Epoch=1, Offset=2]ã€‚ä¹‹åï¼Œå‰¯æœ¬ B ä¼šä½¿ç”¨è¿™ä¸ªæ¡ç›®å¸®åŠ©åˆ¤æ–­åç»­æ˜¯å¦æ‰§è¡Œæ—¥å¿—æˆªæ–­æ“ä½œã€‚è¿™æ ·ï¼Œé€šè¿‡ Leader Epoch æœºåˆ¶ï¼ŒKafka å®Œç¾åœ°è§„é¿äº†è¿™ç§æ•°æ®ä¸¢å¤±åœºæ™¯ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>kafkaç»å…¸é¢è¯•é¢˜è¯¦è§£</title>
      <link>https://bgbiao.top/post/kafka%E7%BB%8F%E5%85%B8%E9%9D%A2%E8%AF%95%E9%A2%98%E8%AF%A6%E8%A7%A3/</link>
      <pubDate>Sun, 14 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/kafka%E7%BB%8F%E5%85%B8%E9%9D%A2%E8%AF%95%E9%A2%98%E8%AF%A6%E8%A7%A3/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;æ— è®ºæ˜¯ä½œä¸ºé¢è¯•å®˜ï¼Œè¿˜æ˜¯åº”è˜è€…ï¼Œæˆ‘éƒ½æ¥è§¦è¿‡å¾ˆå¤š Kafka é¢è¯•é¢˜ã€‚è€Œåœ¨æœ€è¿‘é¢è¯•äº†å¾ˆå¤šå€™é€‰äººï¼Œå‘ç°å†™äº†ç†Ÿæ‚‰Kafkaï¼Œä½†æ˜¯å¯¹äºKafkaç›¸å…³çš„çŸ¥è¯†å´æ˜¯åªçŸ¥é“å¤§æ¦‚ç”¨å¤„ï¼Œç®€å•æ­å»ºå’Œä½¿ç”¨ã€‚æˆ‘æƒ³è¯´ï¼Œè™½ç„¶æˆ‘ä»¬æ˜¯SRE(å¯é æ€§å·¥ç¨‹å¸ˆ)ï¼Œä½†ä¸è®ºä½ æ˜¯ä¸šåŠ¡å±‚çš„SREè¿˜æ˜¯åŸºç¡€è®¾æ–½å±‚çš„SREï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹ä¸šåŠ¡æ–¹çš„ä½¿ç”¨åœºæ™¯æœ‰è¶³å¤Ÿç†è§£ï¼Œæˆ–è€…å¯¹æˆ‘ä»¬è¦æä¾›çš„æœåŠ¡æœ‰è¶³å¤Ÿçš„äº†è§£æ‰è¡Œï¼Œè¿™æ ·ä½ æ‰èƒ½æ•´ä½“çš„ä¿è¯ä½ çš„ä¸šåŠ¡è¿ç»­æ€§ä»¥åŠä¸šåŠ¡å¯é æ€§ã€‚å› æ­¤ï¼Œä¸“é—¨æ€»ç»“äº†å¦‚ä¸‹ç»å…¸çš„kafkaé¢è¯•è¯¦è§£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä»¥ä¸‹é¢è¯•é¢˜ï¼Œå‚è€ƒèƒ¡å¤§çš„&lt;code&gt;Kafka æ ¸å¿ƒæºç è§£è¯»&lt;/code&gt;ï¼Œå¯¹ç›¸å…³çš„çŸ¥è¯†è¿›è¡Œäº†è¡¥å……å’Œæ€è€ƒã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŸºç¡€é¢˜ç›®&#34;&gt;åŸºç¡€é¢˜ç›®&lt;/h3&gt;

&lt;h4 id=&#34;1-apache-kafka-æ˜¯ä»€ä¹ˆ&#34;&gt;1.Apache Kafka æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h4&gt;

&lt;p&gt;èƒ½é—®è¿™é“é¢˜ï¼Œä¸»è¦æ˜¯æƒ³çœ‹å€™é€‰äººå¯¹äºkafkaçš„ä½¿ç”¨åœºæ™¯ä»¥åŠå®šä½è®¤çŸ¥ç†è§£æœ‰å¤šæ·±ï¼ŒåŒæ—¶å€™å¯ä»¥çŸ¥é“å€™é€‰äººå¯¹äºè¿™é¡¹æŠ€æœ¯çš„å…³æ³¨åº¦ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œå¤§éƒ¨åˆ†è½¯ä»¶éšç€ç”¨æˆ·é‡çš„å¢åŠ ï¼Œæ•´ä¸ªè½¯ä»¶çš„åŠŸèƒ½å’Œå®šä½ä¹Ÿæœ‰äº†æ–°çš„å˜åŒ–ï¼Œè€ŒApache Kafka ä¸€è·¯å‘å±•åˆ°ç°åœ¨ï¼Œå·²ç»ç”±æœ€åˆçš„åˆ†å¸ƒå¼æäº¤æ—¥å¿—ç³»ç»Ÿé€æ¸æ¼”å˜æˆäº†å®æ—¶æµå¤„ç†æ¡†æ¶ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œè¿™é“é¢˜ä½ æœ€å¥½è¿™ä¹ˆå›ç­”ï¼š&lt;strong&gt;Apach Kafka æ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼Œç”¨äºå®æ—¶æ„å»ºæµå¤„ç†åº”ç”¨ã€‚å®ƒæœ‰ä¸€ä¸ªæ ¸å¿ƒçš„åŠŸèƒ½å¹¿ä¸ºäººçŸ¥ï¼Œå³ä½œä¸ºä¼ä¸šçº§çš„æ¶ˆæ¯å¼•æ“è¢«å¹¿æ³›ä½¿ç”¨(é€šå¸¸ä¹Ÿä¼šç§°ä¹‹ä¸ºæ¶ˆæ¯æ€»çº¿message bus)ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…³äº&lt;code&gt;åˆ†å¸ƒå¼æµå¤„ç†å¹³å°&lt;/code&gt;ï¼Œå…¶å®ä»å®ƒå®˜æ–¹çš„logoä»¥åŠsloganæˆ‘ä»¬å°±å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://kafka.apache.org/images/logo.png&#34; alt=&#34;kafka-logo&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;2-ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„&#34;&gt;2.ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„?&lt;/h4&gt;

&lt;p&gt;æ¶ˆè´¹è€…ç»„æ˜¯ Kafka ç‹¬æœ‰çš„æ¦‚å¿µï¼Œå¦‚æœé¢è¯•å®˜é—®è¿™ä¸ªï¼Œå°±è¯´æ˜ä»–å¯¹æ­¤æ˜¯æœ‰ä¸€å®šäº†è§£çš„ã€‚&lt;/p&gt;

&lt;p&gt;èƒ¡å¤§ç»™çš„æ ‡å‡†ç­”æ¡ˆæ˜¯: &lt;strong&gt;å®˜ç½‘ä¸Šçš„ä»‹ç»è¨€ç®€æ„èµ…ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯ Kafka æä¾›çš„å¯æ‰©å±•ä¸”å…·æœ‰å®¹é”™æ€§çš„æ¶ˆè´¹è€…æœºåˆ¶&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½†å®é™…ä¸Šï¼Œæ¶ˆè´¹è€…ç»„(Consumer Group)å…¶å®åŒ…å«ä¸¤ä¸ªæ¦‚å¿µï¼Œä½œä¸º&lt;code&gt;é˜Ÿåˆ—&lt;/code&gt;ï¼Œæ¶ˆè´¹è€…ç»„å…è®¸ä½ åˆ†å‰²æ•°æ®å¤„ç†åˆ°ä¸€ç»„è¿›ç¨‹é›†åˆä¸Š(å³ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ¶ˆè´¹è€…è¿›ç¨‹ï¼Œä»–ä»¬å…±åŒæ¶ˆè´¹è¯¥topicçš„æ•°æ®)ï¼Œè¿™æœ‰åŠ©äºä½ çš„æ¶ˆè´¹èƒ½åŠ›çš„åŠ¨æ€è°ƒæ•´ï¼›ä½œä¸º&lt;code&gt;å‘å¸ƒ-è®¢é˜…æ¨¡å‹(publish-subscribe)&lt;/code&gt;ï¼Œkafkaå…è®¸ä½ å°†åŒä¸€ä»½æ¶ˆæ¯å¹¿æ’­åˆ°å¤šä¸ªæ¶ˆè´¹è€…ç»„é‡Œï¼Œä»¥æ­¤æ¥ä¸°å¯Œå¤šç§æ•°æ®ä½¿ç”¨åœºæ™¯ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯: &lt;strong&gt;åœ¨æ¶ˆè´¹è€…ç»„ä¸­ï¼Œå¤šä¸ªå®ä¾‹å…±åŒè®¢é˜…è‹¥å¹²ä¸ªä¸»é¢˜ï¼Œå®ç°å…±åŒæ¶ˆè´¹ã€‚åŒä¸€ä¸ªç»„ä¸‹çš„æ¯ä¸ªå®ä¾‹éƒ½é…ç½®æœ‰ç›¸åŒçš„ç»„ IDï¼Œè¢«åˆ†é…ä¸åŒçš„è®¢é˜…åˆ†åŒºã€‚å½“æŸä¸ªå®ä¾‹æŒ‚æ‰çš„æ—¶å€™ï¼Œå…¶ä»–å®ä¾‹ä¼šè‡ªåŠ¨åœ°æ‰¿æ‹…èµ·å®ƒè´Ÿè´£æ¶ˆè´¹çš„åˆ†åŒºã€‚&lt;/strong&gt; å› æ­¤ï¼Œæ¶ˆè´¹è€…ç»„åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¿è¯äº†æ¶ˆè´¹è€…ç¨‹åºçš„é«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfs6dbcw1yj30d6070aar.jpg&#34; alt=&#34;kafka-consumer-group&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; æ¶ˆè´¹è€…ç»„çš„é¢˜ç›®ï¼Œèƒ½å¤Ÿå¸®ä½ åœ¨æŸç§ç¨‹åº¦ä¸ŠæŒæ§ä¸‹é¢çš„é¢è¯•æ–¹å‘ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ æ“…é•¿&lt;code&gt;ä½ç§»å€¼åŸç†(Offset)&lt;/code&gt;ï¼Œå°±ä¸å¦¨å†æä¸€ä¸‹æ¶ˆè´¹è€…ç»„çš„ä½ç§»æäº¤æœºåˆ¶ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æ“…é•¿&lt;code&gt;Kafka Broker&lt;/code&gt;ï¼Œå¯ä»¥æä¸€ä¸‹æ¶ˆè´¹è€…ç»„ä¸ Broker ä¹‹é—´çš„äº¤äº’ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æ“…é•¿ä¸æ¶ˆè´¹è€…ç»„å®Œå…¨ä¸ç›¸å…³çš„ &lt;code&gt;Producer&lt;/code&gt;ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿™ä¹ˆè¯´ï¼šâ€œæ¶ˆè´¹è€…ç»„è¦æ¶ˆè´¹çš„æ•°æ®å®Œå…¨æ¥è‡ªäº Producer ç«¯ç”Ÿäº§çš„æ¶ˆæ¯ï¼Œæˆ‘å¯¹ Producer è¿˜æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„ã€‚â€&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»ä¹‹ï¼Œä½ æ€»å¾—å¯¹&lt;code&gt;consumer group&lt;/code&gt;ç›¸å…³çš„æ–¹å‘æœ‰ä¸€å®šç†è§£ï¼Œç„¶åæ‰èƒ½åƒé¢è¯•å®˜è¡¨åä½ å¯¹æŸä¸€å—å¾ˆç†è§£ã€‚&lt;/p&gt;

&lt;h4 id=&#34;3-åœ¨-kafka-ä¸­-zookeeper-çš„ä½œç”¨æ˜¯ä»€ä¹ˆ&#34;&gt;3.åœ¨ Kafka ä¸­ï¼ŒZooKeeper çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h4&gt;

&lt;p&gt;è¿™é“é¢˜ï¼Œä¹Ÿæ˜¯æˆ‘ç»å¸¸ä¼šé—®å€™é€‰äººçš„é¢˜ï¼Œå› ä¸ºä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è™½ç„¶éƒ½é€šè¿‡ä¸€äº›åˆ—çš„ç®—æ³•å»é™¤äº†ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®å­˜å‚¨ï¼Œä½†æ˜¯æ¯•ç«Ÿè¿˜æ˜¯æœ‰äº›æ•°æ®è¦å­˜å‚¨çš„ï¼ŒåŒæ—¶åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹æ€§å¾€å¾€æ˜¯éœ€è¦æœ‰ä¸€äº›ä¸­é—´äººè§’è‰²æ¥ç»Ÿç­¹é›†ç¾¤ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨æ•´ä¸ªå¾®æœåŠ¡æ¡†æ¶ä¸­çš„&lt;code&gt;Dubbo&lt;/code&gt;ï¼Œå®ƒä¹Ÿæ˜¯éœ€è¦ä¾èµ–ä¸€äº›æ³¨å†Œä¸­å¿ƒæˆ–é…ç½®ä¸­å¿ƒç±»çš„ä¸­é—´ä»¶çš„ï¼Œä»¥åŠäº‘åŸç”Ÿçš„Kubernetesä½¿ç”¨&lt;code&gt;Etcd&lt;/code&gt;ä½œä¸ºæ•´ä¸ªé›†ç¾¤çš„æ¢çº½ã€‚&lt;/p&gt;

&lt;p&gt;æ ‡å‡†ç­”æ¡ˆ: &lt;strong&gt;ç›®å‰ï¼ŒKafka ä½¿ç”¨ ZooKeeper å­˜æ”¾é›†ç¾¤å…ƒæ•°æ®ã€æˆå‘˜ç®¡ç†ã€Controller é€‰ä¸¾ï¼Œä»¥åŠå…¶ä»–ä¸€äº›ç®¡ç†ç±»ä»»åŠ¡ã€‚ä¹‹åï¼Œç­‰ KIP-500 ææ¡ˆå®Œæˆåï¼ŒKafka å°†å®Œå…¨ä¸å†ä¾èµ–äº ZooKeeperã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;â€œå­˜æ”¾å…ƒæ•°æ®â€ æ˜¯æŒ‡ä¸»é¢˜åˆ†åŒºçš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨ ZooKeeper ä¸­ï¼Œä¸”ä»¥å®ƒä¿å­˜çš„æ•°æ®ä¸ºæƒå¨ï¼Œå…¶ä»– â€œäººâ€ éƒ½è¦ä¸å®ƒä¿æŒå¯¹é½ã€‚&lt;/li&gt;
&lt;li&gt;â€œæˆå‘˜ç®¡ç†â€ æ˜¯æŒ‡ Broker èŠ‚ç‚¹çš„æ³¨å†Œã€æ³¨é”€ä»¥åŠå±æ€§å˜æ›´ï¼Œç­‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;â€œController é€‰ä¸¾â€ æ˜¯æŒ‡é€‰ä¸¾é›†ç¾¤ Controllerï¼Œè€Œå…¶ä»–ç®¡ç†ç±»ä»»åŠ¡åŒ…æ‹¬ä½†ä¸é™äºä¸»é¢˜åˆ é™¤ã€å‚æ•°é…ç½®ç­‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;KIP-500 æ€æƒ³ï¼Œæ˜¯ä½¿ç”¨ç¤¾åŒºè‡ªç ”çš„åŸºäº Raft çš„å…±è¯†ç®—æ³•ï¼Œæ›¿ä»£ ZooKeeperï¼Œå®ç° Controller è‡ªé€‰ä¸¾ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&#34;4-è§£é‡Šä¸‹-kafka-ä¸­ä½ç§»-offset-çš„ä½œç”¨&#34;&gt;4.è§£é‡Šä¸‹ Kafka ä¸­ä½ç§»ï¼ˆoffsetï¼‰çš„ä½œç”¨&lt;/h4&gt;

&lt;p&gt;æ ‡å‡†ç­”æ¡ˆ: &lt;strong&gt;åœ¨ Kafka ä¸­ï¼Œæ¯ä¸ªä¸»é¢˜åˆ†åŒºä¸‹çš„æ¯æ¡æ¶ˆæ¯éƒ½è¢«èµ‹äºˆäº†ä¸€ä¸ªå”¯ä¸€çš„ ID æ•°å€¼ï¼Œç”¨äºæ ‡è¯†å®ƒåœ¨åˆ†åŒºä¸­çš„ä½ç½®ã€‚è¿™ä¸ª ID æ•°å€¼ï¼Œå°±è¢«ç§°ä¸ºä½ç§»ï¼Œæˆ–è€…å«åç§»é‡ã€‚ä¸€æ—¦æ¶ˆæ¯è¢«å†™å…¥åˆ°åˆ†åŒºæ—¥å¿—ï¼Œå®ƒçš„ä½ç§»å€¼å°†ä¸èƒ½è¢«ä¿®æ”¹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç­”å®Œè¿™äº›ä¹‹åï¼Œä½ è¿˜å¯ä»¥æŠŠæ•´ä¸ªé¢è¯•æ–¹å‘è½¬ç§»åˆ°ä½ å¸Œæœ›çš„åœ°æ–¹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ æ·±è°™ Broker åº•å±‚æ—¥å¿—å†™å…¥çš„é€»è¾‘ï¼Œå¯ä»¥å¼ºè°ƒä¸‹æ¶ˆæ¯åœ¨æ—¥å¿—ä¸­çš„å­˜æ”¾æ ¼å¼&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æ˜ç™½ä½ç§»å€¼ä¸€æ—¦è¢«ç¡®å®šä¸èƒ½ä¿®æ”¹ï¼Œå¯ä»¥å¼ºè°ƒä¸‹ â€œLog Cleaner ç»„ä»¶éƒ½ä¸èƒ½å½±å“ä½ç§»å€¼â€ è¿™ä»¶äº‹æƒ…&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ å¯¹æ¶ˆè´¹è€…çš„æ¦‚å¿µè¿˜ç®—ç†Ÿæ‚‰ï¼Œå¯ä»¥å†è¯¦ç»†è¯´è¯´&lt;code&gt;ä½ç§»å€¼&lt;/code&gt;å’Œ&lt;code&gt;æ¶ˆè´¹è€…ä½ç§»å€¼&lt;/code&gt;ä¹‹é—´çš„åŒºåˆ«&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;5-é˜è¿°ä¸‹-kafka-ä¸­çš„é¢†å¯¼è€…å‰¯æœ¬-leader-replica-å’Œè¿½éšè€…å‰¯æœ¬-follower-replica-çš„åŒºåˆ«&#34;&gt;5.é˜è¿°ä¸‹ Kafka ä¸­çš„é¢†å¯¼è€…å‰¯æœ¬ï¼ˆLeader Replicaï¼‰å’Œè¿½éšè€…å‰¯æœ¬ï¼ˆFollower Replicaï¼‰çš„åŒºåˆ«&lt;/h4&gt;

&lt;p&gt;æ¨èçš„ç­”æ¡ˆ: &lt;strong&gt;Kafka å‰¯æœ¬å½“å‰åˆ†ä¸ºé¢†å¯¼è€…å‰¯æœ¬å’Œè¿½éšè€…å‰¯æœ¬ã€‚åªæœ‰ Leader å‰¯æœ¬æ‰èƒ½å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œå“åº” Clients ç«¯çš„è¯·æ±‚ã€‚Follower å‰¯æœ¬åªæ˜¯é‡‡ç”¨æ‹‰ï¼ˆPULLï¼‰çš„æ–¹å¼ï¼Œè¢«åŠ¨åœ°åŒæ­¥ Leader å‰¯æœ¬ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨ Leader å‰¯æœ¬æ‰€åœ¨çš„ Broker å®•æœºåï¼Œéšæ—¶å‡†å¤‡åº”è˜ Leader å‰¯æœ¬ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŠ åˆ†ç‚¹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºè°ƒ Follower å‰¯æœ¬ä¹Ÿèƒ½å¯¹å¤–æä¾›è¯»æœåŠ¡&lt;/strong&gt;ã€‚è‡ª Kafka 2.4 ç‰ˆæœ¬å¼€å§‹ï¼Œç¤¾åŒºé€šè¿‡å¼•å…¥æ–°çš„ Broker ç«¯å‚æ•°ï¼Œå…è®¸ Follower å‰¯æœ¬æœ‰é™åº¦åœ°æä¾›è¯»æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼ºè°ƒ Leader å’Œ Follower çš„æ¶ˆæ¯åºåˆ—åœ¨å®é™…åœºæ™¯ä¸­ä¸ä¸€è‡´&lt;/strong&gt;ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¾ˆå¤šå› ç´ å¯èƒ½é€ æˆleaderå’Œfollowerä¹‹é—´çš„ä¸åŒæ­¥ï¼Œæ¯”å¦‚ç¨‹åºé—®é¢˜ï¼Œç½‘ç»œé—®é¢˜ï¼Œbrokeré—®é¢˜ç­‰ï¼ŒçŸ­æš‚çš„ä¸åŒæ­¥æˆ‘ä»¬å¯ä»¥å…³æ³¨(ç§’çº§åˆ«)ï¼Œä½†é•¿æ—¶é—´çš„ä¸åŒæ­¥å¯èƒ½å°±éœ€è¦æ·±å…¥æ’æŸ¥äº†ï¼Œå› ä¸ºä¸€æ—¦leaderæ‰€åœ¨èŠ‚ç‚¹å¼‚å¸¸ï¼Œå¯èƒ½ç›´æ¥å½±å“å¯ç”¨æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; ä¹‹å‰ç¡®ä¿ä¸€è‡´æ€§çš„ä¸»è¦æ‰‹æ®µæ˜¯é«˜æ°´ä½æœºåˆ¶(HW)ï¼Œä½†é«˜æ°´ä½å€¼æ— æ³•ä¿è¯ Leader è¿ç»­å˜æ›´åœºæ™¯ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå› æ­¤ï¼Œç¤¾åŒºå¼•å…¥äº†&lt;code&gt;Leader Epoch&lt;/code&gt; æœºåˆ¶ï¼Œæ¥ä¿®å¤é«˜æ°´ä½å€¼çš„å¼Šç«¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://time.geekbang.org/column/article/112118?utm_source=pinpaizhuanqu&amp;amp;utm_medium=geektime&amp;amp;utm_campaign=guanwang&amp;amp;utm_term=guanwang&amp;amp;utm_content=0511&#34;&gt;å…³äºé«˜æ°´ä½å’Œ Leader Epoch çš„è®¨è®º&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å®æ“é¢˜ç›®&#34;&gt;å®æ“é¢˜ç›®&lt;/h3&gt;

&lt;h4 id=&#34;6-å¦‚ä½•è®¾ç½®-kafka-èƒ½æ¥æ”¶çš„æœ€å¤§æ¶ˆæ¯çš„å¤§å°&#34;&gt;6.å¦‚ä½•è®¾ç½® Kafka èƒ½æ¥æ”¶çš„æœ€å¤§æ¶ˆæ¯çš„å¤§å°?&lt;/h4&gt;

&lt;p&gt;å¯¹äºSREæ¥è®²ï¼Œè¯¥é¢˜ç®€ç›´æ˜¯é€åˆ†é¢˜å•Šï¼Œä½†æ˜¯ï¼Œæœ€å¤§æ¶ˆæ¯çš„è®¾ç½®é€šå¸¸æƒ…å†µä¸‹æœ‰ç”Ÿäº§è€…ç«¯ï¼Œæ¶ˆè´¹è€…ç«¯ï¼Œbrokerç«¯å’Œtopicçº§åˆ«çš„å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ­£ç¡®è®¾ç½®ï¼Œä»¥ä¿è¯å¯ä»¥æ­£å¸¸çš„ç”Ÿäº§å’Œæ¶ˆè´¹ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Brokerç«¯å‚æ•°: &lt;code&gt;message.max.bytes&lt;/code&gt;,&lt;code&gt;max.message.bytes(topicçº§åˆ«)&lt;/code&gt;,&lt;code&gt;replica.fetch.max.bytes(å¦åˆ™followä¼šåŒæ­¥å¤±è´¥)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Consumerç«¯å‚æ•°: &lt;code&gt;fetch.message.max.bytes&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;7-ç›‘æ§-kafka-çš„æ¡†æ¶éƒ½æœ‰å“ªäº›&#34;&gt;7.ç›‘æ§ Kafka çš„æ¡†æ¶éƒ½æœ‰å“ªäº›ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;å¯¹äºSREæ¥è®²ï¼Œä¾ç„¶æ˜¯é€åˆ†é¢˜ã€‚ä½†åŸºç¡€çš„æˆ‘ä»¬è¦çŸ¥é“ï¼Œkafkaæœ¬èº«æ˜¯æä¾›äº†&lt;code&gt;jmx(Java Management Extensions)&lt;/code&gt;çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥è·å–åˆ°kafkaå†…éƒ¨çš„ä¸€äº›åŸºæœ¬æ•°æ®ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka Manager&lt;/strong&gt;: æ›´å¤šæ˜¯kafkaçš„ç®¡ç†ï¼Œå¯¹äºSREéå¸¸å‹å¥½ï¼Œä¹Ÿæä¾›äº†ç®€å•çš„ç¬æ—¶æŒ‡æ ‡ç›‘æ§&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka Monitor&lt;/strong&gt;: LinkedIn å¼€æºçš„å…è´¹æ¡†æ¶ï¼Œæ”¯æŒå¯¹é›†ç¾¤è¿›è¡Œç³»ç»Ÿæµ‹è¯•ï¼Œå¹¶å®æ—¶ç›‘æ§æµ‹è¯•ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CruiseControl&lt;/strong&gt;: ä¹Ÿæ˜¯ LinkedIn å…¬å¸å¼€æºçš„ç›‘æ§æ¡†æ¶ï¼Œç”¨äºå®æ—¶ç›‘æµ‹èµ„æºä½¿ç”¨ç‡ï¼Œä»¥åŠæä¾›å¸¸ç”¨è¿ç»´æ“ä½œç­‰ã€‚æ—  UI ç•Œé¢ï¼Œåªæä¾› REST APIï¼Œå¯ä»¥è¿›è¡Œå¤šé›†ç¾¤ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JMX ç›‘æ§&lt;/strong&gt;: ç”±äº Kafka æä¾›çš„ç›‘æ§æŒ‡æ ‡éƒ½æ˜¯åŸºäº JMX çš„ï¼Œå› æ­¤ï¼Œå¸‚é¢ä¸Šä»»ä½•èƒ½å¤Ÿé›†æˆ JMX çš„æ¡†æ¶éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚ Zabbix å’Œ Prometheusã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·²æœ‰å¤§æ•°æ®å¹³å°è‡ªå·±çš„ç›‘æ§ä½“ç³»&lt;/strong&gt;: åƒ Cloudera æä¾›çš„ CDH è¿™ç±»å¤§æ•°æ®å¹³å°ï¼Œå¤©ç„¶å°±æä¾› Kafka ç›‘æ§æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JMXTool&lt;/strong&gt;: ç¤¾åŒºæä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œèƒ½å¤Ÿå®æ—¶ç›‘æ§ JMX æŒ‡æ ‡ã€‚å¯ä»¥ä½¿ç”¨&lt;code&gt;kafka-run-class.sh kafka.tools.JmxTool&lt;/code&gt;æ¥æŸ¥çœ‹å…·ä½“çš„ç”¨æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;8-broker-çš„-heap-size-å¦‚ä½•è®¾ç½®&#34;&gt;8.Broker çš„ Heap Size å¦‚ä½•è®¾ç½®ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;å…¶å®å¯¹äºSREè¿˜æ˜¯é€åˆ†é¢˜ï¼Œå› ä¸ºç›®å‰æ¥è®²å¤§éƒ¨åˆ†å…¬å¸çš„ä¸šåŠ¡ç³»ç»Ÿéƒ½æ˜¯ä½¿ç”¨Javaå¼€å‘ï¼Œå› æ­¤SREå¯¹äºåŸºæœ¬çš„JVMç›¸å…³çš„å‚æ•°åº”è¯¥è‡³å°‘éƒ½æ˜¯éå¸¸äº†è§£çš„ï¼Œæ ¸å¿ƒå°±åœ¨äºJVMçš„é…ç½®ä»¥åŠGCç›¸å…³çš„çŸ¥è¯†ã€‚&lt;/p&gt;

&lt;p&gt;æ ‡å‡†ç­”æ¡ˆ: &lt;strong&gt;ä»»ä½• Java è¿›ç¨‹ JVM å †å¤§å°çš„è®¾ç½®éƒ½éœ€è¦ä»”ç»†åœ°è¿›è¡Œè€ƒé‡å’Œæµ‹è¯•ã€‚ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯ï¼Œä»¥é»˜è®¤çš„åˆå§‹ JVM å †å¤§å°è¿è¡Œç¨‹åºï¼Œå½“ç³»ç»Ÿè¾¾åˆ°ç¨³å®šçŠ¶æ€åï¼Œæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ Full GCï¼Œç„¶åé€šè¿‡ JVM å·¥å…·æŸ¥çœ‹ GC åçš„å­˜æ´»å¯¹è±¡å¤§å°ã€‚ä¹‹åï¼Œå°†å †å¤§å°è®¾ç½®æˆå­˜æ´»å¯¹è±¡æ€»å¤§å°çš„ 1.5~2 å€ã€‚å¯¹äº Kafka è€Œè¨€ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯é€‚ç”¨çš„ã€‚ä¸è¿‡ï¼Œä¸šç•Œæœ‰ä¸ªæœ€ä½³å®è·µï¼Œé‚£å°±æ˜¯å°† Broker çš„ Heap Size å›ºå®šä¸º 6GBã€‚ç»è¿‡å¾ˆå¤šå…¬å¸çš„éªŒè¯ï¼Œè¿™ä¸ªå¤§å°æ˜¯è¶³å¤Ÿä¸”è‰¯å¥½çš„ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&#34;9-å¦‚ä½•ä¼°ç®—-kafka-é›†ç¾¤çš„æœºå™¨æ•°é‡&#34;&gt;9.å¦‚ä½•ä¼°ç®— Kafka é›†ç¾¤çš„æœºå™¨æ•°é‡?&lt;/h4&gt;

&lt;p&gt;è¯¥é¢˜ä¹Ÿç®—æ˜¯SREçš„é€åˆ†é¢˜å§ï¼Œå¯¹äºSREæ¥è®²ï¼Œä»»ä½•ç”Ÿäº§çš„ç³»ç»Ÿç¬¬ä¸€æ­¥éœ€è¦åšçš„å°±æ˜¯å®¹é‡é¢„ä¼°ä»¥åŠé›†ç¾¤çš„æ¶æ„è§„åˆ’ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯&lt;strong&gt;æœºå™¨æ•°é‡å’Œæ‰€ç”¨èµ„æºä¹‹é—´çš„å…³è”å…³ç³»&lt;/strong&gt;ï¼Œèµ„æºé€šå¸¸æ¥è®²å°±æ˜¯cpuï¼Œå†…å­˜ï¼Œç£ç›˜å®¹é‡ï¼Œå¸¦å®½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œkafkaå› ä¸ºç‹¬æœ‰çš„è®¾è®¡ï¼Œå¯¹äºç£ç›˜çš„è¦æ±‚å¹¶ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œæ™®é€šæœºæ¢°ç¡¬ç›˜è¶³å¤Ÿï¼Œè€Œé€šå¸¸çš„ç“¶é¢ˆä¼šå‡ºç°åœ¨å¸¦å®½ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;åœ¨é¢„ä¼°ç£ç›˜çš„å ç”¨æ—¶ï¼Œä½ ä¸€å®šä¸è¦å¿˜è®°è®¡ç®—å‰¯æœ¬åŒæ­¥çš„å¼€é”€ã€‚å¦‚æœä¸€æ¡æ¶ˆæ¯å ç”¨ 1KB çš„ç£ç›˜ç©ºé—´ï¼Œé‚£ä¹ˆï¼Œåœ¨æœ‰ 3 ä¸ªå‰¯æœ¬çš„ä¸»é¢˜ä¸­ï¼Œä½ å°±éœ€è¦ 3KB çš„æ€»ç©ºé—´æ¥ä¿å­˜è¿™æ¡æ¶ˆæ¯ã€‚åŒæ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°æ•´ä¸ªä¸šåŠ¡Topicæ•°æ®ä¿å­˜çš„æœ€å¤§æ—¶é—´ï¼Œä»¥ä¸Šå‡ ä¸ªå› ç´ ï¼ŒåŸºæœ¬å¯ä»¥é¢„ä¼°å‡ºæ¥ç£ç›˜çš„å®¹é‡éœ€æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯: å¯¹äºç£ç›˜æ¥è®²ï¼Œä¸€å®šè¦æå‰å’Œä¸šåŠ¡æ²Ÿé€šå¥½åœºæ™¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…çœŸæ­£æœ‰ç£ç›˜å®¹é‡ç“¶é¢ˆäº†æ‰å»æ‰©å®¹ç£ç›˜æˆ–è€…æ‰¾ä¸šåŠ¡æ–¹æ²Ÿé€šæ–¹æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºå¸¦å®½æ¥è¯´ï¼Œå¸¸è§çš„å¸¦å®½æœ‰ 1Gbps å’Œ 10Gbpsï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œå½“å¸¦å®½å ç”¨æ¥è¿‘æ€»å¸¦å®½çš„ 90% æ—¶ï¼Œä¸¢åŒ…æƒ…å½¢å°±ä¼šå‘ç”Ÿã€‚&lt;/p&gt;

&lt;h4 id=&#34;10-leader-æ€»æ˜¯-1-æ€ä¹ˆç ´&#34;&gt;10.Leader æ€»æ˜¯ -1ï¼Œæ€ä¹ˆç ´ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;å¯¹äºæœ‰ç»éªŒçš„SREæ¥è®²ï¼Œæ—©æœŸçš„kafkaç‰ˆæœ¬åº”è¯¥å¤šå¤šå°‘å°‘éƒ½é‡åˆ°è¿‡è¯¥ç§æƒ…å†µï¼Œé€šå¸¸æƒ…å†µä¸‹å°±æ˜¯&lt;code&gt;controller&lt;/code&gt;ä¸å·¥ä½œäº†ï¼Œå¯¼è‡´æ— æ³•åˆ†é…leaderï¼Œé‚£æ—¢ç„¶çŸ¥é“é—®é¢˜åï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿå°±å¾ˆç®€å•äº†ã€‚é‡å¯controllerèŠ‚ç‚¹ä¸Šçš„kafkaè¿›ç¨‹ï¼Œè®©å…¶ä»–èŠ‚ç‚¹é‡æ–°æ³¨å†Œcontrollerè§’è‰²ï¼Œä½†æ˜¯å¦‚ä¸Šé¢&lt;code&gt;zookeeper&lt;/code&gt;çš„ä½œç”¨ï¼Œä½ è¦çŸ¥é“ä¸ºä»€ä¹ˆ&lt;code&gt;controller&lt;/code&gt;å¯ä»¥è‡ªåŠ¨æ³¨å†Œã€‚&lt;/p&gt;

&lt;p&gt;å½“ç„¶äº†ï¼Œå½“ä½ çŸ¥é“&lt;code&gt;controller&lt;/code&gt;çš„æ³¨å†Œæœºåˆ¶åï¼Œä½ ä¹Ÿå¯ä»¥è¯´: &lt;strong&gt;åˆ é™¤ ZooKeeper èŠ‚ç‚¹ /controllerï¼Œè§¦å‘ Controller é‡é€‰ä¸¾ã€‚Controller é‡é€‰ä¸¾èƒ½å¤Ÿä¸ºæ‰€æœ‰ä¸»é¢˜åˆ†åŒºé‡åˆ·åˆ†åŒºçŠ¶æ€ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³å› ä¸ä¸€è‡´å¯¼è‡´çš„ Leader ä¸å¯ç”¨é—®é¢˜&lt;/strong&gt;ã€‚ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥æ“ä½œ&lt;code&gt;zookeeper&lt;/code&gt;æ˜¯ä¸€ä»¶é£é™©å¾ˆå¤§çš„æ“ä½œï¼Œå°±å¥½æ¯”åœ¨Linuxä¸­æ‰§è¡Œäº†&lt;strong&gt;rm -rf /xxx&lt;/strong&gt;ä¸€æ ·ï¼Œå¦‚æœåœ¨&lt;code&gt;/&lt;/code&gt;å’Œ&lt;code&gt;xxx&lt;/code&gt;ä¹‹é—´ä¸å°å¿ƒå¤šäº†å‡ ä¸ªç©ºæ ¼ï¼Œé‚£&amp;rdquo;æ­å–œä½ &amp;rdquo;ï¼Œä»Šå¹´ç™½å¹²äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç‚«æŠ€å¼é¢˜ç›®&#34;&gt;ç‚«æŠ€å¼é¢˜ç›®&lt;/h3&gt;

&lt;h4 id=&#34;11-leo-lso-ar-isr-hw-éƒ½è¡¨ç¤ºä»€ä¹ˆå«ä¹‰&#34;&gt;11.LEOã€LSOã€ARã€ISRã€HW éƒ½è¡¨ç¤ºä»€ä¹ˆå«ä¹‰ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;è®²çœŸï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯ç‚«æŠ€çš„é¢˜ç›®ï¼Œç‰¹åˆ«æ˜¯ä½œä¸ºSREæ¥è®²ï¼Œå¯¹äºä¸€ä¸ªå¼€æºè½¯ä»¶çš„åŸç†ä»¥åŠæ¦‚å¿µçš„ç†è§£ï¼Œæ˜¯éå¸¸é‡è¦çš„ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;LEO(Log End Offset)&lt;/strong&gt;: æ—¥å¿—æœ«ç«¯ä½ç§»å€¼æˆ–æœ«ç«¯åç§»é‡ï¼Œè¡¨ç¤ºæ—¥å¿—ä¸‹ä¸€æ¡å¾…æ’å…¥æ¶ˆæ¯çš„ä½ç§»å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ—¥å¿—æœ‰ 10 æ¡æ¶ˆæ¯ï¼Œä½ç§»å€¼ä» 0 å¼€å§‹ï¼Œé‚£ä¹ˆï¼Œç¬¬ 10 æ¡æ¶ˆæ¯çš„ä½ç§»å€¼å°±æ˜¯ 9ã€‚æ­¤æ—¶ï¼ŒLEO = 10ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LSO(Log Stable Offset)&lt;/strong&gt;: è¿™æ˜¯ Kafka äº‹åŠ¡çš„æ¦‚å¿µã€‚å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨åˆ°äº‹åŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼ä¸å­˜åœ¨ï¼ˆå…¶å®ä¹Ÿä¸æ˜¯ä¸å­˜åœ¨ï¼Œåªæ˜¯è®¾ç½®æˆä¸€ä¸ªæ— æ„ä¹‰çš„å€¼ï¼‰ã€‚è¯¥å€¼æ§åˆ¶äº†äº‹åŠ¡å‹æ¶ˆè´¹è€…èƒ½å¤Ÿçœ‹åˆ°çš„æ¶ˆæ¯èŒƒå›´ã€‚å®ƒç»å¸¸ä¸ Log Start Offsetï¼Œå³æ—¥å¿—èµ·å§‹ä½ç§»å€¼ç›¸æ··æ·†ï¼Œå› ä¸ºæœ‰äº›äººå°†åè€…ç¼©å†™æˆ LSOï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚åœ¨ Kafka ä¸­ï¼ŒLSO å°±æ˜¯æŒ‡ä»£ Log Stable Offsetã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AR(Assigned Replicas)&lt;/strong&gt;: AR æ˜¯ä¸»é¢˜è¢«åˆ›å»ºåï¼Œåˆ†åŒºåˆ›å»ºæ—¶è¢«åˆ†é…çš„å‰¯æœ¬é›†åˆï¼Œå‰¯æœ¬ä¸ªæ•°ç”±å‰¯æœ¬å› å­å†³å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ISR(In-Sync Replicas)&lt;/strong&gt;: Kafka ä¸­ç‰¹åˆ«é‡è¦çš„æ¦‚å¿µï¼ŒæŒ‡ä»£çš„æ˜¯ AR ä¸­é‚£äº›ä¸ Leader ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆã€‚åœ¨ AR ä¸­çš„å‰¯æœ¬å¯èƒ½ä¸åœ¨ ISR ä¸­ï¼Œä½† Leader å‰¯æœ¬å¤©ç„¶å°±åŒ…å«åœ¨ ISR ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HW(High watermark)&lt;/strong&gt;: é«˜æ°´ä½å€¼ï¼Œè¿™æ˜¯æ§åˆ¶æ¶ˆè´¹è€…å¯è¯»å–æ¶ˆæ¯èŒƒå›´çš„é‡è¦å­—æ®µã€‚ä¸€ä¸ªæ™®é€šæ¶ˆè´¹è€…åªèƒ½ â€œçœ‹åˆ°â€ Leader å‰¯æœ¬ä¸Šä»‹äº Log Start Offset å’Œ HWï¼ˆä¸å«ï¼‰ä¹‹é—´çš„æ‰€æœ‰æ¶ˆæ¯ã€‚æ°´ä½ä»¥ä¸Šçš„æ¶ˆæ¯æ˜¯å¯¹æ¶ˆè´¹è€…ä¸å¯è§çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šå¸¸åœ¨&lt;code&gt;ISR&lt;/code&gt;ä¸­ï¼Œå¯èƒ½ä¼šæœ‰äººé—®åˆ°ä¸ºä»€ä¹ˆæœ‰æ—¶å€™å‰¯æœ¬ä¸åœ¨ISRä¸­ï¼Œè¿™å…¶å®ä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„Leaderå’ŒFollowerä¸åŒæ­¥çš„æƒ…å†µï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬å‰é¢è¯´ï¼ŒçŸ­æš‚çš„ä¸åŒæ­¥æˆ‘ä»¬å¯ä»¥å…³æ³¨ï¼Œä½†æ˜¯é•¿æ—¶é—´çš„ä¸åŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦ä»‹å…¥æ’æŸ¥äº†ï¼Œå› ä¸ºISRé‡Œçš„å‰¯æœ¬åé¢éƒ½æ˜¯é€šè¿‡&lt;code&gt;replica.lag.time.max.ms&lt;/code&gt;ï¼Œå³Follower å‰¯æœ¬çš„ LEO è½å Leader LEO çš„æ—¶é—´æ˜¯å¦è¶…è¿‡é˜ˆå€¼æ¥å†³å®šå‰¯æœ¬æ˜¯å¦åœ¨ISRå†…éƒ¨çš„ã€‚&lt;/p&gt;

&lt;h4 id=&#34;12-kafka-èƒ½æ‰‹åŠ¨åˆ é™¤æ¶ˆæ¯å—&#34;&gt;12.Kafka èƒ½æ‰‹åŠ¨åˆ é™¤æ¶ˆæ¯å—ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;Kafka ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨åˆ é™¤æ¶ˆæ¯ã€‚å®ƒæœ¬èº«æä¾›äº†ç•™å­˜ç­–ç•¥ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åˆ é™¤è¿‡æœŸæ¶ˆæ¯ã€‚å½“ç„¶ï¼Œå®ƒæ˜¯æ”¯æŒæ‰‹åŠ¨åˆ é™¤æ¶ˆæ¯çš„ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¯¹äºè®¾ç½®äº† Key ä¸”å‚æ•° &lt;code&gt;cleanup.policy=compact&lt;/code&gt; çš„ä¸»é¢˜è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€æ¡ çš„æ¶ˆæ¯å‘é€ç»™ Brokerï¼Œä¾é  Log Cleaner ç»„ä»¶æä¾›çš„åŠŸèƒ½åˆ é™¤æ‰è¯¥ Key çš„æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºæ™®é€šä¸»é¢˜è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kafka-delete-records å‘½ä»¤ï¼Œæˆ–ç¼–å†™ç¨‹åºè°ƒç”¨ Admin.deleteRecords æ–¹æ³•æ¥åˆ é™¤æ¶ˆæ¯ã€‚è¿™ä¸¤ç§æ–¹æ³•æ®Šé€”åŒå½’ï¼Œåº•å±‚éƒ½æ˜¯è°ƒç”¨ Admin çš„ deleteRecords æ–¹æ³•ï¼Œé€šè¿‡å°†åˆ†åŒº Log Start Offset å€¼æŠ¬é«˜çš„æ–¹å¼é—´æ¥åˆ é™¤æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;13-consumer-offsets-æ˜¯åšä»€ä¹ˆç”¨çš„&#34;&gt;13.__consumer_offsets æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå†…éƒ¨ä¸»é¢˜ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ¶ˆè´¹è€…çš„åç§»é‡ï¼Œä»¥åŠæ¶ˆè´¹è€…çš„å…ƒæ•°æ®ä¿¡æ¯(&lt;code&gt;æ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆè´¹è€…id&lt;/code&gt;ç­‰ç­‰)&lt;/p&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯: Kafka çš„ &lt;code&gt;GroupCoordinator&lt;/code&gt; ç»„ä»¶æä¾›å¯¹è¯¥ä¸»é¢˜å®Œæ•´çš„ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¯¥ä¸»é¢˜çš„åˆ›å»ºã€å†™å…¥ã€è¯»å–å’Œ Leader ç»´æŠ¤ç­‰ã€‚&lt;/p&gt;

&lt;h4 id=&#34;14-åˆ†åŒº-leader-é€‰ä¸¾ç­–ç•¥æœ‰å‡ ç§&#34;&gt;14.åˆ†åŒº Leader é€‰ä¸¾ç­–ç•¥æœ‰å‡ ç§ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;åˆ†åŒºçš„ Leader å‰¯æœ¬é€‰ä¸¾å¯¹ç”¨æˆ·æ˜¯å®Œå…¨é€æ˜çš„ï¼Œå®ƒæ˜¯ç”± &lt;code&gt;Controller&lt;/code&gt; ç‹¬ç«‹å®Œæˆçš„ã€‚ä½ éœ€è¦å›ç­”çš„æ˜¯ï¼Œåœ¨å“ªäº›åœºæ™¯ä¸‹ï¼Œéœ€è¦æ‰§è¡Œåˆ†åŒº Leader é€‰ä¸¾ã€‚æ¯ä¸€ç§åœºæ™¯å¯¹åº”äºä¸€ç§é€‰ä¸¾ç­–ç•¥ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;OfflinePartition Leader é€‰ä¸¾&lt;/strong&gt;: æ¯å½“æœ‰åˆ†åŒºä¸Šçº¿æ—¶ï¼Œå°±éœ€è¦æ‰§è¡Œ Leader é€‰ä¸¾ã€‚æ‰€è°“çš„åˆ†åŒºä¸Šçº¿ï¼Œå¯èƒ½æ˜¯åˆ›å»ºäº†æ–°åˆ†åŒºï¼Œä¹Ÿå¯èƒ½æ˜¯ä¹‹å‰çš„ä¸‹çº¿åˆ†åŒºé‡æ–°ä¸Šçº¿ã€‚è¿™æ˜¯æœ€å¸¸è§çš„åˆ†åŒº Leader é€‰ä¸¾åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ReassignPartition Leader é€‰ä¸¾&lt;/strong&gt;: å½“ä½ æ‰‹åŠ¨è¿è¡Œ kafka-reassign-partitions å‘½ä»¤ï¼Œæˆ–è€…æ˜¯è°ƒç”¨ Admin çš„ alterPartitionReassignments æ–¹æ³•æ‰§è¡Œåˆ†åŒºå‰¯æœ¬é‡åˆ†é…æ—¶ï¼Œå¯èƒ½è§¦å‘æ­¤ç±»é€‰ä¸¾ã€‚å‡è®¾åŸæ¥çš„ AR æ˜¯ [1ï¼Œ2ï¼Œ3]ï¼ŒLeader æ˜¯ 1ï¼Œå½“æ‰§è¡Œå‰¯æœ¬é‡åˆ†é…åï¼Œå‰¯æœ¬é›†åˆ AR è¢«è®¾ç½®æˆ [4ï¼Œ5ï¼Œ6]ï¼Œæ˜¾ç„¶ï¼ŒLeader å¿…é¡»è¦å˜æ›´ï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿ Reassign Partition Leader é€‰ä¸¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PreferredReplicaPartition Leader é€‰ä¸¾&lt;/strong&gt;: å½“ä½ æ‰‹åŠ¨è¿è¡Œ kafka-preferred-replica-election å‘½ä»¤ï¼Œæˆ–è‡ªåŠ¨è§¦å‘äº† Preferred Leader é€‰ä¸¾æ—¶ï¼Œè¯¥ç±»ç­–ç•¥è¢«æ¿€æ´»ã€‚æ‰€è°“çš„ Preferred Leaderï¼ŒæŒ‡çš„æ˜¯ AR ä¸­çš„ç¬¬ä¸€ä¸ªå‰¯æœ¬ã€‚æ¯”å¦‚ AR æ˜¯ [3ï¼Œ2ï¼Œ1]ï¼Œé‚£ä¹ˆï¼ŒPreferred Leader å°±æ˜¯ 3ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ControlledShutdownPartition Leader é€‰ä¸¾&lt;/strong&gt;: å½“ Broker æ­£å¸¸å…³é—­æ—¶ï¼Œè¯¥ Broker ä¸Šçš„æ‰€æœ‰ Leader å‰¯æœ¬éƒ½ä¼šä¸‹çº¿ï¼Œå› æ­¤ï¼Œéœ€è¦ä¸ºå—å½±å“çš„åˆ†åŒºæ‰§è¡Œç›¸åº”çš„ Leader é€‰ä¸¾ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™ 4 ç±»é€‰ä¸¾ç­–ç•¥çš„å¤§è‡´æ€æƒ³æ˜¯ç±»ä¼¼çš„ï¼Œå³ä» AR ä¸­æŒ‘é€‰é¦–ä¸ªåœ¨ ISR ä¸­çš„å‰¯æœ¬ï¼Œä½œä¸ºæ–° Leaderã€‚&lt;/p&gt;

&lt;h4 id=&#34;15-kafka-çš„å“ªäº›åœºæ™¯ä¸­ä½¿ç”¨äº†é›¶æ‹·è´-zero-copy&#34;&gt;15.Kafka çš„å“ªäº›åœºæ™¯ä¸­ä½¿ç”¨äº†é›¶æ‹·è´ï¼ˆZero Copyï¼‰&lt;/h4&gt;

&lt;p&gt;å…¶å®è¿™é“é¢˜å¯¹äºSREæ¥è®²ï¼Œæœ‰ç‚¹è¶…çº²äº†ï¼Œä¸è¿‡æ—¢ç„¶&lt;code&gt;Zero Copy&lt;/code&gt;æ˜¯kafkaé«˜æ€§èƒ½çš„ä¿è¯ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®ƒã€‚&lt;/p&gt;

&lt;p&gt;Zero Copy æ˜¯ç‰¹åˆ«å®¹æ˜“è¢«é—®åˆ°çš„é«˜é˜¶é¢˜ç›®ã€‚åœ¨ Kafka ä¸­ï¼Œä½“ç° Zero Copy ä½¿ç”¨åœºæ™¯çš„åœ°æ–¹æœ‰ä¸¤å¤„ï¼š&lt;strong&gt;åŸºäº mmap çš„ç´¢å¼•å’Œæ—¥å¿—æ–‡ä»¶è¯»å†™æ‰€ç”¨çš„ TransportLayer&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…ˆè¯´ç¬¬ä¸€ä¸ªã€‚ç´¢å¼•éƒ½æ˜¯åŸºäº MappedByteBuffer çš„ï¼Œä¹Ÿå°±æ˜¯è®©ç”¨æˆ·æ€å’Œå†…æ ¸æ€å…±äº«å†…æ ¸æ€çš„æ•°æ®ç¼“å†²åŒºï¼Œæ­¤æ—¶ï¼Œæ•°æ®ä¸éœ€è¦å¤åˆ¶åˆ°ç”¨æˆ·æ€ç©ºé—´ã€‚ä¸è¿‡ï¼Œmmap è™½ç„¶é¿å…äº†ä¸å¿…è¦çš„æ‹·è´ï¼Œä½†ä¸ä¸€å®šå°±èƒ½ä¿è¯å¾ˆé«˜çš„æ€§èƒ½ã€‚åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸‹ï¼Œmmap çš„åˆ›å»ºå’Œé”€æ¯æˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚å¾ˆé«˜çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€ä¼šæŠµæ¶ˆ Zero Copy å¸¦æ¥çš„æ€§èƒ½ä¼˜åŠ¿ã€‚ç”±äºè¿™ç§ä¸ç¡®å®šæ€§ï¼Œåœ¨ Kafka ä¸­ï¼Œåªæœ‰ç´¢å¼•åº”ç”¨äº† mmapï¼Œæœ€æ ¸å¿ƒçš„æ—¥å¿—å¹¶æœªä½¿ç”¨ mmap æœºåˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;å†è¯´ç¬¬äºŒä¸ªã€‚TransportLayer æ˜¯ Kafka ä¼ è¾“å±‚çš„æ¥å£ã€‚å®ƒçš„æŸä¸ªå®ç°ç±»ä½¿ç”¨äº† FileChannel çš„ transferTo æ–¹æ³•ã€‚è¯¥æ–¹æ³•åº•å±‚ä½¿ç”¨ sendfile å®ç°äº† Zero Copyã€‚å¯¹ Kafka è€Œè¨€ï¼Œå¦‚æœ I/O é€šé“ä½¿ç”¨æ™®é€šçš„ PLAINTEXTï¼Œé‚£ä¹ˆï¼ŒKafka å°±å¯ä»¥åˆ©ç”¨ Zero Copy ç‰¹æ€§ï¼Œç›´æ¥å°†é¡µç¼“å­˜ä¸­çš„æ•°æ®å‘é€åˆ°ç½‘å¡çš„ Buffer ä¸­ï¼Œé¿å…ä¸­é—´çš„å¤šæ¬¡æ‹·è´ã€‚ç›¸åï¼Œå¦‚æœ I/O é€šé“å¯ç”¨äº† SSLï¼Œé‚£ä¹ˆï¼ŒKafka ä¾¿æ— æ³•åˆ©ç”¨ Zero Copy ç‰¹æ€§äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ·±åº¦æ€è€ƒé¢˜&#34;&gt;æ·±åº¦æ€è€ƒé¢˜&lt;/h3&gt;

&lt;h4 id=&#34;16-kafka-ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»&#34;&gt;16.Kafka ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;è¿™å…¶å®æ˜¯åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„é€šç”¨é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“CAPç†è®ºä¸‹ï¼Œæˆ‘ä»¬åªèƒ½ä¿è¯C(å¯ç”¨æ€§)å’ŒA(ä¸€è‡´æ€§)å–å…¶ä¸€ï¼Œå¦‚æœæ”¯æŒè¯»å†™åˆ†ç¦»ï¼Œé‚£å…¶å®å¯¹äºä¸€è‡´æ€§çš„è¦æ±‚å¯èƒ½å°±ä¼šæœ‰ä¸€å®šæŠ˜æ‰£ï¼Œå› ä¸ºé€šå¸¸çš„åœºæ™¯ä¸‹ï¼Œå‰¯æœ¬ä¹‹é—´éƒ½æ˜¯é€šè¿‡åŒæ­¥æ¥å®ç°å‰¯æœ¬æ•°æ®ä¸€è‡´çš„ï¼Œé‚£åŒæ­¥è¿‡ç¨‹ä¸­è‚¯å®šä¼šæœ‰æ—¶é—´çš„æ¶ˆè€—ï¼Œå¦‚æœæ”¯æŒäº†è¯»å†™åˆ†ç¦»ï¼Œå°±æ„å‘³ç€å¯èƒ½çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæˆ–æ•°æ®æ»åã€‚&lt;/p&gt;

&lt;p&gt;Leader/Follower æ¨¡å‹å¹¶æ²¡æœ‰è§„å®š Follower å‰¯æœ¬ä¸å¯ä»¥å¯¹å¤–æä¾›è¯»æœåŠ¡ã€‚å¾ˆå¤šæ¡†æ¶éƒ½æ˜¯å…è®¸è¿™ä¹ˆåšçš„ï¼Œåªæ˜¯ Kafka æœ€åˆä¸ºäº†é¿å…ä¸ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œè€Œé‡‡ç”¨äº†è®© Leader ç»Ÿä¸€æä¾›æœåŠ¡çš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿‡ï¼Œ&lt;strong&gt;è‡ª Kafka 2.4 ä¹‹åï¼ŒKafka æä¾›äº†æœ‰é™åº¦çš„è¯»å†™åˆ†ç¦»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒFollower å‰¯æœ¬èƒ½å¤Ÿå¯¹å¤–æä¾›è¯»æœåŠ¡&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;17-å¦‚ä½•è°ƒä¼˜-kafka&#34;&gt;17.å¦‚ä½•è°ƒä¼˜ Kafkaï¼Ÿ&lt;/h4&gt;

&lt;p&gt;ä½œä¸ºSREæ¥è®²ï¼Œä»»ä½•ç”Ÿäº§ç¯å¢ƒçš„è°ƒä¼˜ï¼Œé¦–å…ˆéœ€è¦&lt;strong&gt;è¯†åˆ«é—®é¢˜å’Œç“¶é¢ˆç‚¹&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯éšæ„çš„è¿›è¡Œè‡†æƒ³è°ƒä¼˜ã€‚éšåï¼Œéœ€è¦&lt;strong&gt;ç¡®å®šä¼˜åŒ–ç›®æ ‡ï¼Œå¹¶ä¸”å®šé‡ç»™å‡ºç›®æ ‡&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¯¹äºkafkaæ¥è®²ï¼Œå¸¸è§çš„è°ƒä¼˜æ–¹å‘åŸºæœ¬ä¸º: ååé‡ã€å»¶æ—¶ã€æŒä¹…æ€§å’Œå¯ç”¨æ€§ï¼Œæ¯ç§ç›®æ ‡ä¹‹å‰éƒ½æ˜¯ç”±å†²çªç‚¹ï¼Œè¿™ä¹Ÿå°±è¦æ±‚äº†ï¼Œæˆ‘ä»¬åœ¨å¯¹ä¸šåŠ¡æ¥å…¥ä½¿ç”¨æ—¶ï¼Œè¦è¿›è¡Œä¸šåŠ¡åœºæ™¯çš„äº†è§£ï¼Œä»¥å¯¹ä¸šåŠ¡è¿›è¡Œç›¸å¯¹çš„é›†ç¾¤éš”ç¦»ï¼Œå› ä¸ºæ¯ä¸€ä¸ªæ–¹å‘çš„ä¼˜åŒ–æ€è·¯éƒ½æ˜¯ä¸åŒçš„ï¼Œç”šè‡³æ˜¯ç›¸åçš„ã€‚&lt;/p&gt;

&lt;p&gt;ç¡®å®šäº†ç›®æ ‡ä¹‹åï¼Œè¿˜è¦æ˜ç¡®ä¼˜åŒ–çš„ç»´åº¦ã€‚æœ‰äº›è°ƒä¼˜å±äºé€šç”¨çš„ä¼˜åŒ–æ€è·¯ï¼Œæ¯”å¦‚å¯¹æ“ä½œç³»ç»Ÿã€JVM ç­‰çš„ä¼˜åŒ–ï¼›æœ‰äº›åˆ™æ˜¯æœ‰é’ˆå¯¹æ€§çš„ï¼Œæ¯”å¦‚è¦ä¼˜åŒ– Kafka çš„ TPSã€‚æˆ‘ä»¬éœ€è¦ä» 3 ä¸ªæ–¹å‘å»è€ƒè™‘ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Producer ç«¯&lt;/strong&gt;: å¢åŠ &lt;code&gt;batch.size&lt;/code&gt;å’Œ&lt;code&gt;linger.ms&lt;/code&gt;ï¼Œå¯ç”¨å‹ç¼©ï¼Œå…³é—­é‡è¯•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Broker ç«¯&lt;/strong&gt;: å¢åŠ &lt;code&gt;num.replica.fetchers&lt;/code&gt;æå‡ Follower åŒæ­¥ TPSï¼Œé¿å… Broker Full GC ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Consumer&lt;/strong&gt;: å¢åŠ &lt;code&gt;fetch.min.bytes&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;18-controller-å‘ç”Ÿç½‘ç»œåˆ†åŒº-network-partitioning-æ—¶-kafka-ä¼šæ€ä¹ˆæ ·&#34;&gt;18.Controller å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼ˆNetwork Partitioningï¼‰æ—¶ï¼ŒKafka ä¼šæ€ä¹ˆæ ·&lt;/h4&gt;

&lt;p&gt;è¿™é“é¢˜ç›®èƒ½å¤Ÿè¯±å‘æˆ‘ä»¬å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ã€CAP ç†è®ºã€ä¸€è‡´æ€§ç­‰å¤šæ–¹é¢çš„æ€è€ƒã€‚&lt;/p&gt;

&lt;p&gt;ä¸€æ—¦å‘ç”Ÿ Controller ç½‘ç»œåˆ†åŒºï¼Œé‚£ä¹ˆï¼Œç¬¬ä¸€è¦åŠ¡å°±æ˜¯æŸ¥çœ‹é›†ç¾¤æ˜¯å¦å‡ºç° â€œè„‘è£‚â€ï¼Œå³åŒæ—¶å‡ºç°ä¸¤ä¸ªç”šè‡³æ˜¯å¤šä¸ª Controller ç»„ä»¶ã€‚è¿™å¯ä»¥æ ¹æ® Broker ç«¯ç›‘æ§æŒ‡æ ‡ ActiveControllerCount æ¥åˆ¤æ–­ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿‡ï¼Œé€šå¸¸è€Œè¨€ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡æ•´ä¸ªéƒ¨ç½²æ¶æ„æ—¶ï¼Œä¸ºäº†é¿å…è¿™ç§ç½‘ç»œåˆ†åŒºçš„å‘ç”Ÿï¼Œä¸€èˆ¬ä¼šå°†brokerèŠ‚ç‚¹å°½å¯èƒ½çš„é˜²æ­¢åœ¨ä¸€ä¸ªæœºæˆ¿æˆ–è€…å¯ç”¨åŒºã€‚&lt;/p&gt;

&lt;p&gt;ç”±äº Controller ä¼šç»™ Broker å‘é€ 3 ç±»è¯·æ±‚ï¼Œ&lt;code&gt;LeaderAndIsrRequest&lt;/code&gt;ï¼Œ&lt;code&gt;StopReplicaRequest&lt;/code&gt;ï¼Œ&lt;code&gt;UpdateMetadataRequest&lt;/code&gt;ï¼Œå› æ­¤ï¼Œä¸€æ—¦å‡ºç°ç½‘ç»œåˆ†åŒºï¼Œè¿™äº›è¯·æ±‚å°†ä¸èƒ½é¡ºåˆ©åˆ°è¾¾ Broker ç«¯ã€‚&lt;/p&gt;

&lt;p&gt;è¿™å°†å½±å“ä¸»é¢˜çš„åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œçš„ä¿¡æ¯åŒæ­¥ï¼Œè¡¨ç°ä¸ºé›†ç¾¤ä»¿ä½›åƒµä½äº†ä¸€æ ·ï¼Œæ— æ³•æ„ŸçŸ¥åˆ°åé¢çš„æ‰€æœ‰æ“ä½œã€‚å› æ­¤ï¼Œç½‘ç»œåˆ†åŒºé€šå¸¸éƒ½æ˜¯éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œè¦èµ¶å¿«ä¿®å¤ã€‚&lt;/p&gt;

&lt;h4 id=&#34;19-java-consumer-ä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹æ¥è·å–æ¶ˆæ¯&#34;&gt;19.Java Consumer ä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹æ¥è·å–æ¶ˆæ¯ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;åœ¨å›ç­”ä¹‹å‰ï¼Œå¦‚æœå…ˆæŠŠè¿™å¥è¯è¯´å‡ºæ¥ï¼Œä¸€å®šä¼šåŠ åˆ†ï¼š&lt;strong&gt;Java Consumer æ˜¯åŒçº¿ç¨‹çš„è®¾è®¡ã€‚ä¸€ä¸ªçº¿ç¨‹æ˜¯ç”¨æˆ·ä¸»çº¿ç¨‹ï¼Œè´Ÿè´£è·å–æ¶ˆæ¯ï¼›å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¿ƒè·³çº¿ç¨‹ï¼Œè´Ÿè´£å‘ Kafka æ±‡æŠ¥æ¶ˆè´¹è€…å­˜æ´»æƒ…å†µã€‚å°†å¿ƒè·³å•ç‹¬æ”¾å…¥ä¸“å±çš„çº¿ç¨‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°è§„é¿å› æ¶ˆæ¯å¤„ç†é€Ÿåº¦æ…¢è€Œè¢«è§†ä¸ºä¸‹çº¿çš„ â€œå‡æ­»â€ æƒ…å†µã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å•çº¿ç¨‹è·å–æ¶ˆæ¯çš„è®¾è®¡èƒ½å¤Ÿé¿å…é˜»å¡å¼çš„æ¶ˆæ¯è·å–æ–¹å¼ã€‚å•çº¿ç¨‹è½®è¯¢æ–¹å¼å®¹æ˜“å®ç°å¼‚æ­¥éé˜»å¡å¼ï¼Œè¿™æ ·ä¾¿äºå°†æ¶ˆè´¹è€…æ‰©å±•æˆæ”¯æŒå®æ—¶æµå¤„ç†çš„æ“ä½œç®—å­ã€‚å› ä¸ºå¾ˆå¤šå®æ—¶æµå¤„ç†æ“ä½œç®—å­éƒ½ä¸èƒ½æ˜¯é˜»å¡å¼çš„ã€‚å¦å¤–ä¸€ä¸ªå¯èƒ½çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥ç®€åŒ–ä»£ç çš„å¼€å‘ã€‚å¤šçº¿ç¨‹äº¤äº’çš„ä»£ç æ˜¯éå¸¸å®¹æ˜“å‡ºé”™çš„ã€‚&lt;/p&gt;

&lt;h4 id=&#34;20-ç®€è¿°-follower-å‰¯æœ¬æ¶ˆæ¯åŒæ­¥çš„å®Œæ•´æµç¨‹&#34;&gt;20.ç®€è¿° Follower å‰¯æœ¬æ¶ˆæ¯åŒæ­¥çš„å®Œæ•´æµç¨‹&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆï¼ŒFollower å‘é€ FETCH è¯·æ±‚ç»™ Leaderã€‚&lt;/p&gt;

&lt;p&gt;æ¥ç€ï¼ŒLeader ä¼šè¯»å–åº•å±‚æ—¥å¿—æ–‡ä»¶ä¸­çš„æ¶ˆæ¯æ•°æ®ï¼Œå†æ›´æ–°å®ƒå†…å­˜ä¸­çš„ Follower å‰¯æœ¬çš„ LEO å€¼ï¼Œæ›´æ–°ä¸º FETCH è¯·æ±‚ä¸­çš„ fetchOffset å€¼ã€‚&lt;/p&gt;

&lt;p&gt;æœ€åï¼Œå°è¯•æ›´æ–°åˆ†åŒºé«˜æ°´ä½å€¼ã€‚Follower æ¥æ”¶åˆ° FETCH å“åº”ä¹‹åï¼Œä¼šæŠŠæ¶ˆæ¯å†™å…¥åˆ°åº•å±‚æ—¥å¿—ï¼Œæ¥ç€æ›´æ–° LEO å’Œ HW å€¼ã€‚&lt;/p&gt;

&lt;p&gt;Leader å’Œ Follower çš„ HW å€¼æ›´æ–°æ—¶æœºæ˜¯ä¸åŒçš„ï¼ŒFollower çš„ HW æ›´æ–°æ°¸è¿œè½åäº Leader çš„ HWã€‚è¿™ç§æ—¶é—´ä¸Šçš„é”™é…æ˜¯é€ æˆå„ç§ä¸ä¸€è‡´çš„åŸå› ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œå¯¹äºæ¶ˆè´¹è€…è€Œè¨€ï¼Œæ¶ˆè´¹åˆ°çš„æ¶ˆæ¯æ°¸è¿œæ˜¯æ‰€æœ‰å‰¯æœ¬ä¸­æœ€å°çš„é‚£ä¸ªHWã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gfs986oapjj30u01hdaj9.jpg&#34; alt=&#34;èƒ¡å¤§çš„kafkaæºç è¯¾ç¨‹&#34; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Gitå¸¸ç”¨å‘½ä»¤</title>
      <link>https://bgbiao.top/post/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</link>
      <pubDate>Mon, 08 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œå¯èƒ½ç»å¸¸ä¼šé‡åˆ°ä¸€äº›ä¸€è‡´æ€§éœ€æ±‚ï¼Œéœ€è¦å°†æœ¬åœ°ä»£ç å’ŒGitè¿œç«¯ä»£ç ä¿æŒä¸€è‡´ï¼Œå› æ­¤è¿™é‡Œå°±ä¸»è¦æ¥è®°å½•ä¸€äº›Gitçš„æ—¥å¸¸æ“ä½œã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;å¼ºåˆ¶è¦†ç›–æœ¬åœ°ä»£ç &lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å°å¿ƒä¿®æ”¹é”™äº†ä»£ç æˆ–è€…ä¹‹å‰æ„æ€çš„ä¸šåŠ¡é€»è¾‘è¢«æ¨ç¿»äº†ï¼Œä½†æ˜¯è¿™ä¸ªè¿­ä»£ä¸­æˆ‘ä»¬å¢åŠ äº†å¾ˆå¤šä»£ç ï¼Œæƒ³è¦å°½å¿«å›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨å¼ºåˆ¶è¦†ç›–æœ¬åœ°ä»£ç çš„æ–¹å¼æ¥å®ç°ï¼Œæ­¤æ—¶è·ç¦»ä¸Šä¸€æ¬¡commitä¿®æ”¹çš„ä»£ç å°†ä¼šè¢«å¼ºåˆ¶è¦†ç›–ï¼Œå¯ä»¥å¾ˆå¥½çš„å°†æˆ‘ä»¬æœ¬æ¬¡çš„é”™è¯¯éœ€æ±‚ä»£ç æ¸…ç†æ‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# é¦–å…ˆå°†è¿œç«¯ä»£ç å…¨éƒ¨fetchä¸‹æ¥
âœ  kafka git:(master) âœ— git fetch --all
Fetching origin
Fetching bgbiao
From https://github.com/goops-top/utils
 * [new branch]      master     -&amp;gt; bgbiao/master

# å°†æœ¬åœ°ä»£ç è®¾ç½®åˆ°è¿œç«¯çš„ç¨³å®šç‰ˆæœ¬
âœ  kafka git:(master) âœ— git reset --hard origin/master
HEAD is now at 1223981 update the go.mod fix the &amp;#39;module declares its path as:&amp;#39;

# é‡æ–°pull
âœ  kafka git:(master) git pull
Already up to date.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>ä¸€æ–‡å¸®ä½ å¿«é€Ÿå›é¡¾æ­£åˆ™è¡¨è¾¾å¼çŸ¥è¯†</title>
      <link>https://bgbiao.top/post/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE/</link>
      <pubDate>Sat, 06 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;èƒŒæ™¯: åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å¿«é€ŸåŒ¹é…å’Œè¿‡æ»¤ä¸€äº›æˆ‘ä»¬æœŸæœ›çš„å­—ç¬¦ä¸²æ¥å¤„ç†ä¸€äº›ç®€å•åˆç¹ççš„æ–‡å­—ç»Ÿè®¡å’Œè¿‡æ»¤æ“ä½œï¼›è€Œä½œä¸ºä¸€åæŠ€æœ¯ä»ä¸šè€…ï¼Œæˆ‘ä»¬ä¹Ÿç»å¸¸ä¼šåœ¨ç¨‹åºä¸­æˆ–è€…é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å¤„ç†å­—ç¬¦æˆ–è¿›è¡Œæ‰¹é‡é…ç½®é¡¹çš„æŸ¥è¯¢å’Œæ›´æ”¹ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¼–å†™çš„æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œä¸æ–­æµ‹è¯•æ‰èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæœ¬ç¯‡æ–‡ç« å¸¦ä½ é‡æ–°å›é¡¾æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶åˆ†äº«ä¸€ä¸ªåœ¨çº¿çš„æ­£åˆ™è¡¨è¾¾å¼å·¥å…·(&lt;a href=&#34;https://regex101.com/)ï¼Œå¸®ä½ åœ¨å·¥ä½œä¸­å¿«é€Ÿæµ‹è¯•ä½ çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚&#34;&gt;https://regex101.com/)ï¼Œå¸®ä½ åœ¨å·¥ä½œä¸­å¿«é€Ÿæµ‹è¯•ä½ çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼&#34;&gt;ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Ÿ&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç»„ç”±å­—æ¯å’Œç¬¦å·ç»„æˆçš„ç‰¹æ®Šæ–‡æœ¬ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä»æ–‡æœ¬ä¸­æ‰¾å‡ºæ»¡è¶³ä½ æƒ³è¦çš„æ ¼å¼çš„å¥å­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§ä»å·¦åˆ°å³åŒ¹é…ä¸»ä½“å­—ç¬¦ä¸²çš„æ¨¡å¼ã€‚
â€œRegular expressionâ€è¿™ä¸ªè¯æ¯”è¾ƒæ‹—å£ï¼Œæˆ‘ä»¬å¸¸ä½¿ç”¨ç¼©å†™çš„æœ¯è¯­â€œregexâ€æˆ–â€œregexpâ€ã€‚
æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä»ä¸€ä¸ªåŸºç¡€å­—ç¬¦ä¸²ä¸­æ ¹æ®ä¸€å®šçš„åŒ¹é…æ¨¡å¼æ›¿æ¢æ–‡æœ¬ä¸­çš„å­—ç¬¦ä¸²ã€éªŒè¯è¡¨å•ã€æå–å­—ç¬¦ä¸²ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;æƒ³è±¡ä½ æ­£åœ¨å†™ä¸€ä¸ªåº”ç”¨ï¼Œç„¶åä½ æƒ³è®¾å®šä¸€ä¸ªç”¨æˆ·å‘½åçš„è§„åˆ™ï¼Œè®©ç”¨æˆ·ååŒ…å«å­—ç¬¦ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦ï¼Œä»¥åŠé™åˆ¶å­—ç¬¦çš„ä¸ªæ•°ï¼Œå¥½è®©åå­—çœ‹èµ·æ¥æ²¡é‚£ä¹ˆä¸‘ã€‚
æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼æ¥éªŒè¯ä¸€ä¸ªç”¨æˆ·åï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gficxu10luj30hl0bsq3e.jpg&#34; alt=&#34;ç”¨æˆ·ååŒ¹é…&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šçš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥æ¥å— &lt;code&gt;john_doe&lt;/code&gt;ã€&lt;code&gt;jo-hn_doe&lt;/code&gt;ã€&lt;code&gt;john12_as&lt;/code&gt;ã€‚
ä½†ä¸åŒ¹é…&lt;code&gt;Jo&lt;/code&gt;ï¼Œå› ä¸ºå®ƒåŒ…å«äº†å¤§å†™çš„å­—æ¯è€Œä¸”å¤ªçŸ­äº†ã€‚&lt;/p&gt;

&lt;h1 id=&#34;ç›®å½•&#34;&gt;ç›®å½•&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#1-åŸºæœ¬åŒ¹é…&#34;&gt;1. åŸºæœ¬åŒ¹é…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#2-å…ƒå­—ç¬¦&#34;&gt;2. å…ƒå­—ç¬¦&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#21-ç‚¹è¿ç®—ç¬¦-&#34;&gt;2.1 ç‚¹è¿ç®—ç¬¦ .&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#22-å­—ç¬¦é›†&#34;&gt;2.2 å­—ç¬¦é›†&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#221-å¦å®šå­—ç¬¦é›†&#34;&gt;2.2.1 å¦å®šå­—ç¬¦é›†&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#23-é‡å¤æ¬¡æ•°&#34;&gt;2.3 é‡å¤æ¬¡æ•°&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#231--å·&#34;&gt;2.3.1 * å·&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#232--å·&#34;&gt;2.3.2 + å·&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#233--å·&#34;&gt;2.3.3 ? å·&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#24--å·&#34;&gt;2.4 {} å·&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#25--ç‰¹å¾æ ‡ç¾¤&#34;&gt;2.5 (&amp;hellip;) ç‰¹å¾æ ‡ç¾¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#26--æˆ–è¿ç®—ç¬¦&#34;&gt;2.6 | æˆ–è¿ç®—ç¬¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#27-è½¬ç ç‰¹æ®Šå­—ç¬¦&#34;&gt;2.7 è½¬ç ç‰¹æ®Šå­—ç¬¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#28-é”šç‚¹&#34;&gt;2.8 é”šç‚¹&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#281--å·&#34;&gt;2.8.1 ^ å·&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#282--å·&#34;&gt;2.8.2 $ å·&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#3-ç®€å†™å­—ç¬¦é›†&#34;&gt;3. ç®€å†™å­—ç¬¦é›†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#4-é›¶å®½åº¦æ–­è¨€å‰åé¢„æŸ¥&#34;&gt;4. é›¶å®½åº¦æ–­è¨€(å‰åé¢„æŸ¥)&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#41--æ­£å…ˆè¡Œæ–­è¨€&#34;&gt;4.1 ?=&amp;hellip; æ­£å…ˆè¡Œæ–­è¨€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#42--è´Ÿå…ˆè¡Œæ–­è¨€&#34;&gt;4.2 ?!&amp;hellip; è´Ÿå…ˆè¡Œæ–­è¨€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#43---æ­£åå‘æ–­è¨€&#34;&gt;4.3 ?&amp;lt;= &amp;hellip; æ­£åå‘æ–­è¨€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#44--è´Ÿåå‘æ–­è¨€&#34;&gt;4.4 ?&amp;lt;!&amp;hellip; è´Ÿåå‘æ–­è¨€&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#5-æ ‡å¿—&#34;&gt;5. æ ‡å¿—&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#51-å¿½ç•¥å¤§å°å†™-case-insensitive&#34;&gt;5.1 å¿½ç•¥å¤§å°å†™ï¼ˆCase Insensitiveï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#52-å…¨å±€æœç´¢-global-search&#34;&gt;5.2 å…¨å±€æœç´¢ï¼ˆGlobal searchï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#53-å¤šè¡Œä¿®é¥°ç¬¦-multiline&#34;&gt;5.3 å¤šè¡Œä¿®é¥°ç¬¦ï¼ˆMultilineï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#é¢å¤–è¡¥å……&#34;&gt;é¢å¤–è¡¥å……&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#è´¡çŒ®&#34;&gt;è´¡çŒ®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#è®¸å¯è¯&#34;&gt;è®¸å¯è¯&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-åŸºæœ¬åŒ¹é…&#34;&gt;1. åŸºæœ¬åŒ¹é…&lt;/h2&gt;

&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼å…¶å®å°±æ˜¯åœ¨æ‰§è¡Œæœç´¢æ—¶çš„æ ¼å¼ï¼Œå®ƒç”±ä¸€äº›å­—æ¯å’Œæ•°å­—ç»„åˆè€Œæˆã€‚
ä¾‹å¦‚ï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ &lt;code&gt;the&lt;/code&gt;ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªè§„åˆ™ï¼šç”±å­—æ¯&lt;code&gt;t&lt;/code&gt;å¼€å§‹ï¼Œæ¥ç€æ˜¯&lt;code&gt;h&lt;/code&gt;ï¼Œå†æ¥ç€æ˜¯&lt;code&gt;e&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;the&#34; =&gt; The fat cat sat on &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;the&lt;/strong&gt;&lt;/a&gt; mat.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/dmRygT/1&#34;&gt;https://regex101.com/r/dmRygT/1&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼&lt;code&gt;123&lt;/code&gt;åŒ¹é…å­—ç¬¦ä¸²&lt;code&gt;123&lt;/code&gt;ã€‚å®ƒé€ä¸ªå­—ç¬¦çš„ä¸è¾“å…¥çš„æ­£åˆ™è¡¨è¾¾å¼åšæ¯”è¾ƒã€‚&lt;/p&gt;

&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œæ‰€ä»¥&lt;code&gt;The&lt;/code&gt;ä¸ä¼šåŒ¹é…&lt;code&gt;the&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;The&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; fat cat sat on the mat.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/1paXsy/1&#34;&gt;https://regex101.com/r/1paXsy/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-å…ƒå­—ç¬¦&#34;&gt;2. å…ƒå­—ç¬¦&lt;/h2&gt;

&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼ä¸»è¦ä¾èµ–äºå…ƒå­—ç¬¦ã€‚
å…ƒå­—ç¬¦ä¸ä»£è¡¨ä»–ä»¬æœ¬èº«çš„å­—é¢æ„æ€ï¼Œä»–ä»¬éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚ä¸€äº›å…ƒå­—ç¬¦å†™åœ¨æ–¹æ‹¬å·ä¸­çš„æ—¶å€™æœ‰ä¸€äº›ç‰¹æ®Šçš„æ„æ€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…ƒå­—ç¬¦çš„ä»‹ç»ï¼š&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;å…ƒå­—ç¬¦&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;.&lt;/td&gt;
&lt;td&gt;å¥å·åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦é™¤äº†æ¢è¡Œç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;[ ]&lt;/td&gt;
&lt;td&gt;å­—ç¬¦ç§ç±»ã€‚åŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»æ„å­—ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;[^ ]&lt;/td&gt;
&lt;td&gt;å¦å®šçš„å­—ç¬¦ç§ç±»ã€‚åŒ¹é…é™¤äº†æ–¹æ‹¬å·é‡Œçš„ä»»æ„å­—ç¬¦&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;*&lt;/td&gt;
&lt;td&gt;åŒ¹é…&amp;gt;=0ä¸ªé‡å¤çš„åœ¨*å·ä¹‹å‰çš„å­—ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;+&lt;/td&gt;
&lt;td&gt;åŒ¹é…&amp;gt;=1ä¸ªé‡å¤çš„+å·å‰çš„å­—ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;?&lt;/td&gt;
&lt;td&gt;æ ‡è®°?ä¹‹å‰çš„å­—ç¬¦ä¸ºå¯é€‰.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;{n,m}&lt;/td&gt;
&lt;td&gt;åŒ¹é…numä¸ªå¤§æ‹¬å·ä¹‹å‰çš„å­—ç¬¦æˆ–å­—ç¬¦é›† (n &amp;lt;= num &amp;lt;= m).&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;(xyz)&lt;/td&gt;
&lt;td&gt;å­—ç¬¦é›†ï¼ŒåŒ¹é…ä¸ xyz å®Œå…¨ç›¸ç­‰çš„å­—ç¬¦ä¸².&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&amp;#124;&lt;/td&gt;
&lt;td&gt;æˆ–è¿ç®—ç¬¦ï¼ŒåŒ¹é…ç¬¦å·å‰æˆ–åçš„å­—ç¬¦.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&amp;#92;&lt;/td&gt;
&lt;td&gt;è½¬ä¹‰å­—ç¬¦,ç”¨äºåŒ¹é…ä¸€äº›ä¿ç•™çš„å­—ç¬¦ &lt;code&gt;[ ] ( ) { } . * + ? ^ $ \ &amp;#124;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;^&lt;/td&gt;
&lt;td&gt;ä»å¼€å§‹è¡Œå¼€å§‹åŒ¹é….&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$&lt;/td&gt;
&lt;td&gt;ä»æœ«ç«¯å¼€å§‹åŒ¹é….&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;2-1-ç‚¹è¿ç®—ç¬¦&#34;&gt;2.1 ç‚¹è¿ç®—ç¬¦ &lt;code&gt;.&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;.&lt;/code&gt;æ˜¯å…ƒå­—ç¬¦ä¸­æœ€ç®€å•çš„ä¾‹å­ã€‚
&lt;code&gt;.&lt;/code&gt;åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œä½†ä¸åŒ¹é…æ¢è¡Œç¬¦ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼&lt;code&gt;.ar&lt;/code&gt;åŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦åé¢è·Ÿç€æ˜¯&lt;code&gt;a&lt;/code&gt;å’Œ&lt;code&gt;r&lt;/code&gt;çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;.ar&#34; =&gt; The &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;car&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;par&lt;/strong&gt;&lt;/a&gt;ked in the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;gar&lt;/strong&gt;&lt;/a&gt;age.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/xc9GkU/1&#34;&gt;https://regex101.com/r/xc9GkU/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-2-å­—ç¬¦é›†&#34;&gt;2.2 å­—ç¬¦é›†&lt;/h2&gt;

&lt;p&gt;å­—ç¬¦é›†ä¹Ÿå«åšå­—ç¬¦ç±»ã€‚
æ–¹æ‹¬å·ç”¨æ¥æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†ã€‚
åœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨è¿å­—ç¬¦æ¥æŒ‡å®šå­—ç¬¦é›†çš„èŒƒå›´ã€‚
åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦é›†ä¸å…³å¿ƒé¡ºåºã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼&lt;code&gt;[Tt]he&lt;/code&gt; åŒ¹é… &lt;code&gt;the&lt;/code&gt; å’Œ &lt;code&gt;The&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;[Tt]he&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; car parked in &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;the&lt;/strong&gt;&lt;/a&gt; garage.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/2ITLQ4/1&#34;&gt;https://regex101.com/r/2ITLQ4/1&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;æ–¹æ‹¬å·çš„å¥å·å°±è¡¨ç¤ºå¥å·ã€‚
è¡¨è¾¾å¼ &lt;code&gt;ar[.]&lt;/code&gt; åŒ¹é… &lt;code&gt;ar.&lt;/code&gt;å­—ç¬¦ä¸²&lt;/p&gt;

&lt;pre&gt;
&#34;ar[.]&#34; =&gt; A garage is a good place to park a c&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;ar.&lt;/strong&gt;&lt;/a&gt;
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/wL3xtE/1&#34;&gt;https://regex101.com/r/wL3xtE/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;2-2-1-å¦å®šå­—ç¬¦é›†&#34;&gt;2.2.1 å¦å®šå­—ç¬¦é›†&lt;/h3&gt;

&lt;p&gt;ä¸€èˆ¬æ¥è¯´ &lt;code&gt;^&lt;/code&gt; è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œä½†å®ƒç”¨åœ¨ä¸€ä¸ªæ–¹æ‹¬å·çš„å¼€å¤´çš„æ—¶å€™ï¼Œå®ƒè¡¨ç¤ºè¿™ä¸ªå­—ç¬¦é›†æ˜¯å¦å®šçš„ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼&lt;code&gt;[^c]ar&lt;/code&gt; åŒ¹é…ä¸€ä¸ªåé¢è·Ÿç€&lt;code&gt;ar&lt;/code&gt;çš„é™¤äº†&lt;code&gt;c&lt;/code&gt;çš„ä»»æ„å­—ç¬¦ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;[^c]ar&#34; =&gt; The car &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;par&lt;/strong&gt;&lt;/a&gt;ked in the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;gar&lt;/strong&gt;&lt;/a&gt;age.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/nNNlq3/1&#34;&gt;https://regex101.com/r/nNNlq3/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-3-é‡å¤æ¬¡æ•°&#34;&gt;2.3 é‡å¤æ¬¡æ•°&lt;/h2&gt;

&lt;p&gt;åé¢è·Ÿç€å…ƒå­—ç¬¦ &lt;code&gt;+&lt;/code&gt;ï¼Œ&lt;code&gt;*&lt;/code&gt; or &lt;code&gt;?&lt;/code&gt; çš„ï¼Œç”¨æ¥æŒ‡å®šåŒ¹é…å­æ¨¡å¼çš„æ¬¡æ•°ã€‚
è¿™äº›å…ƒå­—ç¬¦åœ¨ä¸åŒçš„æƒ…å†µä¸‹æœ‰ç€ä¸åŒçš„æ„æ€ã€‚&lt;/p&gt;

&lt;h3 id=&#34;2-3-1-å·&#34;&gt;2.3.1 &lt;code&gt;*&lt;/code&gt; å·&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;*&lt;/code&gt;å·åŒ¹é… åœ¨&lt;code&gt;*&lt;/code&gt;ä¹‹å‰çš„å­—ç¬¦å‡ºç°&lt;code&gt;å¤§äºç­‰äº0&lt;/code&gt;æ¬¡ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;a*&lt;/code&gt; åŒ¹é…0æˆ–æ›´å¤šä¸ªä»¥aå¼€å¤´çš„å­—ç¬¦ã€‚è¡¨è¾¾å¼&lt;code&gt;[a-z]*&lt;/code&gt; åŒ¹é…ä¸€ä¸ªè¡Œä¸­æ‰€æœ‰ä»¥å°å†™å­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;[a-z]*&#34; =&gt; T&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;he&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;car&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;parked&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;in&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;the&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;garage&lt;/strong&gt;&lt;/a&gt; #21.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/7m8me5/1&#34;&gt;https://regex101.com/r/7m8me5/1&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&lt;code&gt;*&lt;/code&gt;å­—ç¬¦å’Œ&lt;code&gt;.&lt;/code&gt;å­—ç¬¦æ­é…å¯ä»¥åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦&lt;code&gt;.*&lt;/code&gt;ã€‚
&lt;code&gt;*&lt;/code&gt;å’Œè¡¨ç¤ºåŒ¹é…ç©ºæ ¼çš„ç¬¦å·&lt;code&gt;\s&lt;/code&gt;è¿èµ·æ¥ç”¨ï¼Œå¦‚è¡¨è¾¾å¼&lt;code&gt;\s*cat\s*&lt;/code&gt;åŒ¹é…0æˆ–æ›´å¤šä¸ªç©ºæ ¼å¼€å¤´å’Œ0æˆ–æ›´å¤šä¸ªç©ºæ ¼ç»“å°¾çš„catå­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;\s*cat\s*&#34; =&gt; The fat&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt; cat &lt;/strong&gt;&lt;/a&gt;sat on the con&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;cat&lt;/strong&gt;&lt;/a&gt;enation.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/gGrwuz/1&#34;&gt;https://regex101.com/r/gGrwuz/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;2-3-2-å·&#34;&gt;2.3.2 &lt;code&gt;+&lt;/code&gt; å·&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;+&lt;/code&gt;å·åŒ¹é…&lt;code&gt;+&lt;/code&gt;å·ä¹‹å‰çš„å­—ç¬¦å‡ºç° &amp;gt;=1 æ¬¡ã€‚
ä¾‹å¦‚è¡¨è¾¾å¼&lt;code&gt;c.+t&lt;/code&gt; åŒ¹é…ä»¥é¦–å­—æ¯&lt;code&gt;c&lt;/code&gt;å¼€å¤´ä»¥&lt;code&gt;t&lt;/code&gt;ç»“å°¾ï¼Œä¸­é—´è·Ÿç€è‡³å°‘ä¸€ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;c.+t&#34; =&gt; The fat &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;cat sat on the mat&lt;/strong&gt;&lt;/a&gt;.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/Dzf9Aa/1&#34;&gt;https://regex101.com/r/Dzf9Aa/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;2-3-3-å·&#34;&gt;2.3.3 &lt;code&gt;?&lt;/code&gt; å·&lt;/h3&gt;

&lt;p&gt;åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å…ƒå­—ç¬¦ &lt;code&gt;?&lt;/code&gt; æ ‡è®°åœ¨ç¬¦å·å‰é¢çš„å­—ç¬¦ä¸ºå¯é€‰ï¼Œå³å‡ºç° 0 æˆ– 1 æ¬¡ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;[T]?he&lt;/code&gt; åŒ¹é…å­—ç¬¦ä¸² &lt;code&gt;he&lt;/code&gt; å’Œ &lt;code&gt;The&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;[T]he&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; car is parked in the garage.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/cIg9zm/1&#34;&gt;https://regex101.com/r/cIg9zm/1&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;
&#34;[T]?he&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; car is parked in t&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;he&lt;/strong&gt;&lt;/a&gt; garage.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/kPpO2x/1&#34;&gt;https://regex101.com/r/kPpO2x/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-4-å·&#34;&gt;2.4 &lt;code&gt;{}&lt;/code&gt; å·&lt;/h2&gt;

&lt;p&gt;åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ &lt;code&gt;{}&lt;/code&gt; æ˜¯ä¸€ä¸ªé‡è¯ï¼Œå¸¸ç”¨æ¥é™å®šä¸€ä¸ªæˆ–ä¸€ç»„å­—ç¬¦å¯ä»¥é‡å¤å‡ºç°çš„æ¬¡æ•°ã€‚
ä¾‹å¦‚ï¼Œ è¡¨è¾¾å¼ &lt;code&gt;[0-9]{2,3}&lt;/code&gt; åŒ¹é…æœ€å°‘ 2 ä½æœ€å¤š 3 ä½ 0~9 çš„æ•°å­—ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;[0-9]{2,3}&#34; =&gt; The number was 9.&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;999&lt;/strong&gt;&lt;/a&gt;7 but we rounded it off to &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;10&lt;/strong&gt;&lt;/a&gt;.0.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/juM86s/1&#34;&gt;https://regex101.com/r/juM86s/1&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå‚æ•°ã€‚
ä¾‹å¦‚ï¼Œ&lt;code&gt;[0-9]{2,}&lt;/code&gt; åŒ¹é…è‡³å°‘ä¸¤ä½ 0~9 çš„æ•°å­—ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;[0-9]{2,}&#34; =&gt; The number was 9.&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;9997&lt;/strong&gt;&lt;/a&gt; but we rounded it off to &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;10&lt;/strong&gt;&lt;/a&gt;.0.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/Gdy4w5/1&#34;&gt;https://regex101.com/r/Gdy4w5/1&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;å¦‚æœé€—å·ä¹Ÿçœç•¥æ‰åˆ™è¡¨ç¤ºé‡å¤å›ºå®šçš„æ¬¡æ•°ã€‚
ä¾‹å¦‚ï¼Œ&lt;code&gt;[0-9]{3}&lt;/code&gt; åŒ¹é…3ä½æ•°å­—&lt;/p&gt;

&lt;pre&gt;
&#34;[0-9]{3}&#34; =&gt; The number was 9.&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;999&lt;/strong&gt;&lt;/a&gt;7 but we rounded it off to 10.0.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/Sivu30/1&#34;&gt;https://regex101.com/r/Sivu30/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-5-ç‰¹å¾æ ‡ç¾¤&#34;&gt;2.5 &lt;code&gt;(...)&lt;/code&gt; ç‰¹å¾æ ‡ç¾¤&lt;/h2&gt;

&lt;p&gt;ç‰¹å¾æ ‡ç¾¤æ˜¯ä¸€ç»„å†™åœ¨ &lt;code&gt;(...)&lt;/code&gt; ä¸­çš„å­æ¨¡å¼ã€‚&lt;code&gt;(...)&lt;/code&gt; ä¸­åŒ…å«çš„å†…å®¹å°†ä¼šè¢«çœ‹æˆä¸€ä¸ªæ•´ä½“ï¼Œå’Œæ•°å­¦ä¸­å°æ‹¬å·ï¼ˆ ï¼‰çš„ä½œç”¨ç›¸åŒã€‚ä¾‹å¦‚, è¡¨è¾¾å¼ &lt;code&gt;(ab)*&lt;/code&gt; åŒ¹é…è¿ç»­å‡ºç° 0 æˆ–æ›´å¤šä¸ª &lt;code&gt;ab&lt;/code&gt;ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ &lt;code&gt;(...)&lt;/code&gt; ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼ &lt;code&gt;ab*&lt;/code&gt; å°†åŒ¹é…è¿ç»­å‡ºç° 0 æˆ–æ›´å¤šä¸ª &lt;code&gt;b&lt;/code&gt; ã€‚å†æ¯”å¦‚ä¹‹å‰è¯´çš„ &lt;code&gt;{}&lt;/code&gt; æ˜¯ç”¨æ¥è¡¨ç¤ºå‰é¢ä¸€ä¸ªå­—ç¬¦å‡ºç°æŒ‡å®šæ¬¡æ•°ã€‚ä½†å¦‚æœåœ¨ &lt;code&gt;{}&lt;/code&gt; å‰åŠ ä¸Šç‰¹å¾æ ‡ç¾¤ &lt;code&gt;(...)&lt;/code&gt; åˆ™è¡¨ç¤ºæ•´ä¸ªæ ‡ç¾¤å†…çš„å­—ç¬¦é‡å¤ N æ¬¡ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ &lt;code&gt;()&lt;/code&gt; ä¸­ç”¨æˆ–å­—ç¬¦ &lt;code&gt;|&lt;/code&gt; è¡¨ç¤ºæˆ–ã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;(c|g|p)ar&lt;/code&gt; åŒ¹é… &lt;code&gt;car&lt;/code&gt; æˆ– &lt;code&gt;gar&lt;/code&gt; æˆ– &lt;code&gt;par&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;
&#34;(c|g|p)ar&#34; =&gt; The &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;car&lt;/strong&gt;&lt;/a&gt; is &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;par&lt;/strong&gt;&lt;/a&gt;ked in the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;gar&lt;/strong&gt;&lt;/a&gt;age.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/tUxrBG/1&#34;&gt;https://regex101.com/r/tUxrBG/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-6-æˆ–è¿ç®—ç¬¦&#34;&gt;2.6 &lt;code&gt;|&lt;/code&gt; æˆ–è¿ç®—ç¬¦&lt;/h2&gt;

&lt;p&gt;æˆ–è¿ç®—ç¬¦å°±è¡¨ç¤ºæˆ–ï¼Œç”¨ä½œåˆ¤æ–­æ¡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ &lt;code&gt;(T|t)he|car&lt;/code&gt; åŒ¹é… &lt;code&gt;(T|t)he&lt;/code&gt; æˆ– &lt;code&gt;car&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;(T|t)he|car&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;car&lt;/strong&gt;&lt;/a&gt; is parked in &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;the&lt;/strong&gt;&lt;/a&gt; garage.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/fBXyX0/1&#34;&gt;https://regex101.com/r/fBXyX0/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-7-è½¬ç ç‰¹æ®Šå­—ç¬¦&#34;&gt;2.7 è½¬ç ç‰¹æ®Šå­—ç¬¦&lt;/h2&gt;

&lt;p&gt;åæ–œçº¿ &lt;code&gt;\&lt;/code&gt; åœ¨è¡¨è¾¾å¼ä¸­ç”¨äºè½¬ç ç´§è·Ÿå…¶åçš„å­—ç¬¦ã€‚ç”¨äºæŒ‡å®š &lt;code&gt;{ } [ ] / \ + * . $ ^ | ?&lt;/code&gt; è¿™äº›ç‰¹æ®Šå­—ç¬¦ã€‚å¦‚æœæƒ³è¦åŒ¹é…è¿™äº›ç‰¹æ®Šå­—ç¬¦åˆ™è¦åœ¨å…¶å‰é¢åŠ ä¸Šåæ–œçº¿ &lt;code&gt;\&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ &lt;code&gt;.&lt;/code&gt; æ˜¯ç”¨æ¥åŒ¹é…é™¤æ¢è¡Œç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦çš„ã€‚å¦‚æœæƒ³è¦åŒ¹é…å¥å­ä¸­çš„ &lt;code&gt;.&lt;/code&gt; åˆ™è¦å†™æˆ &lt;code&gt;\.&lt;/code&gt; ä»¥ä¸‹è¿™ä¸ªä¾‹å­ &lt;code&gt;\.?&lt;/code&gt;æ˜¯é€‰æ‹©æ€§åŒ¹é…&lt;code&gt;.&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;
&#34;(f|c|m)at\.?&#34; =&gt; The &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;fat&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;cat&lt;/strong&gt;&lt;/a&gt; sat on the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;mat.&lt;/strong&gt;&lt;/a&gt;
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/DOc5Nu/1&#34;&gt;https://regex101.com/r/DOc5Nu/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2-8-é”šç‚¹&#34;&gt;2.8 é”šç‚¹&lt;/h2&gt;

&lt;p&gt;åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæƒ³è¦åŒ¹é…æŒ‡å®šå¼€å¤´æˆ–ç»“å°¾çš„å­—ç¬¦ä¸²å°±è¦ä½¿ç”¨åˆ°é”šç‚¹ã€‚&lt;code&gt;^&lt;/code&gt; æŒ‡å®šå¼€å¤´ï¼Œ&lt;code&gt;$&lt;/code&gt; æŒ‡å®šç»“å°¾ã€‚&lt;/p&gt;

&lt;h3 id=&#34;2-8-1-å·&#34;&gt;2.8.1 &lt;code&gt;^&lt;/code&gt; å·&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;^&lt;/code&gt; ç”¨æ¥æ£€æŸ¥åŒ¹é…çš„å­—ç¬¦ä¸²æ˜¯å¦åœ¨æ‰€åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œåœ¨ &lt;code&gt;abc&lt;/code&gt; ä¸­ä½¿ç”¨è¡¨è¾¾å¼ &lt;code&gt;^a&lt;/code&gt; ä¼šå¾—åˆ°ç»“æœ &lt;code&gt;a&lt;/code&gt;ã€‚ä½†å¦‚æœä½¿ç”¨ &lt;code&gt;^b&lt;/code&gt; å°†åŒ¹é…ä¸åˆ°ä»»ä½•ç»“æœã€‚å› ä¸ºåœ¨å­—ç¬¦ä¸² &lt;code&gt;abc&lt;/code&gt; ä¸­å¹¶ä¸æ˜¯ä»¥ &lt;code&gt;b&lt;/code&gt; å¼€å¤´ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œ&lt;code&gt;^(T|t)he&lt;/code&gt; åŒ¹é…ä»¥ &lt;code&gt;The&lt;/code&gt; æˆ– &lt;code&gt;the&lt;/code&gt; å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;(T|t)he&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; car is parked in &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;the&lt;/strong&gt;&lt;/a&gt; garage.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/5ljjgB/1&#34;&gt;https://regex101.com/r/5ljjgB/1&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;
&#34;^(T|t)he&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; car is parked in the garage.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/jXrKne/1&#34;&gt;https://regex101.com/r/jXrKne/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;2-8-2-å·&#34;&gt;2.8.2 &lt;code&gt;$&lt;/code&gt; å·&lt;/h3&gt;

&lt;p&gt;åŒç†äº &lt;code&gt;^&lt;/code&gt; å·ï¼Œ&lt;code&gt;$&lt;/code&gt; å·ç”¨æ¥åŒ¹é…å­—ç¬¦æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œ&lt;code&gt;(at\.)$&lt;/code&gt; åŒ¹é…ä»¥ &lt;code&gt;at.&lt;/code&gt; ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;(at\.)&#34; =&gt; The fat c&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;at.&lt;/strong&gt;&lt;/a&gt; s&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;at.&lt;/strong&gt;&lt;/a&gt; on the m&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;at.&lt;/strong&gt;&lt;/a&gt;
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/y4Au4D/1&#34;&gt;https://regex101.com/r/y4Au4D/1&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;
&#34;(at\.)$&#34; =&gt; The fat cat. sat. on the m&lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;at.&lt;/strong&gt;&lt;/a&gt;
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/t0AkOd/1&#34;&gt;https://regex101.com/r/t0AkOd/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;3-ç®€å†™å­—ç¬¦é›†&#34;&gt;3. ç®€å†™å­—ç¬¦é›†&lt;/h2&gt;

&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼æä¾›ä¸€äº›å¸¸ç”¨çš„å­—ç¬¦é›†ç®€å†™ã€‚å¦‚ä¸‹:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;ç®€å†™&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;.&lt;/td&gt;
&lt;td&gt;é™¤æ¢è¡Œç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\w&lt;/td&gt;
&lt;td&gt;åŒ¹é…æ‰€æœ‰å­—æ¯æ•°å­—ï¼Œç­‰åŒäº &lt;code&gt;[a-zA-Z0-9_]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\W&lt;/td&gt;
&lt;td&gt;åŒ¹é…æ‰€æœ‰éå­—æ¯æ•°å­—ï¼Œå³ç¬¦å·ï¼Œç­‰åŒäºï¼š &lt;code&gt;[^\w]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\d&lt;/td&gt;
&lt;td&gt;åŒ¹é…æ•°å­—ï¼š &lt;code&gt;[0-9]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\D&lt;/td&gt;
&lt;td&gt;åŒ¹é…éæ•°å­—ï¼š &lt;code&gt;[^\d]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\s&lt;/td&gt;
&lt;td&gt;åŒ¹é…æ‰€æœ‰ç©ºæ ¼å­—ç¬¦ï¼Œç­‰åŒäºï¼š &lt;code&gt;[\t\n\f\r\p{Z}]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\S&lt;/td&gt;
&lt;td&gt;åŒ¹é…æ‰€æœ‰éç©ºæ ¼å­—ç¬¦ï¼š &lt;code&gt;[^\s]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\f&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\n&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\r&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\t&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\v&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;\p&lt;/td&gt;
&lt;td&gt;åŒ¹é… CR/LFï¼ˆç­‰åŒäº &lt;code&gt;\r\n&lt;/code&gt;ï¼‰ï¼Œç”¨æ¥åŒ¹é… DOS è¡Œç»ˆæ­¢ç¬¦&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;4-é›¶å®½åº¦æ–­è¨€-å‰åé¢„æŸ¥&#34;&gt;4. é›¶å®½åº¦æ–­è¨€ï¼ˆå‰åé¢„æŸ¥ï¼‰&lt;/h2&gt;

&lt;p&gt;å…ˆè¡Œæ–­è¨€å’Œåå‘æ–­è¨€éƒ½å±äº&lt;strong&gt;éæ•è·ç°‡&lt;/strong&gt;ï¼ˆä¸æ•è·æ–‡æœ¬ ï¼Œä¹Ÿä¸é’ˆå¯¹ç»„åˆè®¡è¿›è¡Œè®¡æ•°ï¼‰ã€‚
å…ˆè¡Œæ–­è¨€ç”¨äºåˆ¤æ–­æ‰€åŒ¹é…çš„æ ¼å¼æ˜¯å¦åœ¨å¦ä¸€ä¸ªç¡®å®šçš„æ ¼å¼ä¹‹å‰ï¼ŒåŒ¹é…ç»“æœä¸åŒ…å«è¯¥ç¡®å®šæ ¼å¼ï¼ˆä»…ä½œä¸ºçº¦æŸï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦è·å¾—æ‰€æœ‰è·Ÿåœ¨ &lt;code&gt;$&lt;/code&gt; ç¬¦å·åçš„æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£åå‘æ–­è¨€ &lt;code&gt;(?&amp;lt;=\$)[0-9\.]*&lt;/code&gt;ã€‚
è¿™ä¸ªè¡¨è¾¾å¼åŒ¹é… &lt;code&gt;$&lt;/code&gt; å¼€å¤´ï¼Œä¹‹åè·Ÿç€ &lt;code&gt;0,1,2,3,4,5,6,7,8,9,.&lt;/code&gt; è¿™äº›å­—ç¬¦å¯ä»¥å‡ºç°å¤§äºç­‰äº 0 æ¬¡ã€‚&lt;/p&gt;

&lt;p&gt;é›¶å®½åº¦æ–­è¨€å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;ç¬¦å·&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;?=&lt;/td&gt;
&lt;td&gt;æ­£å…ˆè¡Œæ–­è¨€-å­˜åœ¨&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;?!&lt;/td&gt;
&lt;td&gt;è´Ÿå…ˆè¡Œæ–­è¨€-æ’é™¤&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;?&amp;lt;=&lt;/td&gt;
&lt;td&gt;æ­£åå‘æ–­è¨€-å­˜åœ¨&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;?&amp;lt;!&lt;/td&gt;
&lt;td&gt;è´Ÿåå‘æ–­è¨€-æ’é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;4-1-æ­£å…ˆè¡Œæ–­è¨€&#34;&gt;4.1 &lt;code&gt;?=...&lt;/code&gt; æ­£å…ˆè¡Œæ–­è¨€&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;?=...&lt;/code&gt; æ­£å…ˆè¡Œæ–­è¨€ï¼Œè¡¨ç¤ºç¬¬ä¸€éƒ¨åˆ†è¡¨è¾¾å¼ä¹‹åå¿…é¡»è·Ÿç€ &lt;code&gt;?=...&lt;/code&gt;å®šä¹‰çš„è¡¨è¾¾å¼ã€‚&lt;/p&gt;

&lt;p&gt;è¿”å›ç»“æœåªåŒ…å«æ»¡è¶³åŒ¹é…æ¡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†è¡¨è¾¾å¼ã€‚
å®šä¹‰ä¸€ä¸ªæ­£å…ˆè¡Œæ–­è¨€è¦ä½¿ç”¨ &lt;code&gt;()&lt;/code&gt;ã€‚åœ¨æ‹¬å·å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªé—®å·å’Œç­‰å·ï¼š &lt;code&gt;(?=...)&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ­£å…ˆè¡Œæ–­è¨€çš„å†…å®¹å†™åœ¨æ‹¬å·ä¸­çš„ç­‰å·åé¢ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;(T|t)he(?=\sfat)&lt;/code&gt; åŒ¹é… &lt;code&gt;The&lt;/code&gt; å’Œ &lt;code&gt;the&lt;/code&gt;ï¼Œåœ¨æ‹¬å·ä¸­æˆ‘ä»¬åˆå®šä¹‰äº†æ­£å…ˆè¡Œæ–­è¨€ &lt;code&gt;(?=\sfat)&lt;/code&gt; ï¼Œå³ &lt;code&gt;The&lt;/code&gt; å’Œ &lt;code&gt;the&lt;/code&gt; åé¢ç´§è·Ÿç€ &lt;code&gt;(ç©ºæ ¼)fat&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;(T|t)he(?=\sfat)&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; fat cat sat on the mat.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/IDDARt/1&#34;&gt;https://regex101.com/r/IDDARt/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;4-2-è´Ÿå…ˆè¡Œæ–­è¨€&#34;&gt;4.2 &lt;code&gt;?!...&lt;/code&gt; è´Ÿå…ˆè¡Œæ–­è¨€&lt;/h3&gt;

&lt;p&gt;è´Ÿå…ˆè¡Œæ–­è¨€ &lt;code&gt;?!&lt;/code&gt; ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœï¼Œç­›é€‰æ¡ä»¶ä¸º å…¶åä¸è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼ã€‚
&lt;code&gt;æ­£å…ˆè¡Œæ–­è¨€&lt;/code&gt;  å®šä¹‰å’Œ &lt;code&gt;è´Ÿå…ˆè¡Œæ–­è¨€&lt;/code&gt; ä¸€æ ·ï¼ŒåŒºåˆ«å°±æ˜¯ &lt;code&gt;=&lt;/code&gt; æ›¿æ¢æˆ &lt;code&gt;!&lt;/code&gt; ä¹Ÿå°±æ˜¯ &lt;code&gt;(?!...)&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è¡¨è¾¾å¼ &lt;code&gt;(T|t)he(?!\sfat)&lt;/code&gt; åŒ¹é… &lt;code&gt;The&lt;/code&gt; å’Œ &lt;code&gt;the&lt;/code&gt;ï¼Œä¸”å…¶åä¸è·Ÿç€ &lt;code&gt;(ç©ºæ ¼)fat&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;(T|t)he(?!\sfat)&#34; =&gt; The fat cat sat on &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;the&lt;/strong&gt;&lt;/a&gt; mat.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/V32Npg/1&#34;&gt;https://regex101.com/r/V32Npg/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;4-3-æ­£åå‘æ–­è¨€&#34;&gt;4.3 &lt;code&gt;?&amp;lt;= ...&lt;/code&gt; æ­£åå‘æ–­è¨€&lt;/h3&gt;

&lt;p&gt;æ­£åå‘æ–­è¨€ è®°ä½œ&lt;code&gt;(?&amp;lt;=...)&lt;/code&gt; ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœï¼Œç­›é€‰æ¡ä»¶ä¸º å…¶å‰è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;(?&amp;lt;=(T|t)he\s)(fat|mat)&lt;/code&gt; åŒ¹é… &lt;code&gt;fat&lt;/code&gt; å’Œ &lt;code&gt;mat&lt;/code&gt;ï¼Œä¸”å…¶å‰è·Ÿç€ &lt;code&gt;The&lt;/code&gt; æˆ– &lt;code&gt;the&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;(?&lt;=(T|t)he\s)(fat|mat)&#34; =&gt; The &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;fat&lt;/strong&gt;&lt;/a&gt; cat sat on the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;mat&lt;/strong&gt;&lt;/a&gt;.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/avH165/1&#34;&gt;https://regex101.com/r/avH165/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;4-4-è´Ÿåå‘æ–­è¨€&#34;&gt;4.4 &lt;code&gt;?&amp;lt;!...&lt;/code&gt; è´Ÿåå‘æ–­è¨€&lt;/h3&gt;

&lt;p&gt;è´Ÿåå‘æ–­è¨€ è®°ä½œ &lt;code&gt;(?&amp;lt;!...)&lt;/code&gt; ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœï¼Œç­›é€‰æ¡ä»¶ä¸º å…¶å‰ä¸è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;(?&amp;lt;!(T|t)he\s)(cat)&lt;/code&gt; åŒ¹é… &lt;code&gt;cat&lt;/code&gt;ï¼Œä¸”å…¶å‰ä¸è·Ÿç€ &lt;code&gt;The&lt;/code&gt; æˆ– &lt;code&gt;the&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;(?&amp;lt;!(T|t)he\s)(cat)&#34; =&gt; The cat sat on &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;cat&lt;/strong&gt;&lt;/a&gt;.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/8Efx5G/1&#34;&gt;https://regex101.com/r/8Efx5G/1&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;5-æ ‡å¿—&#34;&gt;5. æ ‡å¿—&lt;/h2&gt;

&lt;p&gt;æ ‡å¿—ä¹Ÿå«æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ç”¨æ¥ä¿®æ”¹è¡¨è¾¾å¼çš„æœç´¢ç»“æœã€‚
è¿™äº›æ ‡å¿—å¯ä»¥ä»»æ„çš„ç»„åˆä½¿ç”¨ï¼Œå®ƒä¹Ÿæ˜¯æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;æ ‡å¿—&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;i&lt;/td&gt;
&lt;td&gt;å¿½ç•¥å¤§å°å†™ã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;g&lt;/td&gt;
&lt;td&gt;å…¨å±€æœç´¢ã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;m&lt;/td&gt;
&lt;td&gt;å¤šè¡Œä¿®é¥°ç¬¦ï¼šé”šç‚¹å…ƒå­—ç¬¦ &lt;code&gt;^&lt;/code&gt; &lt;code&gt;$&lt;/code&gt; å·¥ä½œèŒƒå›´åœ¨æ¯è¡Œçš„èµ·å§‹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;5-1-å¿½ç•¥å¤§å°å†™-case-insensitive&#34;&gt;5.1 å¿½ç•¥å¤§å°å†™ï¼ˆCase Insensitiveï¼‰&lt;/h3&gt;

&lt;p&gt;ä¿®é¥°è¯­ &lt;code&gt;i&lt;/code&gt; ç”¨äºå¿½ç•¥å¤§å°å†™ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;/The/gi&lt;/code&gt; è¡¨ç¤ºåœ¨å…¨å±€æœç´¢ &lt;code&gt;The&lt;/code&gt;ï¼Œåœ¨åé¢çš„ &lt;code&gt;i&lt;/code&gt; å°†å…¶æ¡ä»¶ä¿®æ”¹ä¸ºå¿½ç•¥å¤§å°å†™ï¼Œåˆ™å˜æˆæœç´¢ &lt;code&gt;the&lt;/code&gt; å’Œ &lt;code&gt;The&lt;/code&gt;ï¼Œ&lt;code&gt;g&lt;/code&gt; è¡¨ç¤ºå…¨å±€æœç´¢ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;The&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; fat cat sat on the mat.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/dpQyf9/1&#34;&gt;https://regex101.com/r/dpQyf9/1&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;
&#34;/The/gi&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The&lt;/strong&gt;&lt;/a&gt; fat cat sat on &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;the&lt;/strong&gt;&lt;/a&gt; mat.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/ahfiuh/1&#34;&gt;https://regex101.com/r/ahfiuh/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;5-2-å…¨å±€æœç´¢-global-search&#34;&gt;5.2 å…¨å±€æœç´¢ï¼ˆGlobal searchï¼‰&lt;/h3&gt;

&lt;p&gt;ä¿®é¥°ç¬¦ &lt;code&gt;g&lt;/code&gt; å¸¸ç”¨äºæ‰§è¡Œä¸€ä¸ªå…¨å±€æœç´¢åŒ¹é…ï¼Œå³ï¼ˆä¸ä»…ä»…è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„ï¼Œè€Œæ˜¯è¿”å›å…¨éƒ¨ï¼‰ã€‚
ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;/.(at)/g&lt;/code&gt; è¡¨ç¤ºæœç´¢ ä»»æ„å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œï¼‰+ &lt;code&gt;at&lt;/code&gt;ï¼Œå¹¶è¿”å›å…¨éƒ¨ç»“æœã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;/.(at)/&#34; =&gt; The &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;fat&lt;/strong&gt;&lt;/a&gt; cat sat on the mat.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/jnk6gM/1&#34;&gt;https://regex101.com/r/jnk6gM/1&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;
&#34;/.(at)/g&#34; =&gt; The &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;fat&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;cat&lt;/strong&gt;&lt;/a&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;sat&lt;/strong&gt;&lt;/a&gt; on the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;mat&lt;/strong&gt;&lt;/a&gt;.
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/dO1nef/1&#34;&gt;https://regex101.com/r/dO1nef/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;5-3-å¤šè¡Œä¿®é¥°ç¬¦-multiline&#34;&gt;5.3 å¤šè¡Œä¿®é¥°ç¬¦ï¼ˆMultilineï¼‰&lt;/h3&gt;

&lt;p&gt;å¤šè¡Œä¿®é¥°ç¬¦ &lt;code&gt;m&lt;/code&gt; å¸¸ç”¨äºæ‰§è¡Œä¸€ä¸ªå¤šè¡ŒåŒ¹é…ã€‚&lt;/p&gt;

&lt;p&gt;åƒä¹‹å‰ä»‹ç»çš„ &lt;code&gt;(^,$)&lt;/code&gt; ç”¨äºæ£€æŸ¥æ ¼å¼æ˜¯å¦æ˜¯åœ¨å¾…æ£€æµ‹å­—ç¬¦ä¸²çš„å¼€å¤´æˆ–ç»“å°¾ã€‚ä½†æˆ‘ä»¬å¦‚æœæƒ³è¦å®ƒåœ¨æ¯è¡Œçš„å¼€å¤´å’Œç»“å°¾ç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°å¤šè¡Œä¿®é¥°ç¬¦ &lt;code&gt;m&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ &lt;code&gt;/at(.)?$/gm&lt;/code&gt; è¡¨ç¤ºå°å†™å­—ç¬¦ &lt;code&gt;a&lt;/code&gt; åè·Ÿå°å†™å­—ç¬¦ &lt;code&gt;t&lt;/code&gt; ï¼Œæœ«å°¾å¯é€‰é™¤æ¢è¡Œç¬¦å¤–ä»»æ„å­—ç¬¦ã€‚æ ¹æ® &lt;code&gt;m&lt;/code&gt; ä¿®é¥°ç¬¦ï¼Œç°åœ¨è¡¨è¾¾å¼åŒ¹é…æ¯è¡Œçš„ç»“å°¾ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;/.at(.)?$/&#34; =&gt; The fat
                cat sat
                on the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;mat.&lt;/strong&gt;&lt;/a&gt;
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/hoGMkP/1&#34;&gt;https://regex101.com/r/hoGMkP/1&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;
&#34;/.at(.)?$/gm&#34; =&gt; The &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;fat&lt;/strong&gt;&lt;/a&gt;
                  cat &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;sat&lt;/strong&gt;&lt;/a&gt;
                  on the &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;mat.&lt;/strong&gt;&lt;/a&gt;
&lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/E88WE2/1&#34;&gt;https://regex101.com/r/E88WE2/1&lt;/a&gt;)&lt;/p&gt;

&lt;h3 id=&#34;6-è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é…-greedy-vs-lazy-matching&#34;&gt;6. è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é…ï¼ˆGreedy vs lazy matchingï¼‰&lt;/h3&gt;

&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼é»˜è®¤é‡‡ç”¨è´ªå©ªåŒ¹é…æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹æ„å‘³ç€ä¼šåŒ¹é…å°½å¯èƒ½é•¿çš„å­ä¸²ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;?&lt;/code&gt; å°†è´ªå©ªåŒ¹é…æ¨¡å¼è½¬åŒ–ä¸ºæƒ°æ€§åŒ¹é…æ¨¡å¼ã€‚&lt;/p&gt;

&lt;pre&gt;
&#34;/(.*at)/&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The fat cat sat on the mat&lt;/strong&gt;&lt;/a&gt;. &lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/AyAdgJ/1&#34;&gt;https://regex101.com/r/AyAdgJ/1&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;
&#34;/(.*?at)/&#34; =&gt; &lt;a href=&#34;#learn-regex&#34;&gt;&lt;strong&gt;The fat&lt;/strong&gt;&lt;/a&gt; cat sat on the mat. &lt;/pre&gt;

&lt;p&gt;(åœ¨çº¿ç»ƒä¹ )(&lt;a href=&#34;https://regex101.com/r/AyAdgJ/2&#34;&gt;https://regex101.com/r/AyAdgJ/2&lt;/a&gt;)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>ElasticSearchæ¶æ„è§£æä¸æœ€ä½³å®è·µ</title>
      <link>https://bgbiao.top/post/elasticsearch%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</link>
      <pubDate>Wed, 27 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/elasticsearch%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</guid>
      
        <description>&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6talv0b0j30u00gwgmv.jpg&#34; alt=&#34;ç›®å½•&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6taz9e6mj30u00gwgn1.jpg&#34; alt=&#34;åº”ç”¨æ¦‚è¿°-1&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tbcoytlj30u00gw0v2.jpg&#34; alt=&#34;åº”ç”¨æ¦‚è¿°-2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tc1k3flj30u00gwdih.jpg&#34; alt=&#34;åº”ç”¨æ¦‚è¿°-3&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tcd3b6zj30u00gw416.jpg&#34; alt=&#34;åº”ç”¨æ¦‚è¿°-4&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tcptmk3j30u00gwju7.jpg&#34; alt=&#34;Luceneå†…æ ¸åŸç†-1&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tdh8oo9j30u00gwq5d.jpg&#34; alt=&#34;Luceneå†…æ ¸åŸç†-2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tdtnjioj30u00gwq67.jpg&#34; alt=&#34;Luceneå†…æ ¸åŸç†-3&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6te64te2j30u00gw76q.jpg&#34; alt=&#34;Luceneå†…æ ¸åŸç†-4&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tegzbfej30u00gwgnr.jpg&#34; alt=&#34;Luceneå†…æ ¸åŸç†-5&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tesbdjrj30u00gwq4l.jpg&#34; alt=&#34;Luceneå†…æ ¸åŸç†-6&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tf62pxfj30u00gwmzk.jpg&#34; alt=&#34;Luceneå†…æ ¸åŸç†-7&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tfo8dnyj30u00gwdit.jpg&#34; alt=&#34;ElasticSearchæ¶æ„è§£æ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tg98nsrj30u00gwwgz.jpg&#34; alt=&#34;ElasticSearchæ¶æ„è§£æ-1&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tgl8k6aj30u00gw41m.jpg&#34; alt=&#34;ElasticSearchæ¶æ„è§£æ-2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tgy5lhqj30u00gwtbh.jpg&#34; alt=&#34;ElasticSearchæ¶æ„è§£æ-3&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6th9bynxj30u00gwgoi.jpg&#34; alt=&#34;ElasticSearchæ¶æ„è§£æ-4&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6thjuhgtj30u00gwwgb.jpg&#34; alt=&#34;ElasticSearchæ¶æ„è§£æ-5&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6thyvb72j30u00gwwgy.jpg&#34; alt=&#34;ElasticSearchæ¶æ„è§£æ-6&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tiaoksoj30u00gwq57.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-1&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tinieeyj30u00gwq51.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tiy8yc4j30u00gw40r.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-3&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tj6kki5j30u00gwmz3.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-4&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tjflhouj30u00gwmzs.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-5&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tjrhom9j30u00gw414.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-6&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tk30ujjj30u00gwwgd.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-7&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tkez1t6j30u00gwacw.jpg&#34; alt=&#34;æœ€ä½³å®è·µ-8&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tksdke2j30u00gwgmw.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-1&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tl2qkemj30u00gw76f.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tlejqftj30u00gwjtk.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-3&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tlpduy6j30u00gw0ut.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-4&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tlz6ifvj30u00gwmzi.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-5&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tm9ln5dj30u00gw410.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-6&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tmjx424j30u00gwmyd.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-7&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tmta1rxj30u00gwacb.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-8&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tn4mub6j30u00gw76f.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-9&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tni8rnxj30u00gw410.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-10&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6tnset4mj30u00gwacc.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-11&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf6to3orh5j30u00gwmxu.jpg&#34; alt=&#34;æ€§èƒ½è°ƒä¼˜-12&#34; /&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>kafkaç«¯åˆ°ç«¯çš„å»¶è¿Ÿ</title>
      <link>https://bgbiao.top/post/kafka%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E5%BB%B6%E8%BF%9F/</link>
      <pubDate>Sat, 23 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/kafka%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E5%BB%B6%E8%BF%9F/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;å‰è¨€: åœ¨å¤§è§„æ¨¡çš„ä½¿ç”¨kafkaè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼Œé€šå¸¸ä¼šæœ‰ä¸€äº›å¤§æ•°æ®é›†ç¾¤ä¸­çš„Jobå‘ç°æ€»æœ‰å‡ ä¸ªtaskä¼šæ¯”è¾ƒæ…¢ï¼Œå¯¼è‡´æ•´ä½“çš„ä»»åŠ¡è¿Ÿè¿Ÿä¸èƒ½å®Œæˆè¿è¡Œï¼Œè¿™ç§æƒ…å†µé€šå¸¸é—®é¢˜ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæƒ³è¦çŸ¥é“å…·ä½“å»¶è¿Ÿåœ¨å“ªé‡Œï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨Kafkaé›†ç¾¤ä¸­å“ªäº›ç‚¹å¯èƒ½ä¼šå¢åŠ ç«¯åˆ°ç«¯çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ¥ä¸‹æ¥çš„å†…å®¹ç¿»è¯‘è‡ª&lt;code&gt;confluent&lt;/code&gt;å®˜ç½‘åšå®¢ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©å¤§å®¶ç†è§£kafkaä½¿ç”¨è¿‡ç¨‹ä¸­ç«¯åˆ°ç«¯çš„å»¶è¿Ÿã€‚&lt;a href=&#34;https://www.confluent.io/blog/configure-kafka-to-minimize-latency/&#34;&gt;99th Percentile Latency at Scale with Apache Kafka&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ¬ºè¯ˆæ£€æµ‹ã€æ”¯ä»˜ç³»ç»Ÿå’Œè‚¡ç¥¨äº¤æ˜“å¹³å°åªæ˜¯è®¸å¤šApache Kafkaç”¨ä¾‹ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œè¿™äº›ç”¨ä¾‹éœ€è¦å¿«é€Ÿä¸”å¯é¢„æµ‹çš„æ•°æ®äº¤ä»˜ã€‚ä¾‹å¦‚ï¼Œåœ¨çº¿é“¶è¡Œäº¤æ˜“çš„æ¬ºè¯ˆæ£€æµ‹å¿…é¡»å®æ—¶å‘ç”Ÿï¼Œä»¥äº¤ä»˜ä¸šåŠ¡ä»·å€¼ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸ªäº¤æ˜“å¢åŠ è¶…è¿‡50 100æ¯«ç§’çš„å¼€é”€ï¼Œä»¥ä¿æŒè‰¯å¥½çš„å®¢æˆ·ä½“éªŒã€‚&lt;/p&gt;

&lt;p&gt;åœ¨Kafkaæœ¯è¯­ä¸­ï¼Œæ•°æ®äº¤ä»˜æ—¶é—´(data delivery time)æ˜¯ç”±&lt;code&gt;ç«¯åˆ°ç«¯å»¶è¿Ÿ(end-to-end latency)&lt;/code&gt;å®šä¹‰çš„ï¼Œå³&lt;code&gt;æ¶ˆè´¹è€…è·å–ä¸€æ¡å‘Kafkaç”Ÿæˆçš„è®°å½•æ‰€éœ€çš„æ—¶é—´&lt;/code&gt;ã€‚å»¶è¿Ÿç›®æ ‡è¡¨ç¤ºä¸ºç›®æ ‡å»¶è¿Ÿå’Œæ»¡è¶³æ­¤ç›®æ ‡çš„é‡è¦æ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„å»¶è¿Ÿç›®æ ‡å¯ä»¥è¡¨ç¤ºä¸º:æˆ‘å¸Œæœ›99%çš„æƒ…å†µä¸‹ä»Kafkaè·å¾—ç«¯åˆ°ç«¯å»¶è¿Ÿä¸º50 msã€‚&lt;/p&gt;

&lt;p&gt;è¿™å°†å¢åŠ &lt;code&gt;å¯ç”¨æ€§ã€æŒä¹…æ€§å’Œååé‡&lt;/code&gt;ç›®æ ‡ã€‚å®ç°é«˜æŒä¹…æ€§å’Œé«˜ååé‡ä¸¤ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€å®šçš„æƒè¡¡ï¼ŒæŒ‘æˆ˜åœ¨äºåœ¨ä¿æŒå»¶è¿Ÿç•Œé™çš„åŒæ—¶æ‰©å±•åº”ç”¨ç¨‹åºçš„ååé‡ï¼Œå¹¶è°ƒæ•´Kafkaé›†ç¾¤çš„å¤§å°ä»¥ä½¿ç”¨å¯æ¥å—çš„Brokerå»¶è¿Ÿæ¥å¤„ç†å®¢æˆ·ç«¯å’Œå¤åˆ¶çš„è¯·æ±‚ã€‚å»¶è¿Ÿä¹Ÿå–å†³äºæ‚¨å¯¹ç¡¬ä»¶æˆ–äº‘æä¾›å•†çš„é€‰æ‹©ï¼Œæ‰€ä»¥æ‚¨éœ€è¦èƒ½å¤Ÿç›‘è§†å’Œè°ƒä¼˜æ‚¨çš„å®¢æˆ·ç«¯ï¼Œä»¥åœ¨æ‚¨ç‹¬ç‰¹çš„ç¯å¢ƒä¸­å®ç°æ‚¨çš„ç‰¹å®šå»¶è¿Ÿç›®æ ‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„&lt;/code&gt;: é€šå¸¸æƒ…å†µä¸‹ï¼ŒBrokeræ‰€åœ¨çš„ç½‘ç»œåŒºåŸŸå…¶å®ä¹Ÿä¼šå¯¹å»¶è¿Ÿé€ æˆå¾ˆå¤§å½±å“ï¼Œå½“ç„¶è¿™ä»ç„¶å–å†³äºæ‚¨å¯¹å¯ç”¨æ€§å’Œå»¶è¿Ÿçš„æƒè¡¡ã€‚&lt;/p&gt;

&lt;p&gt;ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å†™è¿‡ç™½çš®ä¹¦&lt;a href=&#34;https://www.confluent.io/white-paper/optimizing-your-apache-kafka-deployment/&#34;&gt;optimizing-your-apache-kafka-deployment&lt;/a&gt;ï¼Œå…¶ä¸­åˆ—å‡ºäº†é…ç½®Kafkaéƒ¨ç½²ä»¥ä¼˜åŒ–å„ç§ç›®æ ‡çš„æŒ‡å¯¼åŸåˆ™ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« å°†å¸®åŠ©æ‚¨è¿›ä¸€æ­¥è·å¾—æ›´å¥½çš„ç›´è§‰å’Œå¯¹ç«¯åˆ°ç«¯å»¶è¿Ÿçš„ç†è§£ï¼Œå¹¶é…ç½®å’Œæ‰©å±•æ‚¨çš„åº”ç”¨ç¨‹åºçš„ååé‡ï¼ŒåŒæ—¶ä¿æŒå»¶è¿Ÿçš„ç•Œé™ã€‚&lt;/p&gt;

&lt;h4 id=&#34;ç†è§£åˆ°ç«¯çš„å»¶è¿Ÿ-end-to-end-latency&#34;&gt;ç†è§£åˆ°ç«¯çš„å»¶è¿Ÿ(end-to-end latency)&lt;/h4&gt;

&lt;p&gt;ç«¯åˆ°ç«¯å»¶æ—¶æ˜¯æŒ‡åº”ç”¨é€»è¾‘è°ƒç”¨&lt;code&gt;KafkaProducer.send()&lt;/code&gt;ç”Ÿäº§æ¶ˆæ¯åˆ°è¯¥æ¶ˆæ¯è¢«åº”ç”¨é€»è¾‘é€šè¿‡&lt;code&gt;KafkaConsumer.poll()&lt;/code&gt;æ¶ˆè´¹åˆ°ä¹‹é—´çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­çš„è·¯å¾„ï¼Œä»Kafkasç”Ÿäº§è€…åˆ°Kafkaçš„BrokerèŠ‚ç‚¹ï¼Œå‰¯æœ¬çš„å¤åˆ¶ï¼Œä»¥åŠæ¶ˆè´¹è€…æœ€ç»ˆåœ¨å…¶ä¸»ä½“åˆ†åŒºæ—¥å¿—ä¸­è·å–åˆ°å…·ä½“çš„æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œç«¯åˆ°ç«¯çš„å»¶è¿Ÿä¸»è¦ä¼šç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆ:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Produce time&lt;/code&gt;: å†…éƒ¨Kafka producerå¤„ç†æ¶ˆæ¯å¹¶å°†æ¶ˆæ¯æ‰“åŒ…çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Publish time&lt;/code&gt;: producerå‘é€åˆ°brokerå¹¶å†™å…¥åˆ°leaderå‰¯æœ¬logçš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Commit time&lt;/code&gt;: followerå‰¯æœ¬å¤‡ä»½æ¶ˆæ¯çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Catch-up time&lt;/code&gt;: æ¶ˆè´¹è€…è¿½èµ¶æ¶ˆè´¹è¿›åº¦ï¼Œæ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ä½ç§»å€¼å‰æ‰€èŠ±è´¹çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Fetch time&lt;/code&gt;: ä»brokerè¯»å–è¯¥æ¶ˆæ¯çš„æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf2l82tu4nj30nd0dz40n.jpg&#34; alt=&#34;kafkaç«¯åˆ°ç«¯çš„å»¶è¿Ÿ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†åˆ«è§£é‡Šè¿™äº”ä¸ªå»¶è¿Ÿé˜¶æ®µçš„å…·ä½“å«ä¹‰ï¼Œç‰¹å®šçš„å®¢æˆ·ç«¯é…ç½®æˆ–åº”ç”¨é€»è¾‘è®¾è®¡é€šå¸¸ä¼šæå¤§åœ°å½±å“ç«¯åˆ°ç«¯å»¶æ—¶ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦ç²¾å‡†å®šä½å“ªä¸ªå› ç´ å¯¹å»¶æ—¶çš„å½±å“æœ€å¤§ã€‚&lt;/p&gt;

&lt;h4 id=&#34;produce-time&#34;&gt;Produce time&lt;/h4&gt;

&lt;p&gt;Produce time æŒ‡çš„æ˜¯ä»åº”ç”¨ç¨‹åºé€šè¿‡&lt;code&gt;KafkaProducer.send()&lt;/code&gt;ç”Ÿäº§ä¸€æ¡è®°å½•åˆ°åŒ…å«è¯¥æ¶ˆæ¯çš„ç”Ÿäº§è€…è¯·æ±‚è¢«å‘å¾€leaderå‰¯æœ¬æ‰€åœ¨çš„brokerä¹‹é—´çš„æ—¶é—´ã€‚(å› æ­¤ï¼Œç”Ÿäº§è€…æ‰€å¤„çš„ç½‘ç»œç¯å¢ƒä»¥åŠå¯¹åº”topicåˆ†åŒºleaderå‰¯æœ¬æ‰€åœ¨çš„brokerçš„ç½‘ç»œå¯èƒ½ä¼šå½±å“åˆ°produce timeçš„å»¶è¿Ÿ)&lt;/p&gt;

&lt;p&gt;Kafka producerä¼šå°†&lt;code&gt;ç›¸åŒtopicåˆ†åŒº&lt;/code&gt;ä¸‹çš„ä¸€ç»„æ¶ˆæ¯æ‰“åŒ…åœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªæ‰¹æ¬¡ï¼ˆbatchï¼‰ä»¥æå‡ç½‘ç»œI/Oæ€§èƒ½ã€‚(åœ¨å¿…è¦æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç”Ÿäº§è€…çš„batch sizeè¿›è¡Œä¸€å®šçš„è°ƒæ•´)&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œproducerä¼šç«‹å³å‘é€batchï¼Œè¿™æ ·ä¸€ä¸ªbatchä¸­é€šå¸¸ä¸ä¼šåŒ…å«å¤ªå¤šçš„æ¶ˆæ¯ã€‚ä¸ºäº†æé«˜batchçš„æ•ˆç‡ï¼Œç”Ÿäº§è€…é€šå¸¸ä¼šå¯¹&lt;code&gt;linger.ms&lt;/code&gt;æ¥äººä¸ºè®¾ç½®ä¸€ä¸ªè¾ƒå°çš„å»¶è¿Ÿæ¥ä¿è¯æœ‰è¶³å¤Ÿå¤šçš„æ¶ˆæ¯è®°å½•èƒ½å°è£…åœ¨ä¸€ä¸ªbatchä¸­ã€‚ä¸€æ—¦è¿‡äº†&lt;code&gt;linger.ms&lt;/code&gt;è®¾ç½®çš„äº‹ä»¶ï¼Œæˆ–è€…batch sizeå·²ç»è¾¾åˆ°æœ€å¤§å€¼(&lt;code&gt;batch.size&lt;/code&gt;çš„å‚æ•°å€¼)ï¼Œè¿™ä¸ªbatchå°†è¢«è®¤ä¸ºå·²ç»å®Œæˆã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœç”Ÿäº§è€…ä¹Ÿå¼€å¯äº†å‹ç¼©(&lt;code&gt;compression.type&lt;/code&gt;)ï¼Œkafkaçš„ç”Ÿäº§è€…ä¼šå°†å·²å®Œæˆçš„batchè¿›è¡Œå‹ç¼©ã€‚åœ¨batchå®Œæˆä¹‹å‰ï¼Œå®ƒçš„å¤§å°æ—¶æ ¹æ®ç”Ÿäº§è€…æŒ‡å®šçš„å‹ç¼©ç±»å‹å’Œä¹‹å‰è§‚æµ‹åˆ°çš„å‹ç¼©æ¯”ç‡ä¼°ç®—å‡ºæ¥çš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœå‘é€ç»™leaderå‰¯æœ¬çš„æœªç¡®è®¤çš„ç”Ÿäº§è€…è¯·æ±‚æ•°é‡å·²ç»è¾¾åˆ°æœ€å¤§(&lt;code&gt;max.inflight.requests.per.connection=5&lt;/code&gt;)ï¼Œåˆ™åœ¨ç”Ÿäº§è€…çš„æ‰¹å¤„ç†å¯èƒ½éœ€è¦ç­‰å¾…æ›´é•¿çš„æ—¶é—´ã€‚å› æ­¤ï¼Œbrokerå“åº”ç”Ÿäº§è€…è¯·æ±‚è¶Šå¿«ï¼Œç”Ÿäº§è€…çš„ç­‰å¾…æ—¶é—´ä¹Ÿå°†ä¼šå˜å¾—æ›´å°ã€‚&lt;/p&gt;

&lt;h4 id=&#34;publish-time&#34;&gt;Publish time&lt;/h4&gt;

&lt;p&gt;Publish timeæ˜¯æŒ‡å†…éƒ¨kafkaç”Ÿäº§è€…å‘é€ç”Ÿäº§è€…è¯·æ±‚åˆ°ä¸€ä¸ªbrokerèŠ‚ç‚¹ï¼Œå¹¶ä¸”å¯¹åº”çš„æ¶ˆæ¯åˆ°è¾¾leaderå‰¯æœ¬æ—¥å¿—ä¹‹é—´çš„æ—¶é—´ã€‚å½“è¯·æ±‚åˆ°è¾¾BrokerèŠ‚ç‚¹æ—¶ï¼Œè´Ÿè´£è¿æ¥çš„ç½‘ç»œçº¿ç¨‹å°†è·å–è¯¥è¯·æ±‚å¹¶å°†å…¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚å…¶ä¸­ä¸€ä¸ªè¯·æ±‚å¤„ç†ç¨‹åºçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è·å–è¯·æ±‚å¹¶å¤„ç†å®ƒä»¬ã€‚(å¯¹åº”brokerèŠ‚ç‚¹çš„num.thread å’Œnum.io.threadä¸¤ä¸ªç›¸å…³å‚æ•°)&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼ŒPublish timeåŒ…å«ç”Ÿäº§è€…è¯·æ±‚çš„ç½‘ç»œæ—¶é—´ï¼Œbrokerä¸Šçš„æ’é˜Ÿæ—¶é—´ï¼Œä»¥åŠå°†æ¶ˆæ¯è¿½åŠ åˆ°æ—¥å¿—æ‰€æ¶ˆè€—çš„æ—¶é—´(é€šå¸¸ä¹Ÿæ˜¯page cache çš„è®¿é—®æ—¶é—´)ã€‚å½“Brokerç«¯è´Ÿè½½æ¯”è¾ƒä½ï¼Œç½‘ç»œå’Œæ—¥å¿—çš„è¿½åŠ å†™å…¥æ—¶é—´ä¼šå½±å“publish timeï¼Œéšç€brokerè´Ÿè½½å˜é«˜ï¼Œé˜Ÿåˆ—å»¶è¿Ÿçš„å¢åŠ 
å°†ä¼šæ›´å¤šçš„å½±å“publish timeã€‚&lt;/p&gt;

&lt;h4 id=&#34;commit-time&#34;&gt;Commit time&lt;/h4&gt;

&lt;p&gt;Commit timeæ˜¯æŒ‡ä»leaderå‰¯æœ¬ä¸­å¤åˆ¶æ¶ˆæ¯åˆ°å…¨éƒ¨çš„åŒæ­¥å‰¯æœ¬(all in-sync replicas)ä¸­æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚kafkaåªä¼šå°†å·²æäº¤(committed)çš„æ¶ˆæ¯æš´éœ²ç»™consumerï¼Œä¹Ÿå°±æ˜¯è¯¥æ¶ˆæ¯å¿…é¡»åœ¨å…¨éƒ¨çš„ISRä¸­åŒ…å«ã€‚followerå‰¯æœ¬ä¸­çš„æ¶ˆæ¯ä¼šä»leaderå‰¯æœ¬ä¸­å¹¶è¡Œçš„æ‹‰å–ï¼Œåœ¨ä¸€ä¸ªæ­£å¸¸çš„é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸å¸Œæœ›å‰¯æœ¬å¤„äºä¸åŒæ­¥çŠ¶æ€(å½“ç„¶æœ‰çš„ä¸šåŠ¡åœºæ™¯å¯èƒ½ä¼šå¯¼è‡´çŸ­æš‚çš„ä¸åŒæ­¥ç°è±¡)ã€‚è¿™æ„å‘³ç€æ¶ˆæ¯è¢«æäº¤çš„æ—¶é—´ç­‰äºISRä¸­æœ€æ…¢çš„followerå‰¯æœ¬æ‰€åœ¨brokerå»ä»ledaer brokerèŠ‚ç‚¹è·å–è®°å½•å¹¶å†™å…¥åˆ°followerå‰¯æœ¬æ—¥å¿—çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†å¤åˆ¶æ•°æ®ï¼Œfolloweræ‰€åœ¨çš„brokerä¼šæƒ³leaderèŠ‚ç‚¹å‘é€fetchè¯·æ±‚ï¼Œå‡†ç¡®çš„æ¥è®²æ¶ˆè´¹è€…ä¹Ÿæ˜¯ä½¿ç”¨fetchè¯·æ±‚æ¥è·å–æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œå®˜æ–¹åœ¨å‰¯æœ¬å¤åˆ¶çš„fetchè¯·æ±‚ä¸­ï¼Œbrokerç«¯ä¼˜åŒ–äº†é»˜è®¤é…ç½®: leaderå‰¯æœ¬ä¼šå°½æ—©çš„å‘é€è¯·æ±‚ï¼Œåªè¦æœ‰ä¸€ä¸ªå­—èŠ‚å¯ç”¨ï¼Œå°±ä¼šå‘èµ·fetchè¯·æ±‚(ç”±&lt;code&gt;replica.fetch.min.bytes&lt;/code&gt;å‚æ•°æ§åˆ¶)æˆ–è€…å½“&lt;code&gt;replica.fetch.wait.max.ms&lt;/code&gt;æ»¡è¶³æ¡ä»¶ã€‚Commit timeä¸»è¦å—å‰¯æœ¬å› æ­¤é…ç½®å‚æ•°çš„å½±å“ä»¥åŠé›†ç¾¤çš„å½“å‰è´Ÿè½½æƒ…å†µã€‚&lt;/p&gt;

&lt;h4 id=&#34;catch-up-time&#34;&gt;Catch-up time&lt;/h4&gt;

&lt;p&gt;Kafkaä¸­æ¶ˆæ¯æ˜¯æŒ‰ç…§å…¶ç”Ÿäº§çš„é¡ºåºè¢«æ¶ˆè´¹çš„ï¼Œé™¤éæ˜¾ç¤ºçš„å£°æ˜äº†ä¸€ä¸ªæ–°çš„offsetæˆ–è€…æœ‰ä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ä»æœ€æ–°çš„offsetè¿›è¡Œæ¶ˆè´¹ã€‚åŒä¸€ä¸ªåˆ†åŒºä¸‹ï¼Œconsumerå¿…é¡»è¦æ¶ˆè´¹å®Œä¹‹å‰å‘å¸ƒçš„æ¶ˆæ¯åæ‰èƒ½è¯»å–åé¢çš„æ¶ˆæ¯ã€‚å‡è®¾åœ¨æäº¤æ¶ˆæ¯æ—¶ï¼Œæ¶ˆè´¹è€…çš„åç§»é‡æ˜¯æäº¤æ¶ˆæ¯åé¢çš„Næ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆï¼ŒCatch-up timeå°±æ˜¯æ¶ˆè´¹è€…æ¶ˆè´¹è€…Næ¡æ¶ˆæ¯çš„æ€»æ—¶é—´.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf2mnjafg2j30rs0723z1.jpg&#34; alt=&#34;Catch-up time&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å½“æˆ‘ä»¬åœ¨æ„å»ºå®æ—¶å¤„ç†åº”ç”¨çš„æ—¶å€™ï¼Œæœ€å¥½è®©catch-upæ—¶é—´ä¸º0ï¼Œå³ä¸€æ—¦æ¶ˆæ¯è¢«æäº¤ï¼Œæ¶ˆè´¹è€…å¯ä»¥ç«‹é©¬è¯»å–åˆ°æ¶ˆæ¯ã€‚å¦‚æœæ¶ˆè´¹è€…æ€»æ˜¯è½åï¼Œç«¯åˆ°ç«¯å»¶è¿Ÿå¯èƒ½ä¼šå˜å¾—æ— é™å¤§ã€‚å› æ­¤ï¼Œcatch-up æ—¶é—´é€šå¸¸ä¾èµ–äºæ¶ˆè´¹è€…çš„èƒ½åŠ›æ˜¯å¦èƒ½å¤Ÿè¿½èµ¶ä¸Šç”Ÿäº§è€…çš„ååé‡ã€‚&lt;/p&gt;

&lt;h4 id=&#34;fetch-time&#34;&gt;Fetch time&lt;/h4&gt;

&lt;p&gt;è®¢é˜…ä¸»é¢˜åˆ†åŒºçš„æ¶ˆè´¹è€…ä¼šä¸æ–­è½®è¯¢å»ä»leaderå‰¯æœ¬ä¸­è·å–æ›´å¤šçš„æ•°æ®ï¼ŒFetch timeæ˜¯ä»leaderå‰¯æœ¬æ‰€åœ¨brokerèŠ‚ç‚¹è·å–æ¶ˆæ¯è®°å½•çš„sæ—¶é—´ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®æ¥å½¢æˆå¯¹fetchè¯·æ±‚çš„å“åº”ï¼Œå¹¶ä»&lt;code&gt;KafkaConsumer.poll()&lt;/code&gt;çš„å“åº”ä¸­è¿”å›è®°å½•ã€‚åœ¨é»˜è®¤çš„é…ç½®ä¸‹ï¼Œå·²ç»å¯¹äºæ¶ˆè´¹è€…çš„fetchå»¶è¿Ÿåšäº†ä¼˜åŒ–(&lt;code&gt;fetch.min.bytes&lt;/code&gt;=1)ï¼Œå³åŠæ—¶åªæœ‰ä¸€ä¸ªå­—èŠ‚å¯ç”¨çš„æ—¶å€™ï¼Œfetchè¯·æ±‚ä¹Ÿä¼šå“åº”æ•°æ®ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªçŸ­æš‚è¶…æ—¶ä¹‹å&lt;code&gt;fetch.max.wait.ms&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&#34;end-to-end-latency-vs-producer-and-consumer-latencies&#34;&gt;End-to-end latency VS producer and consumer latencies&lt;/h4&gt;

&lt;p&gt;ä¸‹å›¾æ˜¾ç¤ºäº†Kafkaå®¢æˆ·ç«¯è§‚å¯Ÿåˆ°çš„å»¶è¿Ÿ(é€šå¸¸ç§°ä¸ºç”Ÿäº§è€…å»¶è¿Ÿå’Œæ¶ˆè´¹è€…å»¶è¿Ÿ)ä¸ç«¯åˆ°ç«¯å»¶è¿Ÿä¹‹é—´çš„å…³ç³»ã€‚&lt;/p&gt;

&lt;p&gt;ç”Ÿäº§è€…å»¶è¿Ÿæ˜¯æŒ‡&lt;code&gt;KafkaProducer.send()&lt;/code&gt;å‘é€å’Œç”Ÿäº§çš„æ¶ˆæ¯è¢«ç¡®è®¤é—´çš„äº‹ä»¶ã€‚æ¶ˆæ¯çš„ç¡®è®¤ä¾èµ–äº&lt;code&gt;acks&lt;/code&gt;çš„é…ç½®ï¼Œè¯¥å‚æ•°å¯ä»¥æ§åˆ¶æ¶ˆæ¯çš„æŒä¹…æ€§(durability):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å½“&lt;code&gt;acks=0&lt;/code&gt;ï¼Œç«‹å³ç¡®è®¤ï¼Œä¸ç­‰å¾…brokerçš„è¿”å›&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;acks=1&lt;/code&gt;ï¼Œæ¶ˆæ¯è¢«è¿½åŠ åˆ°leaderå‰¯æœ¬æ‰€åœ¨åˆ†åŒºåå†ç¡®è®¤&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;acks=all&lt;/code&gt;ï¼Œåœ¨æ‰€æœ‰çš„ISR(åŒæ­¥å‰¯æœ¬)éƒ½æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶æ‰ç¡®è®¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œç”Ÿäº§è€…å»¶è¿ŸåŒ…å«&lt;code&gt;produce time&lt;/code&gt;,&lt;code&gt;publich time(å¦‚æœacks &amp;gt;= 1)&lt;/code&gt;,&lt;code&gt;commit time(å¦‚æœacks=all)&lt;/code&gt; ä»¥åŠç”Ÿäº§è€…å“åº”ä»brokerè¿”å›åˆ°ç”Ÿäº§è€…çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf2n8dbz3bj30rs08a75c.jpg&#34; alt=&#34;end-to-end-latency and producer time&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šå›¾æ¸…æ™°çš„å‘æˆ‘ä»¬å±•ç¤ºäº†ä¸ºä½•æ”¹å˜&lt;code&gt;acks&lt;/code&gt;å‚æ•°èƒ½å¤Ÿå‡å°‘ç”Ÿäº§è€…å»¶è¿Ÿ(å…¶å®æ˜¯é€šè¿‡ä»ç”Ÿäº§è€…å»¶è¿Ÿä¸­ç§»é™¤å‡ ä¸ªå»¶è¿Ÿæ¦‚å¿µæ¥å‡å°‘çš„&lt;code&gt;publishå’Œcommit&lt;/code&gt;)ã€‚ä¸è¿‡ï¼Œæ— è®ºæˆ‘ä»¬å¦‚ä½•é…ç½®ç”Ÿäº§è€…çš„&lt;code&gt;acks&lt;/code&gt;å‚æ•°ï¼Œpublishå’Œcommit æ—¶é—´æ€»æ˜¯ç«¯åˆ°ç«¯å»¶è¿Ÿçš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;æ¶ˆè´¹è€…å»¶è¿Ÿ(Consumer latency)æ˜¯æŒ‡æ¶ˆè´¹è€…å‘èµ·ä¸€ä¸ªfetchè¯·æ±‚åˆ°brokerèŠ‚ç‚¹ï¼Œä»¥åŠbrokerèŠ‚ç‚¹å‘consumerè¿”å›å“åº”çš„æ—¶é—´ã€‚è®¡ç®—æ–¹æ³•æ˜¯&lt;code&gt;KafkaConsumer.poll()&lt;/code&gt;è¿”å›çš„æ—¶é—´ã€‚Consumerçš„å»¶è¿Ÿä¸»è¦åŒ…å«äº†ä¸Šå›¾ä¸­çš„fetch time&lt;/p&gt;

&lt;h4 id=&#34;æ§åˆ¶end-to-end-latency&#34;&gt;æ§åˆ¶end-to-end latency&lt;/h4&gt;

&lt;p&gt;å¦‚æœæˆ‘ä»¬æ€è€ƒä¸€æ¡æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ§åˆ¶ç«¯åˆ°ç«¯å»¶æ—¶å…¶å®å°±æ˜¯æ§åˆ¶æ¶ˆæ¯åœ¨ç³»ç»Ÿä¸­æµè½¬çš„æ—¶é—´æ€»å’Œã€‚å¾ˆå¤šKafka clientsç«¯å’Œbrokerç«¯å‚æ•°çš„é»˜è®¤å€¼å·²ç„¶å¯¹å»¶æ—¶åšäº†ä¼˜åŒ–ï¼šæ¯”å¦‚å‡å°‘äººä¸ºç­‰å¾…æ—¶é—´æ¥æé«˜æ‰¹å¤„ç†çš„èƒ½åŠ›(é€šè¿‡&lt;code&gt;linger.ms&lt;/code&gt;,&lt;code&gt;fetch.min.bytes&lt;/code&gt;,&lt;code&gt;replica.fetch.min.bytes&lt;/code&gt;å‚æ•°æ¥é€‚å½“è°ƒä¼˜)ã€‚å…¶ä»–çš„å»¶æ—¶å¯èƒ½æ¥è‡ªäºbrokerç«¯ä¸Šçš„é˜Ÿåˆ—ç­‰å€™æ—¶é—´ï¼Œæ§åˆ¶è¿™ç§å»¶æ—¶å°±è¦æ¶‰åŠæ§åˆ¶brokerçš„è´Ÿè½½ï¼ˆCPUæˆ–ååé‡ï¼‰ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬è¦æ—¶åˆ»å…³æ³¨brokerèŠ‚ç‚¹çš„å„é¡¹åŸºç¡€ç›‘æ§æŒ‡æ ‡ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæˆ‘ä»¬å°†ç³»ç»Ÿè§†ä¸ºä¸€ä¸ªæ•´ä½“ï¼Œé‚£ä¹ˆæ•´ä¸ªç«¯åˆ°ç«¯çš„å»¶è¿Ÿè¿˜è¦æ±‚ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªéƒ¨åˆ†(ç”Ÿäº§è€…,broker,æ¶ˆè´¹è€…)éƒ½èƒ½å¤Ÿå¯é çš„ç»´æŒåº”ç”¨ç¨‹åºé€»è¾‘æ‰€éœ€çš„ååé‡ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºé€»è¾‘ä»¥100 MB/så‘é€æ•°æ®ï¼Œä½†æ˜¯ç”±äºæŸç§åŸå› ï¼Œæ‚¨çš„Kafkaæ¶ˆè´¹è€…ååé‡åœ¨å‡ ç§’é’Ÿå†…ä¸‹é™åˆ°10 MB/sï¼Œé‚£ä¹ˆåœ¨æ­¤ä¹‹å‰äº§ç”Ÿçš„å¤§å¤šæ•°æ¶ˆæ¯éƒ½éœ€è¦åœ¨ç³»ç»Ÿä¸­ç­‰å¾…æ›´é•¿çš„æ—¶é—´ï¼Œç›´åˆ°æ¶ˆè´¹è€…èµ¶ä¸Šäº†ã€‚æ­¤æ—¶ï¼Œä½ éœ€è¦ä¸€ç§é«˜æ•ˆçš„æ–¹å¼æ¥æ‰©å±•ä½ çš„Kafka clientsç¨‹åºä»¥æå‡ååé‡â€”â€”é«˜æ•ˆåœ°åˆ©ç”¨brokerç«¯èµ„æºæ¥å‡å°‘é˜Ÿåˆ—ç­‰å€™æ—¶é—´å’Œå¶å‘çš„ç½‘ç»œæ‹¥å¡ã€‚&lt;/p&gt;

&lt;p&gt;ç†æƒ³æƒ…å†µä¸‹ï¼Œé™åˆ¶å»¶è¿Ÿæ„å‘³ç€ç¡®ä¿æ‰€æœ‰å»¶è¿Ÿéƒ½ä½äºç›®æ ‡ã€‚ä½†å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”±äºæ„å¤–æ•…éšœå’Œå³°å€¼è´Ÿè½½ï¼Œè¿™ç§ä¸¥æ ¼çš„ä¿è¯æ˜¯ä¸å¯èƒ½çš„ã€‚ä¸è¿‡ï¼Œå¯ä»¥è®¾è®¡åº”ç”¨ç¨‹åºå¹¶å¯¹ç³»ç»Ÿè¿›è¡Œè°ƒä¼˜ï¼Œä»¥å®ç°95%çš„å»¶è¿Ÿç›®æ ‡ï¼Œæ§åˆ¶æ‰€æœ‰çš„æ¶ˆæ¯å»¶è¿Ÿåœ¨95~99%ä½äºç›®æ ‡å»¶è¿Ÿæ—¶é—´ã€‚é«˜ç™¾åˆ†ä½å»¶è¿Ÿä¹Ÿç§°ä¸ºå°¾éƒ¨å»¶è¿Ÿï¼Œå› ä¸ºå®ƒä»¬æ˜¯å»¶è¿Ÿé¢‘è°±çš„å°¾éƒ¨ã€‚&lt;/p&gt;

&lt;p&gt;ç›®æ ‡å»¶æ—¶æ‰€ç”¨çš„ç™¾åˆ†ä½è¶Šå¤§ï¼Œä½ éœ€è¦é™ä½æˆ–å®¹å¿åº”ç”¨æœ€å·®è¡¨ç°æ‰€åšçš„åŠªåŠ›å°±è¶Šå¤šã€‚æ¯”å¦‚ï¼Œå¶å°”çš„å¤§è¯·æ±‚å¯èƒ½ä¼šé˜»å¡å…¨éƒ¨çš„è¯·æ±‚ï¼Œä»è€Œå¢åŠ æ•´ä½“çš„å»¶è¿Ÿï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„&lt;code&gt;head-of-line&lt;/code&gt;é˜Ÿé¦–é˜»å¡ã€‚åŒæ—¶ï¼Œå¤§é‡ä½é€Ÿç‡å®¢æˆ·ç«¯å¯èƒ½å¶å°”ä¼šåŒæ—¶å‘kafkaå‘é€ç”Ÿäº§æˆ–æ¶ˆè´¹è¯·æ±‚ï¼Œæˆ–å…¨éƒ¨åˆ·æ–°é›†ç¾¤å…ƒæ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´è¯·æ±‚é˜Ÿåˆ—æ¯”å¹³å¸¸æ›´é•¿ï¼Œä»è€Œå¼•å‘æ¯”å¹³æ—¶æ›´ä¸¥é‡çš„å°¾å»¶è¿Ÿã€‚è¿™ç§è¡Œä¸ºå°±æ˜¯æ‰€è°“çš„&lt;code&gt;micro-bursting&lt;/code&gt;(å¾®å‹å†²å‡»ï¼Œå¯èƒ½å°±æ˜¯æ°´æ»´çŸ³ç©¿çš„æ„æ€å§)&lt;/p&gt;

&lt;h4 id=&#34;ä¸åŒå®¢æˆ·ç«¯é…ç½®çš„å»¶è¿Ÿæµ‹è¯•&#34;&gt;ä¸åŒå®¢æˆ·ç«¯é…ç½®çš„å»¶è¿Ÿæµ‹è¯•&lt;/h4&gt;

&lt;p&gt;åœ¨è¿™æ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®éªŒç»“æœæ¥è¯´æ˜Kafkaå®¢æˆ·ç«¯é…ç½®å’Œååé‡æ‰©å±•æŠ€æœ¯å¯¹æ€§èƒ½çš„å½±å“ã€‚æˆ‘ä»¬ä½¿ç”¨kafkaå†…ç½®çš„&lt;a href=&#34;https://github.com/apache/kafka/tree/trunk/tools/src/main/java/org/apache/kafka/trogdor&#34;&gt;Trogdor&lt;/a&gt;æµ‹è¯•æ¡†æ¶ä»¥åŠç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºå‡†æµ‹è¯•ï¼Œ&lt;code&gt;ProduceBench&lt;/code&gt;å’Œ&lt;code&gt;ConsumeBench&lt;/code&gt;æ¥è¿›è¡Œæˆ‘ä»¬çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®éªŒæµ‹è¯•ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬æ‰€æœ‰çš„æµ‹è¯•éƒ½åœ¨ä¸€ä¸ªåŒ…å«9ä¸ªä»£ç†çš„Kafkaé›†ç¾¤ä¸Šè¿è¡Œï¼Œè¯¥é›†ç¾¤çš„å¤åˆ¶å› å­ä¸º3ï¼Œè¿™ä¿è¯äº†åœ¨å‡ºç°æœ€å¤šä¸¤ä¸ªåŒæ—¶å‘ç”Ÿçš„èŠ‚ç‚¹æ•…éšœæ—¶ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaé›†ç¾¤è¿è¡Œåœ¨AWSçš„&lt;code&gt;r5.xlarge&lt;/code&gt;å®ä¾‹ä¸Šï¼Œä½¿ç”¨æœ‰2Tçš„EBS(å¼¹æ€§å—å­˜å‚¨)ã€‚Kafkaçš„brokerèŠ‚ç‚¹åˆ†å¸ƒåœ¨åŒä¸€åŒºåŸŸå†…çš„ä¸‰ä¸ªå¯ç”¨æ€§åŒºåŸŸ(AZ)ï¼Œä»¥è·å¾—æ›´å¼ºçš„å®¹é”™æ€§ï¼Œå…¶ä¸­æ¯ä¸ªä¸»é¢˜åˆ†åŒºå‰¯æœ¬è¢«æ”¾ç½®åœ¨ä¸€ä¸ªä¸åŒçš„AZä¸Šï¼Œå¹¶ä¸”kafkaå®¢æˆ·ç«¯é…ç½®ä½¿ç”¨SASLè®¤è¯å’ŒSSLåŠ å¯†ï¼ŒBrokerä¹‹é—´ä½¿ç”¨&lt;code&gt;PLAINTEXT&lt;/code&gt;è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ä¸»é¢˜:&lt;/code&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ†å¸ƒå¼é›†ç¾¤ä¸­èŠ‚ç‚¹å¦‚æœåœ¨ä¸åŒå¯ç”¨åŒºä¹Ÿå¯èƒ½å¯¼è‡´å»¶è¿Ÿçš„å¢åŠ ï¼Œå½“ç„¶è¿™è¦åœ¨å»¶è¿Ÿå’Œå®¹é”™æ€§è§’åº¦è¿›è¡Œæƒè¡¡ï¼Œä¹Ÿéœ€è¦è€ƒè™‘åˆ°äº‘å‚å•†çš„å¯ç”¨åŒºä¹‹é—´æœ¬èº«çš„å»¶è¿Ÿã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çš„å®éªŒä½¿ç”¨äº†ä»¥ä¸‹éé»˜è®¤å®¢æˆ·ç«¯é…ç½®å’Œå…¶ä»–è§„èŒƒ:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°é¡¹&lt;/th&gt;
&lt;th&gt;å‚æ•°å€¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å‰¯æœ¬æ•°&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;topicçš„åˆ†åŒºæ•°&lt;/td&gt;
&lt;td&gt;108&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;security.protocol&lt;/td&gt;
&lt;td&gt;SASL_SSL&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;sasl.mechanism&lt;/td&gt;
&lt;td&gt;PLAIN&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;acks&lt;/td&gt;
&lt;td&gt;all&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;linger.ms&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;compression.type&lt;/td&gt;
&lt;td&gt;lz4&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Producer record size&lt;/td&gt;
&lt;td&gt;value=521bytes/key=4bytes&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Trogdor record value generator&lt;/td&gt;
&lt;td&gt;uniformRandom&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Trogdor record key generator&lt;/td&gt;
&lt;td&gt;sequential&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Number of Trogdor agents&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;è¿™ä¸ªæµ‹è¯•åœºæ™¯ä¼šäº§ç”Ÿé¢å¤–çš„å»¶è¿Ÿ: å¤šå¯ç”¨åŒºå¯èƒ½å¢åŠ commitæ—¶é—´ï¼Œç”±äºæ˜¯è·¨å¯ç”¨åŒºçš„å‰¯æœ¬ã€‚æ— è®ºæ˜¯clientsç«¯è¿˜æ˜¯brokerç«¯ï¼ŒSSLåŠ å¯†ä¹Ÿæ˜¯æœ‰å¼€é”€çš„ã€‚åŒæ—¶ç”±äºSSLæ— æ³•åˆ©ç”¨Zero Copyç‰¹æ€§è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå› ä¸ºconsumerè·å–æ¶ˆæ¯æ—¶ä¹Ÿä¼šå¢åŠ é¢å¤–çš„å¼€é”€ã€‚&lt;/p&gt;

&lt;p&gt;è™½ç„¶è¿™äº›å› ç´ éƒ½ä¼šå½±å“å»¶è¿Ÿï¼Œä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹ä¼ä¸šå†…éƒ¨å¯èƒ½è¿˜æ˜¯éœ€è¦è¿™ç§æ¶æ„ä¸Šçš„è€ƒè™‘ï¼Œå› æ­¤é‡‡ç”¨è¯¥éƒ¨ç½²ç»“æ„è¿›è¡Œæµ‹è¯•ã€‚&lt;/p&gt;

&lt;h4 id=&#34;æŒä¹…æ€§è®¾ç½®å¯¹å»¶è¿Ÿçš„å½±å“&#34;&gt;æŒä¹…æ€§è®¾ç½®å¯¹å»¶è¿Ÿçš„å½±å“&lt;/h4&gt;

&lt;p&gt;å½“å°†å»¶è¿Ÿç›®æ ‡ä¸å…¶ä»–éœ€æ±‚å åŠ åœ¨ä¸€èµ·æ—¶ï¼Œé¦–å…ˆè€ƒè™‘æŒä¹…æ€§éœ€æ±‚æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ç”±äºæ•°æ®çš„é‡è¦æ€§ï¼Œé€šå¸¸éœ€è¦ä¸€å®šç¨‹åº¦çš„æŒä¹…æ€§ã€‚&lt;/p&gt;

&lt;p&gt;ä¼˜åŒ–æŒä¹…æ€§ä¼šå¢åŠ ç«¯åˆ°ç«¯å»¶è¿Ÿï¼Œå› ä¸ºè¿™ä¼šå¢åŠ å»¶è¿Ÿçš„å¤åˆ¶å¼€é”€(æäº¤æ—¶é—´)ï¼Œå¹¶å‘Brokeræ·»åŠ å¤åˆ¶è´Ÿè½½ï¼Œä»è€Œå¢åŠ æ’é˜Ÿå»¶è¿Ÿã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Replication factor&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Replication factor æ˜¯KafkaæŒä¹…åŒ–ä¿è¯çš„æ ¸å¿ƒï¼Œå®ƒå®šä¹‰äº†Kafkaé›†ç¾¤ä¸Šä¿å­˜çš„topicå‰¯æœ¬æ•°ã€‚Replication factor = N è¡¨ç¤ºæˆ‘ä»¬æœ€å¤šèƒ½å¤Ÿå®¹å¿N-1å°brokerå®•æœºè€Œä¸å¿…æ•°æ®ä¸¢å¤±ã€‚N=1èƒ½å¤Ÿä»¤ç«¯åˆ°ç«¯å»¶æ—¶æœ€å°åŒ–ï¼Œä½†å´æ˜¯æœ€ä½çš„æŒä¹…åŒ–ä¿è¯ã€‚&lt;/p&gt;

&lt;p&gt;å¢åŠ å‰¯æœ¬æ•°ä¼šå¢åŠ å¤‡ä»½å¼€é”€å¹¶ç»™brokeré¢å¤–å¢åŠ è´Ÿè½½ã€‚å¦‚æœclientsç«¯å¸¦å®½åœ¨brokerç«¯å‡åŒ€åˆ†å¸ƒï¼Œé‚£ä¹ˆæ¯ä¸ªbrokeréƒ½ä¼šä½¿ç”¨&lt;code&gt;N * wå†™å¸¦å®½&lt;/code&gt;å’Œ&lt;code&gt;r + (N - 1) * wè¯»å¸¦å®½&lt;/code&gt;ï¼Œå…¶ä¸­wæ˜¯clientsç«¯åœ¨brokerä¸Šçš„å†™å…¥å¸¦å®½å ç”¨ï¼Œræ˜¯è¯»å¸¦å®½å ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;ç”±æ­¤ï¼Œé™ä½N å¯¹ç«¯åˆ°ç«¯å»¶æ—¶å½±å“çš„æœ€ä½³æ–¹æ³•å°±æ˜¯ç¡®ä¿æ¯ä¸ªbrokerä¸Šçš„è´Ÿè½½æ˜¯å‡åŒ€çš„ã€‚è¿™ä¼šé™ä½commit timeï¼Œå› ä¸ºcommit timeæ˜¯ç”±æœ€æ…¢çš„é‚£ä¸ªfollowerå‰¯æœ¬å†³å®šçš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ çš„Kafka brokerä½¿ç”¨äº†è¿‡å¤šçš„ç£ç›˜å¸¦å®½æˆ–CPUï¼Œfollowerå°±ä¼šå¼€å§‹å‡ºç°è¿½ä¸ä¸Šleaderçš„æƒ…å†µä»è€Œæ¨é«˜äº†commit timeã€‚(å…¶å®è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æœ€å°çš„ISRé»˜è®¤ä¸ºå‰¯æœ¬çš„æ•°é‡ä¸ªæ•°æ—¶ï¼Œåœ¨å‡ºç°followerå’Œleaderä¸åŒæ­¥æ—¶æ°å·§leaderèŠ‚ç‚¹å®•æœºï¼Œä¼šå¯¼è‡´topicæœ¬èº«ä¸å¯ç”¨)&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å»ºè®®ä¸ºå‰¯æœ¬åŒæ­¥æ¶ˆæ¯æµé‡è®¾ç½®æˆä½¿ç”¨ä¸åŒçš„listeneræ¥å‡å°‘ä¸æ­£å¸¸clientsæµé‡çš„å¹²æ‰°ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨follower brokerä¸Šå¢åŠ I/Oå¹¶è¡Œåº¦ï¼Œå¹¶å¢åŠ å‰¯æœ¬æ‹‰å–çº¿ç¨‹æ•°é‡&lt;code&gt;number.replica.fetchers&lt;/code&gt;æ¥æ”¹å–„å¤‡ä»½æ€§èƒ½ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Acks&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;çºµç„¶æˆ‘ä»¬é…ç½®äº†å¤šä¸ªå‰¯æœ¬ï¼Œproducerè¿˜æ˜¯å¿…é¡»é€šè¿‡ackså‚æ•°æ¥é…ç½®å¯é æ€§æ°´å¹³ã€‚è®¾ç½®acks=allèƒ½å¤Ÿæä¾›æœ€å¼ºçš„å¯é æ€§ä¿è¯ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ brokeråº”ç­”PRODUCEè¯·æ±‚çš„æ—¶é—´ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„é‚£æ ·ã€‚&lt;/p&gt;

&lt;p&gt;Brokerç«¯åº”ç­”çš„é€Ÿåº¦å˜æ…¢é€šå¸¸ä¼šé™ä½å•ä¸ªproducerçš„ååé‡ï¼Œè¿›è€Œå¢åŠ producerçš„ç­‰å¾…æ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºproducerç«¯ä¼šé™åˆ¶æœªåº”ç­”è¯·æ±‚çš„æ•°é‡(&lt;code&gt;max.inflight.requests.per.connection&lt;/code&gt;)ã€‚&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æˆ‘ä»¬çš„ç¯å¢ƒä¸­acks=1ï¼Œæˆ‘ä»¬å¯åŠ¨äº†9ä¸ªproducerï¼ˆåŒæ—¶ä¹Ÿè·‘äº†9ä¸ªconsumerï¼‰ï¼Œååé‡è¾¾åˆ°äº†195MB/ç§’ã€‚å½“acksåˆ‡æ¢æˆallæ—¶ï¼Œååé‡ä¸‹é™åˆ°161MB/ç§’ã€‚è®¾ç½®æ›´é«˜çº§åˆ«çš„acksé€šå¸¸è¦æ±‚æˆ‘ä»¬æ‰©å±•producerç¨‹åºæ‰èƒ½ç»´æŒä¹‹å‰çš„ååé‡æ°´å¹³ä»¥åŠæœ€å°åŒ–producerå†…éƒ¨çš„ç­‰å¾…æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Min.insync.replicas&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;min.insync.replicas&lt;/code&gt;æ˜¯ä¸€ä¸ªé‡è¦çš„æŒä¹…åŒ–å‚æ•°ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†brokerç«¯ISRå‰¯æœ¬ä¸­æœ€å°‘è¦æœ‰å¤šå°‘ä¸ªå‰¯æœ¬å†™å…¥æ¶ˆæ¯æ‰ç®—PRODUCEè¯·æ±‚æˆåŠŸã€‚è¿™ä¸ªå‚æ•°ä¼šå½±å“å¯ç”¨æ€§ï¼Œä½†æ˜¯ä¸ä¼šå½±å“ç«¯åˆ°ç«¯çš„å»¶æ—¶ã€‚å› æ­¤ï¼Œé€‰æ‹©ä¸€ä¸ªå°ä¸€ç‚¹çš„å€¼å¹¶ä¸èƒ½å‡å°‘commit timeå¹¶å‡å°‘å»¶è¿Ÿã€‚&lt;/p&gt;

&lt;h4 id=&#34;åœ¨æ»¡è¶³å»¶è¿Ÿç›®æ ‡çš„å‰æä¸‹æ‰©å±•åå&#34;&gt;åœ¨æ»¡è¶³å»¶è¿Ÿç›®æ ‡çš„å‰æä¸‹æ‰©å±•åå&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;å»¶è¿Ÿå’Œååçš„æƒè¡¡&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¼˜åŒ–Kafka clientsç«¯ååé‡æ„å‘³ç€ä¼˜åŒ–batchingçš„æ•ˆæœã€‚Kafka producerå†…éƒ¨ä¼šæ‰§è¡Œä¸€ç±»batchingï¼Œå³æ”¶é›†å¤šæ¡æ¶ˆæ¯åˆ°ä¸€ä¸ªbatchä¸­ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªbatchè¢«ç»Ÿä¸€å‹ç¼©ç„¶åä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«å†™å…¥æ—¥å¿—æˆ–ä»æ—¥å¿—ä¸­è¯»å–ã€‚è¿™è¯´æ˜æ¶ˆæ¯å¤‡ä»½ä¹Ÿæ˜¯ä»¥batchä¸ºå•ä½è¿›è¡Œçš„ã€‚&lt;/p&gt;

&lt;p&gt;Batchingä¼šå‡å°‘æ¯æ¡æ¶ˆæ¯çš„æˆæœ¬ï¼Œå› ä¸ºå®ƒå°†è¿™äº›æˆæœ¬æ‘Šè¿˜åˆ°clientsç«¯å’Œbrokerç«¯ã€‚é€šå¸¸æ¥è¯´ï¼Œbatchè¶Šå¤§è¿™ç§å¼€é”€é™ä½çš„æ•ˆæœå°±è¶Šé«˜ï¼Œå‡å°‘çš„ç½‘ç»œå’Œç£ç›˜I/Oå°±è¶Šå¤šã€‚&lt;/p&gt;

&lt;p&gt;å¦ä¸€ç±»batchingå°±æ˜¯åœ¨å•ä¸ªç½‘ç»œè¯·æ±‚/å“åº”ä¸­æ”¶é›†å¤šä¸ªbatchä»¥å‡å°‘ç½‘ç»œæ•°æ®ä¼ è¾“é‡ã€‚è¿™èƒ½é™ä½clientsç«¯å’Œbrokerç«¯çš„è¯·æ±‚å¤„ç†å¼€é”€ã€‚è¿™ç±»batchingèƒ½å¤Ÿæå‡ååé‡å’Œé™ä½å»¶æ—¶ï¼Œå› ä¸ºbatchè¶Šå¤§ï¼Œç½‘ç»œä¼ è¾“I/Oé‡è¶Šå°ï¼ŒCPUå’Œç£ç›˜ä½¿ç”¨ç‡è¶Šä½ï¼Œæ•…æœ€ç»ˆèƒ½å¤Ÿä¼˜åŒ–ååé‡ã€‚å¦å¤–batchè¶Šå¤§è¿˜èƒ½å‡ä½ç«¯åˆ°ç«¯å»¶æ—¶ï¼Œå› ä¸ºæ¯æ¡æ¶ˆæ¯çš„æˆæœ¬é™ä½äº†ï¼Œä½¿å¾—ç³»ç»Ÿå¤„ç†ç›¸åŒæ•°é‡æ¶ˆæ¯çš„æ€»æ—¶é—´å˜å°‘äº†ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œçš„å»¶æ—¶-ååé‡æƒè¡¡æ˜¯æŒ‡é€šè¿‡äººä¸ºå¢åŠ ç­‰å¾…æ—¶é—´æ¥æå‡æ‰“åŒ…æ¶ˆæ¯çš„èƒ½åŠ›ã€‚ä½†è¿‡äº†æŸä¸ªç¨‹åº¦ï¼Œäººä¸ºç­‰å¾…æ—¶é—´çš„å¢åŠ å¯èƒ½ä¼šæŠµæ¶ˆæˆ–è¦†ç›–ä½ ä»æ‰“åŒ…æœºåˆ¶è·å¾—çš„å»¶æ—¶æ”¶ç›Šã€‚å› æ­¤ä½ çš„å»¶æ—¶ç›®æ ‡æœ‰å¯èƒ½ä¼šé™åˆ¶ä½ èƒ½å®æ–½æ‰“åŒ…åŒ–çš„æ°´å¹³ï¼Œè¿›è€Œå‡å°‘æ‰€èƒ½è¾¾åˆ°çš„ååé‡å¹¶å¢åŠ å»¶æ—¶ã€‚å¦‚æœæ‹‰ä½äº†æœ¬èƒ½è¾¾åˆ°çš„ååé‡æˆ–ç«¯åˆ°ç«¯å»¶æ—¶æ°´å¹³ï¼Œä½ å¯ä»¥é€šè¿‡æ‰©å±•é›†ç¾¤æ¥æ¢å–æˆ–â€œè´­ä¹°â€æ›´å¤šçš„ååé‡æˆ–å¤„ç†èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;h4 id=&#34;é…ç½®kafkaçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä»¥å®ç°batching&#34;&gt;é…ç½®kafkaçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä»¥å®ç°batching&lt;/h4&gt;

&lt;p&gt;å¯¹äºproducerè€Œè¨€ï¼Œbatchingç”±ä¸¤ä¸ªå‚æ•°è¿›è¡Œæ§åˆ¶: &lt;code&gt;batch.size(16KB)&lt;/code&gt;å’Œ&lt;code&gt;linger.ms(0)&lt;/code&gt;ï¼Œå‰è€…æ§åˆ¶batchçš„å¤§å°ï¼Œåè€…é™åˆ¶å»¶è¿Ÿé‡ã€‚å¦‚æœä½¿ç”¨åœºæ™¯ä¸­ï¼Œåº”ç”¨ä¼šé¢‘ç¹çš„åƒkafkaé›†ç¾¤å‘é€æ•°æ®ï¼ŒåŠæ—¶è®¾ç½®äº†&lt;code&gt;linger.ms=0&lt;/code&gt;ï¼Œæ•´ä¸ªbatchä¹Ÿä¼šè¢«å°½å¿«å¡«æ»¡ã€‚å¦‚æœåº”ç”¨ç”Ÿäº§æ•°æ®çš„é¢‘ç‡è¾ƒä½ï¼Œå¯ä»¥é€šè¿‡å¢åŠ &lt;code&gt;linger.ms&lt;/code&gt;æ¥å¢åŠ batchã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºconsumerè€Œè¨€ï¼Œå¯ä»¥è°ƒæ•´&lt;code&gt;fetch.min.bytes(1)&lt;/code&gt;æ¥é™åˆ¶æ¯ä¸ªæ¶ˆè´¹è€…åœ¨æ¯ä¸ªfetchå“åº”ä¸­æ¥æ”¶çš„æ•°æ®é‡ï¼Œè¯¥å‚æ•°æŒ‡å®šäº†brokeråº”è¯¥åœ¨ä¸€ä¸ªfetchå“åº”ä¸­è¿”å›çš„æœ€å°æ•°æ®ï¼Œä»¥åŠ&lt;code&gt;fetch.max.wait.ms(500)&lt;/code&gt;æ¥è®¾ç½®ç­‰å¾…æ•°æ®çš„è¶…æ—¶æ—¶é—´ã€‚åœ¨fetchå“åº”ä¸­çš„æ•°æ®è¶Šå¤šï¼Œå°±ä¼šæœ‰æ›´å°‘çš„fetchè¯·æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç”Ÿäº§è€…ç«¯çš„batchingä¹Ÿä¼šé—´æ¥å½±å“produceå’Œfetchçš„è¯·æ±‚æ•°é‡ï¼Œå› ä¸ºbatchå®šä¹‰äº†æ•°æ®èƒ½å¤Ÿè¢«è·å–çš„æœ€å°æ•°æ®é‡ã€‚&lt;/p&gt;

&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒKafka producerå’Œconsumerè®¾ç½®çš„æ˜¯æ— äººä¸ºç­‰å¾…æ—¶é—´ï¼Œè¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä¸ºäº†é™ä½å»¶æ—¶ã€‚ä½†æ˜¯ï¼Œå³ä½¿ä½ çš„ç›®æ ‡å°±æ˜¯äº†ä½¿å»¶æ—¶æœ€å°åŒ–ï¼Œæˆ‘ä»¬ä¾ç„¶æ¨èä½ è®¾ç½®ä¸€ä¸ªä¸ä¸º0çš„linger.mså€¼ï¼Œæ¯”å¦‚5~10msã€‚å½“ç„¶ï¼Œè¿™ä¹ˆåšæ˜¯æœ‰å‰æçš„ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ æ‰©å±•äº†ä½ çš„producerç¨‹åºï¼Œå¹³å‡ä¸‹æ¥ä½¿å¾—æ¯ä¸ªproducerå®ä¾‹çš„å‘é€é€Ÿç‡å˜å¾—å¾ˆä½ï¼Œé‚£ä¹ˆä½ çš„batchåªä¼šåŒ…å«å¾ˆå°‘çš„å‡ æ¡æ¶ˆæ¯ã€‚å¦‚æœä½ æ•´ä½“çš„ååé‡å·²ç„¶å¾ˆé«˜äº†ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šç›´æ¥æŠŠä½ çš„Kafkaé›†ç¾¤å‹æŒ‚ï¼Œå¯¼è‡´è¶…é«˜çš„é˜Ÿåˆ—ç­‰å€™æ—¶é—´ä»è€Œæ¨é«˜å»¶æ—¶ã€‚æ­¤æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªè¾ƒå°çš„&lt;code&gt;linger.ms&lt;/code&gt;å€¼ç¡®å®èƒ½å¤Ÿæ”¹å–„å»¶æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ åœ¨æ„å°¾å»¶æ—¶ï¼Œé‚£ä¹ˆå¢åŠ &lt;code&gt;linger.ms&lt;/code&gt;å¯èƒ½ä¼šé™ä½è¯·æ±‚é€Ÿç‡ä»¥åŠåŒæ—¶åˆ°è¾¾brokerç«¯çš„ç¬æ—¶å†²å‡»æµé‡ã€‚è¿™ç§å†²å‡»è¶Šå¤§ï¼Œè¯·æ±‚åœ¨å°¾éƒ¨çš„å»¶æ—¶å°±è¶Šé«˜ã€‚è¿™äº›ç¬æ—¶å†²å‡»æµé‡å†³å®šäº†ä½ çš„å°¾å»¶æ—¶æ°´å¹³ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹é¢è¿™ä¸ªå®éªŒè¯´æ˜äº†ä»¥ä¸Šä¸¤ç§åœºæ™¯ã€‚æˆ‘ä»¬å¯åŠ¨äº†90ä¸ªproducerï¼Œå‘ä¸€ä¸ªæœ‰108ä¸ªåˆ†åŒºçš„topicå‘é€æ¶ˆæ¯ã€‚ç”Ÿäº§ç«¯æ•´ä½“çš„ååé‡å³°å€¼åœ¨90MB/ç§’ã€‚æˆ‘ä»¬è·‘äº†3æ¬¡æµ‹è¯•ï¼Œæ¯ä¸€æ¬¡å¯¹åº”ä¸€ç§ä¸åŒçš„produceré…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf2squjyvij30rs0fzaaz.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å› ä¸ºåœ¨ç»™å®šçš„æ€»ååä¸‹ï¼Œæˆ‘ä»¬æœ‰ç›¸å¯¹å¤§é‡çš„ç”Ÿäº§è€…ï¼Œå› æ­¤&lt;code&gt;linger.ms = 0&lt;/code&gt;å¯¼è‡´åœ¨ç”Ÿäº§è€…ç«¯æœºä¼šæ²¡æœ‰batchæ“ä½œã€‚å°†&lt;code&gt;linger.ms&lt;/code&gt;ä»0è°ƒæ•´åˆ°5å¯ä»¥å¢åŠ batchingèƒ½åŠ›: å‘kafkaå‘èµ·çš„ç”Ÿäº§è€…è¯·æ±‚ä»2800é™ä½åˆ°äº†1100ã€‚è¿™å‡å°‘äº†50%å’Œ99%çš„ç”Ÿäº§è€…å»¶è¿Ÿã€‚&lt;/p&gt;

&lt;p&gt;å¢åŠ &lt;code&gt;batch.size&lt;/code&gt;ä¸ä¼šç›´æ¥å½±å“ç”Ÿäº§è€…çš„ç­‰å¾…æ—¶é—´ï¼Œå› ä¸ºç”Ÿäº§è€…åœ¨å¡«æ»¡batchçš„æ—¶é—´ä¸ä¼šè¶…è¿‡&lt;code&gt;linger.ms&lt;/code&gt;çš„é™åˆ¶ã€‚åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œå¢åŠ &lt;code&gt;batch.size&lt;/code&gt;ä»16KBåˆ°128KBæ²¡æœ‰å¢åŠ bacthçš„æ•ˆæœï¼Œå› ä¸ºæ¯ä¸ªç”Ÿäº§è€…çš„ååé‡éå¸¸ä½ã€‚æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œç”Ÿäº§è€…å»¶è¿Ÿåœ¨ä¸¤ç§é…ç½®ä¹‹é—´æ²¡æœ‰å˜åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;æ€»ä¹‹ï¼Œå¦‚æœæ‚¨çš„ç›®æ ‡æ˜¯æœ€å°åŒ–å»¶è¿Ÿï¼Œæˆ‘ä»¬å»ºè®®ä¿ç•™é»˜è®¤çš„å®¢æˆ·ç«¯æ‰¹å¤„ç†é…ç½®ï¼Œå¹¶å°½å¯èƒ½å¢åŠ &lt;code&gt;linger.ms&lt;/code&gt;ã€‚å¦‚æœä½ åœ¨æ„å°¾å»¶æ—¶ï¼Œæœ€å¥½è°ƒä¼˜ä¸‹æ‰“åŒ…æ°´å¹³æ¥å‡å°‘è¯·æ±‚å‘é€ç‡ä»¥åŠå¤§è¯·æ±‚å†²å‡»çš„æ¦‚ç‡ã€‚&lt;/p&gt;

&lt;h4 id=&#34;ä¸å¢åŠ äººä¸ºå»¶è¿Ÿä»¥æé«˜batchingæ•ˆç‡&#34;&gt;ä¸å¢åŠ äººä¸ºå»¶è¿Ÿä»¥æé«˜batchingæ•ˆç‡&lt;/h4&gt;

&lt;p&gt;batchingæ•ˆæœä¸å¥½çš„å¦ä¸€ä¸ªåŸå› æ˜¯producerå‘é€æ¶ˆæ¯ç»™å¤§é‡åˆ†åŒºã€‚&lt;code&gt;å¦‚æœæ¶ˆæ¯ä¸æ˜¯å‘å¾€åŒä¸€ä¸ªåˆ†åŒºçš„ï¼Œå®ƒä»¬å°±æ— æ³•èšé›†åœ¨ä¸€ä¸ªbatchä¸‹&lt;/code&gt;ã€‚å› æ­¤ï¼Œé€šå¸¸æœ€å¥½è®¾è®¡æˆè®©æ¯ä¸ªproduceréƒ½åªå‘æœ‰é™çš„å‡ ä¸ªåˆ†åŒºå‘é€æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œå¯ä»¥è€ƒè™‘å‡çº§åˆ°Kafka 2.4 producerã€‚è¿™ä¸ªç‰ˆæœ¬å¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„Stickyåˆ†åŒºå™¨ã€‚è¯¥åˆ†åŒºå™¨èƒ½å¤Ÿæ”¹å–„non-keyed topicçš„æ‰“åŒ…æ•ˆæœï¼ŒåŒæ—¶è¿˜æ— éœ€å¼•å…¥äººä¸ºç­‰å¾…ã€‚&lt;/p&gt;

&lt;h4 id=&#34;clientsçš„æ•°é‡å¯¹å°¾å»¶è¿Ÿ-tail-latency-çš„å½±å“&#34;&gt;clientsçš„æ•°é‡å¯¹å°¾å»¶è¿Ÿ(tail-latency)çš„å½±å“&lt;/h4&gt;

&lt;p&gt;å³ä½¿æ•´ä½“çš„ç”Ÿäº§å’Œæ¶ˆè´¹çš„ååé‡ä¿æŒä¸å˜ï¼Œé€šå¸¸ä¹Ÿæ˜¯Clientsæ•°è¶Šå¤šï¼Œbrokerä¸Šè´Ÿè½½è¶Šå¤§ã€‚è¿™æ˜¯å› ä¸ºclientsæ•°é‡å¤šä¼šå¯¼è‡´æ›´å¤šçš„METADATAè¯·æ±‚å‘åˆ°Kafkaï¼Œç»§è€Œè¦ç»´æŠ¤æ›´å¤šçš„è¿æ¥ï¼Œæ•…ç»™brokerå¸¦æ¥æ›´å¤§çš„å¼€é”€ã€‚&lt;/p&gt;

&lt;p&gt;ç›¸å¯¹äº50%æˆ–å¹³å‡å»¶æ—¶çš„å½±å“ï¼ŒClientsæ•°é‡å¢åŠ å¯¹å°¾å»¶æ—¶çš„å½±å“æ›´å¤§ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªproduceræœ€å¤šå‘é€&lt;code&gt;max.inflight.requests.per.connection&lt;/code&gt;ä¸ªPRODUCEè¯·æ±‚ç»™å•ä¸ªbrokerï¼Œè€Œæ¯ä¸ªconsumerä¸€æ¬¡æœ€å¤šåªä¼šç»™ä¸€ä¸ªbrokerå‘é€FETCHè¯·æ±‚ã€‚Clientsè¶Šå¤šï¼ŒåŒä¸€æ—¶åˆ»å‘é€åˆ°brokerçš„PRODUCEå’ŒFETCHè¯·æ±‚ä¹Ÿå°±è¶Šå¤šï¼Œè¿™å°±å¢åŠ äº†å½¢æˆè¯·æ±‚ç¬æ—¶å†²å‡»çš„æ¦‚ç‡ï¼Œè¿›è€Œæ¨é«˜äº†å°¾å»¶æ—¶ã€‚&lt;/p&gt;

&lt;p&gt;Consumeræ•°é‡é€šå¸¸ç”±topicåˆ†åŒºæ•°é‡ä»¥åŠæœŸæœ›consumeræ²¡æœ‰è¾ƒå¤§lagçš„ç›®æ ‡å…±åŒå†³å®šã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å´å¾ˆå®¹æ˜“ä¸ºäº†æ‰©å±•ååé‡è€Œå¼•å…¥å¤§é‡çš„producerã€‚&lt;/p&gt;

&lt;p&gt;åŸºäºååé‡çš„è€ƒé‡å¢åŠ producerå®ä¾‹æ•°å¯èƒ½æœ‰ç›¸åçš„æ•ˆæœï¼Œå› ä¸ºproducerä¼šå¯¼è‡´æ›´å°‘çš„æ¶ˆæ¯è¢«æ‰“åŒ…ï¼Œæ¯•ç«Ÿæ¯ä¸ªproducerå¤„ç†äº†æ›´å°‘çš„æ¶ˆæ¯ï¼Œå› è€Œå‘é€é€Ÿç‡ä¼šå˜æ…¢ã€‚åŒæ—¶producerè¿˜å¿…é¡»ç­‰å¾…æ›´é•¿çš„æ—¶é—´æ¥ç§¯ç´¯ç›¸åŒæ•°é‡çš„æ¶ˆæ¯è¿›åˆ°batché‡Œé¢ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†producerçš„æ•°é‡ä»90å¢åŠ åˆ°900ï¼Œå‘ç°ååé‡æ²¡æœ‰ä»–æ‰“å˜åŒ–ï¼š90MB/ç§’ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;batch.size=16KB&lt;/code&gt;,&lt;code&gt;linger.ms=5&lt;/code&gt;,&lt;code&gt;acks=all&lt;/code&gt;çš„ç”Ÿäº§è€…é…ç½®ï¼Œå®éªŒç»“æœå¦‚ä¸‹:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf2s85pax9j30rs0f60tm.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç»“æœæ˜¾ç¤ºå¢åŠ produceræ•°é‡(90-&amp;gt;900)å¢åŠ äº†60%çš„ä¸­ä½æ•°å»¶æ—¶å€¼ï¼Œè€Œ99%å»¶æ—¶å€¼å‡ ä¹å¢åŠ äº†3å€ã€‚&lt;/p&gt;

&lt;p&gt;å»¶æ—¶çš„å¢åŠ æ˜¯å› ä¸ºproducerç«¯æ‰“åŒ…æ•ˆæœå˜å·®å¯¼è‡´çš„ã€‚&lt;/p&gt;

&lt;p&gt;å°¾å»¶æ—¶çš„å¢åŠ æ˜¯å› ä¸ºæ›´å¤§çš„è¯·æ±‚ç¬æ—¶å†²å‡»ï¼Œè¿™ä¼šæ‹‰å‡brokerç«¯å»¶æ—¶ï¼ŒåŒæ—¶producerç«¯ä¼šç­‰å¾…æ›´é•¿çš„æ—¶é—´æ¥æ¥æ”¶åº”ç­”ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨900ä¸ªproducerçš„æµ‹è¯•ä¸­ï¼Œbrokerå®Œå…¨è¢«PRODUCEè¯·æ±‚å‹å®äº†ã€‚ç”¨äºå¤„ç†è¯·æ±‚çš„æ—¶é—´å‡ ä¹å åˆ°äº†brokerç«¯CPUä½¿ç”¨ç‡çš„100%ã€‚å¦å¤–ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†SSLï¼Œå®ƒä¹Ÿä¼šè¿›ä¸€æ­¥å¼•å…¥è¯·æ±‚çº§çš„å¼€é”€ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ é€šè¿‡æ·»åŠ produceræ¥æå‡ååé‡ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘å¢åŠ å•ä¸ªproudcerçš„ååé‡ï¼Œå³&lt;code&gt;æ”¹å–„batchingçš„æ•ˆæœ&lt;/code&gt;ã€‚ä¸ç®¡æ€æ ·ï¼Œä½ æœ€ç»ˆå¯èƒ½ä¼šæœ‰å¾ˆå¤šproducerå®ä¾‹ã€‚æ¯”å¦‚ï¼Œå¤§å…¬å¸æ”¶é›†è®¾å¤‡ä¸Šçš„ç»Ÿè®¡æŒ‡æ ‡ï¼Œè€Œè®¾å¤‡æ•°å¯èƒ½æœ‰æˆåƒä¸Šä¸‡ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªBrokeræ”¶é›†æ¥è‡ªå¤šä¸ªclieintsçš„è¯·æ±‚ï¼Œç„¶åæŠŠå®ƒä»¬è½¬æ¢æˆæ›´é«˜æ•ˆçš„PRODUCEè¯·æ±‚å†å‘ç»™Kafkaã€‚ä½ ä¹Ÿå¯ä»¥å¢åŠ brokeræ•°æ¥é™ä½å•ä¸ªbrokerä¸Šçš„è¯·æ±‚è´Ÿè½½ã€‚&lt;/p&gt;

&lt;h4 id=&#34;å…³äºå¢åŠ æ¶ˆè´¹è€…æ•°é‡çš„è¯´æ˜&#34;&gt;å…³äºå¢åŠ æ¶ˆè´¹è€…æ•°é‡çš„è¯´æ˜&lt;/h4&gt;

&lt;p&gt;å½“æ‰©å±•æ¶ˆè´¹è€…æ—¶éœ€è¦æ³¨æ„ï¼Œåœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…ä¼šæäº¤offsetä¿¡æ¯å’Œå¿ƒè·³åˆ°brokerèŠ‚ç‚¹ä¸Š(controllerèŠ‚ç‚¹)ã€‚å¦‚æœæŒ‰æ—¶é—´é—´éš”æ‰§è¡Œåç§»æäº¤(&lt;code&gt;auto.commit.interval.ms&lt;/code&gt;)ï¼Œåˆ™æ¶ˆè´¹è€…ç»„ä¸­çš„æ›´å¤šæ¶ˆè´¹è€…è€…ä¼šå¢åŠ åç§»æäº¤ç‡ã€‚åç§»é‡æäº¤æœ¬è´¨ä¸Šæ˜¯å‘å†…éƒ¨&lt;code&gt;__consumer_offsets&lt;/code&gt;äº§ç”Ÿè¯·æ±‚ï¼Œå› æ­¤å¢åŠ consumeræ•°é‡ä¼šå¯¼è‡´brokerä¸Šçš„è¯·æ±‚è´Ÿè½½å¢åŠ ï¼Œç‰¹åˆ«æ˜¯&lt;code&gt;auto.commit.interval.ms&lt;/code&gt;å€¼å¾ˆå°çš„æ—¶å€™ã€‚&lt;/p&gt;

&lt;h4 id=&#34;å‹ç¼©é…ç½®çš„å½±å“&#34;&gt;å‹ç¼©é…ç½®çš„å½±å“&lt;/h4&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafka producerä¸åšå‹ç¼©ã€‚&lt;code&gt;compression.type&lt;/code&gt;å‚æ•°å¯ä»¥å†³å®šè¦ä¸è¦åšå‹ç¼©ã€‚&lt;/p&gt;

&lt;p&gt;å‹ç¼©ä¼šåœ¨producerç«¯å¼•å…¥é¢å¤–çš„å¼€é”€æ¥å‹ç¼©æ¶ˆæ¯ï¼Œåœ¨brokerç«¯åšæ ¡éªŒæ—¶è§£å‹ç¼©ä»è€Œå¼•å…¥é¢å¤–çš„å¼€é”€ï¼Œå¦å¤–åœ¨consumerç«¯è§£å‹ç¼©ä¹Ÿæ˜¯å¼€é”€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„&lt;/code&gt;:é€šå¸¸æƒ…å†µä¸‹brokerç«¯çš„å‹ç¼©å‚æ•°éœ€è¦è®¾ç½®æˆ&lt;code&gt;producer&lt;/code&gt;ï¼Œä»¥é¿å…å‹ç¼©æ–¹å¼å†²çªå¯¼è‡´æ•°æ®æ— æ³•æ­£å¸¸æ¶ˆè´¹ï¼Œè¿™æ ·brokeråªéœ€è¦ç›´æ¥å°†å‹ç¼©åçš„æ—¥å¿—å†™å…¥&lt;/p&gt;

&lt;p&gt;è™½ç„¶å‹ç¼©ä¼šå¢åŠ CPUå¼€é”€ï¼Œä½†å®ƒè¿˜æ˜¯å¯èƒ½å‡å°‘ç«¯åˆ°ç«¯å»¶æ—¶çš„ï¼Œå› ä¸ºå®ƒèƒ½æ˜¾è‘—åœ°é™ä½å¤„ç†æ•°æ®æ‰€éœ€çš„å¸¦å®½å ç”¨ï¼Œè¿›è€Œå‡å°‘brokerç«¯çš„è´Ÿè½½ã€‚å‹ç¼©æ˜¯åœ¨batchçº§åˆ«ä¸Šå®Œæˆçš„ï¼Œæ•…æ‰“åŒ…æ•ˆæœè¶Šå¥½ï¼Œå‹ç¼©æ•ˆæœä¹Ÿå°±è¶Šå¥½ã€‚&lt;/p&gt;

&lt;h4 id=&#34;æ›´å¤šçš„åˆ†åŒºå¯èƒ½å¢åŠ å»¶è¿Ÿ&#34;&gt;æ›´å¤šçš„åˆ†åŒºå¯èƒ½å¢åŠ å»¶è¿Ÿ&lt;/h4&gt;

&lt;p&gt;ä¸€ä¸ªä¸»é¢˜çš„åˆ†åŒºæ˜¯kafkaä¸­çš„å¹¶è¡Œå•å…ƒã€‚å‘é€åˆ°ä¸åŒåˆ†åŒºçš„æ¶ˆæ¯å¯ä»¥ç”±ç”Ÿäº§è€…å¹¶è¡Œå‘é€ï¼Œç”±ä¸åŒçš„Brokerå¹¶è¡Œå†™å…¥ï¼Œå¹¶å¯ä»¥ç”±ä¸åŒçš„æ¶ˆè´¹è€…å¹¶è¡Œè¯»å–ã€‚å› æ­¤ï¼Œæ›´å¤šçš„åˆ†åŒºé€šå¸¸ä¼šå¯¼è‡´æ›´é«˜çš„ååé‡ï¼Œä¸è¿‡å•ä»ååé‡çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»æ¯ä¸ªBrokeræœ‰10ä¸ªåˆ†åŒºçš„kafkaé›†ç¾¤ï¼Œå°±å·²ç»èƒ½å¤Ÿè¾¾åˆ°æœ€å¤§çš„ååé‡äº†ã€‚æ‚¨å¯èƒ½éœ€è¦æ›´å¤šçš„ä¸»é¢˜åˆ†åŒºæ¥æ”¯æŒæ‚¨çš„åº”ç”¨ç¨‹åºé€»è¾‘ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ï¼Œå¤ªå¤šçš„åˆ†åŒºå¯èƒ½å¯¼è‡´æ›´å¤šçš„ç«¯åˆ°ç«¯çš„å»¶è¿Ÿã€‚æ¯ä¸ªä¸»é¢˜çš„åˆ†åŒºè¶Šå¤šï¼Œå¯¹ç”Ÿäº§è€…çš„æ‰¹å¤„ç†å°±è¶Šå°‘ã€‚æ¯ä¸ªBrokerçš„ä¸»é¢˜åˆ†åŒºè¶Šå¤šï¼Œæ¯ä¸ªfollowå‰¯æœ¬è·å–è¯·æ±‚çš„å¼€é”€å°±è¶Šå¤§ã€‚æ¯ä¸ªfetchè¯·æ±‚å¿…é¡»å»æšä¸¾è‡ªå·±æ„Ÿå…´è¶£çš„åˆ†åŒºï¼Œå¹¶ä¸”æ¯ä¸ªleaderå‰¯æœ¬å¿…é¡»å»æ£€æŸ¥çŠ¶æ€ï¼ŒåŒæ—¶ä»è¯·æ±‚çš„æ¯ä¸ªåˆ†åŒºä¸­å»fetchæ•°æ®ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´è¾ƒå°çš„ç£ç›˜I/Oã€‚å› æ­¤ï¼Œè¶Šå¤šçš„åˆ†åŒºï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´é•¿çš„commit timeå’Œæ›´é«˜çš„cpuä½¿ç”¨ï¼Œæœ€ç»ˆå¯¼è‡´è¾ƒé•¿çš„æ’é˜Ÿå»¶è¿Ÿã€‚&lt;/p&gt;

&lt;p&gt;æäº¤æ—¶é—´çš„å¢åŠ å’Œæ›´é«˜çš„CPUè´Ÿè½½ä¼šå¯¼è‡´æ‰€æœ‰å…±äº«åŒä¸€ä¸ªKafkaé›†ç¾¤çš„å®¢æˆ·ç«¯ç«¯åˆ°ç«¯å»¶è¿Ÿçš„å¢åŠ ï¼Œå³ä½¿æ˜¯é‚£äº›åªç”Ÿäº§å’Œä½¿ç”¨å°‘é‡ä¸»é¢˜åˆ†åŒºçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªtopicæ¥åšæ­¤æ¬¡æµ‹è¯•ã€‚ä¸€ä¸ªTopicæœ‰9ä¸ªç”Ÿäº§è€…ç”Ÿäº§5MB/sçš„æ•°æ®ï¼Œç„¶åæœ‰ä¸€ä¸ªå¯¹åº”9ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹è€…ç»„ã€‚è¿™ä¸ªå®éªŒæŒç»­äº†å‡ å¤©ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªä¸»é¢˜ä¸­çš„åˆ†åŒºæ•°é‡ä»108ä¸ªé€æ­¥å¢åŠ åˆ°7200ä¸ª(æ¯ä¸ªBroker8000ä¸ª)ï¼Œæ¯ä¸ªæ­¥éª¤è¿è¡Œä¸€ä¸ªå°æ—¶ã€‚ç¬¬äºŒä¸ªä¸»é¢˜åœ¨æ•´ä¸ªå®éªŒè¿è¡ŒæœŸé—´æœ‰9ä¸ªåˆ†åŒºå’Œ9ä¸ªç”Ÿäº§è€…ï¼Œæ¯ä¸ªç”Ÿäº§è€…å‘ä¸€ä¸ªåˆ†åŒºå’Œä¸€ä¸ªå¯¹åº”çš„æ¶ˆè´¹è€…ç»„(æ¯ä¸ªåˆ†åŒºä¸€ä¸ª)ç”Ÿäº§æ¶ˆæ¯ï¼Œè¯¥ä¸»é¢˜æ¯ç§’ç”Ÿäº§ä¸€ä¸ª512bytesçš„æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾æ˜¾ç¤ºäº†åˆ†åŒºæ•°é‡å¯¹å®¢æˆ·ç«¯è®¿é—®9åˆ†åŒºä¸»é¢˜çš„99%çš„ç«¯åˆ°ç«¯å»¶è¿Ÿçš„å½±å“ï¼Œéšç€æ¯ä¸ªbrokerä¸Šåˆ†åŒºæ•°çš„å¢åŠ ï¼Œclientsçš„ç«¯åˆ°ç«¯å»¶æ—¶å¤§è‡´å‘ˆçº¿æ€§å¢åŠ è¶‹åŠ¿ã€‚åˆ†åŒºæ•°çš„å¢åŠ ä¼šæ¨é«˜brokerä¸Šçš„CPUè´Ÿè½½åŒæ—¶æ‹–æ…¢æ‰€æœ‰clientsçš„å¤‡ä»½ï¼Œå³ä½¿æ˜¯å¯¹é‚£äº›åªä¸å›ºå®šåˆ†åŒºæ•°é‡äº¤äº’çš„clientsè€Œè¨€ï¼Œä¹Ÿä¼šæŠ¬é«˜ç«¯åˆ°ç«¯å»¶è¿Ÿã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf2rwiufyuj30rs0eh0ty.jpg&#34; alt=&#34;mutli-partition-latency&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºäº†å‡å°‘å»¶æ—¶ï¼Œæœ€å¥½è¿˜æ˜¯é™åˆ¶æ¯ä¸ªbrokerä¸Šçš„åˆ†åŒºæ•°ï¼Œæ–¹æ³•æ˜¯å‡å°‘æ€»çš„åˆ†åŒºæ•°æˆ–æ‰©å±•é›†ç¾¤ã€‚ä½ è¿˜å¯ä»¥é€šè¿‡å¢åŠ fetcherçº¿ç¨‹æ•°é‡çš„æ–¹å¼æ¥æ”¹å–„commit timeã€‚&lt;/p&gt;

&lt;h4 id=&#34;brokerèŠ‚ç‚¹è´Ÿè½½å¯¹å»¶è¿Ÿçš„å½±å“&#34;&gt;brokerèŠ‚ç‚¹è´Ÿè½½å¯¹å»¶è¿Ÿçš„å½±å“&lt;/h4&gt;

&lt;p&gt;æˆ‘ä»¬å·²ç»è®¨è®ºäº†Brokerä¸Šçš„è´Ÿè½½å¯¼è‡´å¢åŠ æ’é˜Ÿå»¶è¿Ÿï¼Œä»è€Œå¢åŠ äº†ç«¯åˆ°ç«¯çš„å»¶è¿Ÿï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºä¸ºä»€ä¹ˆè¯·æ±‚é€Ÿç‡çš„å¢åŠ ä¼šåŠ å‰§æ’é˜Ÿå»¶è¿Ÿï¼Œå› ä¸ºæ›´å¤šçš„è¯·æ±‚ä¼šå¯¼è‡´æ›´å¤§çš„é˜Ÿåˆ—ã€‚&lt;/p&gt;

&lt;p&gt;brokerèŠ‚ç‚¹ä¸Šé«˜èµ„æºåˆ©ç”¨ç‡(ç£ç›˜æˆ–cpu)å¯èƒ½å¯¼è‡´æ›´é«˜çš„é˜Ÿåˆ—çš„å»¶è¿Ÿï¼Œå¹¶ä¸”å»¶è¿Ÿçš„å¢é•¿ä¼šéšç€èµ„æºåˆ©ç”¨ç‡çš„å¢é•¿å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æœ‰æ’é˜Ÿç†è®ºè§£é‡Šçš„å·²çŸ¥å±æ€§: Kingmanå…¬å¼è¯æ˜ç­‰å¾…æŸç§èµ„æºçš„æ—¶é—´æ­£æ¯”äºèµ„æºç¹å¿™ç¨‹åº¦/èµ„æºç©ºé—²ç¨‹åº¦&lt;code&gt;(% of time resource is busy)/(% of time resource is idle)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gf2r3oe03wj30rs0gb0tp.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±äºå»¶è¿Ÿéšèµ„æºåˆ©ç”¨ç‡å‘ˆæŒ‡æ•°å¢é•¿ï¼Œå¦‚æœbrokerä¸­çš„ä»»ä½•èµ„æºçš„åˆ©ç”¨ç‡æ¥è¿‘100%ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°å¾ˆé«˜çš„å»¶è¿Ÿã€‚é€šè¿‡å‡å°‘æ¯ä¸ªBrokerçš„èµ„æºä½¿ç”¨(æ¯”å¦‚å‡å°‘æ¯ä¸ªbrokerçš„é“¾æ¥æ•°ï¼Œè¯·æ±‚ä»¥åŠåˆ†åŒºæ•°)æˆ–æ‰©å±•é›†ç¾¤æ¥æ•´ä½“é™ä½æ¯ä¸ªbrokerèŠ‚ç‚¹çš„èµ„æºä½¿ç”¨ç‡ï¼Œåœ¨è¿™ç§æƒ…å†µå¯ä»¥æ˜¾è‘—é™ä½å»¶è¿Ÿã€‚ä¿æŒè´Ÿè½½åœ¨brokerä¹‹é—´å¹³å‡é€šå¸¸æƒ…å†µä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥&lt;code&gt;å‡åŒ€åœ°æˆ–åŸºäºè´Ÿè½½åˆ†å¸ƒåˆ†åŒºå‰¯æœ¬&lt;/code&gt;ä¹Ÿèƒ½é™ä½å°¾éƒ¨å»¶è¿Ÿã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè´Ÿè´£kafkaé›†ç¾¤çš„SREå›¢é˜Ÿéœ€è¦è‡ªåŠ¨æ£€æµ‹BrokerèŠ‚ç‚¹ä¸Šçš„é«˜èµ„æºåˆ©ç”¨ç‡(ç£ç›˜å’ŒCPU)ï¼Œç„¶åé‡æ–°å¹³è¡¡é›†ç¾¤ä¸Šçš„åˆ†åŒºï¼Œä»¥ä¾¿æ›´å‡åŒ€åœ°åœ¨Brokerä¹‹é—´é‡æ–°åˆ†é…è´Ÿè½½ï¼Œæˆ–è€…åœ¨éœ€è¦æ—¶æ‰©å±•é›†ç¾¤ã€‚è€Œå¦‚æœä½¿ç”¨äº‘å‚å•†æä¾›çš„kafkaæœåŠ¡ï¼Œåˆ™å¯ä»¥é€‚å½“é¿å…è¿™ç±»äº‹æƒ…çš„å‘ç”Ÿï¼Œå› ä¸ºäº‘æœåŠ¡ä¼šå»åšç›¸å…³çš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;h4 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h4&gt;

&lt;p&gt;æˆ‘ä»¬å·²ç»æ¼”ç¤ºäº†ï¼Œåœ¨ä¸ºååé‡æ‰©å±•å®¢æˆ·æœºå’Œåˆ†åŒºæ—¶çš„è¾¹ç•Œå»¶è¿Ÿè¦æ±‚æ—¶å¯ä»¥é€šè¿‡é™åˆ¶æ¯ä¸ªbrokerçš„è¿æ¥æ•°ã€åˆ†åŒºæ•°å’Œè¯·æ±‚é€Ÿç‡æ¥é™åˆ¶æ¯ä¸ªbrokerçš„ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;è¾¹ç•Œå°¾å»¶è¿Ÿéœ€è¦é¢å¤–æ³¨æ„å‡å°‘æ¥è‡ªå®¢æˆ·æœºçš„ä»»ä½•çªå‘(è¿æ¥å’Œè¯·æ±‚)æˆ–åº”ç”¨ç¨‹åºè¡Œä¸ºä¸­çš„å·®å¼‚ã€‚&lt;/p&gt;

&lt;p&gt;å‡åŒ€åŠ è½½çš„brokerèŠ‚ç‚¹å¯¹äºæœ€å°åŒ–å°¾éƒ¨å»¶è¿Ÿä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå—åˆ°æœ€æ…¢brokerçš„å½±å“ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸‹æ˜¯ä¸€äº›ç›¸å…³æ‰©å±•çš„æ–‡ç« ï¼Œå¯èƒ½æœ‰åŠ©äºæˆ‘ä»¬æ§åˆ¶æ•´ä½“å»¶è¿Ÿ:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.confluent.io/white-paper/optimizing-your-apache-kafka-deployment/&#34;&gt;Optimizing Your Apache Kafka Deployment&lt;/a&gt;æä¾›é…ç½®Kafkaéƒ¨ç½²çš„æŒ‡å¯¼æ–¹é’ˆï¼Œä»¥ä¼˜åŒ–å„ç§ç›®æ ‡:ååé‡ã€å»¶è¿Ÿã€æŒä¹…æ€§å’Œå¯ç”¨æ€§(å…¬ä¼—å·å›å¤:&lt;code&gt;kafka&lt;/code&gt;å¯è·å–èµ„æ–™)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.confluent.io/blog/how-choose-number-topics-partitions-kafka-cluster&#34;&gt;How to Choose the Number of Topics/Partitions in a Kafka Cluster?&lt;/a&gt;(2016) å’Œ&lt;a href=&#34;https://www.confluent.io/blog/apache-kafka-supports-200k-partitions-per-cluster&#34;&gt;follow-updates&lt;/a&gt;æœ‰ä¸€äº›kafka 2.0ç‰ˆæœ¬çš„ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.confluent.io/blog/apache-kafka-producer-improvements-sticky-partitioner&#34;&gt;Improving batching with the new sticky partitioner&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cwiki.apache.org/confluence/display/KAFKA/KIP-345%3A+Introduce+static+membership+protocol+to+reduce+consumer+rebalances&#34;&gt;KIP-345&lt;/a&gt;: å¼•å…¥é™æ€æˆå‘˜åè®®æ¥å‡å°‘æ¶ˆè´¹è€…çš„å†å¹³è¡¡&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>kafkaå¦‚ä½•åˆç†è§„åˆ’åˆ†åŒºæ•°é‡</title>
      <link>https://bgbiao.top/post/kafka%E5%A6%82%E4%BD%95%E5%90%88%E7%90%86%E8%A7%84%E5%88%92%E5%88%86%E5%8C%BA%E6%95%B0%E9%87%8F/</link>
      <pubDate>Sat, 16 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/kafka%E5%A6%82%E4%BD%95%E5%90%88%E7%90%86%E8%A7%84%E5%88%92%E5%88%86%E5%8C%BA%E6%95%B0%E9%87%8F/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;èƒŒæ™¯: å¦‚åŒå…¶ä»–åˆ†å¸ƒå¼ç³»ç»Ÿä¸€æ ·ï¼Œåœ¨kafkaé›†ç¾¤ä¸­ï¼Œå•Topicçš„partitionä¹Ÿå¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œä½†é€šå¸¸å¯¹äºä¸šåŠ¡æ–¹æ¥è¯´ï¼Œå¯èƒ½ä¼šç®€å•çš„æ ¹æ®ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›æ¥æå‡ºæ‰©partitionçš„éœ€æ±‚ï¼Œæ­¤æ—¶å°±éœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯è¿›è¡Œåˆ†æä»¥ç¡®å®špartitionçš„æ•°é‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¯¹äºKafkaé›†ç¾¤æ‰¿è½½çš„ä¸šåŠ¡Topicæ¥è¯´ï¼Œåˆ†åŒºçš„æ•°é‡ï¼Œå¯ä»¥ä½“ç°å‡ºæ•´ä¸ªä¸šåŠ¡çš„é‡çº§åŒæ—¶èƒ½å¤Ÿå°½å¯èƒ½çš„æä¾›æ›´é«˜çš„ååï¼Œä½†å¹¶ä¸æ˜¯è¶Šå¤šçš„åˆ†åŒºå°±æ„å‘³ç€è¶Šé«˜çš„ååå’Œå¤„ç†èƒ½åŠ›ï¼Œé€šå¸¸æƒ…å†µä¸‹éœ€è¦ä¸šåŠ¡æ–¹å’ŒåŸºç¡€æœåŠ¡æ–¹ä¸€èµ·æ¥è¿›è¡Œåˆ†æã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹ä¸ºå¤šåˆ†åŒºTopicçš„ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥é€‚å½“æ ¹æ®éœ€æ±‚å’Œåœºæ™¯è¿›è¡Œè§„åˆ’åˆ†åŒºæ•°é‡ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç›®å½•&#34;&gt;ç›®å½•&lt;/h3&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h3 id=&#34;å¤šåˆ†åŒºå¯ä»¥æé«˜åå-higher-throughput&#34;&gt;å¤šåˆ†åŒºå¯ä»¥æé«˜åå(Higher Throughput)&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£çš„æ˜¯ï¼Œåœ¨kafkaé›†ç¾¤ä¸­ï¼Œtopicåˆ†åŒº&lt;code&gt;partition&lt;/code&gt;æ˜¯ä¸€ä¸ªå¹¶è¡Œå•ä½ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç”Ÿäº§è€…å’Œbrokerç«¯ï¼Œå¯ä»¥å®Œå…¨å¹¶è¡Œå®Œæˆå¯¹ä¸åŒåˆ†åŒºçš„å†™å…¥æ“ä½œã€‚ä¸€äº›æ˜‚è´µçš„æ“ä½œï¼Œæ¯”å¦‚å‹ç¼©(compression)ï¼Œéœ€è¦æ¶ˆè€—æ›´å¤šçš„ç¡¬ä»¶èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ¶ˆè´¹è€…ç«¯ï¼Œkafkaæ€»æ˜¯ä¼šç»™æ¯ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä¸€ä¸ªå•åˆ†åŒºçš„æ•°æ®ï¼Œå› æ­¤å½“åˆ†åŒºçš„æ•°é‡å…¶å®ä¹Ÿå°±é™åˆ¶äº†æ¶ˆè´¹è€…çº¿ç¨‹çš„æœ€å¤§æ•°æ®é‡ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸è¶³ä»¥åœ¨æœ€çŸ­æ—¶é—´æ¶ˆè´¹æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä¼˜åŒ–å®¢æˆ·ç«¯ç¨‹åºæˆ–å¢åŠ partitionæ•°é‡çš„æ–¹å¼(åŒæ—¶å¢åŠ æ¶ˆè´¹è€…çº¿ç¨‹)æ¥ç¼“è§£ï¼Œä½†åè€…éœ€è¦topicçº§åˆ«çš„è°ƒæ•´ï¼ŒåŒæ—¶éœ€è¦ç¡®è®¤ç”Ÿäº§è€…æ˜¯å¦æœ‰åˆ†åŒºç»‘å®šç›¸å…³æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œkafkaé›†ç¾¤çš„æ‹¥æœ‰è¶Šå¤šçš„åˆ†åŒºä¹Ÿæ„å‘³ç€å¯ä»¥è·å–æ›´é«˜çš„ååã€‚&lt;/p&gt;

&lt;p&gt;é€‰æ‹©åˆ†åŒºçš„æ•°é‡ä¸€èˆ¬å¯ç”¨åŸºäºååæ¥è¿›è¡Œç®€å•è®¡ç®—ã€‚&lt;/p&gt;

&lt;p&gt;æ‚¨å¯ä»¥åœ¨å•ä¸ªåˆ†åŒºä¸Šå¯¹ç”Ÿäº§(ç§°ä¸ºp)å’Œæ¶ˆè´¹(ç§°ä¸ºc)æ‰€èƒ½å®ç°çš„æ‰€æœ‰æ€§èƒ½è¿›è¡Œåº¦é‡ã€‚å‡å¦‚æˆ‘ä»¬çš„ç›®æ ‡ååæ˜¯&lt;code&gt;t&lt;/code&gt;ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è®¾ç½®åˆ†åŒºæ•°é‡ä¸º&lt;code&gt;max(t/p, t/c)&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç”Ÿäº§è€…ç«¯ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®&lt;code&gt;batch size&lt;/code&gt;,&lt;code&gt;compression&lt;/code&gt;,&lt;code&gt;ack&lt;/code&gt;,&lt;code&gt;replication factor&lt;/code&gt;ç­‰å‚æ•°æ¥è®¡ç®—å•ä¸ªåˆ†åŒºçš„ååã€‚
ä¸è¿‡å¦‚&lt;a href=&#34;https://engineering.linkedin.com/kafka/benchmarking-apache-kafka-2-million-writes-second-three-cheap-machines&#34;&gt;LinkedIn-Benchmarking&lt;/a&gt;ä¸­æ˜¾ç¤ºï¼Œé€šå¸¸å•ä¸ªåˆ†åŒºå¯ä»¥æ‰¿è½½æ¯ç§’10 Millionè°ƒæ•°æ®çš„å†™å…¥ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ¶ˆè´¹è€…ç«¯ååé‡é€šå¸¸ä¾èµ–äºåº”ç”¨ç¨‹åºï¼Œå› ä¸ºå®ƒå¯¹åº”äºä½¿ç”¨è€…é€»è¾‘å¤„ç†æ¯ä¸ªæ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå› æ­¤å¾—å®é™…è¿›è¡Œæµ‹é‡ã€‚&lt;/p&gt;

&lt;p&gt;å°½ç®¡åœ¨topicåˆ›å»ºåæœŸï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œæ‰©å®¹åˆ†åŒºï¼Œä½†æ˜¯å¯¹äºæœ‰&lt;code&gt;keys&lt;/code&gt;çš„æ¶ˆæ¯éœ€è¦æ³¨æ„ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºå½“ç”Ÿäº§è€…å†™å…¥ä¸€ä¸ªå¸¦&lt;code&gt;key&lt;/code&gt;çš„æ¶ˆæ¯åï¼Œkafkaå°†ä¾æ®è¯¥&lt;code&gt;key&lt;/code&gt;çš„hashæ¥å†³å®šæ•°æ®æ˜ å°„åˆ°å…·ä½“çš„åˆ†åŒºï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å…·æœ‰ç›¸åŒ&lt;code&gt;key&lt;/code&gt;çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼Œä»è€Œä¿è¯äº†ä¸€ç±»æ¶ˆæ¯çš„æœ‰åºæ€§ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ­¤æ—¶åˆ†åŒºæ•°é‡çªç„¶å¢åŠ ï¼Œå°†å¯èƒ½å¯¼è‡´æ•°æ®çš„æ— åºæ€§ï¼Œä¸ºäº†é¿å…æœªæ¥è¿™ç§é—®é¢˜çš„å‡ºç°ï¼Œä¸€èˆ¬è€Œè¨€ä¼šåœ¨ä¸šåŠ¡æ¥å…¥åˆæœŸè¿›è¡Œåˆ†åŒºçš„è¿‡åº¦åˆ†é…&lt;code&gt;over-partition&lt;/code&gt;ï¼Œå³åœ¨topicåˆ›å»ºæ—¶å°½é‡å¤šåˆ›å»ºä¸€äº›ï¼Œä½†åŸºæœ¬ä¸Šåœ¨æ¥å…¥ä¹‹å‰éœ€è¦é¢„ä¼°æœªæ¥çš„ååé‡ä»¥ç¡®å®šä¸€ä¸ªåˆç†çš„åˆ†åŒºæ•°é‡ï¼Œè¿™æ ·å³ä½¿å½“å‰é›†ç¾¤è§„æ¨¡è¾ƒå°ï¼Œå¯ä»¥å¯¹topicè¿›è¡Œæå‰è§„åˆ’ï¼Œå¾…åæœŸé›†ç¾¤è§„æ¨¡å¤§ä¹‹åè¿›è¡Œè¿ç§»å³å¯ï¼Œå¦åˆ™åˆšå¼€å§‹å› ä¸ºé›†ç¾¤è§„æ¨¡å°ï¼Œè€Œå¯¹åˆ†åŒºæ•°é‡æ²¡æœ‰åˆç†è§„åˆ’ï¼ŒåæœŸä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”è¿™æ ·å½“ç”Ÿäº§è€…ä½¿ç”¨å¸¦&lt;code&gt;key&lt;/code&gt;çš„æ¶ˆæ¯æ—¶ï¼Œæ‚¨å¯ä»¥è·Ÿä¸Šååé‡çš„å¢é•¿ï¼Œè€Œä¸ä¼šç ´ååº”ç”¨ç¨‹åºä¸­çš„è¯­ä¹‰ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†ååé‡ä¹‹å¤–ï¼Œåœ¨è§„åˆ’åˆ†åŒºæ•°æ—¶è¿˜éœ€è¦è€ƒè™‘ä¸€äº›å…¶ä»–çš„å› ç´ ï¼Œå› ä¸ºåœ¨ååå¢åŠ çš„åŒæ—¶å¯èƒ½ä¼šå¢åŠ ä¸€äº›å…¶ä»–å½±å“ã€‚&lt;/p&gt;

&lt;h3 id=&#34;éœ€è¦æ›´å¤šçš„open-file-handles&#34;&gt;éœ€è¦æ›´å¤šçš„Open File Handles&lt;/h3&gt;

&lt;p&gt;æ¯ä¸ªåˆ†åŒºä¼šæ˜ å°„åˆ°brokeræœºå™¨çš„å…¶ä¸­ä¸€ä¸ªç›®å½•ï¼Œåœ¨æ¯ä¸ªæ—¥å¿—ç›®å½•æ¯ä¸ªæ—¥å¿—æ®µ(segment)åŒ…å«å››ä¸ªæ–‡ä»¶:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;00000000000029487197.index: ç´¢å¼•æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;00000000000029487197.log: çœŸæ­£çš„æ—¥å¿—æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;00000000000029487197.snapshot: å¿«ç…§&lt;/li&gt;
&lt;li&gt;00000000000029487197.timeindex: æ—¶é—´ç´¢å¼•&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨kafkaä¸­ï¼Œbrokerä¼šä¸ºæ¯ä¸ªsegmentæ‰“å¼€ä¸€ä¸ªfile handle ï¼Œä¸è¿‡è¿™ä»…æ˜¯ä¸€ä¸ªé…ç½®é—®é¢˜ï¼Œé€šå¸¸åœ¨ç”Ÿäº§é›†ç¾¤å¯ä»¥é…ç½®OSå±‚é¢çš„æ‰“å¼€æ–‡ä»¶æ•°ä¸º&lt;code&gt;30 thousand&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;å¤šåˆ†åŒºå¯èƒ½å¢åŠ æ•´ä½“ä¸å¯ç”¨æ€§&#34;&gt;å¤šåˆ†åŒºå¯èƒ½å¢åŠ æ•´ä½“ä¸å¯ç”¨æ€§&lt;/h3&gt;

&lt;p&gt;æ•´ä½“å¯ç”¨æ€§çš„é™ä½æ˜¯å› ä¸ºåœ¨å¼‚å¸¸æ—¶æœ‰æ›´å¤šçš„åˆ†åŒºéœ€è¦è¿›è¡Œæ¢å¤æ•°æ®ï¼Œæ­¤æ—¶å¤šåˆ†åŒºä¹‹é—´çš„æ•°æ®åŒæ­¥å¯èƒ½åœ¨ç½‘ç»œä¸Šéœ€è¦æ¶ˆè€—ã€‚&lt;/p&gt;

&lt;p&gt;kafkaé›†ç¾¤å†…éƒ¨çš„å‰¯æœ¬æœºåˆ¶ï¼Œå¯ä»¥æä¾›æ¯”è¾ƒé«˜çš„å¯ç”¨æ€§å’ŒæŒä¹…æ€§ã€‚ä¸€ä¸ªåˆ†åŒºå¦‚æœæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬å°†ä¼šå­˜å‚¨åˆ°ä¸åŒçš„brokerä¸Šï¼Œå‰¯æœ¬è¢«è®¾è®¡ä¸ºleaderå’Œfollowå‰¯æœ¬ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å†…éƒ¨ï¼ŒKafkaè‡ªåŠ¨ç®¡ç†æ‰€æœ‰è¿™äº›å‰¯æœ¬ï¼Œå¹¶ç¡®ä¿å®ƒä»¬ä¿æŒåŒæ­¥ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯¹åˆ†åŒºçš„è¯·æ±‚éƒ½å°†ç”±leaderå‰¯æœ¬æ¥å“åº”ï¼Œå½“brokerå®•æœºåï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„leaderå‰¯æœ¬å°†æš‚æ—¶ä¸å¯ç”¨ï¼Œkafkaå†…éƒ¨çš„controllerè§’è‰²å°†è‡ªåŠ¨å°†åˆ†åŒºçš„leaderå‰¯æœ¬åˆ‡æ¢åˆ°å…¶ä»–æ»¡è¶³æ¡ä»¶çš„å‰¯æœ¬ä¸Šï¼Œä»¥å°½å¿«æä¾›è¯»å†™è¯·æ±‚(æ˜¯å¦èƒ½å°½å¿«åˆ‡æ¢åˆ°å…¶ä»–å‰¯æœ¬ä¸Šå–å†³äºæ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§è¦æ±‚)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;leaderå‰¯æœ¬çš„åˆ‡æ¢åŠ¨ä½œä¼šæ¶‰åŠåˆ°controllerä»zookeeperä¸­å»è·å–å¯¹åº”åˆ†åŒºçš„ç›¸å…³å‰¯æœ¬å…ƒæ•°æ®ï¼Œåœ¨controllerå†…éƒ¨ï¼Œæ“ä½œzookeeperæ˜¯ä¸²è¡Œçš„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªBrokerè¢«ä¼˜é›…åœ°å…³é—­æ—¶ï¼Œæ§åˆ¶å™¨ä¼šä¸»åŠ¨åœ°å°†leaderä»å…³é—­çš„ä»£ç†ä¸­ç§»å¼€ï¼Œæ¯æ¬¡åªå…³é—­ä¸€ä¸ªï¼Œä¸€ä¸ªleaderçš„åˆ‡æ¢é€šå¸¸ä»…ä¼šéœ€è¦æ¶ˆè€—å‡ æ¯«ç§’ï¼Œå› æ­¤ï¼Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå½“ä½¿ç”¨ä¼˜é›…é‡å¯æ—¶ï¼Œä»…æœ‰ä¸€ä¸ªå¾ˆå°çš„ä¸å¯ç”¨çª—å£ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œå½“brokerè¢«å¼‚å¸¸å…³é—­æ—¶(&lt;code&gt;kill -9&lt;/code&gt;)ï¼Œè§‚æµ‹åˆ°çš„ä¸å¯ç”¨æ€§å¯èƒ½ä¸åˆ†åŒºçš„æ•°é‡æˆæ­£æ¯”ã€‚å‡è®¾æ¯ä¸ªbrokerå…±2000ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå…±2ä¸ªå‰¯æœ¬ï¼ŒåŸºæœ¬æ¯ä¸ªbrokerå°†è´Ÿè´£1000ä¸ªåˆ†åŒºï¼Œå½“è¯¥brokerå¼‚å¸¸å…³é—­æ—¶ï¼Œæ‰€æœ‰1000ä¸ªåˆ†åŒºå°†åœ¨åŒä¸€æ—¶é—´ä¸å¯ç”¨ã€‚å‡è®¾ä¸ºå•ä¸ªåˆ†åŒºé€‰ä¸»çš„æ—¶é—´éœ€è¦æ¶ˆè€—5msï¼Œé€‰ä¸¾1000ä¸ªåˆ†åŒºå°†æ¶ˆè€—5sã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œå¯¹äºæŸäº›åˆ†åŒºï¼Œå…¶è§‚å¯Ÿåˆ°çš„ä¸å¯ç”¨æ€§å¯èƒ½æ˜¯5ç§’åŠ ä¸Šæ£€æµ‹æ•…éšœæ‰€éœ€çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸è¡Œçš„æ˜¯ï¼Œå¼‚å¸¸å…³é—­çš„brokerèŠ‚ç‚¹åˆšå¥½æ˜¯controllerè§’è‰²ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†åŒºé€‰leaderçš„æ“ä½œå°†ä¸ä¼šç«‹å³è¿›è¡Œï¼ŒçŸ¥é“controlleræœ¬èº«è½¬ç§»åˆ°æ­£å¸¸çš„brokerèŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;controlleræ§åˆ¶å™¨è‡ªåŠ¨å‘ç”Ÿæ•…éšœè½¬ç§»ï¼Œä½†éœ€è¦æ–°æ§åˆ¶å™¨åœ¨åˆå§‹åŒ–æœŸé—´ä»ZooKeeperè¯»å–æ¯ä¸ªåˆ†åŒºçš„ä¸€äº›å…ƒæ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœKafkaé›†ç¾¤ä¸­æœ‰10,000ä¸ªåˆ†åŒºï¼Œå¹¶ä¸”æ¯ä¸ªåˆ†åŒºåˆå§‹åŒ–æ¥è‡ªZooKeeperçš„å…ƒæ•°æ®éœ€è¦2 msæ—¶é—´ï¼Œè¿™å¯èƒ½ä¼šç»™ä¸å¯ç”¨çª—å£å¢åŠ 20ç§’ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œå¼‚å¸¸çš„å…³é—­æ˜¯ç½•è§çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœå…³å¿ƒåœ¨è¿™äº›ç½•è§æƒ…å†µä¸‹çš„å¯ç”¨æ€§ï¼Œé‚£ä¹ˆæœ€å¥½å°†æ¯ä¸ªBrokerçš„åˆ†åŒºæ•°é‡é™åˆ¶åœ¨&lt;code&gt;2åˆ°4000&lt;/code&gt;ä¸ªï¼Œé›†ç¾¤ä¸­çš„åˆ†åŒºæ€»æ•°é™åˆ¶åœ¨æ•°ä¸‡ä¸ªä»¥å†…ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å¯èƒ½å¢åŠ ç«¯åˆ°ç«¯çš„å»¶è¿Ÿ-end-to-end-latency&#34;&gt;å¯èƒ½å¢åŠ ç«¯åˆ°ç«¯çš„å»¶è¿Ÿ(End-to-end Latency)&lt;/h3&gt;

&lt;p&gt;Kafkaä¸­çš„ç«¯åˆ°ç«¯å»¶è¿Ÿæ˜¯ç”±&lt;code&gt;ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ°æ¶ˆè´¹è€…è¯»å–æ¶ˆæ¯&lt;/code&gt;çš„æ—¶é—´å®šä¹‰çš„ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaåªåœ¨&lt;code&gt;æäº¤æ¶ˆæ¯ä¹‹å&lt;/code&gt;æ‰å‘ä½¿ç”¨è€…å…¬å¼€æ¶ˆæ¯(commited log)ï¼Œå³å½“æ¶ˆæ¯è¢«å¤åˆ¶åˆ°æ‰€æœ‰åŒæ­¥å‰¯æœ¬æ—¶ã€‚å› æ­¤ï¼Œæäº¤æ¶ˆæ¯çš„æ—¶é—´å¯èƒ½æ˜¯ç«¯åˆ°ç«¯å»¶è¿Ÿçš„é‡è¦éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafkaçš„brokerèŠ‚ç‚¹ä»…ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤åˆ¶æ¥è‡ªå¦ä¸€ä¸ªBrokerçš„æ•°æ®ï¼Œç”¨äºåœ¨ä¸¤ä¸ªBrokerä¹‹é—´å…±äº«å‰¯æœ¬çš„æ‰€æœ‰åˆ†åŒºã€‚(å¯ä»¥è®¾ç½®é€‚å½“å¤§å‚æ•°æ¥è°ƒæ•´åŒæ­¥çº¿ç¨‹æ•°)&lt;/p&gt;

&lt;p&gt;å®éªŒè¡¨æ˜ï¼Œå°†1000ä¸ªåˆ†åŒºä»ä¸€ä¸ªBrokerå¤åˆ¶åˆ°å¦ä¸€ä¸ªBrokerå¯ä»¥å¢åŠ å¤§çº¦20 mså»¶è¿Ÿï¼Œè¿™æ„å‘³ç€ç«¯åˆ°ç«¯å»¶è¿Ÿè‡³å°‘æ˜¯20 msï¼Œè¿™å¯¹äºæŸäº›å®æ—¶è®¡ç®—ç±»çš„åº”ç”¨æ¥è¯´ï¼Œæ•´ä½“çš„å»¶è¿Ÿå…¶å®æœ‰ç‚¹é«˜ï¼Œå½“ç„¶å¦‚æœæ•´ä¸ªé›†ç¾¤æ¯”è¾ƒå¤§æ—¶ï¼Œåˆ†åŒºåˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Šï¼Œè¯¥é—®é¢˜å¯ä»¥é€‚å½“ç¼“è§£(å…¶ä½™çš„brokerå¯ä»¥ä»è¿™ä¸€ä¸ªbrokerä¸Šå¹³å‡fetchæ¶ˆæ¯)&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œç”±äºæäº¤æ¶ˆæ¯è€Œå¢åŠ çš„å»¶è¿Ÿå°†åªæœ‰å‡ msï¼Œè€Œä¸æ˜¯å‡ åmsã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœå…³ç³»å»¶è¿ŸæŒ‡æ ‡ï¼Œå¯ä»¥å‚ç…§å¦‚ä¸‹æ–¹å¼æ¥è®¡ç®—åˆ†åŒº:&lt;/p&gt;

&lt;p&gt;å°†æ¯ä¸ªBrokerçš„åˆ†åŒºæ•°é‡é™åˆ¶åœ¨&lt;code&gt;100 * b * r&lt;/code&gt;å¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå…¶ä¸­bæ˜¯Kafkaé›†ç¾¤ä¸­çš„Brokeræ•°é‡ï¼Œræ˜¯å¤åˆ¶å› å­ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ›´å¤šçš„åˆ†åŒºå¯èƒ½åœ¨å®¢æˆ·ç«¯éœ€è¦æ›´å¤šçš„å†…å­˜&#34;&gt;æ›´å¤šçš„åˆ†åŒºå¯èƒ½åœ¨å®¢æˆ·ç«¯éœ€è¦æ›´å¤šçš„å†…å­˜&lt;/h3&gt;

&lt;p&gt;åœ¨å®¢æˆ·ç«¯åœ¨å†…éƒ¨ï¼Œç”Ÿäº§è€…ç¼“å†²æ¯ä¸ªåˆ†åŒºçš„æ¶ˆæ¯ã€‚åœ¨ç§¯ç´¯äº†è¶³å¤Ÿçš„æ•°æ®æˆ–ç»è¿‡äº†è¶³å¤Ÿçš„æ—¶é—´ä¹‹åï¼Œå°†ä»ç¼“å†²åŒºä¸­åˆ é™¤ç´¯ç§¯çš„æ¶ˆæ¯å¹¶å°†å…¶å‘é€ç»™Brokerã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœå¢åŠ åˆ†åŒºçš„æ•°é‡ï¼Œæ¶ˆæ¯å°†åœ¨å®¢æˆ·ç«¯åŒºåŸŸä¸­çš„æ›´å¤šåˆ†åŒºä¸­ç´¯ç§¯ã€‚æ‰€ä½¿ç”¨çš„å†…å­˜æ€»é‡ç°åœ¨å¯èƒ½è¶…è¿‡äº†é…ç½®çš„å†…å­˜é™åˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œç”Ÿäº§è€…å¿…é¡»é˜»æ­¢æˆ–åˆ é™¤ä»»ä½•æ–°æ¶ˆæ¯ï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸ç†æƒ³ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œéœ€è¦é‡æ–°é…ç½®ç”Ÿæˆå™¨ï¼Œä½¿å…¶å…·æœ‰æ›´å¤§çš„å†…å­˜å¤§å°ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ®ç»éªŒï¼Œè¦è·å¾—è‰¯å¥½çš„ååé‡ï¼Œåº”è¯¥ä¸ºç”Ÿäº§è€…ä¸­ç”Ÿæˆçš„æ¯ä¸ªåˆ†åŒºåˆ†é…è‡³å°‘å‡ åKBçš„å†…å­˜ï¼Œå¦‚æœåˆ†åŒºæ•°é‡æ˜¾è‘—å¢åŠ ï¼Œè¿˜åº”è¯¥è°ƒæ•´å†…å­˜æ€»é‡ã€‚&lt;/p&gt;

&lt;p&gt;æ¶ˆè´¹è€…ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚æ¶ˆè´¹è€…ä¸ºæ¯ä¸ªåˆ†åŒºè·å–ä¸€æ‰¹æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…ä½¿ç”¨çš„åˆ†åŒºè¶Šå¤šï¼Œæ‰€éœ€çš„å†…å­˜å°±è¶Šå¤šã€‚ç„¶è€Œï¼Œè¿™é€šå¸¸åªæ˜¯ä¸€ä¸ªé’ˆå¯¹éå®æ—¶ç”¨æˆ·çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;

&lt;p&gt;é€šå¸¸ï¼ŒKafkaé›†ç¾¤ä¸­çš„åˆ†åŒºè¶Šå¤šï¼Œååé‡å°±è¶Šé«˜ã€‚ä½†æ˜¯ï¼Œå¿…é¡»æ„è¯†åˆ°æ€»åˆ†åŒºæˆ–æ¯ä¸ªBrokeræ‹¥æœ‰å¤ªå¤šåˆ†åŒºå¯¹å¯ç”¨æ€§å’Œå»¶è¿Ÿç­‰æ–¹é¢çš„æ½œåœ¨å½±å“ï¼Œé€šå¸¸è¿™éƒ¨åˆ†éœ€è¦ä¸šåŠ¡æ–¹å’ŒåŸºç¡€æœåŠ¡æ–¹è¿›è¡Œåˆç†è§„åˆ’å’Œè°ƒæ•´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç›¸å…³æ–‡æ¡£&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.confluent.io/blog/apache-kafka-supports-200k-partitions-per-cluster/&#34;&gt;kafka-supports-200k-partitions-per-cluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.confluent.io/blog/how-choose-number-topics-partitions-kafka-cluster/&#34;&gt;kafka-topic-partition-numbers&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>kafkaå¸¸ç”¨è¿ç»´æ“ä½œ</title>
      <link>https://bgbiao.top/post/kafka%E5%B8%B8%E7%94%A8%E8%BF%90%E7%BB%B4%E6%93%8D%E4%BD%9C/</link>
      <pubDate>Mon, 04 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/kafka%E5%B8%B8%E7%94%A8%E8%BF%90%E7%BB%B4%E6%93%8D%E4%BD%9C/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;å‰è¨€: åœ¨kafkaçš„é›†ç¾¤è¿ç»´æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›å·¥å…·æ¥å®ç°é›†ç¾¤çš„é«˜å¯ç”¨ä»¥åŠè´Ÿè½½çš„å¹³å‡æ“ä½œï¼Œè€Œå¯¹äºkafkaé›†ç¾¤çš„SREæ¥è¯´ï¼Œéœ€è¦æŒæ¡å¥½å¦‚ä¸‹å‡ ç‚¹ï¼Œæ‰èƒ½æ›´å¥½çš„ç»´æŠ¤å’Œä¿è¯kafkaé›†ç¾¤æœåŠ¡çš„ç¨³å®šæ€§ï¼Œå¯é æ€§å’Œæ•´ä½“æ€§èƒ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code&gt;è¦æƒ³kafkaè·‘çš„å¥½ï¼Œå¦‚ä¸‹å‡ ç‚¹è¦çŸ¥æ™“ã€‚&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Graceful shutdown&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å»ºè®®å¼€å¯å¦‚ä¸‹å‚æ•°:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;controlled.shutdown.enable=true&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åªæœ‰åœ¨brokerä¸Šæ‰¿è½½çš„åˆ†åŒºéƒ½å…·æœ‰å‰¯æœ¬æ—¶(å‰¯æœ¬å¤§äº1ï¼Œä¸”å‰¯æœ¬å­˜æ´»)ï¼ŒcontrollerèŠ‚ç‚¹æ‰ä¼šæˆåŠŸå…³é—­&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Balancing leadership&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ¯å½“Brokeråœæ­¢æˆ–å´©æºƒæ—¶ï¼Œè¯¥brokerçš„åˆ†åŒºçš„é¢†å¯¼æƒå°±è½¬ç§»åˆ°å…¶ä»–å‰¯æœ¬ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ„å‘³ç€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“brokeré‡æ–°å¯åŠ¨æ—¶ï¼Œå®ƒå°†åªæ˜¯æ‰€æœ‰åˆ†åŒºçš„å…³æ³¨è€…ï¼Œè¿™æ„å‘³ç€å®ƒä¸ä¼šç”¨äºå®¢æˆ·ç«¯è¯»å†™ï¼Œè¿™å¯¹äºæ•´ä¸ªé›†ç¾¤æ¥è¯´ååä¼šå—åˆ°1/Nçš„é™ä½(Nè¡¨ç¤ºé›†ç¾¤èŠ‚ç‚¹æ•°)&lt;/p&gt;

&lt;p&gt;ä¸ºäº†é¿å…è¿™ç§ä¸å¹³è¡¡ï¼Œkafkaæä¾›äº†ä¸€ç§ä¼˜å…ˆå‰¯æœ¬çš„æ¦‚å¿µ&lt;code&gt;preferred replicas&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ªåˆ†åŒºçš„å‰¯æœ¬åˆ—è¡¨æ˜¯1ã€5ã€9ï¼Œé‚£ä¹ˆèŠ‚ç‚¹1æ¯”èŠ‚ç‚¹5æˆ–èŠ‚ç‚¹9æ›´é€‚åˆä½œä¸ºleaderï¼Œå› ä¸ºå®ƒä½äºå‰¯æœ¬åˆ—è¡¨çš„å‰é¢ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥æ¢å¤å·²æ¢å¤å‰¯æœ¬çš„é¢†å¯¼æƒ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# è€ç‰ˆæœ¬å·¥å…·
bin/kafka-preferred-replica-election.sh --zookeeper zk_host:port/chroot

# æ–°ç‰ˆæœ¬å·¥å…·&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å½“ç„¶æ¯æ¬¡åœ¨æœåŠ¡å™¨å¯åŠ¨åæ‰§è¡Œè¯¥æ“ä½œï¼Œå¯èƒ½å¾ˆæ— èŠï¼Œå› æ­¤å¯ä»¥è®¾ç½®å¦‚ä¸‹å‚æ•°æ¥è‡ªåŠ¨æ‰§è¡Œ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;auto.leader.rebalance.enable=true&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Balancing Replicas Across Racks&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœºæ¶å±‚é¢çš„å‰¯æœ¬å‡è¡¡ã€‚&lt;/p&gt;

&lt;p&gt;æœºæ¶æ„ŸçŸ¥ç‰¹æ€§å°†ç›¸åŒåˆ†åŒºçš„å‰¯æœ¬åˆ†æ•£åˆ°ä¸åŒçš„æœºæ¶ä¸Šï¼Œè¿™æ‰©å±•äº†Kafkaä¸ºbrokerå¤±è´¥æä¾›çš„è¦†ç›–æœºæ¶å¤±è´¥çš„ä¿è¯ï¼Œå¦‚æœæœºæ¶ä¸Šçš„æ‰€æœ‰brokeråŒæ—¶å¤±è´¥ï¼Œå°±é™åˆ¶äº†æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚&lt;/p&gt;

&lt;p&gt;è¯¥ç‰¹æ€§è¿˜å¯ä»¥åº”ç”¨äºå…¶ä»–brokeråˆ†ç»„ï¼Œå¦‚EC2ä¸­çš„å¯ç”¨æ€§åŒºåŸŸã€‚&lt;/p&gt;

&lt;p&gt;æ‚¨å¯ä»¥é€šè¿‡å‘brokeré…ç½®æ·»åŠ å±æ€§æ¥æŒ‡å®šbrokerå±äºç‰¹å®šçš„æœºæ¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;broker.rack=my-rack-id&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å½“åˆ›å»ºã€ä¿®æ”¹æˆ–é‡æ–°åˆ†å‘ä¸€ä¸ªä¸»é¢˜æ—¶ï¼Œå°†éµå¾ªæœºæ¶çº¦æŸï¼Œç¡®ä¿å‰¯æœ¬å°½å¯èƒ½å¤šåœ°è·¨è¶Šå¤šä¸ªæœºæ¶(ä¸€ä¸ªåˆ†åŒºå°†è·¨è¶Šæœ€å°(#æœºæ¶ï¼Œå¤åˆ¶å› å­)ä¸åŒçš„æœºæ¶)ã€‚&lt;/p&gt;

&lt;p&gt;ç”¨äºå°†å‰¯æœ¬å‰¯æœ¬åˆ†é…ç»™brokerçš„ç®—æ³•ï¼Œä¼šç¡®ä¿æ¯ä¸ªbrokerçš„leaderæ•°é‡æ˜¯æ’å®šçš„ï¼Œè€Œä¸ç®¡brokeræ˜¯å¦‚ä½•åˆ†å¸ƒåœ¨æœºæ¶ä¸Šçš„ã€‚è¿™ç¡®ä¿äº†å¹³è¡¡çš„ååé‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; æ˜æ™ºçš„åšæ³•æ˜¯ä¸ºæ¯ä¸ªæœºæ¶é…ç½®ç›¸åŒæ•°é‡çš„broker&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Mirroring data between clusters&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å°†åœ¨Kafkaé›†ç¾¤ä¹‹é—´å¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ç§°ä¸ºâ€œé•œåƒâ€ï¼Œä»¥é¿å…ä¸å•ä¸ªé›†ç¾¤ä¸­èŠ‚ç‚¹ä¹‹é—´çš„å¤åˆ¶æ··æ·†ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaé™„å¸¦ä¸€ä¸ªç”¨äºåœ¨Kafkaé›†ç¾¤ä¹‹é—´é•œåƒæ•°æ®çš„å·¥å…·ï¼Œå³&lt;code&gt;MirrorMaker&lt;/code&gt;ï¼Œè¯¥å·¥å…·å¯ä»¥ä»æºé›†ç¾¤è¿›è¡Œæ¶ˆè´¹ï¼Œå¹¶ç”Ÿäº§åˆ°ç›®æ ‡é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;å¸¸ç”¨çš„åœºæ™¯å°±æ˜¯åœ¨å¦å¤–ä¸€ä¸ªæ•°æ®ä¸­å¿ƒæä¾›å‰¯æœ¬ã€‚&lt;/p&gt;

&lt;p&gt;æ‚¨å¯ä»¥è¿è¡Œè®¸å¤šè¿™æ ·çš„é•œåƒè¿›ç¨‹æ¥æé«˜ååé‡å’Œå®¹é”™èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨mirrormakerè¿›è¡Œè¿ç§»topicåˆ°å¦å¤–çš„é›†ç¾¤:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;bin/kafka-mirror-maker.sh
      --consumer.config consumer.properties
      --producer.config producer.properties --whitelist my-topic&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨&lt;code&gt;--whitelist&lt;/code&gt;å‚æ•°æŒ‡å®štopicï¼Œè¯¥å‚æ•°æ”¯æŒjavaçš„æ­£åˆ™è¡¨è¾¾å¼ç»“æ„ï¼Œæ¯”å¦‚&lt;code&gt;--whitelist &#39;A|B&#39;&lt;/code&gt;ï¼Œæˆ–è€…&lt;code&gt;--whitelist &#39;*&#39;&lt;/code&gt; .&lt;/p&gt;

&lt;p&gt;é€šå¸¸åœ¨ä½¿ç”¨kafka-mirror-makeræ—¶ï¼Œå»ºè®®é…åˆ&lt;code&gt;auto.create.topics.enable=true&lt;/code&gt;ä½¿ç”¨ï¼Œå¯ä»¥å¤§æ‰¹é‡çš„è¿›è¡Œtopicè¿ç§»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Checking consumer position&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ£€æŸ¥æ¶ˆè´¹è€…çš„ä½ç§»ï¼Œæœ‰æ—¶å€™äº†è§£æ¶ˆè´¹è€…å½“å‰çš„ä½ç½®æ—¶å¾ˆæœ‰å¿…è¦çš„ã€‚&lt;/p&gt;

&lt;p&gt;kafkaæœ‰ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå°†æ˜¾ç¤ºæ‰€æœ‰æ¶ˆè´¹è€…åœ¨ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä½ç½®ï¼Œä»¥åŠä»–ä»¬ä¸æ—¥å¿—ç»“æŸçš„è·ç¦»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# åœ¨my-groupçš„æ¶ˆè´¹è€…ä¸Šæ¶ˆè´¹my-topicçš„ä¸»é¢˜
# å¯ä»¥æŸ¥çœ‹æ•´ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹æƒ…å†µ
$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group my-group&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Managing Consumer Groups&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ConsumerGroupCommandå·¥å…·å¯ä»¥&lt;code&gt;list, describe, or delete&lt;/code&gt;ä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œæ¶ˆè´¹è€…ç»„å¯ä»¥æ‰‹åŠ¨åˆ é™¤ï¼Œä¹Ÿå¯ä»¥åœ¨è¯¥ç»„æœ€åæäº¤çš„åç§»é‡è¿‡æœŸæ—¶è‡ªåŠ¨åˆ é™¤ã€‚&lt;/p&gt;

&lt;p&gt;åªæœ‰åœ¨ç»„ä¸­æ²¡æœ‰ä»»ä½•æ´»åŠ¨æˆå‘˜æ—¶ï¼Œæ‰‹åŠ¨åˆ é™¤æ‰æœ‰æ•ˆã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸‹å‘½ä»¤å¯ä»¥åˆ—å‡ºæ‰€æœ‰ä¸»é¢˜çš„æ‰€æœ‰æ¶ˆè´¹è€…ç»„:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æŸ¥çœ‹æŒ‡å®šæ¶ˆè´¹è€…ç»„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group my-group&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å½“ç„¶å¯ç”¨è¯•ç”¨ä¸€äº›é¢å¤–çš„å‚æ•°æ¥æŸ¥çœ‹æ›´å¤šçš„æ¶ˆè´¹è€…ä¿¡æ¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;ndash;members: æŸ¥çœ‹æ¶ˆè´¹è€…ç»„ä¸­æ´»è·ƒçš„æ¶ˆè´¹è€…&lt;/li&gt;
&lt;li&gt;&amp;ndash;members &amp;ndash;verbose: è¯¥å‚æ•°è¿˜å¯ä»¥æŸ¥çœ‹åˆ†é…ç»™æ¯ä¸ªæˆå‘˜çš„åˆ†åŒº&lt;/li&gt;
&lt;li&gt;&amp;ndash;offsets: è¯¥å‚æ•°å®é™…ä¸Šå¯ä»¥è¢«&lt;code&gt;--describe&lt;/code&gt;å‚æ•°ä¸­çš„å†…å®¹è¦†ç›–æ‰&lt;/li&gt;
&lt;li&gt;&amp;ndash;state: è¯¥å‚æ•°å¯ä»¥æä¾›ç»„çº§åˆ«çš„ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&amp;ndash;delete: è¯¥å‚æ•°å¯ä»¥æ‰‹åŠ¨åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…ç»„&lt;/li&gt;

&lt;li&gt;&lt;p&gt;-reset-offsets: è¯¥å‚æ•°ç”¨äºé‡ç½®æ¶ˆè´¹è€…ç»„çš„åç§»é‡ï¼Œæ­¤é€‰é¡¹åœ¨åŒä¸€æ—¶é—´æ”¯æŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼ŒåŒæ—¶éœ€è¦ä½¿ç”¨&lt;code&gt;--all-topicsæˆ–--topic&lt;/code&gt;æŒ‡å®šèŒƒå›´&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æŸ¥çœ‹æ¶ˆè´¹è€…ç»„æˆå‘˜
$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group my-group --members

CONSUMER-ID                                    HOST            CLIENT-ID       #PARTITIONS
consumer1-3fc8d6f1-581a-4472-bdf3-3515b4aee8c1 /127.0.0.1      consumer1       2
consumer4-117fe4d3-c6c1-4178-8ee9-eb4a3954bee0 /127.0.0.1      consumer4       1
consumer2-e76ea8c3-5d30-4299-9005-47eb41f3d3c4 /127.0.0.1      consumer2       3
consumer3-ecea43e4-1f01-479f-8349-f9130b75d8ee /127.0.0.1      consumer3       0

# æŸ¥çœ‹æ¶ˆè´¹è€…ç»„æˆå‘˜è¯¦ç»†ä¿¡æ¯(åˆ†åŒº)
$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group my-group --members --verbose

CONSUMER-ID                                    HOST            CLIENT-ID       #PARTITIONS     ASSIGNMENT
consumer1-3fc8d6f1-581a-4472-bdf3-3515b4aee8c1 /127.0.0.1      consumer1       2               topic1(0), topic2(0)
consumer4-117fe4d3-c6c1-4178-8ee9-eb4a3954bee0 /127.0.0.1      consumer4       1               topic3(2)
consumer2-e76ea8c3-5d30-4299-9005-47eb41f3d3c4 /127.0.0.1      consumer2       3               topic2(1), topic3(0,1)
consumer3-ecea43e4-1f01-479f-8349-f9130b75d8ee /127.0.0.1      consumer3       0               -

# --stateå‚æ•°

$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group my-group --state

COORDINATOR (ID)          ASSIGNMENT-STRATEGY       STATE                #MEMBERS
localhost:9092 (0)        range                     Stable               4

# åˆ é™¤æ¶ˆè´¹è€…ç»„
$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --delete --group my-group --group my-other-group

Deletion of requested consumer groups (&amp;#39;my-group&amp;#39;, &amp;#39;my-other-group&amp;#39;) was successful.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; &lt;code&gt;--reset-offsets&lt;/code&gt;é€‰é¡¹æ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªæ‰§è¡Œé€‰é¡¹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ˜¾ç¤ºè¦é‡ç½®çš„åç§»é‡&lt;/li&gt;
&lt;li&gt;&amp;ndash;execute: æ‰§è¡Œ&lt;code&gt;--reset-offsets&lt;/code&gt;è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;&amp;ndash;export: ä»¥csvæ ¼å¼å¯¼å‡ºæ‰§è¡Œç»“æœ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;--reset-offsets&lt;/code&gt;å‚æ•°è¿˜æœ‰å¦‚ä¸‹æ–¹æ¡ˆå¯ä¾›é€‰æ‹©:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;ndash;to-datetime: é‡ç½®offsetåˆ°å¦å¤–ä¸€ä¸ªoffset (format:YYYY-MM-DDTHH:mm:SS.sss)&lt;/li&gt;
&lt;li&gt;&amp;ndash;to-earliest: é‡ç½®offsetåˆ°æœ€æ—©çš„offset&lt;/li&gt;
&lt;li&gt;&amp;ndash;to-latest: é‡ç½®ä¸ºæœ€æ–°çš„offset&lt;/li&gt;
&lt;li&gt;&amp;ndash;shift-by: é‡ç½®offsetä¸ºn&lt;/li&gt;
&lt;li&gt;&amp;ndash;from-file: é‡ç½®åˆ°csvä¸­å®šä¹‰çš„offset&lt;/li&gt;
&lt;li&gt;&amp;ndash;to-current: é‡ç½®offsetåˆ°å½“å‰&lt;/li&gt;
&lt;li&gt;&amp;ndash;by-duration: é‡ç½®offsetä¸ºå½“å‰æ—¶é—´( Format: &amp;lsquo;PnDTnHnMnS&amp;rsquo;)&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&amp;ndash;to-offset: é‡ç½®offsetä¸ºæŒ‡å®šçš„å€¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# è®¾ç½®æ¶ˆè´¹è€…ç»„çš„offsetä¸ºæœ€æ–°
$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --reset-offsets --group consumergroup1 --topic topic1 --to-latest

TOPIC                          PARTITION  NEW-OFFSET
topic1                         0          0&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœä½ è¿˜æ˜¯ä½¿ç”¨è€çš„&lt;code&gt;high-level&lt;/code&gt;æ¶ˆè´¹è€…ï¼Œå¹¶ä¸”å°†ç»„çš„å…ƒæ•°æ®å­˜å‚¨åœ¨zkä¸­(&lt;code&gt;offsets.storage=zookeeper&lt;/code&gt;)ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;--zookeeper&lt;/code&gt;æ¥ä»£æ›¿&lt;code&gt;bootstrap-server&lt;/code&gt;å‚æ•°:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;bin/kafka-consumer-groups.sh --zookeeper localhost:2181 --list&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Expanding your cluster&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é›†ç¾¤çš„æ‰©å±•.&lt;/p&gt;

&lt;p&gt;å°†æœåŠ¡å™¨æ·»åŠ åˆ°Kafkaé›†ç¾¤å¾ˆå®¹æ˜“ï¼Œåªéœ€ä¸ºå®ƒä»¬åˆ†é…ä¸€ä¸ªæƒŸä¸€çš„brokeridï¼Œå¹¶åœ¨æ–°æœåŠ¡å™¨ä¸Šå¯åŠ¨Kafka.&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œè¿™äº›æ–°æœåŠ¡å™¨ä¸ä¼šè‡ªåŠ¨åˆ†é…ä»»ä½•æ•°æ®åˆ†åŒºï¼Œå› æ­¤ï¼Œé™¤éå°†åˆ†åŒºç§»åŠ¨åˆ°å®ƒä»¬ï¼Œå¦åˆ™åœ¨åˆ›å»ºæ–°ä¸»é¢˜ä¹‹å‰ï¼Œå®ƒä»¬ä¸ä¼šåšä»»ä½•å·¥ä½œã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œé€šå¸¸åœ¨å‘é›†ç¾¤ä¸­æ·»åŠ æœºå™¨æ—¶ï¼Œæ‚¨ä¼šå¸Œæœ›å°†ä¸€äº›ç°æœ‰æ•°æ®è¿ç§»åˆ°è¿™äº›æœºå™¨ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;è¿ç§»æ•°æ®çš„è¿‡ç¨‹æ˜¯æ‰‹åŠ¨å¯åŠ¨çš„ï¼Œä½†æ˜¯å®Œå…¨è‡ªåŠ¨åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;å®é™…ä¸Šï¼ŒKafkaå°†æ·»åŠ æ–°æœåŠ¡å™¨ä½œä¸ºå®ƒæ­£åœ¨è¿ç§»çš„åˆ†åŒºçš„è¿½éšè€…ï¼Œå¹¶å…è®¸å®ƒå®Œå…¨å¤åˆ¶è¯¥åˆ†åŒºä¸­çš„ç°æœ‰æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;å½“æ–°æœåŠ¡å™¨å®Œå…¨å¤åˆ¶äº†è¯¥åˆ†åŒºçš„å†…å®¹å¹¶åŠ å…¥åŒæ­¥å‰¯æœ¬æ—¶ï¼Œç°æœ‰å‰¯æœ¬ä¸­çš„ä¸€ä¸ªå°†åˆ é™¤å…¶åˆ†åŒºçš„æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥ä½¿ç”¨åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·åœ¨brokerä¹‹é—´ç§»åŠ¨åˆ†åŒºã€‚&lt;/p&gt;

&lt;p&gt;ç†æƒ³çš„åˆ†åŒºåˆ†å¸ƒåº”è¯¥ç¡®ä¿æ‰€æœ‰brokerä¹‹é—´çš„æ•°æ®è´Ÿè½½å’Œåˆ†åŒºå¤§å°æ˜¯ä¸€è‡´çš„ã€‚&lt;/p&gt;

&lt;p&gt;åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·ä¸å…·å¤‡è‡ªåŠ¨ç ”ç©¶Kafkaé›†ç¾¤ä¸­çš„æ•°æ®åˆ†å¸ƒå¹¶ç§»åŠ¨åˆ†åŒºä»¥è·å¾—å‡åŒ€çš„è´Ÿè½½åˆ†å¸ƒçš„èƒ½åŠ›ï¼Œå› æ­¤ï¼Œç®¡ç†å‘˜å¿…é¡»ç¡®å®šåº”è¯¥ç§»åŠ¨å“ªäº›ä¸»é¢˜æˆ–åˆ†åŒºã€‚&lt;/p&gt;

&lt;p&gt;åˆ†åŒºè¿ç§»å·¥å…·å¯ä»¥è¿è¡Œåœ¨ä¸‰ç§äº’æ–¥æ¨¡å¼ä¸‹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--generate&lt;/code&gt;: ç»™å®šä¸»é¢˜åˆ—è¡¨å’Œbrokeråˆ—è¡¨ï¼Œè¯¥å·¥å…·ç”Ÿæˆä¸€ä¸ªå€™é€‰é‡æ–°åˆ†é…ï¼Œå°†æŒ‡å®šä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºç§»åŠ¨åˆ°æ–°çš„brokerï¼Œè¯¥å‚æ•°ä»…å¸®åŠ©ç®¡ç†å‘˜æ–¹ä¾¿çš„æ¥ç”Ÿæˆç»™å®šä¸»é¢˜å’Œç›®æ ‡brokeråˆ—è¡¨çš„åˆ†åŒºé‡æ–°åˆ†é…è®¡åˆ’&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--execute&lt;/code&gt;: è¯¥å·¥å…·æ ¹æ®ç”¨æˆ·æä¾›çš„é‡æ–°åˆ†é…è®¡åˆ’å¼€å§‹é‡æ–°åˆ†é…åˆ†åŒº(ä½¿ç”¨&lt;code&gt;--reassignment-json-file&lt;/code&gt;æŒ‡å®šç”Ÿæˆçš„è¿ç§»é…ç½®)ï¼Œ- &lt;code&gt;--verify&lt;/code&gt;: è¯¥å·¥å…·å°†éªŒè¯åˆ—å‡ºçš„æ‰€æœ‰åˆ†åŒºçš„é‡æ–°åˆ†é…çŠ¶æ€ï¼Œå¯ä»¥æ˜¯æˆåŠŸå®Œæˆã€å¤±è´¥æˆ–æ­£åœ¨è¿›è¡Œ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;1.è‡ªåŠ¨è¿ç§»æ•°æ®åˆ°æ–°çš„æœåŠ¡å™¨&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·å¯ç”¨äºå°†æŸäº›ä¸»é¢˜ä»å½“å‰brokeré›†ç§»åˆ°æ–°æ·»åŠ çš„brokerã€‚ è¿™åœ¨æ‰©å±•ç°æœ‰é›†ç¾¤æ—¶é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä¸ä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªåˆ†åŒºç›¸æ¯”ï¼Œå°†æ•´ä¸ªä¸»é¢˜ç§»è‡³æ–°çš„brokeré›†æ›´å®¹æ˜“ã€‚ ç”¨äºæ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œç”¨æˆ·åº”æä¾›åº”ç§»è‡³æ–°çš„ä¸€ç»„brokerçš„ä¸»é¢˜åˆ—è¡¨å’Œæ–°brokerçš„ç›®æ ‡åˆ—è¡¨ã€‚ ç„¶åï¼Œè¯¥å·¥å…·å°†ç»™å®šä¸»é¢˜åˆ—è¡¨ä¸­çš„æ‰€æœ‰åˆ†åŒºå¹³å‡åˆ†é…åˆ°æ–°çš„ä¸€ç»„brokerä¸­ã€‚ åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¸»é¢˜çš„å¤åˆ¶å› å­ä¿æŒä¸å˜ã€‚ æœ‰æ•ˆåœ°ï¼Œå°†è¾“å…¥ä¸»é¢˜åˆ—è¡¨çš„æ‰€æœ‰åˆ†åŒºçš„å‰¯æœ¬ä»æ—§çš„brokeré›†ç§»è‡³æ–°æ·»åŠ çš„brokerã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸‹ç¤ºä¾‹(topic:foo1å’Œfoo2çš„å…¨éƒ¨åˆ†åŒºç§»åŠ¨åˆ°broker 5å’Œ6ä¸Šï¼Œè¿ç§»å®Œæˆåï¼Œè¯¥topicçš„å…¨éƒ¨åˆ†åŒºå°†åœ¨Broker5å’Œ6ä¸Š):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ cat topics-to-move.json
{&amp;#34;topics&amp;#34;: [{&amp;#34;topic&amp;#34;: &amp;#34;foo1&amp;#34;},
            {&amp;#34;topic&amp;#34;: &amp;#34;foo2&amp;#34;}],
&amp;#34;version&amp;#34;:1
}

# å‡†å¤‡å¥½jsonæ–‡ä»¶ä¹‹åï¼Œä½¿ç”¨åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·ç”Ÿæˆä¸€ä¸ªå€™é€‰åˆ†é…
$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --topics-to-move-json-file topics-to-move.json --broker-list &amp;#34;5,6&amp;#34; --generate
Current partition replica assignment

{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[1,2]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[3,4]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[1,2]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[3,4]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[2,3]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[2,3]}]
}

Proposed partition reassignment configuration

{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[5,6]}]
}

# è¯¥å·¥å…·ç”Ÿæˆä¸€ä¸ªå°†ç§»åŠ¨æ‰€æœ‰åˆ†åŒºçš„å€™é€‰åˆ†é…(åˆ†é…åˆ°å“ªäº›brokerä¸Š)ï¼Œæ­¤æ—¶åˆ†åŒºç§»åŠ¨è¿˜æ²¡æœ‰å¼€å§‹ï¼Œå®ƒåªå‘Šè¯‰æ‚¨å½“å‰çš„åˆ†é…å’Œå»ºè®®çš„æ–°åˆ†é…ã€‚
# åº”è¯¥ä¿å­˜å½“å‰çš„èµ‹å€¼ï¼Œä»¥é˜²æ‚¨æƒ³è¦å›æ»šåˆ°å®ƒ.
# ä½¿ç”¨ç”Ÿæˆçš„è¿ç§»è®¡åˆ’è¿›è¡Œè¿ç§»
$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file expand-cluster-reassignment.json --execute
Current partition replica assignment

{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[1,2]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[3,4]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[1,2]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[3,4]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[2,3]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[2,3]}]
}

Save this to use as the --reassignment-json-file option during rollback
Successfully started reassignment of partitions
{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[5,6]}]
}

# æœ€åä½¿ç”¨--verifyé€‰é¡¹éªŒè¯è¿ç§»çŠ¶æ€
# æ³¨æ„:ä½¿ç”¨ç›¸åŒçš„è¿ç§»è®¡åˆ’ä»»åŠ¡expand-cluster-reassignment.json
$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file expand-cluster-reassignment.json --verify
Status of partition reassignment:
Reassignment of partition [foo1,0] completed successfully
Reassignment of partition [foo1,1] is in progress
Reassignment of partition [foo1,2] is in progress
Reassignment of partition [foo2,0] completed successfully
Reassignment of partition [foo2,1] completed successfully
Reassignment of partition [foo2,2] completed successfully&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;2.è‡ªå®šä¹‰åˆ†åŒºåˆ†é…å’Œè¿ç§»&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åˆ†åŒºé‡åˆ†é…å·¥å…·è¿˜å¯ä»¥ç”¨äºæœ‰é€‰æ‹©åœ°å°†åˆ†åŒºçš„å‰¯æœ¬ç§»åŠ¨åˆ°ä¸€ç»„ç‰¹å®šçš„brokerã€‚&lt;/p&gt;

&lt;p&gt;å½“æˆ‘ä»¬ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨æ—¶ï¼Œå‡è®¾ç”¨æˆ·çŸ¥é“é‡æ–°åˆ†é…è®¡åˆ’ï¼Œå¹¶ä¸”ä¸éœ€è¦è¯¥å·¥å…·æ¥ç”Ÿæˆå€™é€‰çš„é‡æ–°åˆ†é…ï¼Œå³ç›´æ¥ä½¿ç”¨ç”¨æˆ·çš„åˆ†é…ç­–ç•¥è¿›è¡Œæ•°æ®è¿ç§»ã€‚&lt;/p&gt;

&lt;p&gt;ç¤ºä¾‹: è¿ç§»topic&lt;code&gt;foo1&lt;/code&gt;çš„partition-0åˆ°broker5å’Œ6ï¼Œpartition-1åˆ°broker2å’Œ3&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# è‡ªå®šä¹‰è¿ç§»è®¡åˆ’
$ cat custom-reassignment.json
{&amp;#34;version&amp;#34;:1,&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6]},{&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[2,3]}]}

# ä½¿ç”¨--executeé€‰é¡¹æ‰§è¡Œä¸Šè¿°çš„è¿ç§»è®¡åˆ’
$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file custom-reassignment.json --execute
Current partition replica assignment

{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[1,2]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[3,4]}]
}

Save this to use as the --reassignment-json-file option during rollback
Successfully started reassignment of partitions
{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo1&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6]},
              {&amp;#34;topic&amp;#34;:&amp;#34;foo2&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[2,3]}]
}

# --verifyæ¥éªŒè¯è¿ç§»çŠ¶æ€

$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file custom-reassignment.json --verify
Status of partition reassignment:
Reassignment of partition [foo1,0] completed successfully
Reassignment of partition [foo2,1] completed successfully&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Decommissioning brokers&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·è¿˜ä¸èƒ½è‡ªåŠ¨ç”Ÿæˆç”¨äºé€€å½¹brokerçš„é‡æ–°åˆ†é…è®¡åˆ’ï¼Œå› æ­¤ï¼Œç®¡ç†å‘˜å¿…é¡»åˆ¶å®šä¸€ä¸ªé‡æ–°åˆ†é…è®¡åˆ’ï¼Œå°†æ‰˜ç®¡åœ¨ä»£ç†ä¸Šçš„æ‰€æœ‰åˆ†åŒºçš„å‰¯æœ¬è¿ç§»åˆ°ä»£ç†çš„å…¶ä½™éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;è¿™å¯èƒ½æ¯”è¾ƒç¹çï¼Œå› ä¸ºé‡æ–°åˆ†é…éœ€è¦ç¡®ä¿æ‰€æœ‰å‰¯æœ¬ä¸ä¼šä»å·²é€€å½¹çš„ä»£ç†ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä»£ç†ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬è®¡åˆ’åœ¨å°†æ¥ä¸ºé€€å½¹ä»£ç†æ·»åŠ å·¥å…·æ”¯æŒã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Increasing replication factor&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¢åŠ ç°æœ‰åˆ†åŒºçš„å¤åˆ¶å› å­å¾ˆå®¹æ˜“ï¼Œåªéœ€åœ¨å®šåˆ¶çš„é‡æ–°åˆ†é…jsonæ–‡ä»¶ä¸­æŒ‡å®šé¢å¤–çš„å‰¯æœ¬ï¼Œå¹¶ä½¿ç”¨â€”executeé€‰é¡¹æ¥å¢åŠ æŒ‡å®šåˆ†åŒºçš„å¤åˆ¶å› å­ã€‚&lt;/p&gt;

&lt;p&gt;ç¤ºä¾‹: å°†ä¸»é¢˜fooçš„partition-0çš„å‰¯æœ¬ä»1å¢åŠ åˆ°3ã€‚åœ¨å¢åŠ å¤åˆ¶å› å­ä¹‹å‰ï¼Œä»£ç†5ä¸Šåªå­˜åœ¨åˆ†åŒºçš„å‰¯æœ¬ï¼Œä½œä¸ºå¢åŠ å¤åˆ¶å› å­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åœ¨ä»£ç†6å’Œä»£ç†7ä¸Šæ·»åŠ æ›´å¤šçš„å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# è‡ªå®šä¹‰è¿ç§»é…ç½®
$ cat increase-replication-factor.json
{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6,7]}]}

# æ‰§è¡Œ
bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file increase-replication-factor.json --execute
Current partition replica assignment

{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5]}]}

Save this to use as the --reassignment-json-file option during rollback
Successfully started reassignment of partitions
{&amp;#34;version&amp;#34;:1,
&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;foo&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[5,6,7]}]}

# éªŒè¯
bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file increase-replication-factor.json --verify
Status of partition reassignment:
Reassignment of partition [foo,0] completed successfully

# æŸ¥çœ‹å‰¯æœ¬æ•°
$ bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic foo --describe
Topic:foo   PartitionCount:1    ReplicationFactor:3 Configs:
  Topic: foo    Partition: 0    Leader: 5   Replicas: 5,6,7 Isr: 5,6,7&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Limiting Bandwidth Usage during Data Migration&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Kafkaå…è®¸æ‚¨å¯¹å¤åˆ¶æµé‡æ–½åŠ é™åˆ¶ï¼Œè®¾ç½®ç”¨äºå°†å‰¯æœ¬ä»ä¸€å°æœºå™¨ç§»åŠ¨åˆ°å¦ä¸€å°æœºå™¨çš„å¸¦å®½ä¸Šé™ã€‚&lt;/p&gt;

&lt;p&gt;è¿™åœ¨é‡æ–°å¹³è¡¡é›†ç¾¤ã€å¼•å¯¼æ–°ä»£ç†æˆ–æ·»åŠ æˆ–åˆ é™¤ä»£ç†æ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†è¿™äº›æ•°æ®å¯†é›†å‹æ“ä½œå¯¹ç”¨æˆ·çš„å½±å“&lt;/p&gt;

&lt;p&gt;æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åœ¨ä½¿ç”¨&lt;code&gt;kafka-reassign-partitions.sh&lt;/code&gt;è„šæœ¬æ—¶ï¼Œä½¿ç”¨é™æµåŠŸèƒ½ï¼Œä¸è¿‡&lt;code&gt;kafka-configs.sh&lt;/code&gt;è„šæœ¬ä¹Ÿå…·æœ‰è¯¥åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# é™åˆ¶åœ¨æ‰§è¡Œé‡å¹³è¡¡æ—¶ï¼Œè¿ç§»é€Ÿåº¦ä¸èƒ½è¶…è¿‡50MB/s.
$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --execute --reassignment-json-file bigger-cluster.json â€”throttle 50000000

# å½“ç„¶ï¼Œå¦‚æœè¦æ”¹å˜é€Ÿç‡çš„é™åˆ¶ï¼Œå¯ä»¥é‡æ–°è¿è¡Œ
$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181  --execute --reassignment-json-file bigger-cluster.json --throttle 700000000
  There is an existing assignment running.
  The throttle limit was set to 700000000 B/s

# ä¸€æ—¦å®Œæˆé‡å¹³è¡¡åï¼Œå°±å¯ä»¥å†æ¬¡éªŒè¯
# éœ€è¦æ³¨æ„:å½“å†²å¹³è¡¡å®Œæˆåï¼Œä½¿ç”¨--verifyéªŒè¯æ—¶éœ€è¦åˆ é™¤é™æµï¼Œå¦åˆ™ä¼šå½±å“æ­£å¸¸å¤åˆ¶
$ bin/kafka-reassign-partitions.sh --zookeeper localhost:2181  --verify --reassignment-json-file bigger-cluster.json
Status of partition reassignment:
Reassignment of partition [my-topic,1] completed successfully
Reassignment of partition [mytopic,0] completed successfully
Throttle was removed.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æŸ¥çœ‹brokerçš„é™æµé…ç½®:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ bin/kafka-configs.sh --describe --zookeeper localhost:2181 --entity-type brokers
Configs for brokers &amp;#39;2&amp;#39; are leader.replication.throttled.rate=700000000,follower.replication.throttled.rate=700000000
Configs for brokers &amp;#39;1&amp;#39; are leader.replication.throttled.rate=700000000,follower.replication.throttled.rate=700000000&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¿™æ˜¾ç¤ºäº†åº”ç”¨äºå¤åˆ¶åè®®çš„leaderå’Œfollowerç«¯ä¸Šçš„èŠ‚æµã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸¤è¾¹åˆ†é…ç›¸åŒçš„èŠ‚æµååé‡å€¼ã€‚&lt;/p&gt;

&lt;p&gt;æŸ¥çœ‹é™æµçš„å‰¯æœ¬:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ bin/kafka-configs.sh --describe --zookeeper localhost:2181 --entity-type topics
Configs for topic &amp;#39;my-topic&amp;#39; are leader.replication.throttled.replicas=1:102,0:101,
    follower.replication.throttled.replicas=1:101,0:102&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Setting quotas&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é…é¢è®¾ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# ä¸ºuser=user1, client-id=clientAé…ç½®è‡ªå®šä¹‰é…é¢
$ bin/kafka-configs.sh  --zookeeper localhost:2181 --alter --add-config &amp;#39;producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200&amp;#39; --entity-type users --entity-name user1 --entity-type clients --entity-name clientA
Updated config for entity: user-principal &amp;#39;user1&amp;#39;, client-id &amp;#39;clientA&amp;#39;.

# ä¸ºuser=user1é…ç½®é…é¢
$ bin/kafka-configs.sh  --zookeeper localhost:2181 --alter --add-config &amp;#39;producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200&amp;#39; --entity-type users --entity-name user1
Updated config for entity: user-principal &amp;#39;user1&amp;#39;.

# ä¸ºclient-id=clientAé…ç½®é…é¢
$ bin/kafka-configs.sh  --zookeeper localhost:2181 --alter --add-config &amp;#39;producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200&amp;#39; --entity-type clients --entity-name clientA
Updated config for entity: client-id &amp;#39;clientA&amp;#39;.

# ä¸ºuser=userAé…ç½®é»˜è®¤çš„é…é¢
$ bin/kafka-configs.sh  --zookeeper localhost:2181 --alter --add-config &amp;#39;producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200&amp;#39; --entity-type users --entity-name user1 --entity-type clients --entity-default
Updated config for entity: user-principal &amp;#39;user1&amp;#39;, default client-id.

# ä¸ºuseré…ç½®é»˜è®¤é…é¢
$ bin/kafka-configs.sh  --zookeeper localhost:2181 --alter --add-config &amp;#39;producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200&amp;#39; --entity-type users --entity-default
Updated config for entity: default user-principal.

# ä¸ºclient-idé…ç½®é»˜è®¤é…é¢
$  bin/kafka-configs.sh  --zookeeper localhost:2181 --alter --add-config &amp;#39;producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200&amp;#39; --entity-type clients --entity-default
Updated config for entity: default client-id.

# æŸ¥çœ‹é…é¢
$ bin/kafka-configs.sh  --zookeeper localhost:2181 --describe --entity-type users --entity-name user1 --entity-type clients --entity-name clientA
Configs for user-principal &amp;#39;user1&amp;#39;, client-id &amp;#39;clientA&amp;#39; are producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200

$ bin/kafka-configs.sh  --zookeeper localhost:2181 --describe --entity-type users --entity-name user1
Configs for user-principal &amp;#39;user1&amp;#39; are producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200

$ bin/kafka-configs.sh  --zookeeper localhost:2181 --describe --entity-type clients --entity-name clientA
Configs for client-id &amp;#39;clientA&amp;#39; are producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200

# å¦‚æœä¸æŒ‡å®šentity name ï¼Œå°†æ˜¾ç¤ºæ‰€æœ‰çš„entity-typeçš„é…é¢
$ bin/kafka-configs.sh  --zookeeper localhost:2181 --describe --entity-type users
Configs for user-principal &amp;#39;user1&amp;#39; are producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200
Configs for default user-principal are producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200

$ bin/kafka-configs.sh  --zookeeper localhost:2181 --describe --entity-type users --entity-type clients
Configs for user-principal &amp;#39;user1&amp;#39;, default client-id are producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200
Configs for user-principal &amp;#39;user1&amp;#39;, client-id &amp;#39;clientA&amp;#39; are producer_byte_rate=1024,consumer_byte_rate=2048,request_percentage=200&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„&lt;/code&gt;: åœ¨brokerçš„é…ç½®ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼Œä¼šé»˜è®¤ä¸ºå…¨éƒ¨çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è¿›è¡Œé…é¢é™åˆ¶.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…10MB/s
quota.producer.default=10485760
quota.consumer.default=10485760&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&#34;http://kafka.apache.org/24/documentation.html#operations&#34;&gt;kafka-operations&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gehf9xu0tzj30p00angou.jpg&#34; alt=&#34;äº¤æµç¾¤&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>kafkaç”Ÿäº§è§„åˆ’å’Œè¿ç»´</title>
      <link>https://bgbiao.top/post/kafka%E7%94%9F%E4%BA%A7%E8%A7%84%E5%88%92%E5%92%8C%E8%BF%90%E7%BB%B4/</link>
      <pubDate>Sat, 25 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/kafka%E7%94%9F%E4%BA%A7%E8%A7%84%E5%88%92%E5%92%8C%E8%BF%90%E7%BB%B4/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;å‰è¨€: é€šå¸¸å¯¹äºåˆåˆ›ä¼ä¸šæˆ–è€…åˆåˆ›ä¸šåŠ¡å›¢é˜Ÿæ¥è¯´ï¼Œå¯¹äºå¼€æºç»„ä»¶çš„ä½¿ç”¨éƒ½ä¼šæ˜¾çš„æ¯”è¾ƒéšæ„ï¼Œè€Œè¿™ç§æƒ…å†µä¼šéšç€ä¸šåŠ¡é‡çº§çš„å¢é•¿æˆ–æ—¶é—´çš„æ¨ç§»å¯¼è‡´å¼€æºæœåŠ¡çš„æ»¥ç”¨ï¼Œè¿›è€Œé€ æˆçš„ç»“æœå°±æ˜¯æœåŠ¡æ•´ä½“çš„ç¨³å®šæ€§å’Œå¯é æ€§ç›¸å¯¹è¾ƒå·®ï¼Œä¸”æ˜¯è¾¹é™…æ•ˆåº”é€’å‡çš„ï¼Œå¦‚æœæ­¤æ—¶ä¸å¯¹æ•´ä½“ä¸šåŠ¡ä»¥åŠå¼€æºæœåŠ¡è¿›è¡Œè§„åˆ’å’Œæ”¹é€ ï¼Œé‚£ä¹ˆé£é™©å’Œæˆæœ¬å°†æ˜¯åŒæ¯”å¢é•¿çš„ã€‚åœ¨æˆ‘è¿‡å»çš„å·¥ä½œç»å†ä¸­ï¼Œç»å†è¿‡ç±»ä¼¼æœåŠ¡çš„æœ‰&lt;code&gt;Redisé›†ç¾¤&lt;/code&gt;ï¼Œ&lt;code&gt;ElasticSearch&lt;/code&gt;é›†ç¾¤ï¼Œè™½ç„¶æ•´ä½“æ”¹é€ åå¹¶ä¸ä¸€å®šå°†æˆæœ¬é™åˆ°æœ€ä½ï¼Œä½†æ˜¯å¯ä»¥å°†æœåŠ¡çš„å¯ç”¨æ€§å’Œå¯é æ€§æé«˜å¾ˆå¤šï¼Œè€Œä¸”æ ¹æ®ä¸šåŠ¡åœºæ™¯ä»¥åŠä½¿ç”¨æ–¹å¼æ¥è§„åˆ’é›†ç¾¤åä¼šä½¿å¾—æ•´ä½“çš„è¾¹é™…æˆæœ¬å‘ˆé€’å‡çŠ¶æ€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç¬”è€…ç›®å‰æ‰€å¤„çš„å›¢é˜Ÿæ‰€ç®¡ç†çš„kafkaé›†ç¾¤ä¹Ÿå¤„äºè¯¥ç§çŠ¶æ€ï¼Œé›†ç¾¤å½“å‰è§„æ¨¡å¤§çº¦ä¸º20+ECSï¼Œæ€»æ•°æ®é‡å¤§çº¦400Tï¼Œå…¶ä¸­æ‰¿æ¥çš„TopicæœåŠ¡ä¸»è¦åˆ†ä¸º&lt;code&gt;æ—¥å¿—æ”¶é›†&lt;/code&gt;ã€&lt;code&gt;æ•°æ®ç®¡é“&lt;/code&gt;ã€&lt;code&gt;æµå¼è®¡ç®—&lt;/code&gt;ã€&lt;code&gt;ä¸šåŠ¡äº‹ä»¶å­˜å‚¨&lt;/code&gt;å‡ ç§å¤§åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œä»¥ä¸Šå‡ ç§ä½¿ç”¨åœºæ™¯å¯¹äºkafkaé›†ç¾¤çš„çš„&lt;code&gt;å¯ç”¨æ€§&lt;/code&gt;ï¼Œ&lt;code&gt;å¯é æ€§&lt;/code&gt;ï¼Œ&lt;code&gt;æ•°æ®ä¸€è‡´æ€§&lt;/code&gt;è¦æ±‚å…¶å®æ˜¯ä¸åŒçš„ï¼Œå¦‚æœå°†æ‰€æœ‰åœºæ™¯è€¦åˆåˆ°åŒä¸€ä¸ªé›†ç¾¤ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œä»»ä½•çš„å°å¼‚å¸¸ç‚¹éƒ½å¯èƒ½é€ æˆæ•´ä½“æœåŠ¡å—åˆ°å½±å“ï¼Œå¹¶ä¸”æ•´ä¸ªé›†ç¾¤çš„æ¢å¤å‘¨æœŸä¼šå¾ˆé•¿ï¼Œå¦‚æœä¸šåŠ¡æ²¡æœ‰åŠæ—¶çš„é™çº§ç­–ç•¥å¾ˆå¯èƒ½å½±å“æ ¸å¿ƒä¸šåŠ¡çš„å¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;é‰´äºä»¥å‰å¯¹å¼€æºåˆ†å¸ƒå¼æœåŠ¡çš„è§„åˆ’å’Œæ”¹é€ ç»éªŒï¼Œæœ¬ç¯‡æ–‡ç« å°†æ ¹æ®å®˜æ–¹æ–‡æ¡£ä»¥åŠç»éªŒæ¥åˆ†äº«ä¸€äº›å…³äºKafkaç”Ÿäº§é›†ç¾¤è§„åˆ’å’Œè¿ç»´ç®¡ç†ç›¸å…³çš„çŸ¥è¯†.&lt;/p&gt;

&lt;h2 id=&#34;ä¸€-kafkaé›†ç¾¤è¿ç»´å’Œè§„åˆ’&#34;&gt;ä¸€ã€Kafkaé›†ç¾¤è¿ç»´å’Œè§„åˆ’&lt;/h2&gt;

&lt;p&gt;å…¶å®ä»»ä½•å¼€æºçš„åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å¼€å§‹è§„åˆ’æ—¶ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°ä¸šåŠ¡åœºæ™¯ï¼Œä»¥åŠç”Ÿäº§ç¯å¢ƒçš„å‘¨è¾¹å¯è§‚æµ‹ç³»ç»Ÿï¼Œæ¯”å¦‚å¦‚ä¸‹å‡ ä¸ªæ–¹é¢:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è§„åˆ’å’Œéƒ¨ç½²ç”Ÿäº§çº§åˆ«çš„é›†ç¾¤(åŒ…å«å®˜æ–¹æœ€ä½³å®è·µä»¥åŠä¸€äº›é’ˆå¯¹ä¸åœåœºæ™¯æ¨èçš„é…ç½®é¡¹å˜æ›´)&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œä¸€äº›éƒ¨ç½²åçš„æ“ä½œ(æ¯”å¦‚æ»šåŠ¨é‡å¯é›†ç¾¤ï¼Œé›†ç¾¤å¤‡ä»½ï¼Œæ•°æ®è¿ç§»ç­‰ç­‰)&lt;/li&gt;
&lt;li&gt;é›†ç¾¤çš„å¯è§‚æµ‹æ€§(ç›‘æ§é‡è¦ç»Ÿè®¡æ•°æ®ï¼Œç†è§£kafkaå†…éƒ¨è¡Œä¸ºçš„å…·ä½“å«ä¹‰ä»¥åŠæ˜¯å¦éœ€è¦æŠ¥è­¦é€šçŸ¥)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;äºŒ-é›†ç¾¤è§„åˆ’&#34;&gt;äºŒã€é›†ç¾¤è§„åˆ’&lt;/h2&gt;

&lt;p&gt;æœ¬èŠ‚ä¸»è¦ä»‹ç»ï¼Œkafkaé›†ç¾¤åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰çš„ä¸€äº›è§„åˆ’ï¼ŒåŒ…å«ç¡¬ä»¶é…ç½®é€‰æ‹©ï¼Œç½‘ç»œä»¥åŠæ–‡ä»¶ç³»ç»Ÿå’Œå…¶ä»–è€ƒè™‘çš„é€‰å‹.&lt;/p&gt;

&lt;h3 id=&#34;1-ç¡¬ä»¶å’Œos&#34;&gt;1.ç¡¬ä»¶å’ŒOS&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;é€šå¸¸å¯¹äºåˆ†å¸ƒå¼çš„å¼€æºæœåŠ¡æ¥å°†å¯¹äºç¡¬ä»¶æœ¬èº«æ²¡æœ‰å¤ªé«˜çš„è¦æ±‚ï¼Œä½†å½“éœ€è¦æ‰¿è½½ä¸€å®šé‡çº§çš„ä¸šåŠ¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€äº›ç¡¬ä»¶æ˜¯å¦èƒ½å¤Ÿæ”¯æ’‘å¯¹åº”çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¹¶ä¸”é€šå¸¸æ¥è®²é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©ä¸åŒçš„ç¡¬ä»¶(å¦‚æœå¯é€‰æ‹©)ï¼Œä¹Ÿè®¸ä¼šé€‚å½“é™ä½èµ„æºæˆæœ¬ã€‚&lt;/p&gt;

&lt;h4 id=&#34;1-0-os&#34;&gt;1.0 OS&lt;/h4&gt;

&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºè¿è¡ŒLinuxä¸­çš„kafkaé›†ç¾¤ä¸éœ€è¦è¿‡å¤šçš„OSä»¥åŠkernelå‚æ•°è°ƒæ•´ï¼Œä½†å¦‚ä¸‹å‡ ç§æƒ…å†µå¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œå‚è€ƒ:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;æ–‡ä»¶æè¿°ç¬¦(fd)&lt;/code&gt;: brokerèŠ‚ç‚¹ä¸Šfdé™åˆ¶å¯ä»¥å‚è€ƒ&lt;code&gt;(number_of_partitions)*(partition_size/segment_size)&lt;/code&gt;å…¬å¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;å¥—æ¥å­—ç¼“å†²åŒº(socket buffer)&lt;/code&gt;: è¯¥å‚æ•°å¯ä»¥å¢åŠ å¤šæ•°æ®ä¸­å¿ƒä¹‹é—´çš„æ•°æ®ä¼ è¾“(ä¸€èˆ¬å¼‚åœ°é›†ç¾¤å¤‡ä»½å»ºè®®è°ƒæ•´ä»¥å¢åŠ åå)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;æœ€å¤§å†…å­˜æ˜ å°„åŒºåŸŸæ•°(vm.max_map_count)&lt;/code&gt;: å½“kafka brokerèŠ‚ç‚¹æ‹¥æœ‰å¤ªå¤šåˆ†åŒºæ—¶åº”è¯¥å¯†åˆ‡å…³æ³¨ç³»ç»Ÿçº§åˆ«çš„è¯¥å‚æ•°ï¼Œé»˜è®¤ä¸º65535ã€‚æ¯ä¸€ä¸ªæ—¥å¿—æ®µï¼Œåˆ†é…çš„åˆ†åŒºï¼Œéƒ½éœ€è¦ä¸€å¯¹&lt;code&gt;index/timeindex&lt;/code&gt;æ–‡ä»¶ï¼Œè€Œæ¯ä¸ªæ–‡ä»¶éƒ½ä¼šæ¶ˆè€—ä¸€ä¸ªå†…å­˜åŒºåŸŸ(ä¸€ä¸ªæ—¥å¿—æ®µä½¿ç”¨2ä¸ªå†…å­˜æ˜ å°„åŒºåŸŸ)ï¼Œå› æ­¤ä¸€ä¸ªåˆ†åŒºè‡³å°‘éœ€è¦2ä¸ªå†…å­˜åŒºåŸŸï¼Œä¸€ä¸ªbrokerä¸Šæ‹¥æœ‰50000åˆ†åŒºæ—¶ï¼Œå°†ä¼šæ¶ˆè€—100000ä¸ªå†…å­˜åŒºåŸŸï¼Œæ­¤æ—¶é»˜è®¤çš„å‚æ•°å°±ä¼šå¯¼è‡´broker ä»¥&lt;code&gt;OutOfMemoryError&lt;/code&gt;æ–¹å¼crashæ‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;æ¯ä¸ªåˆ†åŒºçš„æ—¥å¿—æ®µçš„æ•°é‡å–å†³äºæ®µ(segment)çš„å¤§å°ï¼Œè´Ÿè½½ï¼Œä»¥åŠä¿ç•™ç­–ç•¥&lt;/p&gt;

&lt;p&gt;kafkaä½¿ç”¨å¤§é‡çš„æ–‡ä»¶ä»¥åŠsocketå’Œå®¢æˆ·ç«¯è¿›è¡Œé€šè®¯ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨Linuxä¸‹ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼Œå› æ­¤ç³»ç»Ÿéœ€è¦è®¾ç½®æ›´å¤šçš„å¯ç”¨æ–‡ä»¶æè¿°ç¬¦&amp;gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å¤§å¤šæ•°çš„é»˜è®¤ç³»ç»Ÿé…ç½®ä¸­ï¼Œå•ä¸ªè¿›ç¨‹å¯ç”¨ä½¿ç”¨1024ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¹äºkafkaæ¥è¯´å¤ªå°äº†ï¼Œå»ºè®®è°ƒæ•´åˆ°è‡³å°‘&lt;code&gt;100000&lt;/code&gt;ï¼Œä½†æ˜¯é€šå¸¸å’Œæ“ä½œ
ç³»ç»Ÿä»¥åŠå‘è¡Œç‰ˆæœ¬æœ‰å…³ç³»ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„OSè¿›è¡Œè°ƒæ•´ã€‚&lt;/p&gt;

&lt;p&gt;å¯ç”¨é€šè¿‡è®¡ç®—Kafkaæ•°æ®ç›®å½•ä¸­çš„&lt;code&gt;.index&lt;/code&gt;æ–‡ä»¶æ¥è®¡ç®—å½“å‰çš„mmapç¼–å·ã€‚&lt;code&gt;.index&lt;/code&gt;æ–‡ä»¶å¤§å¤šæ•°ä»£è¡¨äº†å†…å­˜æ˜ å°„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# 1.ç»Ÿè®¡.indexæ–‡ä»¶ä¸ªæ•°
$ find . -name &amp;#39;*index&amp;#39; | wc -l

# 2.ä¸ºæ¯ä¸ªsessionè®¾ç½®vm.max_map_countå‚æ•°ï¼Œè¿™å°†è®¡ç®—å½“å‰å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ•°é‡ï¼Œmmapé™åˆ¶çš„æœ€å°å€¼å°±æ˜¯æ‰“å¼€æ–‡ä»¶çš„ulimité™åˆ¶
# è¯¥å€¼è¦è¿œå¤§äºindexçš„æ•°é‡
$ sysctl -w vm.max_map_count=262144

# 3.æŒä¹…åŒ–mmapå‚æ•°
$ echo &amp;#39;vm.max_map_count=262144&amp;#39; &amp;gt;&amp;gt; /etc/sysctl.conf
$ sysctl -p&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;1-1-å†…å­˜&#34;&gt;1.1 å†…å­˜&lt;/h4&gt;

&lt;p&gt;Kafkaä¸¥é‡ä¾èµ–æ–‡ä»¶ç³»ç»Ÿæ¥å­˜å‚¨å’Œç¼“å­˜æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰æ•°æ®éƒ½ä¼šç«‹å³å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŒä¹…æ—¥å¿—ä¸­ï¼Œè€Œä¸å¿…åˆ·æ–°åˆ°ç£ç›˜ã€‚å®é™…ä¸Šï¼Œè¿™ä»…æ„å‘³ç€å°†å…¶è½¬ç§»åˆ°å†…æ ¸çš„é¡µé¢ç¼“å­˜&lt;code&gt;pagecache&lt;/code&gt;ä¸­ã€‚ å½“å›æ”¶å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å¯ç”¨å†…å­˜è½¬ç§»åˆ°ç£ç›˜ç¼“å­˜ä¸­ï¼Œè€Œå¯¹æ€§èƒ½çš„å½±å“å¾ˆå°ã€‚&lt;/p&gt;

&lt;p&gt;åŒæ—¶ï¼ŒKafkaéå¸¸å°å¿ƒåœ°ä½¿ç”¨å †ç©ºé—´&lt;code&gt;heap space&lt;/code&gt;ï¼Œä¸éœ€è¦å°†å †å¤§å°è®¾ç½®ä¸ºè¶…è¿‡6 GBï¼Œè¿™æ ·å°†ä¼šåœ¨32Gå†…å­˜çš„æœºå™¨ä¸Šç¼“å­˜28-30Gçš„æ•°æ®åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œç”Ÿäº§é›†ç¾¤éœ€è¦è¶³å¤Ÿçš„å†…å­˜æ¥ç¼“å­˜æ´»åŠ¨çš„readerå’Œwriterã€‚åœ¨Confluentçš„ä½¿ç”¨å»ºè®®ä¸­ï¼Œæå‡ºäº†å¯¹å†…å­˜éœ€æ±‚çš„ç²—ç•¥ä¼°è®¡æ–¹å¼ï¼Œæ¯”å¦‚éœ€è¦ç¼“å†²30sï¼Œé‚£ä¹ˆå†…å­˜éœ€æ±‚å¤§æ¦‚ä¸º&lt;code&gt;write_throughput * 30&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸æ¥è®²&lt;code&gt;64G&lt;/code&gt;å†…å­˜é…ç½®çš„æœºå™¨æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©.&lt;/p&gt;

&lt;h4 id=&#34;1-2-cpu&#34;&gt;1.2 CPU&lt;/h4&gt;

&lt;p&gt;å¤§å¤šæ•°çš„kafkaé›†ç¾¤å¯¹äºcpuçš„è¦æ±‚ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œå› æ­¤å¯¹äºCPUçš„é…ç½®æ²¡æœ‰åƒå…¶ä»–èµ„æºé‚£ä¹ˆé‡è¦(ä½†æ˜¯é€šå¸¸åŒç­‰èµ„æºéƒ½æ˜¯ç”±ä¸€å®šæ¯”ä¾‹é…æ¯”çš„)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¦‚æœå¼€å¯äº†SSLï¼Œé‚£ä¹ˆå¯èƒ½å¯¹é›†ç¾¤çš„æ•´ä½“æ€§èƒ½æœ‰ä¸€å®šå½±å“ï¼Œä¸”å¯¹cpuæœ‰ä¸€å®šè¦æ±‚ï¼Œå…·ä½“éœ€è¦è€ƒè™‘åˆ°cpuçš„ç±»å‹ä»¥åŠå…·ä½“çš„JVMå®ç°ç»†èŠ‚(é€šå¸¸æ¥è®²å†…éƒ¨æœåŠ¡å‡ä¸ä¼šå¼€å¯SSLï¼Œå› ä¸ºç®¡ç†æˆæœ¬å¾ˆé«˜ï¼Œä¸”æ€§èƒ½ä¸Šç•¥æœ‰æŸå¤±ï¼Œå®‰å…¨ä¸Šå¯ä»¥é€šè¿‡æ•´ä½“çš„ITå®‰å…¨è¿›è¡Œè¦æ±‚å’Œç®¡æ§)&lt;/p&gt;

&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨è¾ƒæ–°çš„å¤šæ ¸å¤„ç†å™¨ï¼Œé€šç”¨é›†ç¾¤å¯ä»¥è®¾ç½®ä¸º&lt;code&gt;24&lt;/code&gt;æ ¸å¿ƒã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœéœ€è¦åœ¨æ›´å¿«çš„CPUæˆ–æ›´å¤šçš„å†…æ ¸ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼Œè¯·é€‰æ‹©æ›´å¤šçš„å†…æ ¸ï¼Œå› ä¸ºå¤šæ ¸æä¾›çš„é¢å¤–å¹¶å‘æ€§å°†è¿œè¿œè¶…è¿‡ç¨å¿«çš„æ—¶é’Ÿé€Ÿåº¦ã€‚&lt;/p&gt;

&lt;h4 id=&#34;1-3-disk&#34;&gt;1.3 Disk&lt;/h4&gt;

&lt;p&gt;ç”Ÿäº§é›†ç¾¤å»ºè®®ä½¿ç”¨å¤šå—ç£ç›˜æ¥æœ€å¤§åŒ–æ•´ä½“çš„ååï¼Œä¸è¦ä¸åº”ç”¨ç¨‹åºæ—¥å¿—æˆ–å…¶ä»–OSæ–‡ä»¶ç³»ç»Ÿæ´»åŠ¨å…±äº«ç”¨äºKafkaæ•°æ®çš„ç›¸åŒé©±åŠ¨å™¨ï¼Œä»¥ç¡®ä¿è‰¯å¥½çš„å»¶è¿Ÿã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å®˜æ–¹çš„æœ€ä½³å®è·µä¸­å»ºè®®ï¼Œå¯ä»¥å°†&lt;code&gt;å¤šå—ç£ç›˜æ„å»ºæˆRAID&lt;/code&gt;ï¼Œæˆ–è€…ç›´æ¥å°†ç‹¬ç«‹çš„&lt;code&gt;å¤šå—ç£ç›˜&lt;/code&gt;ä½œä¸ºkafkaçš„æ•°æ®å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯JBODæ–¹æ¡ˆ(Just Bunch Of Disks)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;å¤‡æ³¨:&lt;/code&gt;å¦‚æœè½¯RAIDçš„è¯å…¶å®ä¼šåœ¨å­˜å‚¨æ–¹é¢å¢åŠ ä¸€å±‚æ•°æ®å‡è¡¡ï¼Œå¢åŠ äº†é›†ç¾¤çš„å¤æ‚åº¦ï¼Œå› æ­¤ä¸€èˆ¬å¯ç”¨é€‰æ‹©åè€…ï¼Œè€Œä¸”RAIDä¸»è¦ç”¨äºæä¾›å†—ä½™ï¼Œå¯¹äºå¼€æºåˆ†å¸ƒå¼æœåŠ¡æ¥è®²ï¼Œåœ¨è½¯ä»¶å±‚é¢ä¸ŠåŸºæœ¬éƒ½ä¼šä¿è¯æ•°æ®çš„å†—ä½™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿‡åœ¨å®é™…çš„åœºæ™¯ä¸­ï¼Œå…·ä½“é€‰æ‹©ä½¿ç”¨å¤šå—ç›˜åšRAIDè¿˜æ˜¯ç›´æ¥ä½¿ç”¨å¤šå—ç›˜æŒ‚è½½ï¼Œä»¥ä¸‹æœ‰å‡ ç§åœºæ™¯å¯ä»¥è€ƒè™‘:&lt;/p&gt;

&lt;p&gt;å¦‚æœé…ç½®å¤šä¸ªæ•°æ®ç›®å½•ï¼Œåˆ™Brokerå°†åœ¨è·¯å¾„ä¸­æ”¾ç½®ä¸€ä¸ªæ–°åˆ†åŒºï¼Œè¯¥åˆ†åŒºä¸­å½“å‰å­˜å‚¨çš„åˆ†åŒºæ•°æœ€å°‘ã€‚æ¯ä¸ªåˆ†åŒºå°†å®Œå…¨ä½äºæ•°æ®ç›®å½•ä¹‹ä¸€ä¸­ï¼Œå¦‚æœ&lt;code&gt;åˆ†åŒºä¹‹é—´çš„æ•°æ®ä¸å¹³è¡¡ï¼Œå°±ä¼šå¯¼è‡´ç£ç›˜ä¹‹é—´çš„è´Ÿè½½ä¸å¹³è¡¡&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;RAIDåœ¨å¹³è¡¡ç£ç›˜ä¹‹é—´çš„è´Ÿè½½æ–¹é¢åšå¾—æ›´å¥½ï¼Œå®ƒèƒ½åœ¨è¾ƒä½çš„æ°´å¹³ä¸Šå¹³è¡¡è´Ÿè½½ã€‚RAIDçš„ä¸»è¦ç¼ºç‚¹æ˜¯å‡å°‘äº†å¯ç”¨çš„ç£ç›˜ç©ºé—´(RAID0é™¤å¤–)ï¼Œå¥½å¤„æ˜¯å¯ä»¥å®¹å¿ç£ç›˜æ•…éšœ(RAID1ï¼ŒRAID5ç­‰)ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç”Ÿäº§ä¸­å¼ºçƒˆä¸å»ºè®®ä½¿ç”¨RAID 5 or RAID 6 ,ä¼šä¸¥é‡å½±å“åˆ°å†™ååçš„æ€§èƒ½ï¼Œå¹¶ä¸”åœ¨ç£ç›˜æ•…éšœæ—¶ä¼šæœ‰é‡å»ºé˜µåˆ—çš„I/Oæˆæœ¬(&lt;code&gt;RAID0ä¸‹ä¹Ÿå­˜åœ¨é‡å»ºI/Oçš„æˆæœ¬&lt;/code&gt;)&lt;/p&gt;

&lt;p&gt;å¦‚æœé¢å¤–çš„æˆæœ¬å¯ä»¥æ¥å—ï¼Œå»ºè®®ä½¿ç”¨RAID10(å®¹é‡å‡åŠï¼Œå¤šä¸€ä»½å†—ä½™)ï¼Œå¦åˆ™ï¼Œå»ºè®®KafkaæœåŠ¡å™¨é…ç½®å¤šä¸ªæ—¥å¿—ç›®å½•ï¼Œæ¯ä¸ªç›®å½•éƒ½å®‰è£…åœ¨å•ç‹¬çš„é©±åŠ¨å™¨ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;linkedä½¿ç”¨8x7200è½¬çš„sataç£ç›˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç£ç›˜ååé‡æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œç£ç›˜è¶Šå¤šè¶Šå¥½ã€‚&lt;/p&gt;

&lt;p&gt;kafkaå®˜æ–¹æ–‡æ¡£ä¸­å…¶å®å»ºè®®ä½¿ç”¨å¤šä¸ªé©±åŠ¨å™¨ä»¥è·å¾—è‰¯å¥½çš„ååé‡ï¼Œå› ä¸ºæ¯ä¸ªè·¯å¾„éƒ½ç‹¬ç«‹æŒ‚è½½åœ¨ä¸åŒçš„ç£ç›˜ä¸Šï¼Œè¿™ä½¿å¾—å¤šå—ç‰©ç†ç£ç›˜ç£å¤´åŒæ—¶æ‰§è¡Œç‰©ç†I/Oå†™æ“ä½œï¼Œå¯ä»¥æå¤§åœ°åŠ é€ŸKafkaæ¶ˆæ¯ç”Ÿäº§çš„é€Ÿåº¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; é€šå¸¸åœ¨ä½¿ç”¨æœ¬åœ°ç›˜æ—¶ï¼Œå®¹é‡å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå½“ç£ç›˜å®¹é‡è¶…è¿‡2Tæ—¶ï¼ŒLinuxä¸‹é»˜è®¤çš„MBRåˆ†åŒºå°±ä¸èƒ½æ»¡è¶³å®¹é‡çš„è¦æ±‚äº†ï¼Œæ­¤æ—¶éœ€è¦åœ¨åˆ†åŒºæ—¶è¿›è¡ŒGPTåˆ†åŒºï¼Œå¦åˆ™ç­‰çº¿ä¸Šä¸šåŠ¡çœŸæ­£ä¸Šçº¿åä¼šå‘ç°è¶…è¿‡2Tçš„ç©ºé—´å°±è¢«æµªè´¹äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œç£ç›˜å®¹é‡è§„åˆ’çš„é—®é¢˜ï¼Œè™½ç„¶kafkaé»˜è®¤ä¸ºå…¨éƒ¨çš„æ—¥å¿—æ•°æ®è®¾ç½®äº†7å¤©ä¿ç•™æ—¶é—´ï¼Œä½†æ˜¯å¾€å¾€åœ¨æµ·é‡çš„æ•°æ®æ¶ˆè´¹åœºæ™¯ä¸­ï¼Œå•å¤©çš„æ•°æ®é‡ä¹Ÿå¯èƒ½è¾¾åˆ°å¥½å‡ ä¸ªTï¼Œè¿™å°±å¯¼è‡´äº†éœ€è¦æå‰å¯¹ä¸šåŠ¡çš„åœºæ™¯å’Œä½¿ç”¨æ–¹å¼è¿›è¡Œæå‰è§„åˆ’ï¼Œå¹¶æå‰è®¡ç®—æœ€å°‘çš„å­˜å‚¨é‡ã€‚&lt;/p&gt;

&lt;p&gt;ä½†ä¸€èˆ¬å¯¹äºç£ç›˜ç©ºé—´çš„è§„åˆ’å¯ä»¥æ ¹æ®æ¶ˆæ¯é‡å¤§æ¦‚ä¼°ç®—ï¼Œæ¯”å¦‚ä¸€å¤©7äº¿æ¡æ¶ˆæ¯ï¼Œå•æ¡1kbï¼Œæ¶ˆæ¯å‰¯æœ¬ä¸º3(å¯ä¿è¯2èŠ‚ç‚¹åŒæ—¶æŒ‚)ï¼Œé‚£ä¹ˆå¤§æ¦‚çš„å­˜å‚¨ç©ºé—´ä¸º&lt;code&gt;7äº¿*3*1KB/1000/1000=2100G&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯è¿™ç§è§„æ¨¡ä¸‹çš„æ•°æ®ï¼Œä¸€å¤©äº§ç”Ÿ2Tçš„æ•°æ®ï¼Œå®é™…ä½¿ç”¨æ•°æ®ä¸º700Gï¼Œ1400Gæ•°æ®ä¸ºå†—ä½™æ•°æ®ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨è§„åˆ’ç£ç›˜å®¹é‡æ—¶å°±éœ€è¦è€ƒè™‘åˆ°å•å¤©æ•°æ®é‡çš„å¤§å°ï¼Œä»¥åŠæ•°æ®çš„ä¿ç•™æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¦‚æœå®¢æˆ·ç«¯å¼€å¯äº†æ¶ˆæ¯å‹ç¼©ï¼Œæ•´ä½“çš„æ•°æ®èƒ½å†ç›¸å¯¹å°ä¸€äº›ï¼Œå¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µæ¥è€ƒè™‘&lt;/p&gt;

&lt;h4 id=&#34;1-4-network&#34;&gt;1.4 Network&lt;/h4&gt;

&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¿«é€Ÿå¯é çš„ç½‘ç»œæ˜¯æ€§èƒ½çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†(&lt;code&gt;å› æ­¤é€šå¸¸åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å»ºè®®åœ¨åŒæœºæˆ¿&lt;/code&gt;)ã€‚&lt;/p&gt;

&lt;p&gt;ä½å»¶è¿Ÿç¡®ä¿èŠ‚ç‚¹å¯ä»¥è½»æ¾é€šä¿¡ï¼Œè€Œé«˜å¸¦å®½æœ‰åŠ©äºé›†ç¾¤èŠ‚ç‚¹ä¹‹å‰çš„å‰¯æœ¬ç§»åŠ¨å’Œæ¢å¤(&lt;code&gt;å¾€å¾€åœ¨kafkaé›†ç¾¤ä¸­ä¼˜å…ˆç“¶é¢ˆç‚¹éƒ½æ˜¯å¸¦å®½&lt;/code&gt;)ã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰å¤§å¤šæ•°çš„æ•°æ®ä¸­å¿ƒåŸºæœ¬éƒ½æ˜¯åƒå…†(1 GbE)æˆ–ä¸‡å…†ç½‘ç»œ(10 GbE)ï¼Œå¯¹äºå¤§å¤šæ•°é›†ç¾¤é€šå¸¸éƒ½æ˜¯è¶³å¤Ÿçš„ã€‚&lt;/p&gt;

&lt;p&gt;åº”è¯¥å°½é‡é¿å…é›†ç¾¤è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒï¼Œå³ä½¿æ•°æ®ä¸­å¿ƒåœ¨å¾ˆè¿‘çš„è·ç¦»åŒåœ°åŒºï¼Œä¹Ÿè¦é¿å…è·¨è¶Šå·¨å¤§åœ°ç†è·ç¦»çš„é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;å¤‡æ³¨:&lt;/code&gt;å®é™…ä¸Šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åˆ†åŒºæ˜¯è‚¯å®šä¼šå‘ç”Ÿçš„ï¼Œé€šè¿‡é¿å…è·¨æœºæˆ¿éƒ¨ç½²èƒ½å¤Ÿé™ä½åˆ†åŒºçš„æ¦‚ç‡&lt;/p&gt;

&lt;p&gt;Kafkaé›†ç¾¤å‡è®¾æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œè¾ƒå¤§çš„å»¶è¿Ÿå¯èƒ½ä¼šåŠ å‰§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é—®é¢˜ï¼Œå¹¶ä½¿è°ƒè¯•å’Œè§£å†³å˜å¾—æ›´åŠ å›°éš¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¦‚æœä¸šåŠ¡ä¸Šéœ€è¦å¼‚åœ°è¿›è¡Œæ•°æ®è¯»å†™ï¼Œæ¨èçš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ•°æ®ä¸­å¿ƒä¸­éƒ¨ç½²ä¸€ä¸ªæœ¬åœ°Kafkaé›†ç¾¤ï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒä¸­çš„åº”ç”¨ç¨‹åºå®ä¾‹åªä¸å®ƒä»¬çš„æœ¬åœ°é›†ç¾¤äº¤äº’ï¼Œå¹¶åœ¨é›†ç¾¤ä¹‹é—´è¿›è¡Œé•œåƒ(kafkaæä¾›äº†mirror-makerå·¥å…·)ã€‚&lt;/p&gt;

&lt;h4 id=&#34;1-5-filesystem&#34;&gt;1.5 Filesystem&lt;/h4&gt;

&lt;p&gt;ç°åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œå¤§éƒ¨åˆ†çš„ç³»ç»Ÿåº”è¯¥éƒ½ä½¿ç”¨äº†&lt;code&gt;Ext4&lt;/code&gt;æˆ–&lt;code&gt;XFS&lt;/code&gt;ç³»ç»Ÿï¼Œå®˜æ–¹ä¹Ÿæ¨èä½¿ç”¨è¿™ä¸¤ç§æ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯å¯¹äºå…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿçš„é€‰æ‹©ï¼Œå®˜æ–¹æä¾›äº†å¦‚ä¸‹å‡ ç§åœºæ™¯å’Œéœ€è¦æ³¨æ„çš„ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨å„ç§æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºå’ŒæŒ‚è½½é€‰é¡¹ï¼Œåœ¨å…·æœ‰å¤§é‡æ¶ˆæ¯è´Ÿè½½çš„é›†ç¾¤ä¸Šæ‰§è¡Œäº†æ¯”è¾ƒæµ‹è¯•ï¼ŒXFSå¸¦æ¥äº†æ›´å¥½çš„æœ¬åœ°æ—¶é—´(æœ€å¥½çš„EXT4é…ç½®æ˜¯160ms vs. 250ms+)ï¼Œä»¥åŠæ›´ä½çš„å¹³å‡ç­‰å¾…æ—¶é—´ã€‚XFSæ€§èƒ½åœ¨ç£ç›˜æ€§èƒ½æ–¹é¢çš„å¯å˜æ€§ä¹Ÿè¾ƒå°ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è®ºæ˜¯ä½¿ç”¨å“ªç§æ–‡ä»¶ç³»ç»Ÿï¼Œæ¨èä¿®æ”¹é»˜è®¤çš„æŒ‚è½½å‚æ•°:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;noatime&lt;/code&gt;: æ­¤é€‰é¡¹ç¦æ­¢åœ¨è¯»å–æ–‡ä»¶æ—¶æ›´æ–°æ–‡ä»¶çš„atime(æœ€åè®¿é—®æ—¶é—´)å±æ€§,è¿™å¯ä»¥æ¶ˆé™¤å¤§é‡çš„æ–‡ä»¶ç³»ç»Ÿå†™æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨å¼•å¯¼æ¶ˆè´¹è€…çš„æƒ…å†µä¸‹,Kafkaå®Œå…¨ä¸ä¾èµ–äºatimeå±æ€§ï¼Œæ‰€ä»¥ç¦ç”¨å®ƒæ˜¯å®‰å…¨çš„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ cat /etc/fstab
UUID=&amp;#34;4231b126-7e67-45c4-b8bf-554006291d35&amp;#34;  /export1    xfs    defaults,noatime         0 2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;XFSæ–‡ä»¶ç³»ç»ŸæŒ‚è½½å‚æ•°ä¼˜åŒ–:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;largeio&lt;/code&gt;: è¿™ä¼šå½±å“statè°ƒç”¨æŠ¥å‘Šçš„é¦–é€‰I/Oå¤§å°ï¼Œå°½ç®¡è¿™å¯ä»¥åœ¨è¾ƒå¤§çš„ç£ç›˜å†™å…¥ä¸Šå®ç°æ›´é«˜çš„æ€§èƒ½ï¼Œä½†å®é™…ä¸Šå¯¹æ€§èƒ½çš„å½±å“å¾ˆå°æˆ–æ²¡æœ‰å½±å“&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nobarrier&lt;/code&gt;: äºå…·æœ‰ç”µæ± åå¤‡ç¼“å­˜çš„åŸºç¡€è®¾å¤‡ï¼Œæ­¤é€‰é¡¹å¯ä»¥é€šè¿‡ç¦ç”¨å®šæœŸå†™åˆ·æ–°æ¥æä¾›æ›´é«˜çš„æ€§èƒ½ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåŸºç¡€è®¾å¤‡çš„è¡Œä¸ºè‰¯&amp;gt;å¥½ï¼Œå®ƒå°†å‘æ–‡ä»¶ç³»ç»ŸæŠ¥å‘Šå®ƒä¸éœ€è¦åˆ·æ–°ï¼Œå¹¶ä¸”æ­¤é€‰é¡¹å°†æ— æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;EXTæ–‡ä»¶ç³»ç»ŸæŒ‚è½½å‚æ•°ä¼˜åŒ–:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨ext4æ–‡ä»¶ç³»ç»Ÿä¸‹ï¼Œè¦è·å¾—æœ€ä½³æ€§èƒ½ï¼Œåˆ™éœ€è¦è°ƒæ•´å‡ ä¸ªå‚æ•°ã€‚è¿™äº›é€‰é¡¹åœ¨æ•…éšœæƒ…å†µä¸‹é€šå¸¸æ˜¯ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”å°†å¯¼è‡´æ›´å¤šçš„æ•°æ®ä¸¢å¤±å’ŒæŸåï¼Œå¯¹äºå•ä¸ªbrokeræ•…éšœï¼Œå¯ä»¥æ“¦é™¤ç£ç›˜å¹¶ä»ç¾¤é›†é‡å»ºå‰¯æœ¬ï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤šbrokerå¼‚å¸¸æ„å‘³ç€æ½œåœ¨çš„æ–‡ä»¶ç³»ç»ŸæŸåï¼Œæ— æ³•è½»æ˜“æ¢å¤ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;data=writeback&lt;/code&gt;: Ext4é»˜è®¤ä¸ºdata = orderedï¼Œè¿™ä½¿æŸäº›å†™å…¥æ“ä½œå…·æœ‰å¾ˆå¼ºçš„é¡ºåºï¼Œåœ¨Kafkaåœºæ™¯ä¸‹å…¶å®ä¸éœ€è¦è¯¥å‚æ•°ï¼Œæ­¤è®¾ç½®æ¶ˆé™¤äº†æ’åºçº¦æŸï¼Œå¹¶ä¸”ä¼¼ä¹å¤§å¤§å‡å°‘äº†å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Disabling journaling&lt;/code&gt;: æ—¥å¿—è®°å½•æ˜¯ä¸€ä¸ªæŠ˜è¡·:å®ƒä½¿æœåŠ¡å™¨å´©æºƒåé‡æ–°å¼•å¯¼æ›´å¿«ï¼Œä½†å®ƒå¼•å…¥äº†å¤§é‡é¢å¤–çš„é”å®šï¼Œå¢åŠ äº†å†™å…¥æ€§èƒ½çš„å·®å¼‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;commit=num_secs&lt;/code&gt;: è¿™è°ƒæ•´äº†ext4æäº¤åˆ°å…¶å…ƒæ•°æ®æ—¥å¿—çš„é¢‘ç‡ã€‚ å°†æ­¤å€¼è®¾ç½®ä¸ºè¾ƒä½çš„å€¼å¯ä»¥å‡å°‘å´©æºƒæœŸé—´æœªåˆ·æ–°æ•°æ®çš„ä¸¢å¤±ã€‚ å°†æ­¤å€¼è®¾ç½®ä¸ºè¾ƒé«˜çš„å€¼å°†æé«˜ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nobh&lt;/code&gt;: æ­¤è®¾ç½®æ§åˆ¶åœ¨ä½¿ç”¨data=writebackæ¨¡å¼æ—¶é™„åŠ çš„æ’åºä¿è¯ï¼Œå¯ä»¥æé«˜ååé‡å’Œå»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delalloc&lt;/code&gt;: å»¶è¿Ÿåˆ†é…æ„å‘³ç€æ–‡ä»¶ç³»ç»Ÿé¿å…åœ¨ç‰©ç†å†™å…¥å‘ç”Ÿä¹‹å‰åˆ†é…ä»»ä½•å—ï¼Œæ­¤åŠŸèƒ½éå¸¸é€‚åˆååé‡&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;1-6-application-vs-os-flush-management&#34;&gt;1.6 Application vs. OS Flush Management&lt;/h4&gt;

&lt;p&gt;Kafkaå§‹ç»ˆä¼šç«‹å³å°†æ‰€æœ‰æ•°æ®å†™å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ”¯æŒé…ç½®åˆ·æ–°ç­–ç•¥çš„åŠŸèƒ½ï¼Œè¯¥ç­–ç•¥æ§åˆ¶ä½•æ—¶ä½¿ç”¨åˆ·æ–°å°†æ•°æ®ä»OSç¼“å­˜ä¸­å¼ºåˆ¶å‡ºåˆ°ç£ç›˜ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥æ§åˆ¶æ­¤åˆ·æ–°ç­–ç•¥ï¼Œä»¥åœ¨ä¸€æ®µæ—¶é—´åæˆ–åœ¨å†™å…¥ä¸€å®šæ•°é‡çš„æ¶ˆæ¯ä¹‹åå°†æ•°æ®å¼ºåˆ¶åˆ°ç£ç›˜ã€‚ åœ¨æ­¤é…ç½®ä¸­æœ‰å‡ ç§é€‰æ‹©ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaå¿…é¡»æœ€ç»ˆè°ƒç”¨fsyncæ‰èƒ½çŸ¥é“æ•°æ®å·²åˆ·æ–°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;å½“ä»å´©æºƒä¸­æ¢å¤ä»»ä½•æœªçŸ¥çš„æ—¥å¿—æ®µæ—¶ï¼ŒKafkaå°†é€šè¿‡æ£€æŸ¥å…¶æ¶ˆæ¯çš„CRCæ¥æ£€æŸ¥æ¯æ¡æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶æ‰§è¡Œçš„æ¢å¤è¿‡ç¨‹ä¸­é‡å»ºé™„å¸¦çš„åç§»ç´¢å¼•æ–‡ä»¶&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è¯·æ³¨æ„ï¼ŒKafkaä¸­çš„æŒä¹…æ€§ä¸éœ€è¦å°†æ•°æ®åŒæ­¥åˆ°ç£ç›˜ï¼Œå› ä¸ºå‘ç”Ÿæ•…éšœçš„èŠ‚ç‚¹å°†å§‹ç»ˆä»å…¶å‰¯æœ¬ä¸­æ¢å¤ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å»ºè®®ä½¿ç”¨é»˜è®¤åˆ·æ–°è®¾ç½®ï¼Œè¯¥è®¾ç½®å°†å®Œå…¨ç¦ç”¨åº”ç”¨ç¨‹åºçš„fsyncã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ„å‘³ç€ä¾é æ“ä½œç³»ç»Ÿå’ŒKafkaè‡ªå·±çš„åå°åˆ·æ–°æ¥å®Œæˆåå°åˆ·æ–°ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ºæ‰€æœ‰ç”¨é€”æä¾›äº†æœ€ä½³çš„è§£å†³æ–¹æ¡ˆï¼šæ— éœ€è°ƒèŠ‚é…ç½®ï¼Œæé«˜ååé‡å’Œå»¶è¿Ÿï¼Œå¹¶æä¾›å®Œå…¨æ¢å¤ä¿è¯ã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸ï¼Œæˆ‘ä»¬è®¤ä¸º&lt;code&gt;å¤åˆ¶&lt;/code&gt;æä¾›çš„ä¿è¯è¦å¼ºäº&lt;code&gt;åŒæ­¥åˆ°æœ¬åœ°ç£ç›˜&lt;/code&gt;ï¼Œä½†æ˜¯åæ‰§ç‹‚ä»ç„¶æ›´æ„¿æ„åŒæ—¶æ‹¥æœ‰ä¸¤è€…ï¼Œå¹¶ä¸”ä»ç„¶æ”¯æŒåº”ç”¨ç¨‹åºçº§fsyncç­–ç•¥ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨åº”ç”¨ç¨‹åºçº§åˆ·æ–°è®¾ç½®çš„ç¼ºç‚¹æ˜¯ï¼Œå…¶ç£ç›˜ä½¿ç”¨æ¨¡å¼æ•ˆç‡è¾ƒä½ï¼ˆå®ƒç»™æ“ä½œç³»ç»Ÿå‡å°‘äº†é‡æ–°æ’åºå†™æ“ä½œçš„ä½™åœ°ï¼‰ï¼Œå¹¶ä¸”ç”±äºå¤§å¤šæ•°Linuxæ–‡ä»¶ç³»ç»Ÿä¸­çš„fsyncé˜»æ­¢äº†æ–‡ä»¶å†™å…¥ï¼Œå› æ­¤å®ƒä¼šå¼•å…¥å»¶è¿Ÿã€‚ åå°åˆ·æ–°è¿›è¡Œæ›´ç²¾ç»†çš„é¡µé¢çº§é”å®šã€‚&lt;/p&gt;

&lt;h4 id=&#34;1-7-ç†è§£linuxæ“ä½œç³»ç»Ÿçš„flushè¡Œä¸º&#34;&gt;1.7 ç†è§£Linuxæ“ä½œç³»ç»Ÿçš„Flushè¡Œä¸º&lt;/h4&gt;

&lt;p&gt;åœ¨Linuxä¸­ï¼Œå†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®å°†ä¿ç•™åœ¨é¡µé¢ç¼“å­˜ä¸­ï¼Œç›´åˆ°å¿…é¡»å°†å…¶å†™å‡ºåˆ°ç£ç›˜ä¸ºæ­¢ï¼ˆç”±äºåº”ç”¨ç¨‹åºçº§fsyncæˆ–æ“ä½œç³»ç»Ÿè‡ªèº«çš„åˆ·æ–°ç­–ç•¥ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;æ•°æ®åˆ·æ–°æ˜¯é€šè¿‡ä¸€ç»„ç§°ä¸ºpdflushçš„åå°çº¿ç¨‹å®Œæˆçš„ï¼ˆæˆ–åœ¨2.6.32ç‰ˆçš„å†…æ ¸â€œå†²æ´—çº¿ç¨‹â€ä¸­ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;Pdflushå…·æœ‰å¯é…ç½®çš„ç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ§åˆ¶å¯ä»¥åœ¨ç¼“å­˜ä¸­ç»´æŠ¤å¤šå°‘è„æ•°æ®ä»¥åŠå¿…é¡»å°†å¤šè„æ•°æ®å†™å›åˆ°ç£ç›˜çš„æ—¶é—´.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://web.archive.org/web/20160518040713/http://www.westnet.com/~gsmith/content/linux-pdflush.htm&#34;&gt;pdflushåˆ·æ–°ç­–ç•¥&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å½“Pdflushæ— æ³•è·Ÿä¸Šå†™å…¥æ•°æ®çš„é€Ÿåº¦æ—¶ï¼Œå®ƒå°†æœ€ç»ˆå¯¼è‡´å†™å…¥è¿‡ç¨‹é˜»å¡å†™å…¥ä¸­çš„å»¶è¿Ÿï¼Œä»è€Œå‡æ…¢æ•°æ®çš„ç´¯ç§¯ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿›ç¨‹å†…ç¼“å­˜ç›¸æ¯”ï¼Œä½¿ç”¨pagecacheå­˜å‚¨å°†å†™å…¥ç£ç›˜çš„æ•°æ®æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;I/Oè°ƒåº¦å°†è¿ç»­çš„å°å†™æ‰¹é‡å†™åˆ°æ›´å¤§çš„ç‰©ç†å†™ä¸­ï¼Œä»è€Œæé«˜ååé‡&lt;/li&gt;
&lt;li&gt;I/Oè°ƒåº¦å°è¯•é‡æ–°æ’åºå†™æ“ä½œï¼Œä»¥æœ€å°åŒ–ç£ç›˜å¤´çš„ç§»åŠ¨ï¼Œä»è€Œæé«˜ååé‡&lt;/li&gt;
&lt;li&gt;å®ƒä¼šè‡ªåŠ¨ä½¿ç”¨æœºå™¨ä¸Šæ‰€æœ‰çš„ç©ºé—²å†…å­˜&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2-èŠ‚ç‚¹é…ç½®&#34;&gt;2.èŠ‚ç‚¹é…ç½®&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;1.é¿å…ä½¿ç”¨å¤ªå°çš„èŠ‚ç‚¹é…ç½®ï¼Œå› ä¸ºè¿™æ ·æ•´ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹æ•°å¯èƒ½ä¼šç‰¹åˆ«å¤šï¼Œåœ¨è¿™ç§æœºå™¨ä¸Šè¿è¡Œkafkaå°†ä¼šæœ‰æ›´å¤šçš„å¼€é”€&lt;/li&gt;
&lt;li&gt;2.é¿å…ä½¿ç”¨å¤ªé«˜é…è®¡ç®—æœºï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸å¯¼è‡´èµ„æºä½¿ç”¨ä¸å¹³è¡¡ï¼Œæ¯”å¦‚å†…å­˜ä¼˜å…ˆä¸å¤Ÿäº†ï¼Œä½†cpuè¿˜å‰©ä½™å¾ˆå¤šã€‚å¦‚æœåœ¨æ¯ä¸ªé«˜é…æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªbrokerèŠ‚ç‚¹ï¼Œå°†ä¼šå¢åŠ æ•´ä½“çš„å¤æ‚åº¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;3-jvmé…ç½®&#34;&gt;3.JVMé…ç½®&lt;/h3&gt;

&lt;p&gt;åœ¨å½“å‰å¤§å¤šæ•°Javaç±»åº”ç”¨ä¸‹ï¼ŒåŸºæœ¬éƒ½åœ¨ä½¿ç”¨JDK8(å»ºè®®ä½¿ç”¨æœ€æ–°çš„jdk8)ï¼Œåœ¨æ­¤ç¯å¢ƒä¸‹é»˜è®¤ä½¿ç”¨çš„æ˜¯&lt;code&gt;G1&lt;/code&gt;çš„åƒåœ¾å›æ”¶å™¨ï¼Œå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹ä»…éœ€è¦ä¿®æ”¹å¦‚ä¸‹å‚æ•°å³å¯:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;MaxGCPauseMillis&lt;/code&gt;: æŒ‡å®šæ¯æ¬¡åƒåœ¾å›æ”¶é»˜è®¤çš„åœé¡¿æ—¶é—´ï¼Œé»˜è®¤å€¼200ms&lt;/li&gt;
&lt;li&gt;&lt;code&gt;InitiatingHeapOccupancyPercent&lt;/code&gt;: G1 å¯åŠ¨æ–°ä¸€è½®åƒåœ¾å›æ”¶ä¹‹å‰å¯ä»¥ä½¿ç”¨çš„å †å†…å­˜ç™¾åˆ†æ¯”ï¼Œé»˜è®¤å€¼æ˜¯45&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®˜æ–¹æ¨èçš„GCå‚æ•°å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;-Xms6g -Xmx6g -XX:MetaspaceSize=96m -XX:+UseG1GC -XX:MaxGCPauseMillis=20
       -XX:InitiatingHeapOccupancyPercent=35 -XX:G1HeapRegionSize=16M
       -XX:MinMetaspaceFreeRatio=50 -XX:MaxMetaspaceFreeRatio=80&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä½œä¸ºå‚è€ƒï¼ŒLinkedInæœ€ç¹å¿™çš„é›†ç¾¤å½“å‰æ˜¯å¦‚ä¸‹æƒ…å†µ:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;60 brokers&lt;/li&gt;
&lt;li&gt;50k partitions (replication factor 2)&lt;/li&gt;
&lt;li&gt;800k messages/sec in&lt;/li&gt;
&lt;li&gt;300 MBps inbound, 1 GBps + outbound&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸Šé¢çš„GCè°ƒä¼˜çœ‹èµ·æ¥æ¯”è¾ƒæ¿€è¿›ï¼Œä½†é›†ç¾¤ä¸­çš„æ‰€æœ‰brokeréƒ½ä¼šæœ‰90%çš„gcä¸­æ­¢æ—¶é—´ï¼Œå¤§æ¦‚21msï¼Œå®ƒä»¬åšä¸åˆ°æ¯ç§’ä¸€ä¸ªyoung GC&lt;/p&gt;

&lt;p&gt;ä½œä¸ºåŒæ ·æ˜¯å›¾ç‰‡ç¤¾äº¤çš„&lt;code&gt;Pinterest&lt;/code&gt;æ¥è®²ï¼Œä»–ä»¬é‡‡ç”¨å¦‚ä¸‹çš„JVMå‚æ•°:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://medium.com/pinterest-engineering/how-pinterest-runs-kafka-at-scale-ff9c6f735be&#34;&gt;Pinterestçš„å¤§è§„æ¨¡kafkaå®è·µ&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# 61Gçš„å†…å­˜
-Xms8g -Xmx8g -XX:NewSize=512m -XX:MaxNewSize=512m -XX:MetaspaceSize=128m -XX:+UseG1GC -XX:MaxGCPauseMillis=25
       -XX:InitiatingHeapOccupancyPercent=35 -XX:G1HeapRegionSize=16M -XX:MinMetaspaceFreeRatio=25 
       -XX:MaxMetaspaceFreeRatio=75
       -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:PrintTenuringDistribution 
       -Xloggc:/var/log/kafka/gc.log -XX:UseGCLogFileRotation -XX:NumberOfGCLogFiles=40
       -XX:GCLogFileSize=50M&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;-Xmx10G -Xms10G -server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:MaxInlineLevel=15 -Djava.awt.headless=true -Xloggc:/opt/app/kafka/bin/../logs/kafkaServer-gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=9999&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;4-kafkaæ ¸å¿ƒé…ç½®&#34;&gt;4.kafkaæ ¸å¿ƒé…ç½®&lt;/h3&gt;

&lt;p&gt;Kafkaé»˜è®¤è®¾ç½®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½èƒ½å·¥ä½œï¼Œç‰¹åˆ«æ˜¯ä¸æ€§èƒ½ç›¸å…³çš„è®¾ç½®å’Œé€‰é¡¹ï¼Œä½†æ˜¯è€ƒè™‘åˆ°é›†ç¾¤çš„è§„åˆ’ä»¥åŠåœºæ™¯ç”¨é€”ï¼Œæœ‰ä¸€äº›è¡¥å……çš„é…ç½®å‚æ•°å¯ä»¥å¯¹ç”Ÿäº§ç¯å¢ƒè¿›è¡Œè°ƒä¼˜ã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸é…ç½®ä¸Šæ¥è®²ä¼šåˆ†ä¸º&lt;code&gt;brokerç«¯é…ç½®&lt;/code&gt;ã€&lt;code&gt;produserç«¯é…ç½®&lt;/code&gt;ã€&lt;code&gt;consumerç«¯é…ç½®&lt;/code&gt;ï¼Œç”±äºå„ä¸ªä¸šåŠ¡æ–¹å½“å‰å‡ä½¿ç”¨å¼€æºå®¢æˆ·ç«¯ï¼Œå› æ­¤å¯¹äºå®¢æˆ·ç«¯çš„é…ç½®æ— æ³•åšåˆ°ä¸¥æ ¼ç®¡æ§(å¦‚æœæœ‰å†…éƒ¨çš„sdkå°è£…å¯èƒ½ä¼šæ¯”è¾ƒå¥½)ã€‚&lt;/p&gt;

&lt;h4 id=&#34;4-1-é‡è¦çš„å®¢æˆ·ç«¯é…ç½®&#34;&gt;4.1 é‡è¦çš„å®¢æˆ·ç«¯é…ç½®&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;acks&lt;/code&gt;: æ¶ˆæ¯ä¸€è‡´æ€§ä¿è¯(0:æŠ•é€’å³æˆåŠŸ,1:å‰¯æœ¬åŒæ­¥å³æˆåŠŸ,all/-1:å…¨éƒ¨ISRåŒæ­¥å³æˆåŠŸ)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;compression&lt;/code&gt;: å‹ç¼©ç±»å‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;batch size&lt;/code&gt;: æ‰¹å¤„ç†å¤§å°&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œæœ€é‡è¦çš„å‚æ•°ä¸º&lt;code&gt;fetch size&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;é‰´äºé›†ç¾¤çš„æ•´ä½“å¯ç”¨æ€§å¯é æ€§å…¶å®å¾ˆå¤§ä¸€éƒ¨åˆ†å’Œå®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹å¼æœ‰å…³ï¼Œåé¢ä¼šåˆ—ä¸¾ä¸€äº›å¸¸è§çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ç«¯çš„æ ¸å¿ƒå‚æ•°&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://kafka.apache.org/24/documentation.html#configuration&#34;&gt;kafkaè¯¦ç»†å‚æ•°åˆ—è¡¨&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;4-2-brokeræ ¸å¿ƒé…ç½®&#34;&gt;4.2 brokeræ ¸å¿ƒé…ç½®&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;zookeeper.connect&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;zkè¿æ¥ä¸²ï¼Œå»ºè®®å†™å…¨éƒ¨çš„zkèŠ‚ç‚¹åœ°å€ã€‚&lt;/p&gt;

&lt;p&gt;brokersé“¾æ¥çš„zké›†ç¾¤åœ°å€ï¼Œè¯¥å€¼é»˜è®¤é‡‡ç”¨&lt;code&gt;host:ip/path&lt;/code&gt;æ¥æŒ‡å®šä¸€ä¸ªzkä¸­çš„znodeèŠ‚ç‚¹ï¼Œé€šå¸¸æƒ…å†µä¸‹ç”¨æ¥éš”ç¦»ç¯å¢ƒ. kafkaçš„zkè·¯å¾„ä¸­ä½¿
ç”¨äº†&lt;code&gt;chroot&lt;/code&gt;ç¯å¢ƒï¼Œå¦‚æœä¸æŒ‡å®šä½¿ç”¨é»˜è®¤çš„&lt;code&gt;/&lt;/code&gt;æ¥ä½œä¸ºå­˜å‚¨è·¯å¾„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;broker.id&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;brokerå”¯ä¸€æ ‡è¯†ï¼Œè¯¥å€¼å¯ä»¥ä»»æ„è®¾å®š(intç±»å‹)ã€‚é»˜è®¤&lt;code&gt;reserved.broker.max&lt;/code&gt;å¼€å§‹ï¼Œæ¯æ¬¡+1&lt;/p&gt;

&lt;p&gt;åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªbrokerçš„èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥è‡ªåŠ¨ç”Ÿæˆæ¯ä¸ªbrokerçš„id&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;#broker.id
broker.id.generation.enable=true&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;log.dirs&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;kafkaå­˜å‚¨çš„æ—¥å¿—æ¶ˆæ¯éƒ½æ˜¯ä¿å­˜åœ¨è¯¥å‚æ•°æŒ‡å®šçš„æ—¥å¿—è·¯å¾„ä¸‹ï¼Œè¯¥å€¼å¯ä»¥æŒ‡å®šå¤šä¸ªç£ç›˜è·¯å¾„ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šç»‘å®šåˆ°å¤šä¸ªç£ç›˜ä¸Šã€‚æ¯”å¦‚&lt;code&gt;log.dirs=/exoprt/kafka1,/export/kafka2,/export/kafka3&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å¯¹åº”çš„å¦å¤–ä¸€ä¸ªé»˜è®¤å‚æ•°ä¸º&lt;code&gt;log.dir&lt;/code&gt;ï¼Œé»˜è®¤å€¼ä¸º&lt;code&gt;/tmp/kafka-logs&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;listeners&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;brokerç›‘å¬åˆ—è¡¨ï¼Œé»˜è®¤å°†ä¸º&lt;code&gt;PLAINTEXT://myhost:9092&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;advertised.listeners&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›‘å¬å™¨å‘å¸ƒåˆ°zké›†ç¾¤ä¸­çš„åœ°å€ï¼Œä¾›å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œé»˜è®¤é‡‡ç”¨&lt;code&gt;listeners&lt;/code&gt;å‚æ•°å€¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;num.recovery.threads.per.data.dir&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªæ•°æ®ç›®å½•ç”¨äºåœ¨å¯åŠ¨æ—¶è¿›è¡Œæ—¥å¿—æ¢å¤å’Œåœ¨å…³é—­æ—¶è¿›è¡Œåˆ·æ–°çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º: &lt;code&gt;1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œè¯¥å€¼å¯ä»¥é€‚å½“çš„è°ƒæ•´å¤§ä¸€äº›ï¼Œç”¨æ¥å¢åŠ æ­£å¸¸å…³é—­æ—¶æ•°æ®flushçš„é€Ÿåº¦ï¼Œä»¥åŠå¯åŠ¨æ—¶æ—¥å¿—æ¢å¤çš„é€Ÿåº¦ï¼Œå¯ä»¥æé«˜brokerèŠ‚ç‚¹çš„æ•´ä½“å¯ç”¨æ€§ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºå¦‚ä¸‹å‡ ç§æƒ…å†µï¼Œkafkaä¼šä½¿ç”¨&lt;code&gt;å¯é…ç½®çš„çº¿ç¨‹æ± &lt;/code&gt;æ¥å¤„ç†æ—¥å¿—ç‰‡æ®µ.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨: ç”¨äºæ‰“å¼€æ¯ä¸ªåˆ†åŒºçš„æ—¥å¿—ç‰‡æ®µ&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨å´©æºƒåé‡å¯: ç”¨äºæ£€æŸ¥å’Œæˆªæ–­æ¯ä¸ªåˆ†åŒºçš„æ—¥å¿—ç‰‡æ®µ&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨æ­£å¸¸å…³é—­: ç”¨äºå…³é—­æ—¥å¿—ç‰‡æ®µ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ—¥å¿—ç›®å½•é‡‡ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå› ä¸ºè¿™äº›çº¿ç¨‹ä»…æœ‰åœ¨å¯åŠ¨å’Œå…³é—­æ—¶æ‰ç”¨åˆ°ï¼Œæ‰€ä»¥å¯ä»¥é€‚å½“è®¾ç½®å¤§ä¸€ç‚¹ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°æ•´ä½“æœåŠ¡çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹äºåŒ…å«å¤§é‡åˆ†åŒºçš„æœåŠ¡å™¨æ¥è¯´ï¼Œä¸€æ—¦å‘ç”Ÿå´©æ„¤ï¼Œåœ¨è¿›è¡Œæ¢å¤æ—¶ä½¿ç”¨äº•è¡Œæ“ä½œå¯èƒ½ä¼šçœä¸‹æ•°å°æ—¶çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å€¼æ˜¯æ¯ä¸ªæ—¥å¿—ç›®å½•çš„çº¿ç¨‹æ•°ï¼Œå› æ­¤æ€»çº¿ç¨‹æ•°éœ€è¦è€ƒè™‘åˆ°&lt;code&gt;log.dirs&lt;/code&gt;çš„é…ç½®&lt;/p&gt;

&lt;p&gt;&lt;code&gt;å¤‡æ³¨&lt;/code&gt;: è¿™ä¹Ÿæ˜¯åœ¨ä½¿ç”¨RAIDå’ŒJBODä¸¤ç§ç£ç›˜æ–¹æ¡ˆçš„å¦å¤–ä¸€ä¸ªè€ƒè™‘ç‚¹&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;delete.topic.enable&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ˜¯å¦å…è®¸åˆ é™¤topicï¼Œé»˜è®¤ä¸º: &lt;code&gt;true&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸ºfalseï¼Œé€šè¿‡ç®¡ç†å·¥å…·åˆ é™¤topicä»…ä¸ºæ ‡è®°åˆ é™¤ï¼Œæ­¤æ—¶ä½¿ç”¨&lt;code&gt;describe&lt;/code&gt;å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°topicçš„è¯¦æƒ…ä¿¡æ¯ï¼Œä½†æ˜¯æ— æ³•å†™å…¥ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤&lt;code&gt;zk&lt;/code&gt;ä¸­çš„èŠ‚ç‚¹æ¥åˆ é™¤&lt;/p&gt;

&lt;p&gt;&lt;code&gt;å¤‡æ³¨&lt;/code&gt;: ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®ä¸º&lt;code&gt;false&lt;/code&gt;ï¼Œç”±é›†ç¾¤ç®¡ç†å‘˜å®šæœŸç»Ÿä¸€çš„è¿›è¡Œåˆ é™¤å’Œç®¡ç†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;auto.create.topics.enable&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œkafkaä¼šä½¿ç”¨å¦‚ä¸‹ä¸‰ç§æ–¹å¼åˆ›å»ºtopic:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å½“ä¸€ä¸ªç”Ÿäº§è€…å¼€å§‹å¾€ä¸»é¢˜å†™å…¥æ¶ˆæ¯æ—¶&lt;/li&gt;
&lt;li&gt;å½“ä¸€ä¸ªæ¶ˆè´¹è€…å¼€å§‹ä»ä¸»é¢˜è¯»å–æ¶ˆæ¯æ—¶&lt;/li&gt;
&lt;li&gt;å½“ä»»æ„ä¸€ä¸ªå®¢æˆ·ç«¯å‘ä¸»é¢˜å‘é€å…ƒæ•°æ®è¯·æ±‚æ—¶&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¨èæ˜¯è®¾ç½®æˆ&lt;code&gt;false&lt;/code&gt;ï¼Œä¸å…è®¸å®¢æˆ·ç«¯ç›´æ¥åˆ›å»ºtopicï¼Œå¦åˆ™topicä¼šæ— æ³•ç®¡ç†ã€‚é»˜è®¤å€¼ä¸º&lt;code&gt;true&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;auto.leader.rebalance.enable&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ˜¯å¦å¼€å¯&lt;code&gt;leader&lt;/code&gt;è‡ªåŠ¨å¹³è¡¡ï¼Œé»˜è®¤å€¼ä¸º&lt;code&gt;true&lt;/code&gt;ã€‚åå°ä¼šæœ‰çº¿ç¨‹è¿›è¡Œå®šæœŸæ£€æŸ¥leaderçš„åˆ†å¸ƒæƒ…å†µ&lt;/p&gt;

&lt;p&gt;kafkaä¸­æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºä¼˜å…ˆå‰¯æœ¬ï¼ˆpreferred replicasï¼‰çš„æ¦‚å¿µ(é€šå¸¸åˆ†åŒºä¼šæœ‰ä¸»åˆ†åŒºå’Œå‰¯æœ¬åˆ†åŒºçš„æ¦‚å¿µï¼Œä¸»åˆ†åŒºå…ˆå†™å…¥ï¼Œç„¶åpushåˆ°å…¶ä»–å‰¯æœ¬åˆ†åŒº)ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ªåˆ†åŒºæœ‰3ä¸ªå‰¯æœ¬ï¼Œä¸”è¿™3ä¸ªå‰¯æœ¬çš„ä¼˜å…ˆçº§åˆ«åˆ†åˆ«ä¸º0,1,2ï¼Œæ ¹æ®ä¼˜å…ˆå‰¯æœ¬çš„æ¦‚å¿µï¼Œ0ä¼šä½œä¸ºleader ã€‚&lt;/p&gt;

&lt;p&gt;å½“0èŠ‚ç‚¹çš„brokeræŒ‚æ‰æ—¶ï¼Œä¼šå¯åŠ¨1è¿™ä¸ªèŠ‚ç‚¹brokerå½“åšleaderã€‚&lt;/p&gt;

&lt;p&gt;å½“0èŠ‚ç‚¹çš„brokerå†æ¬¡å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨æ¢å¤ä¸ºæ­¤partitionçš„leaderã€‚ä¸ä¼šå¯¼è‡´è´Ÿè½½ä¸å‡è¡¡å’Œèµ„æºæµªè´¹ï¼Œè¿™å°±æ˜¯leaderçš„å‡è¡¡æœºåˆ¶(å‰ææ˜¯ç¬¬ä¸€æ¬¡partitionåœ¨åˆ†é…çš„æ—¶å€™ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªç›¸å¯¹å¹³å‡çš„åˆ†é…)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;auto.leader.rebalance.enable=true
# å¯¹åº”å½±å“çš„å…¶ä»–ä¸¤ä¸ªå‚æ•°
# leader.imbalance.per.broker.percentage : æ¯ä¸ªbrokerå…è®¸leaderä¸å¹³è¡¡æ¯”ä¾‹(å¦‚æœæ¯ä¸ªbrokerä¸Šè¶…è¿‡äº†è¿™ä¸ªå€¼ï¼Œcontrollerå°†ä¼š&amp;gt;æ‰§è¡Œåˆ†åŒºå†å¹³è¡¡)ï¼Œé»˜è®¤å€¼10.
# leader.imbalance.check.interval.seconds: ä¸»åˆ†åŒºå†å¹³è¡¡çš„é¢‘ç‡ï¼Œé»˜è®¤å€¼ä¸º300s&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å…¶å®ï¼Œåœ¨é‡è¦ä¸šåŠ¡çš„åœºæ™¯ä¸­ï¼Œéœ€è¦å°†&lt;code&gt;leader.imbalance.per.broker.percentage&lt;/code&gt;å‚æ•°é€‚å½“è°ƒæ•´å°ä¸€äº›ï¼Œä»¥é¿å…brokerä¸­leaderä¸å¹³è¡¡ç‡å¯¼è‡´èŠ‚ç‚¹çš„ååä¸å‡åŒ€&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;num.partitions&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è‡ªåŠ¨åˆ›å»ºtopicçš„é»˜è®¤åˆ†åŒºæ•°ï¼Œé»˜è®¤ä¸º1ï¼Œé€šå¸¸ç”Ÿäº§é›†ç¾¤ä¸å»ºè®®æ‰“å¼€topicè‡ªåŠ¨åˆ›å»ºï¼Œä¸€æ–¹é¢æ˜¯ä¸ä¾¿äºç®¡ç†å’Œè¿½æº¯ï¼Œå¦å¤–ä¸€æ–¹é¢å› ä¸ºè‡ªåŠ¨åˆ›å»ºé»˜è®¤åˆ†åŒºæ—¶1ï¼Œä¸”æ— æ³•åŠ¨æ€å˜æ›´ï¼Œé€ æˆçš„é£é™©å¯èƒ½ä¼šæ¯”è¾ƒå¤§ã€‚&lt;/p&gt;

&lt;p&gt;å¤šåˆ†åŒºçš„topicæœ‰è¿™æ›´å¥½çš„æ•°æ®å¹³è¡¡èƒ½åŠ›ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©æ¶ˆè´¹è€…è¿›è¡Œå¹¶è¡ŒåŒ–æ¶ˆè´¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¯¹äºæœ‰keyçš„æ•°æ®ï¼Œé¿å…æ”¹å˜åˆ†åŒºçš„æ•°é‡&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;default.replication.factor&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€‚ç”¨äºè‡ªåŠ¨åˆ›å»ºçš„ä¸»é¢˜çš„é»˜è®¤å¤åˆ¶å› å­ï¼Œæ¨èè‡³å°‘è®¾ç½®ä¸º2ï¼Œé»˜è®¤ä¸º1&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;min.insync.replicas&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å½“ä½¿ç”¨&lt;code&gt;required.acks=-1(all)&lt;/code&gt;æäº¤åˆ°ç”Ÿäº§è¯·æ±‚æ‰€éœ€çš„ISRä¸­çš„æœ€å°å‰¯æœ¬æ•°ï¼Œé»˜è®¤ä¸º1ï¼Œå»ºè®®åœ¨æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„topicä¸­è®¾ç½®è‡³å°‘ä¸º2&lt;/p&gt;

&lt;p&gt;æŒ‡å®š&lt;code&gt;ISR&lt;/code&gt;çš„æœ€å°æ•°é‡ã€‚å½“producerè®¾ç½®&lt;code&gt;ack=all(-1)&lt;/code&gt;æ—¶ï¼Œè¯¥å€¼æŒ‡å®šçš„å‰¯æœ¬å¿…é¡»å…¨éƒ¨å†™æˆåŠŸï¼Œæ‰è®¤ä¸ºæ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œå¦åˆ™ç”Ÿäº§è€…å°†æŠ›å¼‚å¸¸(&lt;code&gt;either NotEnoughReplicas or NotEnoughReplicasAfterAppend&lt;/code&gt;)&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„&lt;/code&gt;: &lt;code&gt;min.insync.replicas&lt;/code&gt;å‚æ•°å’Œç”Ÿäº§è€…&lt;code&gt;ack&lt;/code&gt;å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥åŠ å¼ºæ•´ä¸ªæ¶ˆæ¯çš„æŒä¹…æ€§&lt;/p&gt;

&lt;p&gt;ç¤ºä¾‹:(3å‰¯æœ¬çš„topic,å¯ä»¥è®¾ç½®è¯¥å€¼ä¸º2,åŒæ—¶ç”Ÿäº§è€…ackè®¾ç½®ä¸ºallï¼Œè¿™å°†ç¡®ä¿å¤§å¤šæ•°å‰¯æœ¬æ²¡æœ‰æ”¶åˆ°å†™æ“ä½œæ—¶ï¼Œç”Ÿäº§è€…ç›´æ¥å¼‚å¸¸)&lt;/p&gt;

&lt;p&gt;é»˜è®¤å€¼ä¸º:&lt;code&gt;1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;unclean.leader.election.enable&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ˜¯å¦å¯ç”¨ä¸åœ¨ISRé›†ä¸­çš„å‰¯æœ¬ä»¥é€‰ä½œé¢†å¯¼è€…ï¼Œå³ä½¿è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚è¯¥å‚æ•°å¯ä»¥æé«˜æ•´ä½“Topicçš„å¯ç”¨æ€§ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆæ•°æ®çš„æ•´ä½“ä¸ä¸€è‡´æ€§(éƒ¨åˆ†æ•°æ®çš„ä¸¢å¤±)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://kafka.apache.org/24/documentation.html#topicconfigs&#34;&gt;kafkaå¯ç”¨æ€§å’Œå¯é æ€§ä¿è¯&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é»˜è®¤å€¼ä¸º:&lt;code&gt;false&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºfalseï¼Œå°±åªä»ISRä¸­è·å–leaderä¿è¯äº†æ•°æ®çš„å¯é æ€§ï¼Œä½†æ˜¯partitionå°±å¤±æ•ˆäº†ï¼Œ&lt;code&gt;true&lt;/code&gt;åˆ™ä»replicaä¸­è·å–ï¼Œåˆ™å¯ç”¨æ€§å¢å¼ºï¼Œä½†æ˜¯æ•°&amp;gt;æ®å¯èƒ½å­˜åœ¨ä¸¢å¤±æƒ…å†µ&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;  è¯¥å‚æ•°å®é™…ä¸Šåœ¨è®¾ç½®çš„æ—¶å€™ä¹Ÿæœ‰ä¸€å®šçš„äº‰è®®æ€§ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“å‰¯æœ¬æ˜¯æœ‰&lt;code&gt;ISR&lt;/code&gt;çš„ï¼Œå³æ­£åœ¨åŒæ­¥çš„å‰¯æœ¬ï¼Œå¦‚æœå½“å‰çš„brokerå®•&amp;gt;æœºå¯¼è‡´éœ€è¦é€‰ä¸¾leader partitionï¼Œæ­¤æ—¶å¦‚æœISRå†…é™¤äº†leaderä¹‹å¤–è¿˜æœ‰å…¶ä»–å‰¯æœ¬(ä½†è°åˆèƒ½ä¿è¯ä¸€å®šæœ‰å‘¢)ï¼Œé‚£ç›´æ¥ä»ISRä¸­é€‰ä¸¾leader&amp;gt;å³å¯ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå½“&lt;code&gt;auto.leader.rebalance.enable=true&lt;/code&gt;æ—¶ï¼Œå°±ä¼šå»å…¶ä»–å­˜æ´»çš„å‰¯æœ¬ä¸­é€‰ä¸¾leaderï¼Œæ­¤æ—¶å¯ä»¥å¢å¼ºæ•´ä½“çš„å¯ç”¨æ€§ï¼Œä½†æ˜¯å¦‚æœå­˜æ´»çš„å‰¯æœ¬ä¸åœ¨ISRä¸­ï¼Œå³æ„å‘³ç€æ•°æ®å¯èƒ½æœ‰ä¸€å®šçš„ä¸¢å¤±äº†ã€‚ä½†æ˜¯å¦‚æœè¯¥å‚æ•°ä¸ºfalseçš„è¯ï¼ŒISRä¸­æ²¡æœ‰ï¼Œå°±ç›´æ¥å¼‚å¸¸äº†ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°çš„å­˜åœ¨å…¶å®æ˜¯åœ¨å¯ç”¨æ€§å’Œå¯é æ€§ä¹‹é—´åšäº†ä¸€ä¸ªæƒè¡¡ï¼Œä¸ºtrueæ—¶ä¿è¯äº†å¯ç”¨æ€§APï¼Œä¸ºfalseæ—¶ä¿è¯äº†ä¸€è‡´æ€§CP&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ•°æ®ä¸€è‡´æ€§ä¿è¯&lt;/code&gt;: ISRå°±ä¿å­˜äº†kafkaè®¤ä¸ºå¯é çš„å‰¯æœ¬ï¼Œå®ƒä»¬å…·å¤‡è¿™æ ·çš„æ¡ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è½åleaderçš„æ¶ˆæ¯æ¡æ•°åœ¨ä¸€å®šé˜ˆå€¼å†…&lt;/li&gt;
&lt;li&gt;æˆ–è€…è½ååœ¨ä¸€å®šæ—¶é—´å†…ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;num.replica.fetchers&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°æŒ‡å®šäº†fetchçº¿ç¨‹çš„æ•°é‡(ä»æºbrokerä¸­å¤åˆ¶æ¶ˆæ¯çš„fetchçº¿ç¨‹)ï¼Œé»˜è®¤å€¼: &lt;code&gt;1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å…¶å®å¯ä»¥é€‚å½“çš„è°ƒæ•´å¤§ä¸€äº›ï¼Œå¯ä»¥å¢å¼ºå‰¯æœ¬ä¹‹å‰çš„åŒæ­¥æ•ˆç‡ï¼Œè®¾ç½®ä¸º2å¯ä»¥æ»¡è¶³å¤§å¤šæ•°çš„åœºæ™¯&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;num.io.threads&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;brokerå¤„ç†è¯·æ±‚çš„ IO çº¿ç¨‹æ•°ï¼Œéœ€è¦è€ƒè™‘åˆ°ç£ç›˜çš„IOçŠ¶å†µã€‚é»˜è®¤å€¼ä¸º:&lt;code&gt;8&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å€¼é€šå¸¸æƒ…å†µä¸‹åœ¨ç”Ÿäº§ç¯å¢ƒä¹Ÿå¯ä»¥é€‚å½“çš„è°ƒæ•´å¤§ä¸€äº›ï¼Œä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹éœ€è¦è€ƒè™‘åˆ°æ‰€ä½¿ç”¨çš„çš„ç£ç›˜çš„æ•´ä½“æƒ…å†µï¼Œå¯ä»¥å°è¯•è®¾ç½®ä¸º&lt;code&gt;num.network.threads&lt;/code&gt;çš„ä¸¤å€ï¼Œæ¯”å¦‚&lt;code&gt;d1ne.4xlarge&lt;/code&gt;çš„è§„æ ¼å…¶å®å¯ä»¥è®¾ç½®ä¸º20&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;num.network.threads&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šbrokerç”¨æ¥æ¥æ”¶æ¥è‡ªç½‘ç»œçš„è¯·æ±‚å’Œå‘é€ç½‘ç»œçš„å“åº”çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º: &lt;code&gt;3&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œçš„æƒ…å†µä»¥åŠcpuå’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µå°†è¯¥å€¼é»˜è®¤è°ƒå¤§ä¸€äº›ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ä¸ºé€»è¾‘cpuæ ¸å¿ƒçš„2/3éƒ½æ˜¯å¯ä»¥çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒé‡‡ç”¨&lt;code&gt;d1ne.4xlarge&lt;/code&gt;è§„æ ¼çš„å®ä¾‹ï¼Œå¯ä»¥è®¾ç½®è¯¥å€¼ä¸º10&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;background.threads&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åå°ä»»åŠ¡å¤„ç†çº¿ç¨‹æ•°(ä¾‹å¦‚è¿‡æœŸæ¶ˆæ¯åˆ é™¤ç­‰)ã€‚é»˜è®¤å€¼ä¸º:&lt;code&gt;10&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;socketç›¸å…³&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;socket.send.buffer.bytes: (socketå‘é€ç¼“å†²åŒº:SO_SNDBUFF) é»˜è®¤å€¼:&lt;code&gt;102400&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;socket.receive.buffer.bytes: (socketæ¥æ”¶ç¼“å†²åŒº:SO_RCVBUFF) é»˜è®¤å€¼:&lt;code&gt;102400&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;socket.request.max.bytes: (è¯·æ±‚æœ€å¤§å€¼ï¼Œmessage.max.bytesè¦å°äºè¯¥å€¼è¾ƒå¥½) é»˜è®¤å€¼:&lt;code&gt;104857600&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¦‚æœæ¶‰åŠåˆ°å¤šå¯ç”¨åŒºï¼Œæˆ–å¤šæœºæˆ¿ç¯å¢ƒæ—¶ï¼Œsocketç¼“å†²åŒºçš„é»˜è®¤å€¼ä¹Ÿæ˜¯æœ‰ç‚¹å°çš„ï¼Œå› æ­¤å°è¯•å¯ä»¥å°è¯•å°†è¯¥å€¼è®¾ç½®ä¸º&lt;code&gt;1M&lt;/code&gt;æˆ–è€…&lt;code&gt;2M&lt;/code&gt;ï¼Œå³&lt;code&gt;socket.send.buffer.bytes=2097152/1048576&lt;/code&gt;ï¼Œç”Ÿäº§ç¯å¢ƒæ¨èä¼˜åŒ–è¯¥å‚æ•°&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;message.max.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å€¼è¡¨ç¤ºkafkaå…è®¸çš„æœ€å¤§çš„batchå¤§å°(ä¸æ˜¯å•ä¸ªmessageçš„å¤§å°)ï¼Œé»˜è®¤å€¼ä¸º&lt;code&gt;1000012&lt;/code&gt;ï¼Œå³1MB.&lt;/p&gt;

&lt;p&gt;åœ¨æœ€æ–°çš„æ¶ˆæ¯æ ¼å¼ç‰ˆæœ¬ä¸­ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¸€èˆ¬æ¶ˆæ¯çš„æäº¤éƒ½æ˜¯é‡‡ç”¨batchçš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨ä»¥å‰çš„æ¶ˆæ¯æ ¼å¼ç‰ˆæœ¬ä¸­ï¼Œæœªå‹ç¼©çš„è®°å½•ä¸ä¼šåˆ†ç»„æˆæ‰¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤é™åˆ¶ä»…é€‚ç”¨äºå•ä¸ªè®°å½•ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ¯ä¸ªtopicçº§åˆ«å¯ä»¥ä½¿ç”¨&lt;code&gt;max.message.bytes&lt;/code&gt;è®¾ç½®&lt;/p&gt;

&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªé›†ç¾¤æ‰¿æ‹…å¤šç§ä¸šåŠ¡åœºæ™¯ï¼Œé€šå¸¸éœ€è¦å°†è¯¥å€¼è®¾ç½®ä¸ºå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯çš„é…ç½®ï¼Œæ¯”å¦‚&lt;code&gt;4194304&lt;/code&gt;å³&lt;code&gt;4MB&lt;/code&gt;ï¼Œ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;logç›¸å…³(å…·ä½“åˆ°topicçº§åˆ«)&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;log.segment.bytes: å•ä¸ªæ—¥å¿—æ®µ(segment)çš„å¤§å°ï¼Œé»˜è®¤ä¸º&lt;code&gt;1073741824&lt;/code&gt;,å³1GB&lt;/li&gt;
&lt;li&gt;log.segment.delete.delay.ms: æ—¥å¿—æ®µä»æ–‡ä»¶ç³»ç»Ÿä¸­åˆ é™¤å‰ç­‰å¾…çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º&lt;code&gt;60000&lt;/code&gt;ï¼Œå³1min&lt;/li&gt;
&lt;li&gt;log.cleanup.policy: ä¿ç•™çª—å£ä¹‹å¤–çš„æ—¥å¿—æ¸…ç†ç­–ç•¥å¯åŒæ—¶æŒ‡å®šå¤šä¸ªç­–ç•¥å¦‚: [&lt;code&gt;delete&lt;/code&gt;,compact]&lt;/li&gt;
&lt;li&gt;log.cleaner.enable: å¯ç”¨æ—¥å¿—æ¸…é™¤å™¨è¿›ç¨‹ï¼Œå’Œ&lt;code&gt;cleanup.policy = compact&lt;/code&gt;å‚æ•°ç»“åˆä½¿ç”¨ï¼Œé»˜è®¤ä¸º&lt;code&gt;true&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.cleaner.threads: æ—¥å¿—æ¸…ç†çš„åå°çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤ä¸º&lt;code&gt;1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.cleaner.delete.retention.ms: åˆ é™¤çš„æ—¥å¿—ä¿ç•™çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º&lt;code&gt;86400000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.retention.bytes: åˆ é™¤æ—¥å¿—å‰ï¼Œæ—¥å¿—æœ€å¤§çš„å¤§å°ï¼Œè¶…è¿‡è¯¥å€¼å³åˆ é™¤ï¼Œé»˜è®¤&lt;code&gt;-1&lt;/code&gt;ï¼Œä½œç”¨åœ¨æ¯ä¸ªpartitionï¼Œä¼šå½±å“æ•´ä¸ªtopicçš„å®¹é‡&lt;/li&gt;
&lt;li&gt;log.retention.minutes(hours|ms): æ—¥å¿—ä¿ç•™æ—¶é—´ï¼Œå¦‚æœæ²¡æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨hourså‚æ•°&lt;/li&gt;
&lt;li&gt;log.retention.check.interval.ms: æ—¥å¿—æ¸…ç†å™¨æ£€æŸ¥æ—¥å¿—æ˜¯å¦ç¬¦åˆåˆ é™¤æ¡ä»¶çš„é¢‘ç‡ï¼Œé»˜è®¤ä¸º&lt;code&gt;300000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.flush.interval.messages: å°†æ¶ˆæ¯åˆ·æ–°åˆ°ç£ç›˜ä¹‹å‰åœ¨æ—¥å¿—åˆ†åŒºä¸Šç´¯ç§¯çš„æ¶ˆæ¯æ•°ï¼Œé»˜è®¤ä¸º&lt;code&gt;9223372036854775807&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.flush.interval.ms: ä¸»é¢˜ä¸­çš„æ¶ˆæ¯åœ¨åˆ·æ–°åˆ°ç£ç›˜ä¹‹å‰ä¿å­˜åœ¨å†…å­˜ä¸­çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤ä¸º&lt;code&gt;null&lt;/code&gt;(log.flush.scheduler.interval.mså‚æ•°çš„å€¼)&lt;/li&gt;
&lt;li&gt;log.flush.scheduler.interval.ms: æ—¥å¿—åˆ·æ–°å™¨æ£€æŸ¥æ˜¯å¦éœ€è¦å°†æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜çš„é¢‘ç‡ï¼Œé»˜è®¤&lt;code&gt;9223372036854775807&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.flush.offset.checkpoint.interval.ms: æ›´æ–°æœ€åä¸€æ¬¡åˆ·æ–°çš„æŒä¹…è®°å½•(è¢«ä½œä¸ºæ¢å¤ç‚¹)çš„é¢‘ç‡ï¼Œé»˜è®¤ä¸º&lt;code&gt;60000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.flush.start.offset.checkpoint.interval.ms: æ›´æ–°æ—¥å¿—èµ·å§‹åç§»é‡çš„æŒä¹…è®°å½•çš„é¢‘ç‡ï¼Œé»˜è®¤&lt;code&gt;60000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;log.roll.hours: æ–°æ—¥å¿—æ®µ(segment)è¢«åˆ›å»ºå‰çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤&lt;code&gt;168&lt;/code&gt;ï¼Œå¦‚æœæ²¡è®¾ç½®ä¼˜å…ˆä½¿ç”¨&lt;code&gt;log.roll.ms&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;offsetsç›¸å…³&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;offsets.commit.required.acks: offsetæäº¤ä¹‹å‰æ˜¯å¦éœ€è¦ackç¡®è®¤,é»˜è®¤å€¼:&lt;code&gt;-1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;offsets.commit.timeout.ms: å½“åç§»é‡æ³¨æ„&lt;code&gt;_offset&lt;/code&gt;çš„æ‰€æœ‰å‰¯æœ¬æ¥æ”¶åˆ°æäº¤æˆ–è¶…æ—¶è¾¾åˆ°è¯¥æ—¶é—´æ—¶ï¼Œoffsetæäº¤å°†å»¶è¿Ÿ. é»˜è®¤å€¼:&lt;code&gt;5000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;offsets.load.buffer.size: åç§»é‡åŠ è½½åˆ°ç¼“å­˜ä¸­æ—¶ä»åç§»é‡æ®µè¯»å–çš„æ‰¹å¤„ç†å¤§å°. é»˜è®¤å€¼:&lt;code&gt;5242880&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;offsets.retention.check.interval.ms: å†å²offsetæ£€æŸ¥çš„é¢‘ç‡ï¼Œé»˜è®¤å€¼:&lt;code&gt;600000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;offsets.retention.minutes: åœ¨æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å…¨éƒ¨å¼‚å¸¸ä¹‹åï¼Œoffsetä¿ç•™çš„æ—¶é—´ï¼Œé»˜è®¤å€¼:&lt;code&gt;10080&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;offsets.topic.compression.codec: åç§»é‡ä¸»é¢˜çš„å‹ç¼©è§£ç å™¨ï¼Œé»˜è®¤:&lt;code&gt;0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;offsets.topic.num.partitions: offsetæäº¤ä¸»é¢˜çš„åˆ†åŒºæ•°é‡ï¼Œé»˜è®¤:&lt;code&gt;50&lt;/code&gt;(&lt;code&gt;æ³¨æ„:&lt;/code&gt;é›†ç¾¤éƒ¨ç½²åä¸è¦æ”¹å˜)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;offsets.topic.replication.factor&lt;/code&gt;: offsetæäº¤ä¸»é¢˜çš„å‰¯æœ¬æ•°ï¼Œé»˜è®¤:&lt;code&gt;3&lt;/code&gt; (åœ¨é›†ç¾¤å¤§å°æ»¡è¶³æ­¤å¤åˆ¶å› å­è¦æ±‚ä¹‹å‰ï¼Œå†…éƒ¨ä¸»é¢˜åˆ›å»ºå°†&amp;gt;å¤±è´¥,è¯¥ä¸»é¢˜éå¸¸é‡è¦ï¼Œéœ€è¦è¦æ±‚å¼ºä¸€è‡´æ€§)&lt;/li&gt;
&lt;li&gt;offsets.topic.segment.bytes: offsetæäº¤ä¸»é¢˜çš„æ®µå¤§å°ï¼Œè®¾ç½®ç›¸å¯¹è¾ƒå°ï¼Œä»¥ä¾¿æ›´å¿«åœ°å®ç°æ—¥å¿—å‹ç¼©å’Œç¼“å­˜è´Ÿè½½ï¼Œé»˜è®¤å€¼:&lt;code&gt;104857600&lt;/code&gt;ï¼Œå³1Mb&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;queueç›¸å…³&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;queued.max.requests: åœ¨ç½‘ç»œé˜»å¡çº¿ç¨‹å‰ï¼Œæ•°æ®å¹³é¢å…è®¸çš„æ’é˜Ÿè¯·æ±‚æ•°ï¼Œé»˜è®¤å€¼:&lt;code&gt;500&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;replicaç›¸å…³&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;replica.fetch.min.bytes:æ¯ä¸ªfetchå“åº”æ‰€éœ€çš„æœ€å°å­—èŠ‚æ•°ï¼Œé»˜è®¤å€¼:&lt;code&gt;1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;replica.fetch.wait.max.ms: ç”±followå‰¯æœ¬å‘èµ·çš„æ¯ä¸ªfetchè¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œè¯¥å€¼åº”å°äº&lt;code&gt;replica.lag.time.max.ms&lt;/code&gt;ï¼Œä»¥é¿å…
ä¸ºä½ååé‡çš„ä¸»é¢˜é¢‘ç¹åœ°æ”¶ç¼©ISRï¼Œé»˜è®¤å€¼:&lt;code&gt;500&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;replica.lag.time.max.ms: followå‰¯æœ¬åœ¨è¯¥æ—¶é—´å†…æ²¡æœ‰å’Œleaderå‰¯æœ¬åŒæ­¥ï¼Œæˆ–æ²¡æœ‰å‘é€ä»»ä½•åŒæ­¥è¯·æ±‚ï¼Œå°†ä¼šè¢«leaderå‰¯æœ¬ä»ISRä¸­åˆ &amp;gt;é™¤. é»˜è®¤å€¼:&lt;code&gt;10000&lt;/code&gt;ï¼Œå³10s&lt;/li&gt;
&lt;li&gt;replica.socket.receive.buffer.bytes: å‰¯æœ¬æ¥æ”¶è¯·æ±‚çš„ç½‘ç»œç¼“å†²åŒºï¼Œé»˜è®¤å€¼:&lt;code&gt;65535&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;replica.socket.timeout.ms: ç½‘ç»œè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼:&lt;code&gt;30000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;replica.fetch.backoff.ms: å‘ç”Ÿè·å–åˆ†åŒºé”™è¯¯æ—¶è¦ä¼‘çœ çš„æ—¶é—´ï¼Œå‚æ•°ä¸æ˜¯å¾ˆé‡è¦ï¼Œé»˜è®¤å€¼:&lt;code&gt;1000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;replica.fetch.max.bytes: å°è¯•ä¸ºæ¯ä¸ªåˆ†åŒºè·å–çš„æ¶ˆæ¯å­—èŠ‚æ•°ï¼Œå‚æ•°ä¸æ˜¯å¾ˆé‡è¦ï¼Œé»˜è®¤å€¼:&lt;code&gt;1048576&lt;/code&gt;,å³1M&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;broker.rack&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;brokeræ‰€åœ¨çš„æœºæ¶ï¼Œç”¨æ¥æ„ŸçŸ¥æœºæ¶çš„å˜åŒ–ï¼Œé€šå¸¸å¤šä¸ªåˆ†åŒºä¸ä¼šæ”¾åœ¨åŒä¸€ä¸ªæœºæ¶ä¸Š&lt;/p&gt;

&lt;p&gt;ç¤ºä¾‹: &lt;code&gt;RACK1&lt;/code&gt;, &lt;code&gt;us-east-1d&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;controlleræ§åˆ¶å™¨ç›¸å…³&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;controlled.shutdown.enable&lt;/code&gt;: å¯ç”¨æ§åˆ¶å™¨å…³é—­ï¼Œé»˜è®¤:&lt;code&gt;true&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;controlled.shutdown.max.retries: æ§åˆ¶å™¨ä¼šå› ä¸ºå„ç§åŸå› è€Œå®•æœºï¼Œè¯¥å€¼è¡¨ç¤ºæ§åˆ¶å™¨çš„é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤:&lt;code&gt;3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;controlled.shutdown.retry.backoff.ms: åœ¨æ¯æ¬¡é‡è¯•ä¹‹å‰ï¼Œç³»ç»Ÿä»å‰ä¸€æ¬¡æ•…éšœ(æ§åˆ¶å™¨fail overæˆ–å‰¯æœ¬å»¶è¿Ÿ)çš„çŠ¶æ€ä¸­æ¢å¤è¿‡æ¥çš„æ—¶
é—´ï¼Œé»˜è®¤:&lt;code&gt;5000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;controller.socket.timeout.ms&lt;/code&gt;: æ§åˆ¶å™¨åˆ°brokerè§’è‰²è½¬æ¢çš„socketè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤:&lt;code&gt;30000&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;groupç›¸å…³(æ¶ˆè´¹ç»„)&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;group.max.size: æ¶ˆè´¹ç»„ä¸­æœ€å¤§æ¶ˆè´¹è€…æ•°é‡&lt;/li&gt;
&lt;li&gt;group.initial.rebalance.delay.ms:æ³¨å†Œæ¶ˆè´¹è€…å…è®¸çš„æœ€å°ä¼šè¯è¶…æ—¶ï¼Œé»˜è®¤:&lt;code&gt;6000&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¾ˆå¤šå‚æ•°æ˜¯æœ‰ä¸åŒçº§åˆ«çš„ç”Ÿæ•ˆèŒƒå›´çš„ï¼Œæ¯”å¦‚:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;read-only&lt;/code&gt;: ä»…åœ¨brokeré‡å¯åæ‰èƒ½ç”Ÿæ•ˆ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;per-broker&lt;/code&gt;: å¯ä»¥ä¸ºæ¯ä¸ªbrokeråŠ¨æ€æ›´æ–°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cluster-wide&lt;/code&gt;: å¯ä½œä¸ºé›†ç¾¤èŒƒå›´å†…çš„å€¼åŠ¨æ€æ›´æ–°ï¼Œä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªbrokerä¸Šæ›´æ–°è¿›è¡Œæµ‹è¯•&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&#34;http://kafka.apache.org/24/documentation.html#brokerconfigs&#34;&gt;brokeré…ç½®ä½œç”¨èŒƒå›´&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# ZooKeeperåœ°å€
zookeeper.connect=[list of ZooKeeper servers]

# kafka logç›¸å…³é…ç½®
num.partitions=8
default.replication.factor=3
log.dirs=[List of directories. Kafka should have its own dedicated disk(s) or SSD(s).]

# å…¶ä»–é…ç½®æ ¸å¿ƒé…ç½®
broker.id=[An integer. Start with 0 and increment by 1 for each new broker.]
listeners=[list of listeners]
auto.create.topics.enable=false
# æœ€å°çš„isræ•°é‡ï¼Œå¯ä»¥åœ¨topicçº§åˆ«è®¾ç½®
min.insync.replicas=2
queued.max.requests=[number of concurrent requests]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨kafkaé›†ç¾¤ä¸­ï¼Œå½“brokeré›†ç¾¤å‚æ•°ç¡®å®šåï¼Œè¿˜æœ‰ä¸€äº›é’ˆå¯¹topicçš„å‚æ•°æ˜¯å¯ä»¥è¿›è¡ŒåŠ¨æ€è°ƒæ•´çš„ï¼Œä»¥æé«˜kafkaæœåŠ¡çš„çµæ´»æ€§ã€‚&lt;/p&gt;

&lt;h4 id=&#34;4-3-topicçº§åˆ«çš„åŠ¨æ€å‚æ•°è°ƒæ•´&#34;&gt;4.3 Topicçº§åˆ«çš„åŠ¨æ€å‚æ•°è°ƒæ•´&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;http://kafka.apache.org/24/documentation.html#topicconfigs&#34;&gt;Topicçº§åˆ«çš„é…ç½®&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„&lt;/code&gt;: å¦‚ä¸‹topicçš„å‚æ•°å¯ä»¥åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Œä½¿ç”¨&lt;code&gt;kafka-topic.sh&lt;/code&gt;å·¥å…·ä¸­çš„&lt;code&gt;alter&lt;/code&gt;å‚æ•°æ¥ç›´æ¥ä¿®æ”¹topicç›¸å…³çš„å‚æ•°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;cleanup.policy&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯â€œåˆ é™¤â€æˆ–â€œå‹ç¼©â€æˆ–ä¸¤è€…å…¼è€Œæœ‰ä¹‹. é»˜è®¤å€¼: &lt;code&gt;[compact, delete]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;compression.type&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ—¥å¿—å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º&lt;code&gt;producer&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;delete.retention.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç”¨äºæ—¥å¿—å‹ç¼©ä¸»é¢˜çš„åˆ é™¤ä¿ç•™æ—¶é—´ã€‚é»˜è®¤å€¼:&lt;code&gt;86400000&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;max.message.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šæ¯ä¸ªtopicå¯å‘é€çš„æœ€å¤§æ¶ˆæ¯(batch size)å­—èŠ‚æ•°.(åŒºåˆ«äºå…¨å±€çš„&lt;code&gt;message.max.bytes&lt;/code&gt;å‚æ•°)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;num.partitions&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šåˆ›å»ºtopicçš„é»˜è®¤åˆ†åŒºæ•°é‡ï¼Œè¯¥å€¼é»˜è®¤ä¸º1ï¼Œå»ºè®®æ ¹æ®å…·ä½“çš„æƒ…å†µè¿›è¡Œè®¾å®šï¼Œè¶Šå¤šçš„åˆ†åŒºå¯¹äºæµ·é‡æ•°æ®æ¥è¯´å¯ä»¥æé«˜ååï¼Œä½†æ˜¯å¯¹äºå°‘é‡æ•°æ®æ¥è¯´ï¼Œä¹Ÿå¯èƒ½å¢åŠ ç½‘ç»œæ¶ˆè€—.&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå¯¹é»˜è®¤çš„topicçš„åˆ†åŒºè¿›è¡Œè¿‡åº¦åˆ†é…ï¼Œä»¥é˜²æ­¢åæœŸå¸¦keyçš„messageæ‰©å®¹åˆ†åŒºå¯¼è‡´çš„é—®é¢˜ï¼Œä¸€èˆ¬å»ºè®®åˆå§‹å€¼è®¾ç½®ä¸º5-10&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;åˆ†åŒºæ•°ä¸€æ—¦æŒ‡å®šï¼Œåªèƒ½å¢åŠ ï¼Œä¸èƒ½å‡å°‘&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;default.replication.factor&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®škafkaå‰¯æœ¬æ•°ï¼Œé»˜è®¤æ¯ä¸ªä¸»é¢˜åˆ†åŒºå‡æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œå½“è¯¥å‰¯æœ¬æ‰€åœ¨ä¸»æœºå¼‚å¸¸ï¼Œå¯èƒ½é€ æˆæ•°æ®çš„ä¸¢å¤±ï¼Œå»ºè®®åœ¨é€‚å½“åœºæ™¯å°†å‰¯æœ¬è‡³å°‘è®¾ç½®æˆ
2ä¸ªï¼Œä»¥å°½å¿«ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚é»˜è®¤å€¼:&lt;code&gt;1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;è‡ªåŠ¨åˆ›å»ºä¸»é¢˜çš„å‰¯æœ¬å› å­&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;retention.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;kafkaçš„logä¿ç•™æ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code&gt;log.retention.hours&lt;/code&gt;å‚æ•°æ¥é…ç½®ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤168å°æ—¶ï¼Œå³ä¸€å‘¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;retention.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šlogä¿ç•™çš„å¤§å°ï¼Œä½œç”¨åœ¨æ¯ä¸€ä¸ªpartitionä¸Šï¼ŒåŠ å…¥ä¸€ä¸ªtopicæœ‰3ä¸ªpartitionï¼Œè®¾ç½®äº†&lt;code&gt;log.retention.bytes&lt;/code&gt;ä¸º1GBï¼Œåˆ™è¡¨ç¤ºæ•´ä¸ªtopicä»…å¯ä»¥å­˜å‚¨3GBçš„æ•°æ®ï¼Œè¶…è¿‡è¯¥å®¹é‡çš„æ•°æ®ä¼šè¢«è¿›è¡Œè‡ªåŠ¨åˆ é™¤ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤æ—¶ï¼Œä¸´æ—¶å¢åŠ è¯¥topicçš„å®¹é‡çš„æ–¹æ³•å°±æ˜¯è°ƒæ•´è¯¥å‚æ•°ï¼Œæˆ–è°ƒæ•´topicçš„partitionä¸ªæ•°ã€‚&lt;/p&gt;

&lt;p&gt;-1è¡¨ç¤ºä¸é™åˆ¶&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;segment.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šæ¯ä¸ªæ—¥å¿—æ®µçš„å¤§å°ï¼Œé€šå¸¸åœ¨æ¶ˆæ¯åˆ°è¾¾brokeræ—¶ï¼Œä¼šè¢«è¿½åŠ åˆ°åˆ†åŒºçš„å½“å‰æ—¥å¿—æ®µä¸Š(segment)ï¼Œå½“æ—¥å¿—æ®µå¤§å°è¶…è¿‡è¯¥å‚æ•°æŒ‡å®šçš„å€¼(é»˜è®¤1GB)ï¼Œå½“å‰æ—¥å¿—æ®µå°±ä¼šè¢«å…³é—­ï¼Œä¸€ä¸ªæ–°çš„æ—¥å¿—æ®µè¢«æ‰“å¼€ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ªæ—¥å¿—ç‰‡æ®µè¢«å…³é—­ï¼Œå°±å¼€å§‹ç­‰å¾…è¿‡æœŸï¼Œè¯¥å€¼ä¸å»ºè®®è®¾ç½®å¤ªå°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;segment.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šé¢ä¼šæŒ‡å®šæ—¥å¿—æ®µçš„åˆ†å‰²ï¼Œè¯¥å‚æ•°ä¼šæŒ‡å®šå†å²çš„æ—¥å¿—æ®µçš„è¿‡æœŸæ—¶é—´ã€‚è¯¥å‚æ•°ä¼šå’Œ&lt;code&gt;log.retention.bytes&lt;/code&gt;ä¸€èµ·æ ¡éªŒï¼Œè°å…ˆæ»¡è¶³å°±ç”Ÿæ•ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;message.max.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å€¼ç”¨æ¥é™åˆ¶å•ä¸ªæ¶ˆæ¯çš„å¤§å°ï¼Œé»˜è®¤å€¼ä¸º&lt;code&gt;1000 000&lt;/code&gt;å³&lt;code&gt;1MB&lt;/code&gt;ï¼Œå¦‚æœè¶…è¿‡è¯¥å¤§å°ï¼Œbrokerä¸ä¼šæ¥å—ï¼Œè€Œä¸”ä¼šæŠ›å‡ºç›¸å…³å¼‚å¸¸&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;è¯¥å‚æ•°æŒ‡çš„æ˜¯æ¶ˆæ¯è¢«å‹ç¼©åçš„å¤§å°ï¼Œé€šå¸¸ç”Ÿäº§ä¸­çš„æ¶ˆæ¯ç”Ÿäº§ä¼šä½¿ç”¨gzipæˆ–snappyæ¥è¿›è¡Œå‹ç¼©&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;æ¶ˆæ¯çš„å¤§å°å¯¹äºæ€§èƒ½æœ‰æ¯”è¾ƒæ˜¾è‘—çš„å½±å“ï¼Œè¶Šå¤§è´Ÿè´£å¤„ç†ç½‘ç»œè¿æ¥å’Œè¯·æ±‚çš„çº¿ç¨‹å°±éœ€è¦èŠ±è¶Šå¤šçš„æ—¶é—´æ¥å¤„ç†è¿™äº›è¯·æ±‚ï¼Œè¿˜ä¼šå¢åŠ ç£
ç›˜å†™å…¥å—çš„å¤§å°ï¼Œä»è€Œå½±å“ IO ååé‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;file.delete.delay.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä»æ–‡ä»¶ç³»ç»Ÿä¸­åˆ é™¤ä¸€ä¸ªæ–‡ä»¶å‰çš„ç­‰å¾…æ—¶é—´&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;flush.messages&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°å…è®¸æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªé—´éš”æ¥å¼ºåˆ¶åŒæ­¥æ•°æ®åˆ°æœ¬åœ°ç£ç›˜ï¼Œæ¯”å¦‚è®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºæ¯æ¡æ¶ˆæ¯åéƒ½ä¼šæ‰§è¡ŒåŒæ­¥ç£ç›˜ï¼Œå¦‚æœè®¾ç½®ä¸º5è¡¨ç¤ºï¼Œæ¯5ä¸ªæ¶ˆæ¯åŒæ­¥ä¸€æ¬¡ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç®¡æ³•å®šä¸å»ºè®®ä¿®æ”¹è¯¥å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨å‰¯æœ¬æœºåˆ¶æ¥ä¿è¯æŒä¹…æ€§å’Œå¼€å¯æ“ä½œç³»ç»Ÿçš„åå°flushåŠŸèƒ½ï¼Œä¼šæ›´åŠ æœ‰æ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;flush.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŒä¸Šï¼Œä½†æ˜¯æŒ‡å®šçš„æ˜¯æ—¶é—´é—´éš”ã€‚æ¯”å¦‚è®¾ç½®1000ï¼Œè¡¨ç¤º1000msåæ‰§è¡Œä¸€æ¬¡åŒæ­¥æ“ä½œ.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;follower.replication.throttled.replicas&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¯¹æ—¥å¿—å¤åˆ¶çš„å‰¯æœ¬åˆ—è¡¨åº”è¯¥è¢«åœ¨followä¾§è¿›è¡Œé™æµã€‚&lt;/p&gt;

&lt;p&gt;å‰¯æœ¬åˆ—è¡¨åº”è¯¥ä¸º&lt;code&gt;[PartitionId]:[BrokerId],[PartitionId]:[BrokerId]&lt;/code&gt;æ ¼å¼ï¼Œæˆ–è€…ä½¿ç”¨é€šé…ç¬¦&lt;code&gt;*&lt;/code&gt;æ¥è¡¨ç¤ºç»™topicçš„æ‰€æœ‰å‰¯æœ¬è¿›è¡Œé™æµã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;leader.replication.throttled.replicas&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŒä¸Šï¼Œåœ¨leaderä¾§è¿›è¡Œé™æµ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;index.interval.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°ç”¨æ¥æ§åˆ¶å¤šä¹…kafkaä¼šå¢åŠ ä¸€ä¸ªindexå®ä½“æ•°æ®åˆ°å®ƒçš„offsetçš„indexä¸Šã€‚é»˜è®¤è®¾ç½®ç¡®ä¿æˆ‘ä»¬å¤§çº¦æ¯4096å­—èŠ‚ç´¢å¼•ä¸€æ¡æ¶ˆæ¯ã€‚ç´¢å¼•è¶Šå¤šï¼Œè¯»å–è¶Šæ¥è¿‘æ—¥å¿—ä¸­çš„ç¡®åˆ‡ä½ç½®ï¼Œä½†ç´¢å¼•è¶Šå¤§ã€‚é€šå¸¸ä¸éœ€è¦ä¿®æ”¹è¯¥å‚æ•°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;max.message.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¢«kafkaå…è®¸çš„æœ€å¤§è®°å½•çš„batch sizeã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœå¢åŠ äº†è¯¥å€¼ï¼Œå¹¶ä¸”æœ‰æ¶ˆè´¹è€…ç‰ˆæœ¬è€äº&lt;code&gt;0.10.2&lt;/code&gt;ï¼Œæ¶ˆè´¹è€…çš„&lt;code&gt;fetch size&lt;/code&gt;ä¹Ÿå¿…é¡»å¢åŠ ï¼Œè¿™æ ·å°±èƒ½è·å–åˆ°è¯¥æ‰¹æ¬¡å¤§å°çš„æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨é«˜ç‰ˆæœ¬çš„æ¶ˆæ¯æ ¼å¼(message format)ä¸­ï¼Œä¸ºäº†æ•ˆç‡ï¼Œè®°å½•æ€»æ˜¯ä¼šè¢«åˆ†ç»„æˆbatchï¼›è€Œåœ¨ä¹‹å‰çš„æ¶ˆæ¯æ ¼å¼ç‰ˆæœ¬ä¸­ï¼Œæœªè¢«å‹ç¼©çš„æ¶ˆæ¯ä¸ä¼šè¢«åˆ†ç»„æˆbatchï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°ä»…åœ¨å•æ¡è®°å½•ä¸Šç”Ÿæ•ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;message.downconversion.enable&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ­¤é…ç½®ç”¨äºæ§åˆ¶æ˜¯å¦å¯ç”¨æ¶ˆæ¯æ ¼å¼çš„å‘ä¸‹å…¼å®¹ä»¥æ»¡è¶³æ¶ˆè´¹è€…è¯·æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;å½“è®¾ç½®æˆ&lt;code&gt;false&lt;/code&gt;ï¼Œå¯¹äºå¸Œæœ›ä½¿ç”¨è¾ƒæ—§æ¶ˆæ¯æ ¼å¼çš„æ¶ˆè´¹è€…æ¥è¯´ï¼Œbrokerå°†ä¸ä¼šæ‰§è¡Œå‘ä¸‹è½¬æ¢ã€‚æ¥è‡ªæ—§å®¢æˆ·ç«¯çš„æ¶ˆè´¹è€…è¯·æ±‚ï¼Œbrokerå°†ä¼šè¿”å›&lt;code&gt;UNSUPPORTED_VERSION&lt;/code&gt;é”™è¯¯ç ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤é…ç½®ä¸é€‚ç”¨äºå¯èƒ½éœ€è¦å¤åˆ¶åˆ°followerçš„æ¶ˆæ¯æ ¼å¼è½¬æ¢ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;message.format.version&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šæ¶ˆæ¯æ ¼å¼ç‰ˆæœ¬ï¼Œbrokerå°†ä½¿ç”¨&lt;code&gt;append&lt;/code&gt;æ–¹å¼è¿½åŠ messageåˆ°logé‡Œã€‚è¯¥å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯ç”¨çš„ApiVersionï¼Œæ¯”å¦‚&lt;code&gt;0.8.2, 0.9.0.0, 0.10.0&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡è®¾ç½®ç‰¹å®šçš„æ¶ˆæ¯æ ¼å¼ç‰ˆæœ¬ï¼Œç”¨æˆ·å¯ä»¥éªŒè¯å·²å­˜åœ¨ç£ç›˜ä¸Šçš„æ¶ˆæ¯æ˜¯å¦å°äºæˆ–è€…ç­‰äºæŒ‡å®šçš„ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;é”™è¯¯åœ°è®¾ç½®æ­¤å€¼å°†å¯¼è‡´ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„ä½¿ç”¨è€…ä¸­æ–­ï¼Œå› ä¸ºä»–ä»¬å°†æ”¶åˆ°ä»–ä»¬ä¸ç†è§£çš„æ ¼å¼çš„æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;message.timestamp.difference.max.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;brokeræ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶é—´æˆ³å’Œåœ¨æ¶ˆæ¯ä½“å†…éƒ¨çš„æ—¶é—´æˆ³çš„æœ€å¤§æ—¶é—´å·®è·ã€‚å¦‚æœ&lt;code&gt;message.timestamp.type=CreateTime&lt;/code&gt;ï¼Œå½“æ—¶é—´æˆ³çš„å·®å€¼å¤§äºè¯¥å€¼ï¼Œä¸€ä¸ªmessageå°†è¢«æ‹’ç»ã€‚å¦‚æœ&lt;code&gt;message.timestamp.type=LogAppendTime&lt;/code&gt;ï¼Œè¯¥å‚æ•°å°†è¢«å¿½ç•¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;message.timestamp.type&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šmessageä¸­æ—¶é—´æˆ³çš„ç±»å‹ã€‚&lt;code&gt;CreateTime&lt;/code&gt;æˆ–&lt;code&gt;LogAppendTime&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;min.cleanable.dirty.ratio&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°ç”¨äºæ§åˆ¶ï¼Œæ—¥å¿—å‹ç¼©å™¨(log compactor)å°†å°è¯•æ¸…é™¤æ—¥å¿—çš„é¢‘ç‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†é¿å…æ¸…é™¤å·²å‹ç¼©è¶…è¿‡50ï¼…çš„æ—¥å¿—çš„æ—¥å¿—ã€‚è¿™ä¸ªæ¯”ç‡é™åˆ¶äº†æœ€å¤§ç©ºé—´æµªè´¹(æ—¥å¿—ä¸­çš„é‡å¤,50%æˆ–50%ä»¥ä¸Šçš„æ—¥å¿—é‡å¤)ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”ç‡è¶Šé«˜ï¼Œæ„å‘³ç€è¶Šå°‘ï¼Œæ›´æœ‰æ•ˆçš„æ¸…ç†ï¼Œä½†æ˜¯ä¹Ÿæ„å‘³ç€æ›´å¤šçš„æ—¥å¿—ç©ºé—´æµªè´¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;min.compaction.lag.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸€æ¡æ¶ˆæ¯ä¿æŒæœªå‹ç¼©çš„æœ€å°æ—¶é—´ã€‚ä»…é€‚ç”¨äºæ­£åœ¨å‹ç¼©çš„æ—¥å¿—ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;h4 id=&#34;4-3-produceræ ¸å¿ƒå‚æ•°&#34;&gt;4.3 Produceræ ¸å¿ƒå‚æ•°&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;bootstrap.servers&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šbrokeråœ°å€&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;key.serializer&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;broker éœ€è¦æ¥æ”¶åˆ°åºåˆ—åŒ–ä¹‹åçš„&lt;code&gt;k/v&lt;/code&gt;å€¼ï¼Œæ‰€ä»¥ç”Ÿäº§è€…éœ€è¦å°†åºåˆ—åŒ–åçš„å€¼å‘é€è¿‡æ¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;org.apache.kafka.common.serialization.Serializer&lt;/code&gt;è¯¥ç±»è¡¨ç¤ºæŠŠé”®å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ByteArraySerializer: é»˜è®¤çš„åºåˆ—åŒ–æ–¹å¼&lt;/li&gt;
&lt;li&gt;StringSerializer:&lt;/li&gt;
&lt;li&gt;IntegerSerializer:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;value.serializer&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šåºåˆ—åŒ–åçš„valueï¼Œéœ€è¦å®ç°&lt;code&gt;org.apache.kafka.common.serialization.Serializer&lt;/code&gt;æ¥å£&lt;/p&gt;

&lt;p&gt;&lt;code&gt;org.apache.kafka.common.serialization.StringSerializer&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;compression.type&lt;/strong&gt;
æŒ‡å®šæ¶ˆæ¯å‹ç¼©ç±»å‹:gzip,snappyç­‰ï¼Œ&lt;/p&gt;

&lt;p&gt;brokerç«¯ä¹Ÿæœ‰è¯¥å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º:&lt;code&gt;producer&lt;/code&gt;ï¼Œè¡¨ç¤ºéµå¾ªç”Ÿäº§è€…çš„å‹ç¼©æ–¹å¼&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;ç”Ÿäº§è€…ä½¿ç”¨ä½•ç§å‹ç¼©æ–¹å¼ï¼Œæ¶ˆè´¹è€…å°†å¿…é¡»ä½¿ç”¨è¯¥æ–¹å¼è¿›è¡Œè§£å‹ç¼©&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;acks&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°ç”¨æ¥å£°æ˜è¦æœ‰å¤šå°‘ä¸ªåˆ†åŒºå‰¯æœ¬æ¥æ”¶æ¶ˆæ¯åï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºæ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸€è‡´æ€§è¡¡é‡ï¼Œè¯¥å‚æ•°å¯¹æ¶ˆæ¯çš„ä¸¢å¤±çš„å½±å“è¾ƒ&amp;gt;å¤§. é»˜è®¤å€¼ä¸º:&lt;code&gt;1&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;acks=0&lt;/code&gt;: è¡¨ç¤ºç”Ÿäº§è€…ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦è¢«brokeræˆåŠŸæ¥æ”¶è¢«å¤„ç†ï¼Œåæ­£è‡ªå·±å‘å‡ºå»äº†å°±è®¤ä¸ºæ˜¯æˆåŠŸäº†ï¼Œè¯¥ç§æ¸…ç†å¢åŠ äº†ååï¼Œä½†æ˜¯ä¹Ÿ&amp;gt;å¢åŠ çš„æ•°æ®ä¸¢å¤±çš„é£é™©ï¼Œå› ä¸ºç¨‹åºçš„ç¨³å®šæ€§ï¼Œç½‘ç»œçš„ç¨³å®šæ€§éƒ½å¯èƒ½ä¼šå½±å“åˆ°æ¶ˆæ¯çš„ç”Ÿäº§&lt;/li&gt;
&lt;li&gt;&lt;code&gt;acks=1&lt;/code&gt;: åªè¦é›†ç¾¤ä¸­leaderæ¥æ”¶åˆ°æ¶ˆæ¯å¹¶æˆåŠŸå¤„ç†ï¼Œå°±è¿”å›ç»™ç”Ÿäº§è€…å†™å…¥æˆåŠŸçš„æ¶ˆæ¯ã€‚è¯¥ç§æƒ…å†µï¼Œå¦‚æœå‘é€è¿‡ç¨‹ä¸­ç½‘ç»œå‡ºç°é—®é¢˜æˆ–&amp;gt;è€…kafkaé›†ç¾¤å¼‚å¸¸å¯¼è‡´leaderæ²¡å·¥ä½œè€Œå¯¼è‡´æ¶ˆæ¯å†™å…¥å¤±è´¥ï¼Œç”Ÿäº§è€…ä¼šå—åˆ°å†™å…¥å¤±è´¥ç›¸å…³çš„å¼‚å¸¸ï¼Œæ­¤æ—¶ç”Ÿäº§è€…å¯è¿›è¡Œé‡è¯•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;acks=all/-1&lt;/code&gt;: è¡¨ç¤ºæ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹éƒ½æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…æ‰ä¼šæ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨ç«¯å†™å…¥æˆåŠŸçš„æ¶ˆæ¯ï¼Œè¯¥ç§æƒ…å†µä¸‹ï¼Œæ•´ä½“çš„æ¶ˆæ¯
ç¡®è®¤å»¶è¿Ÿä¼šæ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯æ•°æ®çš„ä¸€è‡´æ€§ä¹Ÿæ›´å¼ºä¸€äº›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; æ¶ˆæ¯çš„å‘é€å…¶å®ä¹Ÿåˆ†&lt;code&gt;sync&lt;/code&gt;å’Œ&lt;code&gt;async&lt;/code&gt;ï¼Œå³åŒæ­¥å’Œå¼‚æ­¥ï¼Œkafkaä¸ºäº†ä¿è¯æ¶ˆæ¯é«˜æ•ˆä¼ è¾“ä¼šå†³å®šæ˜¯åŒæ­¥å‘é€è¿˜æ˜¯å¼‚æ­¥å‘é€ã€‚å¦‚æœè®©&amp;gt;å®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡å™¨çš„å“åº”(é€šè¿‡è°ƒç”¨get()æ–¹æ³•)ä¹Ÿä¼šå¢åŠ å»¶è¿Ÿï¼Œå¦‚æœé‡‡ç”¨å®¢æˆ·ç«¯å›è°ƒæ–¹å¼ï¼Œå»¶è¿Ÿé—®é¢˜å¯èƒ½ä¼šæœ‰å¥½è½¬ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;buffer.memory&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°ç”¨æ¥è®¾ç½®ç”Ÿäº§è€…å†…å­˜ç¼“å†²åŒºçš„å¤§å°ï¼Œç”Ÿäº§è€…ä¼šç”¨å®ƒæ¥ç¼“å†²è¦å‘é€åˆ°æœåŠ¡å™¨çš„æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥æä¾›æ¶ˆæ¯ä¼ é€’çš„æ•ˆç‡ã€‚é»˜è®¤å€¼:&lt;code&gt;33554432&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;å¦‚æœåº”ç”¨ç¨‹åºå‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¶…è¿‡å‘é€åˆ°æœåŠ¡å™¨çš„é€Ÿåº¦ï¼Œä¼šå¯¼è‡´ç”Ÿäº§è€…ç©ºé—´ä¸è¶³ï¼Œæ­¤æ—¶&lt;code&gt;send()&lt;/code&gt;æ–¹æ³•å°±ä¼šé˜»å¡æˆ–è€…ç›´æ¥å¼‚å¸¸ï¼Œå–
å†³äº&lt;code&gt;block.on.buffer.null&lt;/code&gt;å‚æ•°&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;retries&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç”Ÿäº§è€…ä»æœåŠ¡å™¨æ”¶åˆ°çš„é”™è¯¯æœ‰å¯èƒ½æ˜¯ä¸´æ—¶æ€§çš„é”™è¯¯ï¼Œæ¯”å¦‚æš‚æ—¶æ‰¾ä¸åˆ°&lt;code&gt;leader&lt;/code&gt;æˆ–è€…å½“å‰partitionæ­£åœ¨è¿ç§»æ— æ³•æ‰¾åˆ°ç›¸å…³çš„partitionï¼Œ&amp;gt;è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°å¯ä»¥å†³å®šç”Ÿäº§è€…çš„è¡Œä¸ºï¼Œå¦‚æœé‡è¯•æ¬¡æ•°è¶…è¿‡ä¹‹åï¼Œç”Ÿäº§è€…å°±ä¼šæ”¾å¼ƒé‡è¯•ï¼Œå¹¶è¿”å›é”™è¯¯ã€‚&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…åœ¨æ¯æ¬¡é‡è¯•ä¹‹é—´ç­‰å¾…100msï¼Œè¿™ä¸ªç­‰å¾…å‚æ•°å¯ä»¥é€šè¿‡&lt;code&gt;retry.backoff.ms&lt;/code&gt;æ¥ä¿®æ”¹&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;batch.size&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šæ¯æ¬¡æäº¤çš„batchå¤§å°ï¼Œé»˜è®¤å€¼:&lt;code&gt;16384&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å½“æœ‰å¤šä¸ªæ¶ˆæ¯éœ€è¦è¢«å‘é€&lt;code&gt;åŒä¸€ä¸ªåˆ†åŒº&lt;/code&gt;(å¦‚ä½•å†³å®šæ˜¯å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒº?)æ—¶ï¼Œç”Ÿäº§è€…ä¼šæŠŠä»–ä»¬å‘é€åˆ°åŒä¸€ä¸ªæ‰¹æ¬¡é‡Œ.&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°ç”¨æ¥æŒ‡å®šä¸€ä¸ªæ‰¹æ¬¡æäº¤çš„å¤§å°ï¼Œå½“è¾¾åˆ°è¯¥batchçš„å¤§å°ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯ä¼šè¢«ç»Ÿä¸€å‘é€è‡³broker&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;client.id&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°ç”¨æ¥æŒ‡å®šå®¢æˆ·ç«¯çš„idï¼Œä¸è¿‡å¯ä»¥ä¸ç”¨æŒ‡å®šï¼Œæ³¨å†Œåä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆ64ä¸ºçš„id&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;max.in.flight.requests.per.connection&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ­¤å‚æ•°æŒ‡å®šäº†ç”Ÿäº§è€…åœ¨æ”¶åˆ°æœåŠ¡å™¨å“åº”ä¹‹å‰å¯ä»¥å‘é€å¤šå°‘æ¶ˆæ¯ï¼Œå®ƒçš„å€¼è¶Šé«˜ï¼Œå°±ä¼šå ç”¨è¶Šå¤šçš„å†…å­˜ï¼Œä¸è¿‡ä¹Ÿä¼šæé«˜ååé‡&lt;/p&gt;

&lt;p&gt;æŠŠå®ƒè®¾ä¸º1 å¯ä»¥ä¿è¯æ¶ˆæ¯æ˜¯&lt;code&gt;æŒ‰ç…§å‘é€çš„é¡ºåº&lt;/code&gt;å†™å…¥æœåŠ¡å™¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;timeoutç›¸å…³å‚æ•°&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;request.timeout.ms&lt;/code&gt;: ç”Ÿäº§è€…åœ¨å‘é€æ•°æ®æ—¶ç­‰å¾…æœåŠ¡å™¨è¿”å›çš„å“åº”æ—¶é—´ï¼Œé»˜è®¤å€¼:&lt;code&gt;30000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metadata.fetch.timeout.ms&lt;/code&gt;: æŒ‡å®šäº†ç”Ÿäº§è€…åœ¨è·å–å…ƒæ•°æ®ï¼ˆæ¯”å¦‚ç›®æ ‡åˆ†åŒºçš„é¦–é¢†æ˜¯è°ï¼‰æ—¶ç­‰å¾…æœåŠ¡å™¨è¿”å›å“åº”çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;timeout.ms&lt;/code&gt;: æŒ‡å®šäº† broker ç­‰å¾…åŒæ­¥å‰¯æœ¬è¿”å›æ¶ˆæ¯ç¡®è®¤çš„æ—¶é—´ï¼Œä¸ asks çš„é…ç½®ç›¸åŒ¹é…&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;max.block.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ­¤å‚æ•°æŒ‡å®šäº†åœ¨è°ƒç”¨ send() æ–¹æ³•æˆ–ä½¿ç”¨ partitionFor() æ–¹æ³•è·å–å…ƒæ•°æ®æ—¶ç”Ÿäº§è€…çš„é˜»å¡æ—¶é—´.&lt;/p&gt;

&lt;p&gt;å½“ç”Ÿäº§è€…çš„å‘é€ç¼“å†²åŒºå·²æ•ï¼Œæˆ–è€…æ²¡æœ‰å¯ç”¨çš„å…ƒæ•°æ®æ—¶ï¼Œè¿™äº›æ–¹æ³•å°±ä¼šé˜»å¡ï¼Œé˜»å¡æ—¶é—´è¶…è¿‡è¯¥å‚æ•°å€¼æ—¶ï¼Œç”Ÿäº§è€…æŠ›å‡ºå¼‚å¸¸&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;max.request.size&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¥å‚æ•°ç”¨äºæ§åˆ¶ç”Ÿäº§è€…å‘é€çš„&lt;code&gt;è¯·æ±‚å¤§å°&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;å®ƒå¯ä»¥æŒ‡èƒ½å‘é€çš„å•ä¸ªæ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å•ä¸ªè¯·æ±‚é‡Œæ‰€æœ‰æ¶ˆæ¯çš„æ€»å¤§å°&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;receive.buffer.byteså’Œsend.buffer.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºäº†ä¿è¯å¯é çš„æ¶ˆæ¯ä¼ è¾“ï¼Œè¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æŒ‡å®šäº† TCP Socket &lt;code&gt;æ¥æ”¶å’Œå‘é€æ•°æ®åŒ…çš„ç¼“å†²åŒº&lt;/code&gt;çš„å¤§å°ï¼Œé»˜è®¤ä¸º-1ï¼Œè¡¨ç¤ºä½¿ç”¨æ“ä½œç³»ç»Ÿçš„&amp;gt;é»˜è®¤å€¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å¦‚æœç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ä¸brokeræ‰€å¤„çš„æ•°æ®ä¸­å¿ƒä¸åŒï¼Œè¯¥å€¼å¯ä»¥é€‚å½“è°ƒå¤§&lt;/p&gt;

&lt;h4 id=&#34;4-4-consumeræ ¸å¿ƒå‚æ•°&#34;&gt;4.4 Consumeræ ¸å¿ƒå‚æ•°&lt;/h4&gt;

&lt;p&gt;åœ¨æ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…é‡å¹³è¡¡æœŸé—´ï¼Œæ¶ˆè´¹è€…æ— æ³•è¯»å–æ¶ˆæ¯ï¼Œé€ æˆæ•´ä¸ªæ¶ˆè´¹è€…ç»„åœ¨é‡å¹³è¡¡çš„æœŸé—´éƒ½ä¸å¯ç”¨&lt;/p&gt;

&lt;p&gt;æ¶ˆè´¹è€…é€šè¿‡å‘ç»„ç»‡åè°ƒè€…ï¼ˆKafka Brokerï¼‰å‘é€å¿ƒè·³æ¥ç»´æŠ¤è‡ªå·±æ˜¯æ¶ˆè´¹è€…ç»„çš„ä¸€å‘˜å¹¶ç¡®è®¤å…¶æ‹¥æœ‰çš„åˆ†åŒºã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºä¸åŒæ­¥çš„æ¶ˆè´¹ç¾¤ä½“æ¥è¯´ï¼Œå…¶ç»„ç»‡åè°ƒè€…å¯ä»¥æ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;

&lt;p&gt;åªè¦æ¶ˆè´¹è€…å®šæœŸå‘é€å¿ƒè·³ï¼Œå°±ä¼šè®¤ä¸ºæ¶ˆè´¹è€…æ˜¯å­˜æ´»çš„å¹¶å¤„ç†å…¶åˆ†åŒºä¸­çš„æ¶ˆæ¯ã€‚å½“æ¶ˆè´¹è€…æ£€ç´¢è®°å½•æˆ–è€…æäº¤å®ƒæ‰€æ¶ˆè´¹çš„è®°å½•æ—¶å°±ä¼šå‘é€å¿ƒ&amp;gt;è·³ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€æ®µæ—¶é—´ï¼Œæ¶ˆè´¹è€…ä¸å‘é€å¿ƒè·³äº†ï¼Œä¼šè¯ï¼ˆSessionï¼‰å°±ä¼šè¿‡æœŸï¼Œç»„ç»‡åè°ƒè€…å°±ä¼šè®¤ä¸ºè¿™ä¸ª Consumer å·²ç»æ­»äº¡ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡é‡å¹³è¡¡
ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ¶ˆè´¹è€…å®•æœºå¹¶ä¸”åœæ­¢å‘é€æ¶ˆæ¯ï¼Œç»„ç»‡åè°ƒè€…ä¼šç­‰å¾…å‡ ç§’é’Ÿï¼Œç¡®è®¤å®ƒæ­»äº¡äº†æ‰ä¼šè§¦å‘é‡å¹³è¡¡.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œç»„é‡Œçš„æ¶ˆè´¹è€…å°†ä¸å¤„ç†æ¶ˆæ¯(STW)&lt;/p&gt;

&lt;p&gt;&lt;code&gt;_consumer_offset&lt;/code&gt;ä¸»é¢˜å°±ä¸»è¦æ˜¯ç”¨æ¥è®°å½•ç›¸å…³æ¶ˆè´¹è€…çš„åç§»é‡ä»¥åŠæ¶ˆè´¹è€…åˆ†åŒºåˆ†é…çš„&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;fetch.min.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šäº†æ¶ˆè´¹è€…ä»æœåŠ¡å™¨è·å–è®°å½•çš„æœ€å°å­—èŠ‚æ•°ï¼Œé»˜è®¤:&lt;code&gt;1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;broker åœ¨æ”¶åˆ°æ¶ˆè´¹è€…çš„æ•°æ®è¯·æ±‚æ—¶ï¼Œå¦‚æœå¯ç”¨çš„æ•°æ®é‡å°äº fetch.min.bytes æŒ‡å®šçš„å¤§å°ï¼Œé‚£ä¹ˆå®ƒä¼šç­‰åˆ°æœ‰è¶³å¤Ÿçš„å¯ç”¨æ•°æ®æ—¶æ‰æŠŠå®ƒ&amp;gt;è¿”å›ç»™æ¶ˆè´¹è€…ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ ·å¯ä»¥é™ä½æ¶ˆè´¹è€…å’Œ broker çš„å·¥ä½œè´Ÿè½½ï¼Œå› ä¸ºå®ƒä»¬åœ¨ä¸»é¢˜ä½¿ç”¨é¢‘ç‡ä¸æ˜¯å¾ˆé«˜çš„æ—¶å€™å°±ä¸ç”¨æ¥å›å¤„ç†æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ²¡æœ‰å¾ˆå¤šå¯ç”¨æ•°æ®ï¼Œä½†æ¶ˆè´¹è€…çš„ CPU ä½¿ç”¨ç‡å¾ˆé«˜ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠè¯¥å±æ€§çš„å€¼è®¾å¾—æ¯”é»˜è®¤å€¼å¤§ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ¶ˆè´¹è€…çš„æ•°é‡æ¯”è¾ƒå¤šï¼ŒæŠŠè¯¥å±æ€§çš„å€¼è°ƒå¤§å¯ä»¥é™ä½ broker çš„å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;fetch.max.wait.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šé¢å‚æ•°ç”¨æ¥æ§åˆ¶æ¯æ¬¡fetchæ—¶çš„æœ€å°æ•°æ®é‡ï¼Œä½†ä¹Ÿä¸èƒ½ä¸€ç›´ç­‰å¾…æ•°æ®çš„å®¹é‡æ»¡è¶³è¦æ±‚ï¼Œå› æ­¤è¿˜æœ‰å¦å¤–ä¸€ä¸ªå‚æ•°ï¼Œå³&lt;code&gt;fetch.max.wait.ms&lt;/code&gt;ï¼ŒæŒ‡å®šå¤šé•¿æ—¶é—´è¿˜æ²¡æ»¡è¶³æ•°æ®å®¹é‡å°±è¿›è¡Œfetchæ•°æ®ï¼Œé»˜è®¤æ˜¯&lt;code&gt;500ms&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;max.partition.fetch.bytes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šäº†æœåŠ¡å™¨ä»æ¯ä¸ªåˆ†åŒºé‡Œè¿”å›ç»™æ¶ˆè´¹è€…çš„&lt;code&gt;æœ€å¤§å­—èŠ‚æ•°&lt;/code&gt;ï¼Œé»˜è®¤å€¼ä¸º&lt;code&gt;1MB&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;å³&lt;code&gt;KafkaConsumer.poll()&lt;/code&gt;æ–¹æ³•ä»æ¯ä¸ªåˆ†åŒºè¿”å›çš„è®°å½•æœ€å¤šä¸è¶…è¿‡è¯¥å€¼æŒ‡å®šçš„å¤§å°ã€‚&lt;/p&gt;

&lt;p&gt;åŠ å…¥ä¸€ä¸ª20åˆ†åŒºçš„ä¸»é¢˜ï¼Œæ‹¥æœ‰5ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆæ¯ä¸ªæ¶ˆè´¹è€…å¿…é¡»è‡³å°‘&lt;code&gt;4MB&lt;/code&gt;çš„å†…å­˜æ¥æ¥æ”¶æ¶ˆæ¯(æ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹4ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºè¿”å›æ¶ˆ&amp;gt;è´¹è€…çš„æœ€å¤§å­—èŠ‚æ•°1MB)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; è¯¥å‚æ•°çš„è®¾ç½®è¦é€‚å½“çš„è®¾ç½®å¤§ä¸€äº›ï¼Œé˜²æ­¢å•ä¸ªæ¶ˆè´¹è€…å¼‚å¸¸åï¼Œæ•´ä½“å†…å­˜å—é™ã€‚&lt;/p&gt;

&lt;p&gt;è‡³å°‘ï¼Œè¯¥å‚æ•°çš„å€¼è¦å¤§äº&lt;code&gt;max.message.size&lt;/code&gt;(brokeræ¥æ”¶æ¶ˆæ¯çš„æœ€å¤§å­—èŠ‚æ•°)ï¼Œå¦åˆ™æ¶ˆè´¹è€…æ— æ³•è¯»å–è¿™äº›æ¶ˆæ¯ï¼Œå¯¼è‡´æ¶ˆè´¹è€…ä¸€ç›´é‡è¯•å¹¶&amp;gt;æŒ‚èµ·ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;session.timeout.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šäº†æ¶ˆè´¹è€…åœ¨è¢«è®¤ä¸ºæ­»äº¡ä¹‹å‰å¯ä»¥ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 3sï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰å‘é€å¿ƒè·³å°±ä¼šç›´æ¥è®¤ä¸ºæ¶ˆè´¹è€…æ­»äº¡ï¼Œæ­¤æ—¶
åè°ƒå™¨å°±ä¼šè¿›è¡Œè§¦å‘consumer rebalance.&lt;/p&gt;

&lt;p&gt;æ­¤å‚æ•°ä¸&lt;code&gt;heartbeat.interval.ms&lt;/code&gt;(poll() æ–¹æ³•å‘ç¾¤ç»„åè°ƒå™¨å‘é€å¿ƒè·³çš„é¢‘ç‡)å¼ºç›¸å…³ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;auto.offset.reset&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šäº†æ¶ˆè´¹è€…åœ¨è¯»å–ä¸€ä¸ªæ²¡æœ‰åç§»é‡çš„åˆ†åŒºæˆ–è€…åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹çš„è¯¥å¦‚ä½•å¤„ç†ï¼Œé»˜è®¤å€¼ä¸º&lt;code&gt;latest&lt;/code&gt;ï¼Œæ„æ€æ˜¯åœ¨åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹&amp;gt;ï¼Œé»˜è®¤ä»æœ€æ–°çš„è®°å½•ä¸‹å¼€å§‹è¯»å–æ•°æ®ã€‚å¯é€‰å€¼ä¸º&lt;code&gt;earliest&lt;/code&gt;ï¼Œè¡¨ç¤ºä»æœ€å¼€å§‹ä½ç½®è¿›è¡Œè¯»å–.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;enable.auto.commit&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡å®šäº†æ¶ˆè´¹è€…æ˜¯å¦è‡ªåŠ¨æäº¤åç§»é‡ï¼Œé»˜è®¤å€¼æ˜¯ trueï¼Œå¯¹åº”&lt;code&gt;auto.commit.interval.ms&lt;/code&gt;å‚æ•°æ¥ä¿è¯æ¯æ¬¡æäº¤åç§»é‡çš„é¢‘ç‡&lt;/p&gt;

&lt;p&gt;ä¸ºäº†é¿å…æ•°æ®é‡å¤å’Œä¸¢å¤±ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¾ç½®ä¸ºfalseï¼Œç”±è‡ªå·±å†³å®šè‡ªå·±çš„æ¶ˆè´¹ä½ç½®(å®¢æˆ·ç«¯ä¿è¯æ•°æ®æ¶ˆè´¹çš„ä¸€è‡´æ€§)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;partition.assignment.strategy&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;PartitionAssignor&lt;/code&gt;(åˆ†åŒºåˆ†é…å™¨)ä¼šæ ¹æ®ç»™å®šçš„æ¶ˆè´¹è€…å’Œä¸»é¢˜ï¼Œå†³å®šå“ªäº›åˆ†åŒºåº”è¯¥è¢«åˆ†é…åˆ°å“ªä¸ªæ¶ˆè´¹è€…ï¼Œé»˜è®¤æœ‰ä¸¤ä¸ªç­–ç•¥:&lt;code&gt;Range&lt;/code&gt;å’Œ&lt;code&gt;RoundRobin&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;max.poll.records&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç”¨äºæ§åˆ¶&lt;code&gt;å•æ¬¡è°ƒç”¨call()&lt;/code&gt; æ–¹æ³•èƒ½å¤Ÿè¿”å›çš„è®°å½•æ•°é‡ï¼Œå¯ä»¥å¸®ä½ æ§åˆ¶åœ¨è½®è¯¢ä¸­éœ€è¦å¤„ç†çš„æ•°æ®é‡.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;heartbeat.interval.ms&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ¶ˆè´¹ç»„ä¸­ï¼Œæ¶ˆè´¹è€…å¿ƒè·³åˆ°æ¶ˆè´¹è€…åè°ƒå™¨çš„é¢‘ç‡ï¼Œé»˜è®¤å€¼:&lt;code&gt;3000ms&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;ä¸‰-é›†ç¾¤ç®¡ç†&#34;&gt;ä¸‰ã€é›†ç¾¤ç®¡ç†&lt;/h2&gt;

&lt;p&gt;ä»»ä½•ä¸€æ¬¾ä¼˜ç§€çš„å¼€æºè½¯ä»¶ï¼Œéƒ½ä¼šæä¾›æ¯”è¾ƒä¸°å¯Œçš„é›†ç¾¤ç®¡ç†å·¥å…·æ¥å¸®åŠ©ä½¿ç”¨è€…(ç®¡ç†å‘˜å’Œå®é™…ä½¿ç”¨è€…)æ¥å¯¹é›†ç¾¤è¿›è¡Œæ“ä½œï¼Œè®°ä¸‹æ¥ä»ä¸‰ä¸ªè§’åº¦æ¥å¤§æ¦‚è®²è§£é›†ç¾¤ç®¡ç†ç›¸å…³çš„æ“ä½œã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å®˜æ–¹æä¾›çš„æ“ä½œè„šæœ¬&lt;/li&gt;
&lt;li&gt;kafka-manager&lt;/li&gt;
&lt;li&gt;kafkacat&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;1-å®˜æ–¹å·¥å…·&#34;&gt;1. å®˜æ–¹å·¥å…·&lt;/h3&gt;

&lt;p&gt;åœ¨kafkaçš„å‘è¡ŒåŒ…ä¸­ï¼Œé»˜è®¤åŒ…å«äº†å¦‚ä¸‹ç®¡ç†å·¥å…·è„šæœ¬:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ ls
connect-distributed.sh        kafka-delete-records.sh              kafka-server-stop.sh
connect-mirror-maker.sh       kafka-dump-log.sh                    kafka-streams-application-reset.sh
connect-standalone.sh         kafka-leader-election.sh             kafka-topics.sh
kafka-acls.sh                 kafka-log-dirs.sh                    kafka-verifiable-consumer.sh
kafka-broker-api-versions.sh  kafka-mirror-maker.sh                kafka-verifiable-producer.sh
kafka-configs.sh              kafka-preferred-replica-election.sh  trogdor.sh
kafka-console-consumer.sh     kafka-producer-perf-test.sh          windows
kafka-console-producer.sh     kafka-reassign-partitions.sh         zookeeper-security-migration.sh
kafka-consumer-groups.sh      kafka-replica-verification.sh        zookeeper-server-start.sh
kafka-consumer-perf-test.sh   kafka-run-class.sh                   zookeeper-server-stop.sh
kafka-delegation-tokens.sh    kafka-server-start.sh                zookeeper-shell.sh&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¿™é‡Œä¸»è¦ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„å·¥å…·è„šæœ¬:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¿ç»´ç®¡ç†ç±»&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kafka-topics.sh&lt;/code&gt;: ç”¨æ¥åˆ›å»ºï¼Œåˆ é™¤ï¼ŒæŸ¥çœ‹ï¼Œæ”¹å˜ä¸€ä¸ªtopicå‚æ•°çš„å·¥å…·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-reassign-partitions.sh&lt;/code&gt;: ç”¨æ¥å¯¹partitionè¿›è¡Œé‡æ–°åˆ†é…(ç®¡ç†å‘˜ä¼šè¾ƒå¤šä½¿ç”¨)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-log-dirs.sh&lt;/code&gt;: ç”¨æ¥æŸ¥çœ‹æŒ‡å®šbrokerä¸‹æ—¥å¿—ç›®å½•çš„ä½¿ç”¨ç©ºé—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-leader-election.sh&lt;/code&gt;: ç”¨äºä¸€ç»„Topicåˆ†åŒºçš„leaderé‡æ–°åˆ†é…ï¼Œå¯ä»¥æ”¯æŒä¼˜å…ˆå‰¯æœ¬å’ŒéåŒæ­¥å‰¯æœ¬(ä¸åœ¨ISRä¸­)ï¼Œè€ç‰ˆæœ¬ä¸­çš„kafka-preferred-replica-election.shè„šæœ¬&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-replica-verification.sh&lt;/code&gt;: è¯¥å·¥å…·å¯ä»¥ç”¨æ¥æ£€æŸ¥topicçš„ä¸€ç»„å‰¯æœ¬çš„æ•°æ®æ˜¯å¦ä¸€è‡´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-broker-api-versions.sh&lt;/code&gt;: ç”¨æ¥æŸ¥çœ‹æŒ‡å®šbrokerå½“å‰æ”¯æŒçš„å„ä¸ªæ¥å£çš„ç‰ˆæœ¬(kafkaé«˜ç‰ˆæœ¬å·²ç»ä¿è¯äº†å‘ä¸‹å…¼å®¹)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-configs.sh&lt;/code&gt;: ç”¨æ¥æ“ä½œå’ŒæŸ¥çœ‹topic, client, user or brokerçš„å®ä½“é…ç½®&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;kafkaæ“ä½œç±»&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kafka-console-consumer.sh&lt;/code&gt;: é€šè¿‡ç»ˆç«¯æ¥å¯åŠ¨æ¶ˆè´¹è€…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-console-producer.sh&lt;/code&gt;: é€šè¿‡ç»ˆç«¯æ¥å¯åŠ¨ç”Ÿäº§è€…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-consumer-groups.sh&lt;/code&gt;: ç”¨æ¥æŸ¥çœ‹ï¼Œåˆ é™¤æˆ–è€…é‡ç½®æ¶ˆè´¹è€…ç»„offset&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-consumer-perf-test.sh&lt;/code&gt;: ç”¨æ¥è¿›è¡Œæ¶ˆè´¹è€…å‹åŠ›æµ‹è¯•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-producer-perf-test.sh&lt;/code&gt;: ç”¨æ¥è¿›è¡Œç”Ÿäº§è€…å‹åŠ›æµ‹è¯•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-delete-records.sh&lt;/code&gt;: åˆ é™¤æŒ‡å®šåˆ†åŒºçš„è®°å½•ï¼Œç›´åˆ°æŒ‡å®šçš„offset&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-mirror-maker.sh&lt;/code&gt;: ç”¨äºå¤šé›†ç¾¤ä¹‹é—´åŒæ­¥topicæ•°æ®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-server-start.sh&lt;/code&gt;: brokerå¯åŠ¨è„šæœ¬&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-server-stop.sh&lt;/code&gt;: brokerå…³é—­è„šæœ¬&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kafka-streams-application-reset.sh&lt;/code&gt;: æµå¼åº”ç”¨å·¥å…·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;zookeeper-shell.sh&lt;/code&gt;: kafkaå·¥å…·ä¸­ä¹Ÿé»˜è®¤æä¾›äº†zookeeperç®¡ç†å·¥å…·(ä¸å¤ªå¥½ç”¨)&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;1-1-kafka-topics-sh&#34;&gt;1.1 kafka-topics.sh&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;topicåˆ›å»º&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--create&lt;/code&gt;: åˆ›å»ºtopic&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--topic&lt;/code&gt;: æŒ‡å®štopicåç§°&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--partitions&lt;/code&gt;: æŒ‡å®šåˆ†åŒºæ•°é‡&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--replication-factor&lt;/code&gt;: æŒ‡å®šå‰¯æœ¬æ•°é‡(ä»…åœ¨åˆ›å»ºæ—¶å¯ç”¨)&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--config&lt;/code&gt;: æŒ‡å®štopicçº§åˆ«çš„å‚æ•°(åŠ¨æ€å‚æ•°ï¼Œå¯ä¿®æ”¹)&lt;/li&gt;

&lt;li&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;--replica-assignment&lt;/code&gt;: æ‰‹åŠ¨æŒ‡å®špartitionåˆ°brokerçš„åˆ†é…&lt;part1_replica1:part1_replica2,part2_replica1:part2_replica2&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# åˆ›å»ºtopic
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --create --topic bgbiao.top
Created topic bgbiao.top.

# æŸ¥çœ‹é»˜è®¤åˆ›å»ºtopicçš„å‚æ•°è¯¦æƒ…(ç”±brokeré…ç½®å†³å®š)
# é»˜è®¤3ä¸ªåˆ†åŒºï¼Œ1ä¸ªå‰¯æœ¬
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --describe --topic bgbiao.top
Topic: bgbiao.top	PartitionCount: 3	ReplicationFactor: 1	Configs: min.insync.replicas=1,segment.bytes=1073741824
	Topic: bgbiao.top	Partition: 0	Leader: 1	Replicas: 1	Isr: 1
	Topic: bgbiao.top	Partition: 1	Leader: 2	Replicas: 2	Isr: 2
	Topic: bgbiao.top	Partition: 2	Leader: 3	Replicas: 3	Isr: 3

# æŒ‡å®šå‚æ•°åˆ›å»ºtopic
# æŒ‡å®šåˆ†åŒºä¸º5ï¼Œå‰¯æœ¬ä¸º3ï¼Œtopicæ•°æ®ä¿ç•™2åˆ†é’Ÿ
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --create --topic bgbiao.top-1 --partitions 5 --replication-factor 3 --config retention.ms=120000

# åˆ†åŒºï¼Œå‰¯æœ¬å’ŒæŒ‡å®šå‚æ•°éƒ½æ”¹å˜äº†
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --describe --topic bgbiao.top-1
Topic: bgbiao.top-1	PartitionCount: 5	ReplicationFactor: 3	Configs: min.insync.replicas=1,segment.bytes=1073741824,retention.ms=120000
	Topic: bgbiao.top-1	Partition: 0	Leader: 2	Replicas: 2,3,1	Isr: 2,3,1
	Topic: bgbiao.top-1	Partition: 1	Leader: 3	Replicas: 3,1,2	Isr: 3,1,2
	Topic: bgbiao.top-1	Partition: 2	Leader: 1	Replicas: 1,2,3	Isr: 1,2,3
	Topic: bgbiao.top-1	Partition: 3	Leader: 2	Replicas: 2,1,3	Isr: 2,1,3
	Topic: bgbiao.top-1	Partition: 4	Leader: 3	Replicas: 3,2,1	Isr: 3,2,1&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;topicæ›´æ”¹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; topicçš„åˆ†åŒº(partitions)å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´(åªèƒ½è°ƒæ•´å¤§ï¼Œä¸èƒ½è°ƒæ•´å°)ï¼Œè€Œä¸”åœ¨è°ƒæ•´åˆ†åŒºçš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºä¸€ä¸ªæœ‰&lt;code&gt;key&lt;/code&gt;çš„ä¸»é¢˜æ¥è¯´ï¼Œä¸€æ¡æ¶ˆæ¯çš„åˆ†åŒºé€»è¾‘å’Œé¡ºåºæ€§å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å‰¯æœ¬æ•°ä¸€æ—¦topicåˆ›å»ºä¹‹åï¼Œå°±ä¸èƒ½å†ä¿®æ”¹äº†ï¼Œé™¤éè¿›è¡Œé‡åˆ†é…(å‰¯æœ¬æ•°ä¸èƒ½è¶…è¿‡brokeræ•°é‡å“¦)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--alter&lt;/code&gt;: ä¿®æ”¹åˆ†åŒºæ•°é‡ï¼Œreplicaåˆ†é…ï¼Œæˆ–è€…topicçš„åŠ¨æ€é…ç½®é¡¹(ç»“åˆ&amp;ndash;topicå‚æ•°)&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--partitions&lt;/code&gt;: ä¿®æ”¹æŒ‡å®šTopicçš„åˆ†åŒºæ•°é‡&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--replica-assignment&lt;/code&gt;: æ‰‹åŠ¨æŒ‡å®špartåˆ°brokerçš„åˆ†é…&lt;a href=&#34;p1-r1:p1-r2,p2-r1:p2-r2&#34;&gt;p1-r1:p1-r2,p2-r1:p2-r2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--config&lt;/code&gt;: ä¿®æ”¹topicçš„æŒ‡å®šå‚æ•°(åŠ¨æ€å‚æ•°è°ƒæ•´:key=value)&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--delete-config&lt;/code&gt;: åˆ é™¤topipcçš„æŒ‡å®šå‚æ•°()&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; é€šå¸¸æƒ…å†µä¸‹&lt;code&gt;--replica-assignment&lt;/code&gt;å‚æ•°éœ€è¦å’Œ&lt;code&gt;--partitions&lt;/code&gt;ä¸€åŒä½¿ç”¨æ‰å¯ä»¥æŒ‡å®šåˆ†åŒºä¸‹çš„å‰¯æœ¬åˆ°brokerèŠ‚ç‚¹ä¸Šçš„åˆ†é…ï¼Œç›¸å½“äºæ‰‹åŠ¨æ‰©å®¹è¿ç§»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# ä¸Šé¢æˆ‘ä»¬åˆšå¼€å§‹åˆ›å»ºçš„bgbiao.topçš„topicæ˜¯1ä¸ªåˆ†åŒº1ä¸ªå‰¯æœ¬ï¼Œè¿™é‡Œé‡‡ç”¨alterå‚æ•°è¿›è¡Œä¿®æ”¹åŸºæœ¬é…ç½®
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --alter  --topic bgbiao.top --replica-assignment 1,2,3,1,2 --partitions 5

# å› ä¸ºbgbiao.top è¿™ä¸ªtopicå†åˆ›å»ºæ—¶åªæœ‰ä¸€ä¸ªreplicationï¼Œå› æ­¤--replica-assignmentå‚æ•°åªèƒ½æŒ‡å®šå‰¯æœ¬åˆ†é…åœ¨é‚£ä¸ªbrokerä¸Šï¼Œæ— æ³•æŒ‡å®šå¤šä¸ªå‰¯æœ¬çš„å…³ç³»
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --describe --topic bgbiao.top
Topic: bgbiao.top	PartitionCount: 5	ReplicationFactor: 1	Configs: min.insync.replicas=1,segment.bytes=1073741824
	Topic: bgbiao.top	Partition: 0	Leader: 1	Replicas: 1	Isr: 1
	Topic: bgbiao.top	Partition: 1	Leader: 2	Replicas: 2	Isr: 2
	Topic: bgbiao.top	Partition: 2	Leader: 3	Replicas: 3	Isr: 3
	Topic: bgbiao.top	Partition: 3	Leader: 1	Replicas: 1	Isr: 1
	Topic: bgbiao.top	Partition: 4	Leader: 2	Replicas: 2	Isr: 2

 &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;topicç›¸å…³ä¿¡æ¯æŸ¥çœ‹&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--list&lt;/code&gt;: åˆ—å‡ºtopic&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--describe&lt;/code&gt;: æŸ¥çœ‹topicè¯¦æƒ…ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--topic&lt;/code&gt;: æŒ‡å®štopicæŸ¥çœ‹è¯¦æƒ…ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--exclude-internal&lt;/code&gt;: æ’é™¤å†…éƒ¨topic(consumer_offset_topic)&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--unavailable-partitions&lt;/code&gt;: ä»…æ˜¾ç¤ºleaderä¸å¯ç”¨çš„åˆ†åŒº(åœ¨é›†ç¾¤å¼‚å¸¸æ—¶å¿«é€Ÿæ’æŸ¥å—å½±å“çš„åˆ†åŒº)&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--under-min-isr-partitions&lt;/code&gt;: ä»…æ˜¾ç¤ºisrå°äºé…ç½®çš„min-isr-partitionsçš„åˆ†åŒº&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--under-replicated-partitions&lt;/code&gt;: ä»…æ˜¾ç¤ºä¸åŒæ­¥çš„åˆ†åŒº&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨ä½ç‰ˆæœ¬çš„kafkaä¸­ä½¿ç”¨&amp;ndash;zookeeperæ¥é“¾æ¥é›†ç¾¤ï¼Œé«˜ç‰ˆæœ¬ä¸­åŸºæœ¬éƒ½é€šè¿‡&amp;ndash;bootstrap-serveræŒ‡å®šbrokeræ¥è¿æ¥é›†ç¾¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# åˆ—å‡ºé›†ç¾¤topic
# --listå‚æ•°åˆ—å‡ºå¯ç”¨çš„topic
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --list
__consumer_offsets
....
....

# ä¹Ÿå¯ä»¥ä½¿ç”¨--topicæŒ‡å®štopic
# å¦‚æœæŒ‡å®štopicä¸å­˜åœ¨ï¼Œå°†è¿”å›ç©º
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --list --topic __consumer_offsets
__consumer_offsets

# åˆ—å‡ºtopicè¯¦æƒ…ä¿¡æ¯
# --describeå‚æ•°(åŒæ—¶å¯ä»¥ä½¿ç”¨--topicæŒ‡å®štopicæŸ¥çœ‹)
# --exclude-internalå‚æ•°å¯ä»¥æ’é™¤å†…éƒ¨çš„topic(__consumer_offsets)
# --unavailable-partitionså‚æ•°å¯ä»¥åˆ—å‡ºleaderä¸å¯ç”¨çš„topicï¼Œåœ¨é›†ç¾¤æ•…éšœæ—¶å¿«é€ŸæŸ¥çœ‹å—å½±å“çš„topic
# 
# å¯ä»¥æŸ¥çœ‹æŸä¸ªtopicçš„åˆ†åŒºå’Œå‰¯æœ¬åˆ†å¸ƒï¼Œä»¥åŠtopicçº§åˆ«çš„ç›¸å…³é…ç½®
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --describe --topic __consumer_offsets
Topic: __consumer_offsets	PartitionCount: 50	ReplicationFactor: 1	Configs: compression.type=producer,min.insync.replicas=1,cleanup.policy=compact,segment.bytes=104857600
	Topic: __consumer_offsets	Partition: 0	Leader: 3	Replicas: 3	Isr: 3
	Topic: __consumer_offsets	Partition: 1	Leader: 1	Replicas: 1	Isr: 1
....
....

# æŸ¥çœ‹é›†ç¾¤leaderä¸å¯ç”¨çš„åˆ†åŒº
# å¯ä»¥å‘ç°leaderéƒ½ä¸º-1ï¼Œæ˜¯å› ä¸ºå‰¯æœ¬å’Œisrçš„idæ˜¯4ï¼Œè€Œbroker4å…¶å®å·²ç»å…‰è£é˜µäº¡äº†
$ /opt/app/kafka_2.11-1.0.1/bin/kafka-topics.sh --zookeeper 172.16.217.38:2181/log-kafka --describe --unavailable-partitions
...
	Topic: realtime_kafka.post_alg_real	Partition: 2	Leader: -1	Replicas: 4	Isr: 4
	Topic: realtime_kafka.post_alg_real	Partition: 11	Leader: -1	Replicas: 4	Isr: 4
	Topic: realtime_kafka.post_alg_real	Partition: 20	Leader: -1	Replicas: 4	Isr: 4
	Topic: realtime_kafka.post_alg_real	Partition: 29	Leader: -1	Replicas: 4	Isr: 4
	Topic: rm-bp1d3u2p9v3l4da7c632	Partition: 1	Leader: -1	Replicas: 4	Isr: 4
	Topic: rm-bp1udb05091x11q5x	Partition: 1	Leader: -1	Replicas: 4	Isr: 4

# æŸ¥çœ‹å‰¯æœ¬ä¸åŒæ­¥çš„åˆ†åŒºè¯¦æƒ…
# å¯ä»¥å‘ç°å‰¯æœ¬ä¸­æœ‰ä¸åŒæ­¥çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºæœ‰å‰¯æœ¬æ‰€åœ¨çš„èŠ‚ç‚¹å·²ç»æŒ‚äº†ï¼Œé€šå¸¸æœ‰ä¸€éƒ¨åˆ†æ˜¯å› ä¸ºèµ„æºæˆ–è€…ç½‘ç»œåŸå› æœªåŒæ­¥ï¼Œè¿˜æœ‰å°±æ˜¯å¦‚ä¸Šè¿°brokeré˜µäº¡çš„æƒ…å†µ
# å¦‚æœè¯´--unavailable-partitionså¯ä»¥ç›´æ¥æŸ¥çœ‹åˆ°å—å½±å“çš„topicï¼Œé‚£ä¹ˆ--under-replicated-partitionså°±å¯ä»¥æŸ¥çœ‹å¯ç”¨æ€§å—å½±å“çš„topicï¼Œå› ä¸ºå½“å‰¯æœ¬ä¸º2æ—¶ï¼Œæ­¤æ—¶broker4é˜µäº¡çš„å‰æä¸‹ï¼Œtopicä¸‹çš„åˆ†åŒºæ˜¯æ— æ³•ä¿è¯é«˜å¯ç”¨çš„
$ /opt/app/kafka_2.11-1.0.1/bin/kafka-topics.sh --zookeeper 172.16.217.38:2181/log-kafka --describe --under-replicated-partitions
...
...
	Topic: androidregister	Partition: 1	Leader: 2	Replicas: 4,2	Isr: 2
	Topic: eventjsonlog	Partition: 11	Leader: 2	Replicas: 4,2	Isr: 2
	Topic: eventjsonlog	Partition: 27	Leader: 2	Replicas: 2,4	Isr: 2
	Topic: eventjsonlog	Partition: 38	Leader: 13	Replicas: 13,4	Isr: 13
	Topic: eventjsonlog	Partition: 44	Leader: 10	Replicas: 4,10	Isr: 10
	Topic: eventjsonlog	Partition: 52	Leader: 12	Replicas: 12,4	Isr: 12
	Topic: eventjsonlog	Partition: 59	Leader: 11	Replicas: 4,11	Isr: 11
	Topic: eventlog	Partition: 8	Leader: 16	Replicas: 16,4	Isr: 16
	Topic: eventlog	Partition: 23	Leader: 3	Replicas: 4,3	Isr: 3
	Topic: eventlog	Partition: 38	Leader: 13	Replicas: 13,4	Isr: 13
	Topic: eventlog	Partition: 44	Leader: 10	Replicas: 4,10	Isr: 10
	Topic: eventlog	Partition: 52	Leader: 12	Replicas: 12,4	Isr: 12
	Topic: eventlog	Partition: 59	Leader: 11	Replicas: 4,11	Isr: 11
	Topic: pusheventlog	Partition: 9	Leader: 1	Replicas: 1,4	Isr: 1
	Topic: pusheventlog	Partition: 12	Leader: 7	Replicas: 4,7	Isr: 7&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;åˆ é™¤&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--delete&lt;/code&gt;: æŒ‡å®štopicåˆ é™¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨åˆ é™¤Topicæ—¶ä¼šå—&lt;code&gt;delete.topic.enable&lt;/code&gt;å‚æ•°çš„å½±å“ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™topicç›´æ¥åˆ é™¤ï¼Œå¦‚æœä¸ºfalseï¼Œåˆ é™¤ä»…æ˜¯æ ‡è®°åˆ é™¤ï¼Œå³åœ¨topicçš„configä¸­å¢åŠ ä¸€ä¸ªåˆ é™¤æ ‡è®°&lt;code&gt;MarkedForDeletion:true&lt;/code&gt;ï¼Œå¾…brokeré‡å¯åå®Œå…¨åˆ é™¤(ä¹Ÿå¯é€šè¿‡zkä¸­çš„æ•°æ®åˆ é™¤)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å¦‚æœdelete.topic.enable=trueï¼Œåˆ™ç›´æ¥åˆ é™¤æ‰
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --delete   --topic bgbiao.top&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;topicçœŸæ­£çš„å…ƒæ•°æ®ç»“æ„: &lt;code&gt;/brokers/topics/topic-name&lt;/code&gt;,åˆ é™¤è¿™ä¸ªå³åˆ é™¤&lt;/li&gt;
&lt;li&gt;æ ‡è®°åˆ é™¤çš„topicå…ƒæ•°æ®: &lt;code&gt;/admin/delete_topics/topic-name&lt;/code&gt;,åˆ é™¤è¿™ä¸ªæ‰ç®—æ•°æ®æ¸…ç†å®Œæˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;1-2-kafka-reassign-partitions-sh&#34;&gt;1.2 kafka-reassign-partitions.sh&lt;/h4&gt;

&lt;p&gt;è¯¥è„šæœ¬ç”¨äºåœ¨å‰¯æœ¬ä¹‹é—´ç§»åŠ¨topicçš„åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯å¯¹å‰¯æœ¬è¿›è¡Œé‡æ–°åˆ†é…ï¼Œä¹Ÿæ˜¯SREåœ¨æ—¥å¸¸æ“ä½œä¸­ä¼šæ¯”è¾ƒå¸¸ç”¨çš„è„šæœ¬ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åšè¿ç§»æ—¶éœ€è¦æ³¨æ„åˆ°å½“å‰é›†ç¾¤çš„æ•´ä½“æƒ…å†µï¼Œæ¯•ç«Ÿåœ¨ç§»åŠ¨å‰¯æœ¬æ—¶ï¼Œéœ€è¦è®¾è®¡åˆ°æ–°å‰¯æœ¬çš„æ•°æ®åŒæ­¥ï¼Œä¹Ÿä¼šå ç”¨ä¸€å®šèµ„æºã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸ï¼Œå°†æœåŠ¡å™¨æ·»åŠ åˆ°Kafkaé›†ç¾¤å¾ˆå®¹æ˜“ï¼Œåªéœ€ä¸ºå®ƒä»¬åˆ†é…ä¸€ä¸ªæƒŸä¸€çš„brokeridï¼Œå¹¶åœ¨æ–°æœåŠ¡å™¨ä¸Šå¯åŠ¨Kafkaã€‚ç„¶è€Œï¼Œè¿™äº›æ–°æœåŠ¡å™¨ä¸ä¼šè‡ªåŠ¨åˆ†é…ä»»ä½•æ•°æ®åˆ†åŒºï¼Œå› æ­¤ï¼Œé™¤éå°†åˆ†åŒºç§»åŠ¨åˆ°å®ƒä»¬ï¼Œå¦åˆ™åœ¨åˆ›å»ºæ–°ä¸»é¢˜ä¹‹å‰ï¼Œå®ƒä»¬ä¸ä¼šåšä»»ä½•å·¥ä½œã€‚å› æ­¤ï¼Œå‘é›†ç¾¤ä¸­æ·»åŠ æœºå™¨æ—¶ï¼Œæ‚¨ä¼šå¸Œæœ›å°†ä¸€äº›ç°æœ‰æ•°æ®è¿ç§»åˆ°è¿™äº›æœºå™¨ä¸Šã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--broker-list&lt;/code&gt;: æŒ‡å®šåˆ†åŒºéœ€è¦é‡æ–°åˆ†é…åˆ°çš„brokerèŠ‚ç‚¹ï¼Œå¦‚æœ&lt;code&gt;--topics-to-move-json-file&lt;/code&gt;å‚æ•°è¢«æŒ‡å®šç”¨æ¥ç”Ÿæˆé‡åˆ†é…é…ç½®æ—¶ï¼Œå¿…é¡»åˆ¶å®šè¯¥å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--topics-to-move-json-file&lt;/code&gt;: ç”Ÿæˆä¸€ä¸ªç§»åŠ¨æŒ‡å®štopicçš„åˆ†åŒºåˆ°æŒ‡å®šbroker(&lt;code&gt;--broker-list&lt;/code&gt;)çš„é…ç½®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--generate&lt;/code&gt;: ç”Ÿæˆå€™é€‰åˆ†åŒºåˆ†é…çš„é…ç½®ï¼Œè¯¥å‚æ•°ä»…ä¼šç”Ÿæˆå€™é€‰çš„åˆ†é…æ–¹æ¡ˆï¼Œä¸ä¼šè¿›è¡Œæ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--reassignment-json-file&lt;/code&gt;: åˆ†åŒºæ‰‹åŠ¨åˆ†é…çš„é…ç½®å‚æ•°ï¼Œè¯¥å‚æ•°å¯ç”±&lt;code&gt;generate&lt;/code&gt;å‚æ•°ç”Ÿæˆï¼Œé€šå¸¸ä¸€èˆ¬ä¼šè¿›è¡Œå¾®è°ƒ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--replica-alter-log-dirs-throttle&lt;/code&gt;: åœ¨ç›¸åŒçš„brokerä¸Šæ—¥å¿—ç›®å½•ä¹‹é—´çš„å‰¯æœ¬ç§»åŠ¨å°†è¢«é™æµä¸ºè¯¥å€¼bytes/secï¼Œé™æµåº”è¯¥è‡³å°‘è®¾ç½®ä¸º1 KB/sï¼Œé»˜è®¤æ˜¯-1è¡¨ç¤ºä¸é™åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--throttle&lt;/code&gt;: brokerä¹‹é—´çš„åˆ†åŒºç§»åŠ¨å¯ä»¥ä½¿ç”¨è¯¥å€¼è¿›è¡Œé™æµ(bytes/sec)ï¼ŒåŒä¸Š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--execute&lt;/code&gt;: é€šè¿‡æŒ‡å®š&lt;code&gt;--reassignment-json-file&lt;/code&gt;å‚æ•°æ¥æ‰§è¡Œé‡æ–°åˆ†é…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--verify&lt;/code&gt;: å¦‚æœä¸€ä¸ªé‡åˆ†é…å®Œæˆäº†ï¼Œå¯ä»¥æŒ‡å®š&lt;code&gt;--reassignment-json-file&lt;/code&gt;å‚æ•°æ¥æŸ¥çœ‹é‡åˆ†é…çš„è¿›åº¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;topics-to-move-json-fileæ–‡ä»¶ç¤ºä¾‹&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;{&amp;#34;topics&amp;#34;:
[{&amp;#34;topic&amp;#34;: &amp;#34;foo&amp;#34;},{&amp;#34;topic&amp;#34;: &amp;#34;foo1&amp;#34;}],
&amp;#34;version&amp;#34;:1
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;reassignment-json-fileæ–‡ä»¶ç¤ºä¾‹&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æ³¨æ„:log_dirsæ˜¯å¯é€‰å‚æ•°ï¼Œéœ€è¦æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºanyï¼Œå½“æŒ‡å®šåéœ€è¦å’Œreplicasçš„é•¿åº¦ç›¸ç­‰
  {&amp;#34;partitions&amp;#34;:
  	[{&amp;#34;topic&amp;#34;: &amp;#34;foo&amp;#34;,
  	  &amp;#34;partition&amp;#34;: 1,
  	  &amp;#34;replicas&amp;#34;: [1,2,3],
  	  &amp;#34;log_dirs&amp;#34;: [&amp;#34;dir1&amp;#34;,&amp;#34;dir2&amp;#34;,&amp;#34;dir3&amp;#34;]
    }],
  &amp;#34;version&amp;#34;:1
  }&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;åˆ†åŒºé‡åˆ†é…ç¤ºä¾‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æŸ¥çœ‹å½“å‰topicè¯¦æƒ…
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --describe --topic bgbiao.top
Topic: bgbiao.top	PartitionCount: 3	ReplicationFactor: 1	Configs: min.insync.replicas=1,segment.bytes=1073741824
	Topic: bgbiao.top	Partition: 0	Leader: 3	Replicas: 3	Isr: 3
	Topic: bgbiao.top	Partition: 1	Leader: 1	Replicas: 1	Isr: 1
	Topic: bgbiao.top	Partition: 2	Leader: 2	Replicas: 2	Isr: 2

# 1.ç¼–è¾‘move.jsoné…ç½®
$ cat move.json
{&amp;#34;topics&amp;#34;: [{&amp;#34;topic&amp;#34;: &amp;#34;bgbiao.top&amp;#34;}],
&amp;#34;version&amp;#34;:1
}

# 2.ç”Ÿæˆè¿ç§»é…ç½®
# æŒ‡å®šæ­£ç¡®çš„zookeeperåœ°å€æ¥è·å–åˆ†åŒºçš„åˆ†å¸ƒçŠ¶æ€ä»¥åŠå¾…è¿ç§»çš„çŠ¶æ€
$ sh /opt/app/kafka/bin/kafka-reassign-partitions.sh --zookeeper 172.29.203.62:2181 --topics-to-move-json-file move.json --broker-list &amp;#34;1,2,3&amp;#34; --generate
Current partition replica assignment
{&amp;#34;version&amp;#34;:1,&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[2],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]},{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[1],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]},{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[3],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]}]}

Proposed partition reassignment configuration
{&amp;#34;version&amp;#34;:1,&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[1],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]},{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[3],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]},{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[2],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]}]}

# ç¼–è¾‘è¿ç§»é…ç½®
# å½“å‰åˆ†åŒºçŠ¶æ€ä¸º:bgbiao.top-2çš„å‰¯æœ¬åœ¨broker2,bgbiao.top-1çš„å‰¯æœ¬åœ¨broker1,bgbiao.top-0çš„å‰¯æœ¬åœ¨broker3
# è¿ç§»åçš„åˆ†åŒºçŠ¶æ€:bgbiao.top-2çš„å‰¯æœ¬åœ¨broker3,bgbiao.top-1çš„å‰¯æœ¬åœ¨broker2,bgbiao.top-0çš„å‰¯æœ¬åœ¨broker1
# ç„¶åå°†æœŸæœ›çš„è¿ç§»é…ç½®ä¿å­˜ä¸‹æ¥åšç›¸å…³ä¿®æ”¹å³å¯.
# æˆ‘ä»¬æ˜¯æƒ³ç»™æŸä¸ªåˆ†åŒºå¢åŠ å‰¯æœ¬ï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹æˆå¦‚ä¸‹é…ç½®
$ cat assignment.json
{
    &amp;#34;partitions&amp;#34;: [
        {
            &amp;#34;partition&amp;#34;: 0,
            &amp;#34;replicas&amp;#34;: [
                3,1,2
            ],
            &amp;#34;topic&amp;#34;: &amp;#34;bgbiao.top&amp;#34;
        }
    ],
    &amp;#34;version&amp;#34;: 1
}

# 3.æ ¹æ®ä¸Šè¿°çš„è¿ç§»é…ç½®æ‰§è¡Œè¿ç§»
$ sh /opt/app/kafka/bin/kafka-reassign-partitions.sh --zookeeper 172.29.203.62:2181 --reassignment-json-file ./assignment.json --execute
Current partition replica assignment

{&amp;#34;version&amp;#34;:1,&amp;#34;partitions&amp;#34;:[{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:2,&amp;#34;replicas&amp;#34;:[2],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]},{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:1,&amp;#34;replicas&amp;#34;:[1],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]},{&amp;#34;topic&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;partition&amp;#34;:0,&amp;#34;replicas&amp;#34;:[3],&amp;#34;log_dirs&amp;#34;:[&amp;#34;any&amp;#34;]}]}

Save this to use as the --reassignment-json-file option during rollback
Successfully started reassignment of partitions.

# 4.æŸ¥çœ‹ä¸Šè¿°è¿ç§»çš„è¿›åº¦(å°†--executeå‚æ•°æ”¹ä¸º--verifyå‚æ•°)
$ sh /opt/app/kafka/bin/kafka-reassign-partitions.sh --zookeeper 172.29.203.62:2181 --reassignment-json-file ./assignment.json --verify
Status of partition reassignment:
Reassignment of partition bgbiao.top-0 completed successfully

# å†æ¬¡æŸ¥çœ‹topixè¯¦æƒ…
# å¦‚æœŸæœ›ï¼Œpartition-1å¢åŠ äº†ä¸¤ä¸ªå‰¯æœ¬,è¯¥å‰¯æœ¬çš„æ•´ä½“å¯ç”¨æ€§æé«˜äº†3å€
$ sh /opt/app/kafka/bin/kafka-topics.sh --bootstrap-server 172.29.203.62:9092 --describe --topic bgbiao.top
Topic: bgbiao.top	PartitionCount: 3	ReplicationFactor: 3	Configs: min.insync.replicas=1,segment.bytes=1073741824
	Topic: bgbiao.top	Partition: 0	Leader: 3	Replicas: 3,1,2	Isr: 3,1,2
	Topic: bgbiao.top	Partition: 1	Leader: 1	Replicas: 1	Isr: 1
	Topic: bgbiao.top	Partition: 2	Leader: 2	Replicas: 2	Isr: 2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; è¯¥å·¥å…·å¯ä»¥è®©é›†ç¾¤éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœåï¼ŒåŠæ—¶å°†æ–°éƒ¨åˆ†çš„partitionè¿›è¡Œè°ƒæ•´ï¼Œä»¥æ¢å¤partitionçš„é«˜å¯ç”¨æ€§ã€‚åŒæ—¶èƒ½å¤Ÿè®©é›†ç¾¤åœ¨æ‰©å±•åï¼Œå¿«é€Ÿå°†å·²æœ‰topicçš„æ•°æ®å‡è¡¡çš„åˆ†å¸ƒåœ¨æ–°èŠ‚ç‚¹ä¸Šï¼Œä»¥å®ç°æ•´ä½“è´Ÿè½½çš„å‡è¡¡ã€‚&lt;/p&gt;

&lt;h4 id=&#34;1-3-kafka-log-dirs-sh&#34;&gt;1.3 kafka-log-dirs.sh&lt;/h4&gt;

&lt;p&gt;è¯¥è„šæœ¬å‚æ•°ç”¨äºæŸ¥çœ‹kafkaå„ä¸ªbrokerèŠ‚ç‚¹ä»¥åŠtopicçš„ç£ç›˜ä½¿ç”¨ç‡æƒ…å†µ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--describe&lt;/code&gt;: æŸ¥çœ‹topicå’Œbrokerçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--broker-list&lt;/code&gt;: æŒ‡å®šæŸ¥çœ‹çš„brokeråˆ—è¡¨&lt;/li&gt;

&lt;li&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;--topic-list&lt;/code&gt;: æŒ‡å®šéœ€è¦æŸ¥çœ‹çš„topicåˆ—è¡¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# å½“æŒ‡å®štopicåä¼šä»å…¨éƒ¨çš„brokerä¸­è¿›è¡ŒæŸ¥æ‰¾
$ sh /opt/app/kafka/bin/kafka-log-dirs.sh --bootstrap-server 172.29.203.62:9092 --describe --topic-list myapp-yum-log,myapp
Querying brokers for log directories information
Received log directory information from brokers 1,2,3
{&amp;#34;version&amp;#34;:1,&amp;#34;brokers&amp;#34;:[{&amp;#34;broker&amp;#34;:1,&amp;#34;logDirs&amp;#34;:[{&amp;#34;logDir&amp;#34;:&amp;#34;/opt/data/kafka/kafka-logs&amp;#34;,&amp;#34;error&amp;#34;:null,&amp;#34;partitions&amp;#34;:[{&amp;#34;partition&amp;#34;:&amp;#34;myapp-yum-log-2&amp;#34;,&amp;#34;size&amp;#34;:13291235,&amp;#34;offsetLag&amp;#34;:0,&amp;#34;isFuture&amp;#34;:false},{&amp;#34;partition&amp;#34;:&amp;#34;myapp-0&amp;#34;,&amp;#34;size&amp;#34;:0,&amp;#34;offsetLag&amp;#34;:0,&amp;#34;isFuture&amp;#34;:false}]}]},{&amp;#34;broker&amp;#34;:2,&amp;#34;logDirs&amp;#34;:[{&amp;#34;logDir&amp;#34;:&amp;#34;/opt/data/kafka/kafka-logs&amp;#34;,&amp;#34;error&amp;#34;:null,&amp;#34;partitions&amp;#34;:[{&amp;#34;partition&amp;#34;:&amp;#34;myapp-1&amp;#34;,&amp;#34;size&amp;#34;:0,&amp;#34;offsetLag&amp;#34;:0,&amp;#34;isFuture&amp;#34;:false},{&amp;#34;partition&amp;#34;:&amp;#34;myapp-yum-log-0&amp;#34;,&amp;#34;size&amp;#34;:13258726,&amp;#34;offsetLag&amp;#34;:0,&amp;#34;isFuture&amp;#34;:false}]}]},{&amp;#34;broker&amp;#34;:3,&amp;#34;logDirs&amp;#34;:[{&amp;#34;logDir&amp;#34;:&amp;#34;/opt/data/kafka/kafka-logs&amp;#34;,&amp;#34;error&amp;#34;:null,&amp;#34;partitions&amp;#34;:[{&amp;#34;partition&amp;#34;:&amp;#34;myapp-2&amp;#34;,&amp;#34;size&amp;#34;:0,&amp;#34;offsetLag&amp;#34;:0,&amp;#34;isFuture&amp;#34;:false},{&amp;#34;partition&amp;#34;:&amp;#34;myapp-yum-log-1&amp;#34;,&amp;#34;size&amp;#34;:13264869,&amp;#34;offsetLag&amp;#34;:0,&amp;#34;isFuture&amp;#34;:false}]}]}]}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç»“æœæ˜¯jsonä¸²ï¼Œå¯ä»¥çœ‹åˆ°&lt;code&gt;myapp-yum-log-2&lt;/code&gt;åœ¨broker-1ä¸Šå ç”¨äº†&lt;code&gt;13291235&lt;/code&gt;å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;12M&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&#34;1-4-kafka-leader-election-sh&#34;&gt;1.4 kafka-leader-election.sh&lt;/h4&gt;

&lt;p&gt;ç”¨äºä¸€ç»„ Topic åˆ†åŒºçš„ leader é‡æ–°åˆ†é…ï¼Œå¯ä»¥æ”¯æŒä¼˜å…ˆå‰¯æœ¬å’ŒéåŒæ­¥å‰¯æœ¬ã€‚ä¸€èˆ¬ç”¨äºæŒ‡å®štopicçš„åˆ†åŒºå­˜åœ¨éé¢„é€‰å‰¯æœ¬æˆ–éåŒæ­¥å‰¯æœ¬çš„æƒ…å†µï¼Œå¯¹æ•´ä¸ªleaderè¿›è¡Œé€‚å½“è°ƒæ•´&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--admin.config&lt;/code&gt;: ä¼ ç»™adminå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--all-topic-partitions&lt;/code&gt;: åŸºäºé€‰ä¸¾ç±»å‹&lt;code&gt;--election-type&lt;/code&gt;æ¥å¯¹ç¬¦åˆæ¡ä»¶çš„topicè¿›è¡Œé€‰ä¸¾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--bootstrap-server&lt;/code&gt;: æŒ‡å®šbrokeråœ°å€&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--election-type&lt;/code&gt;: æŒ‡å®šé€‰ä¸¾ç±»å‹&lt;code&gt;[preferred,unclean]&lt;/code&gt;ï¼Œå¯¹ä¼˜å…ˆå‰¯æœ¬è¿›è¡Œé€‰ä¸¾æˆ–éåŒæ­¥å‰¯æœ¬è¿›è¡Œé€‰ä¸¾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--partition&lt;/code&gt;: æŒ‡å®šéœ€è¦é€‰ä¸¾çš„æŒ‡å®štopicåˆ†åŒºçš„id(å’Œ&amp;ndash;topicä¸€èµ·ä½¿ç”¨)&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;--path-to-json-file&lt;/code&gt;: ä½¿ç”¨jsoné…ç½®æ–‡ä»¶æ¥ä¿å­˜é‡åˆ†é…ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æ¯”å¦‚æˆ‘ä»¬å‘ç°topicçš„partition-1å½“å‰çš„leaderä¸æ˜¯ä¼˜å…ˆå‰¯æœ¬(brokerç›¸å¯¹å€¾æ–œ),å¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®è¿›è¡Œleaderé‡æ–°é€‰ä¸¾
$ sh kafka-leader-election.sh --bootstrap-server 172.29.203.62:9092 --topic test-bgbiao-1 --partition 0 --election-type preferred
Valid replica already elected for partitions


{&amp;#34;partitions&amp;#34;:
[{&amp;#34;topic&amp;#34;: &amp;#34;foo&amp;#34;, &amp;#34;partition&amp;#34;: 1},
{&amp;#34;topic&amp;#34;: &amp;#34;foobar&amp;#34;, &amp;#34;partition&amp;#34;: 2}]
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;1-5-kafka-configs-sh&#34;&gt;1.5 kafka-configs.sh&lt;/h4&gt;

&lt;p&gt;ç”¨æ¥æŸ¥çœ‹å’Œä¿®æ”¹kafkaç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…å«é›†ç¾¤çš„åŠ¨æ€é…ç½®ï¼Œtopicçº§åˆ«çš„åŠ¨æ€é…ç½®ç­‰ç­‰&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--all&lt;/code&gt;: åˆ—å‡ºç»™å®šå®ä½“çš„å…¨éƒ¨é…ç½®æ–‡ä»¶(é»˜è®¤å·²ç»ç”Ÿæ•ˆçš„å…¨éƒ¨å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰allä»…å¯¹åŠ¨æ€å‚æ•°ç”Ÿæ•ˆ)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--entity-type&lt;/code&gt;: å®ä½“ç±»å‹[topics/clients/users/brokers/broker-loggers]&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--entity-name&lt;/code&gt;: å®ä½“åç§°[topicåç§°/client-id/user-name/broker-id]&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--describe&lt;/code&gt;: åˆ—å‡ºç»™å®šå®ä½“çš„é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--force&lt;/code&gt;: å¼ºåˆ¶ç”Ÿæ•ˆ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--topic&lt;/code&gt;: æŒ‡å®štopicåç§°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--alter&lt;/code&gt;: ä¿®æ”¹æŒ‡å®šå®ä½“çš„é…ç½®æ–‡ä»¶ &lt;code&gt;æ³¨æ„:å½“ä½¿ç”¨delete-configå’Œadd-configæ—¶å¿…é¡»ä½¿ç”¨--alter&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--delete-config&lt;/code&gt;: åˆ é™¤æŒ‡å®šçš„é…ç½®&amp;rdquo;k1,k2&amp;rdquo;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--add-config&lt;/code&gt;: ç»™æŒ‡å®šçš„å®ä½“å¢åŠ é…ç½®(k=v,k2=[v1,v2,v3],k3=v3)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;topicçº§åˆ«çš„åŠ¨æ€å‚æ•°&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cleanup.policy&lt;/code&gt;: æ¸…ç†ç­–ç•¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;compression.type&lt;/code&gt;: å‹ç¼©ç±»å‹(é€šå¸¸å»ºè®®åœ¨produceç«¯æ§åˆ¶)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delete.retention.ms&lt;/code&gt;: å‹ç¼©æ—¥å¿—çš„ä¿ç•™æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flush.messages&lt;/code&gt;: æŒä¹…åŒ–messageé™åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flush.ms&lt;/code&gt;: æŒä¹…åŒ–é¢‘ç‡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;follower.replication.throttled.replicas&lt;/code&gt;: followerå‰¯æœ¬é™æµ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;leader.replication.throttled.replicas&lt;/code&gt;: leaderå‰¯æœ¬é™æµ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;max.message.bytes&lt;/code&gt;: æœ€å¤§çš„batchçš„messageå¤§å°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;message.downconversion.enable&lt;/code&gt;: messageå‘ä¸‹å…¼å®¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;message.format.version&lt;/code&gt;: messageæ ¼å¼ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;&lt;code&gt;min.insync.replicas&lt;/code&gt;: æœ€å°çš„ISR&lt;/li&gt;
&lt;li&gt;&lt;code&gt;retention.ms&lt;/code&gt;: æ—¥å¿—ä¿ç•™æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;retention.bytes&lt;/code&gt;: æ—¥å¿—ä¿ç•™å¤§å°(é€šå¸¸æŒ‰ç…§æ—¶é—´é™åˆ¶)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;segment.bytes&lt;/code&gt;: segmentçš„å¤§å°é™åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;segment.ms&lt;/code&gt;: segmentçš„åˆ‡å‰²æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unclean.leader.election.enable&lt;/code&gt;: æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸»(é’ˆå¯¹å¯ç”¨æ€§è®¾ç½®çš„ä¸€ä¸ªå‚æ•°)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;brokerçº§åˆ«çš„åŠ¨æ€å‚æ•°&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;brokerçº§åˆ«çš„åŠ¨æ€å‚æ•°æ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªåˆ—ä¸¾å¸¸ç”¨çš„å‡ ä¸ª&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;log.retention.ms&lt;/code&gt;: æ—¥å¿—ä¿ç•™æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;max.connections&lt;/code&gt;: æœ€å¤§è¿æ¥æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;max.connections.per.ip&lt;/code&gt;: æ¯ä¸ªipçš„æœ€å¤§è¿æ¥æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;message.max.bytes&lt;/code&gt;: batchçš„messageçš„æœ€å¤§é™åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;min.insync.replicas&lt;/code&gt;: æœ€å°çš„ISR&lt;/li&gt;
&lt;li&gt;&lt;code&gt;num.io.threads&lt;/code&gt;: IOçº¿ç¨‹æ•°(ç½‘ç»œçº¿ç¨‹æ•°çš„ä¸¤å€)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;num.network.threads&lt;/code&gt;: ç½‘ç»œçº¿ç¨‹æ•°(cpuçš„2/3è¾ƒå¥½)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;num.recovery.threads.per.data.dir&lt;/code&gt;: æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;num.replica.fetchers&lt;/code&gt;: å‰¯æœ¬çš„fetchersæ•°é‡(é»˜è®¤ä¸º1,å¯é€‚å½“è°ƒå¤§)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;userçº§åˆ«çš„å‚æ•°&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SCRAM-SHA-256&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SCRAM-SHA-512&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;&lt;code&gt;consumer_byte_rate&lt;/code&gt;: é’ˆå¯¹æ¶ˆè´¹è€…userè¿›è¡Œé™æµ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;producer_byte_rate&lt;/code&gt;: é’ˆå¯¹ç”Ÿäº§è€…è¿›è¡Œé™æµ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;request_percentage&lt;/code&gt;: è¯·æ±‚ç™¾åˆ†æ¯”&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;clientsçº§åˆ«å‚æ•°&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;consumer_byte_rate&lt;/code&gt;: é’ˆå¯¹æ¶ˆè´¹è€…userè¿›è¡Œé™æµ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;producer_byte_rate&lt;/code&gt;: é’ˆå¯¹ç”Ÿäº§è€…è¿›è¡Œé™æµ&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;request_percentage&lt;/code&gt;: è¯·æ±‚ç™¾åˆ†æ¯”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# ä¿®æ”¹topicçš„æ•°æ®ä¿ç•™æ—¶é—´
$ sh kafka-configs.sh --bootstrap-server 172.29.203.62:9092 --topic push-test --add-config retention.ms=10000000 --alter

# æŸ¥çœ‹topicçš„åŠ¨æ€å‚æ•°é…ç½®
$ sh kafka-configs.sh --bootstrap-server 172.29.203.62:9092 --topic push-test --describe
Dynamic configs for topic push-test are:
retention.ms=10000000 sensitive=false synonyms={DYNAMIC_TOPIC_CONFIG:retention.ms=10000000}

# åˆ é™¤topicåŠ¨æ€å‚æ•°
$ sh kafka-configs.sh --bootstrap-server 172.29.203.62:9092 --topic push-test --alter --delete-config retention.ms
Completed updating config for topic push-test.

# æŸ¥çœ‹brokerå…¨éƒ¨çš„å‚æ•°(--allä¼šè·å–å…¨éƒ¨çš„å‚æ•°)
$ sh kafka-configs.sh --bootstrap-server 172.29.203.62:9092 --all --broker-defaults  --describe
Default configs for brokers in the cluster are:

# ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‚æ•°æŸ¥çœ‹brokerçš„å…¨éƒ¨å‚æ•°(åŠ¨æ€çš„å’Œé»˜è®¤çš„å‚æ•°)
$ sh kafka-configs.sh --bootstrap-server 172.29.203.62:9092  --all --entity-type brokers --entity-name  1  --describe
$ sh kafka-configs.sh --bootstrap-server 172.29.203.62:9092  --all --broker 1  --describe

# brokerçš„åŠ¨æ€å‚æ•°(å»é™¤äº†--allä¹‹åï¼Œä¼šå‘ç°åˆ—å‡ºçš„æ˜¯åŠ¨æ€çš„é…ç½®ï¼Œé»˜è®¤brokeræ˜¯æ²¡æœ‰åŠ¨æ€å‚æ•°è°ƒæ•´çš„)
$ sh kafka-configs.sh --bootstrap-server 172.29.203.62:9092  --broker 1  --describe
Dynamic configs for broker 1 are:

# userå’Œclientä¹Ÿæ˜¯ç±»ä¼¼çš„&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;1-6-kafka-broker-api-versions-sh&#34;&gt;1.6 kafka-broker-api-versions.sh&lt;/h4&gt;

&lt;p&gt;æŸ¥çœ‹kafkaå¯¹å¤–çš„å„ä¸ªapiç‰ˆæœ¬.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æŸ¥çœ‹å½“å‰kafkaç‰ˆæœ¬
$ sh kafka-broker-api-versions.sh --bootstrap-server 172.29.203.62:9092 --version
2.5.0 (Commit:66563e712b0b9f84)

# æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„apiç‰ˆæœ¬
$ sh kafka-broker-api-versions.sh --bootstrap-server 172.29.203.62:9092
172.29.203.106:9092 (id: 2 rack: null) -&amp;gt; (
	Produce(0): 0 to 8 [usable: 8],
	Fetch(1): 0 to 11 [usable: 11],
	ListOffsets(2): 0 to 5 [usable: 5],
	Metadata(3): 0 to 9 [usable: 9],
	LeaderAndIsr(4): 0 to 4 [usable: 4],
	StopReplica(5): 0 to 2 [usable: 2],
	UpdateMetadata(6): 0 to 6 [usable: 6],
	ControlledShutdown(7): 0 to 3 [usable: 3],
	OffsetCommit(8): 0 to 8 [usable: 8],
	OffsetFetch(9): 0 to 7 [usable: 7],
	FindCoordinator(10): 0 to 3 [usable: 3],
	JoinGroup(11): 0 to 7 [usable: 7],
	Heartbeat(12): 0 to 4 [usable: 4],
	LeaveGroup(13): 0 to 4 [usable: 4],
	SyncGroup(14): 0 to 5 [usable: 5],
	DescribeGroups(15): 0 to 5 [usable: 5],
	ListGroups(16): 0 to 3 [usable: 3],
	SaslHandshake(17): 0 to 1 [usable: 1],
	ApiVersions(18): 0 to 3 [usable: 3],
	CreateTopics(19): 0 to 5 [usable: 5],
	DeleteTopics(20): 0 to 4 [usable: 4],
	DeleteRecords(21): 0 to 1 [usable: 1],
	InitProducerId(22): 0 to 3 [usable: 3],
	OffsetForLeaderEpoch(23): 0 to 3 [usable: 3],
	AddPartitionsToTxn(24): 0 to 1 [usable: 1],
	AddOffsetsToTxn(25): 0 to 1 [usable: 1],
	EndTxn(26): 0 to 1 [usable: 1],
	WriteTxnMarkers(27): 0 [usable: 0],
	TxnOffsetCommit(28): 0 to 3 [usable: 3],
	DescribeAcls(29): 0 to 2 [usable: 2],
	CreateAcls(30): 0 to 2 [usable: 2],
	DeleteAcls(31): 0 to 2 [usable: 2],
	DescribeConfigs(32): 0 to 2 [usable: 2],
	AlterConfigs(33): 0 to 1 [usable: 1],
	AlterReplicaLogDirs(34): 0 to 1 [usable: 1],
	DescribeLogDirs(35): 0 to 1 [usable: 1],
	SaslAuthenticate(36): 0 to 2 [usable: 2],
	CreatePartitions(37): 0 to 2 [usable: 2],
	CreateDelegationToken(38): 0 to 2 [usable: 2],
	RenewDelegationToken(39): 0 to 2 [usable: 2],
	ExpireDelegationToken(40): 0 to 2 [usable: 2],
	DescribeDelegationToken(41): 0 to 2 [usable: 2],
	DeleteGroups(42): 0 to 2 [usable: 2],
	ElectLeaders(43): 0 to 2 [usable: 2],
	IncrementalAlterConfigs(44): 0 to 1 [usable: 1],
	AlterPartitionReassignments(45): 0 [usable: 0],
	ListPartitionReassignments(46): 0 [usable: 0],
	OffsetDelete(47): 0 [usable: 0]
)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;1-7-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å·¥å…·&#34;&gt;1.7 ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å·¥å…·&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kafka-console-consumer.sh&lt;/code&gt;: ç»ˆç«¯æ¶ˆè´¹è€…å·¥å…·&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;kafka-console-producer.sh&lt;/code&gt;: ç»ˆç«¯ç”Ÿäº§è€…å·¥å…·&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æŒ‡å®štopicä»ç»ˆç«¯å†™å…¥æ•°æ®
$ sh /opt/app/kafka/bin/kafka-console-producer.sh --bootstrap-server 172.29.203.62:9092 --topic test-push
&amp;gt;hello xxb
&amp;gt;BGBiao
&amp;gt;My website is https://bgbiao.top.
&amp;gt;And
&amp;gt;å…¬ä¼—å·: BGBiao


# æŒ‡å®šæ¶ˆè´¹è€…ç»„å¯¹topicè¿›è¡Œæ¶ˆè´¹
# --from-beginningè¡¨ç¤ºä»å¤´å¼€å§‹æ¶ˆè´¹
# å› ä¸ºå¼€å§‹ç”Ÿäº§è€…åˆšå¼€å§‹ç”Ÿäº§å¹¶ç”Ÿäº§topicï¼Œå¯¼è‡´topicæ— leaderä¼šæœ‰è­¦å‘Šä¿¡æ¯
# å¯ä»¥çœ‹åˆ°client-idå°±æ˜¯consumer-test-bgbiao-1,å³consumerçš„å‰ç¼€åŠ æ¶ˆè´¹ç»„åŠ æ•°å­—åç¼€
$ sh kafka-console-consumer.sh --bootstrap-server 172.29.203.62:9092 --topic push-test --group test-bgbiao
[2020-05-31 19:52:13,472] WARN [Consumer clientId=consumer-test-bgbiao-1, groupId=test-bgbiao] Error while fetching metadata with correlation id 2 : {test-push=LEADER_NOT_AVAILABLE} (org.apache.kafka.clients.NetworkClient)
hello xxb
BGBiao
My website is https://bgbiao.top.

å…¬ä¼—å·: BGBiao&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;1-8-kafka-consumer-groups-sh&#34;&gt;1.8 kafka-consumer-groups.sh&lt;/h4&gt;

&lt;p&gt;æ¶ˆè´¹ç»„ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„æ¶ˆè´¹ç»„ï¼ŒæŸ¥çœ‹æ¶ˆè´¹ç»„è¯¦æƒ…ï¼Œåˆ é™¤æ¶ˆè´¹ç»„ä¿¡æ¯ä»¥åŠé‡ç½®æ¶ˆè´¹ç»„çš„offset&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--all-groups&lt;/code&gt;: åº”ç”¨åˆ°æ‰€æœ‰çš„æ¶ˆè´¹ç»„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--all-topics&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--delete&lt;/code&gt;: åˆ é™¤topicåˆ†åŒºçš„offset,ä»¥åŠæ‹¥æœ‰è€…å’Œæ¶ˆè´¹ç»„ä¿¡æ¯(&amp;ndash;group g1 &amp;ndash;group g2)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--delete-offsets&lt;/code&gt;: åˆ é™¤æ¶ˆè´¹ç»„çš„offset&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--describe&lt;/code&gt;: æŸ¥çœ‹æ¶ˆè´¹ç»„ä¿¡æ¯ä»¥åŠæ¶ˆè´¹è€…çš„offset lag&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--execute&lt;/code&gt;: æŒ‡å®šæ“ä½œï¼Œæ”¯æŒ&lt;code&gt;reset-offsets&lt;/code&gt;æ“ä½œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--export&lt;/code&gt;: å¯¼å‡ºæ“ä½œæ‰§è¡Œåˆ°csvï¼Œæ”¯æŒ&lt;code&gt;reset-offsets&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--from-file&lt;/code&gt;: æŒ‡å®šæ–‡ä»¶ä¸­æŒ‡å®šçš„å€¼é‡ç½®offset (csvæ–‡ä»¶)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--group&lt;/code&gt;: æŒ‡å®šæ¶ˆè´¹ç»„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--list&lt;/code&gt;: åˆ—å‡ºæ‰€æœ‰çš„æ¶ˆè´¹ç»„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--members&lt;/code&gt;: æŸ¥çœ‹æ¶ˆè´¹ç»„ä¸­çš„æˆå‘˜&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--state&lt;/code&gt;: æŸ¥çœ‹æ¶ˆè´¹ç»„çš„çŠ¶æ€&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--offsets&lt;/code&gt;: æŸ¥çœ‹æ¶ˆè´¹ç»„å¹¶ä¸”åˆ—å‡ºæ¯ä¸ªæ¶ˆè´¹ç»„æ‰€æœ‰topicçš„åˆ†åŒºä»¥åŠæ¶ˆæ¯çš„offset lag&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--reset-offsets&lt;/code&gt;: é‡ç½®æ¶ˆè´¹ç»„çš„offset (éœ€è¦æŒ‡å®šå¦‚ä¸‹ä¸€ä¸ªå‚æ•°)&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--to-datetime&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--by-period&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--to-earliest&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--to-latest&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--shift-by&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;- &lt;code&gt;--from-file&lt;/code&gt;:&lt;/li&gt;

&lt;li&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;--to-current&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æŸ¥çœ‹å…¨éƒ¨çš„æ¶ˆè´¹è€…ç»„
$ sh /opt/app/kafka/bin/kafka-consumer-groups.sh --bootstrap-server 172.29.203.62:9092 --all-grou  --list
KMOffsetCache-daf27df49ede
test-bgbiao

# æŸ¥çœ‹æ¶ˆè´¹è€…è¯¦æƒ…
$ sh /opt/app/kafka/bin/kafka-consumer-groups.sh --bootstrap-server 172.29.203.62:9092 --group test-bgbiao --describe

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
test-bgbiao     test-push       0          1               1               0               consumer-test-bgbiao-1-a915f28c-3ee0-46ee-a8d8-6c93bddb7686 /172.29.203.62  consumer-test-bgbiao-1
test-bgbiao     test-push       1          2               2               0               consumer-test-bgbiao-1-a915f28c-3ee0-46ee-a8d8-6c93bddb7686 /172.29.203.62  consumer-test-bgbiao-1
test-bgbiao     test-push       2          2               2               0               consumer-test-bgbiao-1-a915f28c-3ee0-46ee-a8d8-6c93bddb7686 /172.29.203.62  consumer-test-bgbiao-1

# æŸ¥çœ‹æ¶ˆè´¹ç»„çš„æˆå‘˜
$ sh /opt/app/kafka/bin/kafka-consumer-groups.sh --bootstrap-server 172.29.203.62:9092 --group test-bgbiao --members --describe

GROUP           CONSUMER-ID                                                 HOST            CLIENT-ID              #PARTITIONS
test-bgbiao     consumer-test-bgbiao-1-a915f28c-3ee0-46ee-a8d8-6c93bddb7686 /172.29.203.62  consumer-test-bgbiao-1 3

# æŸ¥çœ‹æ¶ˆè´¹ç»„çŠ¶æ€
$ sh /opt/app/kafka/bin/kafka-consumer-groups.sh --bootstrap-server 172.29.203.62:9092 --group test-bgbiao --state --describe

GROUP                     COORDINATOR (ID)          ASSIGNMENT-STRATEGY  STATE           #MEMBERS
test-bgbiao               172.29.203.62:9092 (1)    range                Stable          1


# æŸ¥çœ‹æ¶ˆè´¹ç»„çš„offsetä¿¡æ¯
$ sh /opt/app/kafka/bin/kafka-consumer-groups.sh --bootstrap-server 172.29.203.62:9092 --group test-bgbiao --offsets --describe
GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
test-bgbiao     test-push       0          1               1               0               consumer-test-bgbiao-1-a915f28c-3ee0-46ee-a8d8-6c93bddb7686 /172.29.203.62  consumer-test-bgbiao-1
test-bgbiao     test-push       1          2               2               0               consumer-test-bgbiao-1-a915f28c-3ee0-46ee-a8d8-6c93bddb7686 /172.29.203.62  consumer-test-bgbiao-1
test-bgbiao     test-push       2          2               2               0               consumer-test-bgbiao-1-a915f28c-3ee0-46ee-a8d8-6c93bddb7686 /172.29.203.62  consumer-test-bgbiao-1
test-bgbiao     test-full-push    2          61392           61430           38              -                                                           -               -
test-bgbiao     test-full-push    1          61056           61088           32              -                                                           -               -
test-bgbiao     test-full-push    0          61299           61337           38              -&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2-kafka-manager&#34;&gt;2. kafka-manager&lt;/h3&gt;

&lt;h2 id=&#34;å››-é›†ç¾¤ç›‘æ§&#34;&gt;å››ã€é›†ç¾¤ç›‘æ§&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://kafka.apache.org/24/documentation.html#monitoring&#34;&gt;kafka-doc-monitor&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gai9amj2lcj30vu0b275p.jpg&#34; alt=&#34;çŸ¥è¯†æ˜Ÿçƒ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gdra6n69uhj30f00kkgot.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>ä½ è¿˜è®°å¾—ä½ JVMçš„çš„åˆå§‹å †å¤§å°å—</title>
      <link>https://bgbiao.top/post/jvm%E7%9A%84%E5%88%9D%E5%A7%8B%E5%A0%86/</link>
      <pubDate>Tue, 21 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/jvm%E7%9A%84%E5%88%9D%E5%A7%8B%E5%A0%86/</guid>
      
        <description>&lt;p&gt;é€šå¸¸å¯¹äºå¾ˆå¤šjavaåº”ç”¨æ¥è¯´ï¼Œå½“æ‰“æˆjaråŒ…åä¼šä¸‹æ„è¯†çš„ä½¿ç”¨&lt;code&gt;java -jar xxx.jar&lt;/code&gt;æ¥è¿è¡Œåº”ç”¨ï¼Œè€Œä¸æ˜¯æ ¹æ®è‡ªå·±ä¸šåŠ¡æˆ–å®é™…debugçš„ä¸€äº›éœ€æ±‚æ¥å¢åŠ ä¸€äº›JVMçš„è¾…åŠ©å‚æ•°ï¼Œè¿™æ ·å¯¼è‡´çš„é—®é¢˜å°±æ˜¯ï¼Œåç»­å‡ºäº†é—®é¢˜ä¹‹åä¸å®¹æ˜“è¿›è¡Œç®¡ç†ä»¥åŠç›¸å…³æ•…éšœè¿½è¸ªå’Œæ’æŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“ä½ åœ¨&lt;code&gt;jar -jar&lt;/code&gt;çš„æ—¶å€™ï¼Œé»˜è®¤çš„JVMå †å†…å­˜æ˜¯å¤šå°‘å‘¢?&lt;/p&gt;

&lt;p&gt;å…¶å®ï¼ŒJVMåœ¨ä¸åŒæ¶æ„(é…ç½®)çš„OSä¸‹å›ä½“ç°å‡ºä¸åŒçš„JVMé…ç½®ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ª&lt;code&gt;8c16g&lt;/code&gt;çš„ECSä¸Šï¼Œé»˜è®¤çš„Heapå€¼å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ java -XX:+PrintFlagsFinal -version | grep HeapSize
    uintx ErgoHeapSizeLimit                         = 0                                   {product}
    uintx HeapSizePerGCThread                       = 87241520                            {product}
    uintx InitialHeapSize                          := 264241152                           {product}
    uintx LargePageHeapSizeThreshold                = 134217728                           {product}
    uintx MaxHeapSize                              := 4206886912                          {product}
java version &amp;#34;1.8.0_141&amp;#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç”±ä¸Šè¿°çš„è¾“å‡ºå¯çŸ¥ï¼Œåˆå§‹çš„å †å†…å­˜ä¸º&lt;code&gt;264241152/1024/1024=252M&lt;/code&gt;ï¼Œè€Œå †å†…å­˜æœ€å¤§ä¸º&lt;code&gt;4206886912/1024/1024/1024=3G&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæ—¶å€™å¯èƒ½å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œè¯¥ECSä¸Šè·‘å¤šå°‘ä¸ª&lt;code&gt;java -jar xxx.jar&lt;/code&gt;è¿™ç±»çš„æœåŠ¡ä¼šæ¯”è¾ƒå¥½å‘¢ï¼Ÿå¦‚æœæŒ‰ç…§æ¯ä¸ªæœåŠ¡éƒ½èƒ½ä½¿ç”¨3Gçš„å †å†…å­˜æ¥ç®—ï¼Œè¯¥æœºå™¨ä¸Šåšå¤šè·‘4ä¸ªè¿™ç±»çš„æœåŠ¡æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„è§„åˆ’ï¼Œä½†æ˜¯è€ƒè™‘å®é™…çš„ä¸šåŠ¡ä½¿ç”¨éœ€æ±‚ï¼Œå•çº¯è¿™æ ·è€ƒè™‘å¯èƒ½ä¼šæœ‰ç‚¹å”çªäº†ï¼Œå› æ­¤è¿˜æ˜¯å»ºè®®æ¯ä¸ªåº”ç”¨åœ¨éƒ¨ç½²æ—¶æŒ‡å®šä¸€äº›åŸºç¡€çš„å‚æ•°ï¼Œæ¯”å¦‚åˆå§‹å †å’Œæœ€å¤§å †ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªå‚æ•°ä¸€èˆ¬å»ºè®®è®¾ç½®æˆä¸€è‡´ï¼Œä»¥å…åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å †çš„æ‰©å®¹é€ æˆçš„æŸè€—ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gai9amj2lcj30vu0b275p.jpg&#34; alt=&#34;çŸ¥è¯†æ˜Ÿçƒ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gdra6n69uhj30f00kkgot.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨Minioçš„å¯è§‚æµ‹æ€§æ–¹æ¡ˆ</title>
      <link>https://bgbiao.top/post/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8minio%E7%9A%84%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E6%96%B9%E6%A1%88/</link>
      <pubDate>Sun, 12 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8minio%E7%9A%84%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E6%96%B9%E6%A1%88/</guid>
      
        <description>

&lt;blockquote&gt;
&lt;p&gt;èƒŒæ™¯: å¯¹äºåˆåˆ›ä¼ä¸šæ¥è¯´ï¼Œåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´ä¸€äº›åŸºç¡€çš„å¼€æºæœåŠ¡åŸºæœ¬éƒ½æ˜¯&amp;rdquo;è£¸å¥”&amp;rdquo;ä¸Šçº¿çš„ï¼Œé™¤äº†ä¸€äº›ä¼ ç»Ÿçš„ä¸»æœºçº§åˆ«çš„ç›‘æ§ä¹‹å¤–ï¼Œå¾ˆéš¾æœ‰ä¸€äº›é¢å¤–çš„æ€§èƒ½æŒ‡æ ‡æ¥æè¿°è¯¥æœåŠ¡çš„æ•´ä½“æ€§èƒ½æƒ…å†µã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬çš„&lt;a href=&#34;https://bgbiao.top/post/minio%E5%88%86%E5%B8%83%E5%BC%8F%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/&#34;&gt;Minioå¯¹è±¡å­˜å‚¨æœåŠ¡&lt;/a&gt;ä¸Šçº¿åˆ°æœ€è¿‘ä¸€ç›´ä¹Ÿæ˜¯è£¸å¥”çš„ï¼Œè™½ç„¶æš‚æ—¶ä¹Ÿæ²¡å‡ºç°è¿‡æ•…éšœï¼Œä½†æ˜¯ä½œä¸ºä¸€åä¸“ä¸šæç¬‘çš„SREæ¥è®²ï¼ŒæœåŠ¡çš„å¯è§‚æµ‹æ€§ä¸€å®šå¾—è·Ÿä¸Šï¼Œä¸ç„¶åæœŸé“é”…æ˜¯å¦¥å¦¥çš„èƒŒå®šäº†ï¼Œè¿™ç¯‡æ–‡ç« å°±ä¸»è¦ä»‹ç»ä¸‹&lt;code&gt;Minio&lt;/code&gt;çš„å¯è§‚æµ‹æ€§æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;å¼€æºç»„ä»¶çš„å¯è§‚æµ‹æ€§ç°çŠ¶&#34;&gt;å¼€æºç»„ä»¶çš„å¯è§‚æµ‹æ€§ç°çŠ¶&lt;/h3&gt;

&lt;p&gt;åœ¨å¼€å¤´æåˆ°äº†ï¼Œåˆåˆ›ä¼ä¸šçš„å¼€æºæœåŠ¡åˆæœŸå¤§å¤šéƒ½æ˜¯è£¸å¥”ä¸Šçº¿çš„ï¼Œå‡ºç°è¿™ç§æƒ…å†µæˆ‘è®¤ä¸ºä¸€èˆ¬åˆ†ä¸ºå†…å› å’Œå¤–å› :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å†…å› æ˜¯å¼€æºçš„åŸºç¡€ä¸­é—´ä»¶æ€§èƒ½æŒ‡æ ‡é€šå¸¸å¾ˆå¤šï¼Œä¸å®¹æ˜“æŠ½è±¡ï¼Œå› æ­¤è¿™äº›æœåŠ¡çš„æ€§èƒ½æŒ‡æ ‡æ•°æ®é€šå¸¸å¯ä»¥é€šè¿‡å†…éƒ¨çš„apiæˆ–cliæ¥è·å–ï¼Œä¸å¤ªå®¹æ˜“ç›´æ¥å’Œå¼€æºçš„ç›‘æ§ç³»ç»Ÿè¿›è¡Œé›†æˆ;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¤–å› æ˜¯å¯¹äºåˆåˆ›ä¼ä¸šæ¥è¯´ï¼ŒäººåŠ›æœ‰é™å¹¶ä¸”å¯¹äºä¼—å¤šå¼€æºç»„ä»¶çš„ç†è§£ä¸å¤Ÿæ·±å…¥å¯¼è‡´å‰é¢è¯´çš„&amp;rdquo;è£¸å¥”&amp;rdquo;ä¸Šçº¿çš„ç°è±¡ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸è¿‡éšç€ä»¥&lt;code&gt;Kubernetes&lt;/code&gt;ï¼Œ&lt;code&gt;Prometheus&lt;/code&gt;ä¸ºä»£è¡¨çš„CloudNativeç†å¿µä¸æ–­å‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€æºä¸­é—´ä»¶ä¹Ÿæ”¯æŒäº†å…¼å®¹&lt;code&gt;Prometheus Metrics&lt;/code&gt;æ ¼å¼çš„æ€§èƒ½æŒ‡æ ‡ï¼Œè¿™å¯¹äºåˆåˆ›ä¼ä¸šçš„æŠ€æœ¯å›¢é˜Ÿæ¥è¯´å¯è°“æ˜¯ä¸€ä¸ªç¦éŸ³ã€‚&lt;/p&gt;

&lt;p&gt;æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å¾ˆå¤šå¼€æºè½¯ä»¶å·²ç»å†…ç½®äº†å…¼å®¹&lt;code&gt;Prometheus Metrics&lt;/code&gt;çš„APIæ¥å£ï¼Œä¸å†éœ€è¦ç¬¬ä¸‰æ–¹çš„&lt;code&gt;exporter&lt;/code&gt;æ¥å¯¼å‡ºä¸€äº›æ€§èƒ½æŒ‡æ ‡æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;[å†…ç½®Metricsæ¥å£çš„å¼€æºè½¯ä»¶](https://prometheus.io/docs/instrumenting/exporters/#software-exposing-prometheus-metrics)&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.ceph.com/docs/master/mgr/prometheus/&#34;&gt;Ceph&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-metrics&#34;&gt;Docker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/operations/admin.html#get--stats?format=prometheus&#34;&gt;Envoy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/coreos/etcd&#34;&gt;Etcd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/flink&#34;&gt;Flink&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.grafana.org/administration/metrics/&#34;&gt;Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Kong/kong-plugin-prometheus&#34;&gt;Kong&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes&#34;&gt;Kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/BuoyantIO/linkerd&#34;&gt;Linkerd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/minio/minio&#34;&gt;Minio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rabbitmq.com/prometheus.html&#34;&gt;RabbitMQ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/influxdata/telegraf/tree/master/plugins/outputs/prometheus_client&#34;&gt;Telegraf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containous/traefik&#34;&gt;Traefik&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/openzipkin/zipkin/tree/master/zipkin-server#metrics&#34;&gt;Zipkin&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;minioé›†ç¾¤çš„å¯è§‚æµ‹æ€§&#34;&gt;Minioé›†ç¾¤çš„å¯è§‚æµ‹æ€§&lt;/h3&gt;

&lt;p&gt;å¾—ç›Šäº&lt;code&gt;Minio&lt;/code&gt;çš„äº‘åŸç”ŸåŒ–ï¼Œè¿™æ¬¾åˆ†å¸ƒå¼çš„å¯¹è±¡å­˜å‚¨æœåŠ¡å¤©ç„¶çš„æ”¯æŒäº†&lt;code&gt;Prometheus Metrics&lt;/code&gt;æ ¼å¼çš„æŒ‡æ ‡æ•°æ®ä»¥åŠæœåŠ¡ç«¯ç‚¹(API)ï¼Œå› æ­¤ï¼Œå¦‚æœæƒ³è¦åœ¨å·²æœ‰çš„Minioé›†ç¾¤ä¸­å¢åŠ æ€§èƒ½æŒ‡æ ‡çš„ç›‘æ§ï¼Œå°†æ˜¯ä¸€ä»¶å¾ˆå®¹æ˜“çš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.min.io/docs/how-to-monitor-minio-using-prometheus.html&#34;&gt;ä½¿ç”¨Prometheusç›‘æ§MinioæœåŠ¡&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;MinioæœåŠ¡é€šè¿‡å†…ç½®çš„æœåŠ¡ç«¯ç‚¹æš´éœ²ç›‘æ§æ•°æ®ï¼Œç”¨æ¥ç›‘æ§æœåŠ¡æ•´ä½“çš„å¥åº·çŠ¶æ€ä»¥åŠæ€§èƒ½æŒ‡æ ‡:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Healthcheck æ¢é’ˆ: æä¾›ä¸¤ä¸ªæœåŠ¡æ¢æ´»æ¥å£ï¼Œä¸€ä¸ªç”¨äºæ£€æµ‹æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œå¦å¤–ä¸€ä¸ªç”¨äºæ£€æµ‹æœåŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡(æœåŠ¡å°±ç»ª)&lt;/li&gt;
&lt;li&gt;- æ¢æ´»æ¥å£: &lt;code&gt;/minio/health/live&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;- å°±ç»ªæ¥å£: &lt;code&gt;/minio/health/ready&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Prometheus æ¢é’ˆ: æä¾›äº†prometheus metricsæ ¼å¼çš„æ€§èƒ½æŒ‡æ ‡æ•°æ®&lt;/li&gt;
&lt;li&gt;- Metricsæ¥å£: &lt;code&gt;/minio/prometheus/metrics&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; Healthcheckç›¸å…³çš„æ¢é’ˆé»˜è®¤æ˜¯éè®¤è¯çš„æ¥å£ï¼ŒæœåŠ¡å¯åŠ¨åå¯ç›´æ¥è®¿é—®; Prometheusæ¢é’ˆçš„æ¥å£é»˜è®¤æ˜¯åŸºäº&lt;code&gt;JWTè®¤è¯&lt;/code&gt;çš„æ¥å£ï¼Œéœ€è¦é¢å¤–è®¾ç½®æ¥è®¿é—®å…¶Metricsæ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Minioçš„Metricsæ•°æ®æš´éœ²&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç®¡ç†å‘˜å¯é€šè¿‡ä¸‹è¿°æ–¹å¼è·å–Metricsç«¯ç‚¹çš„jwt token:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# è·å–token
$ mc admin prometheus generate  minio
scrape_configs:
- job_name: minio-job
  bearer_token: eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJleHAiOjQ3NDAwMzM4MjAsImlzcyI6InByb21ldGhldXMiLCJzdWIiOiJNaW5pb1NvdWwifQ.1QiANgXVCpAPWCdF9EejhH608rZbdCRcHe3RtalC2XnScWtYMk_OG0ih-Z3t4ADb1cnYREdTrQwWscFw6Xvk3Q
  metrics_path: /minio/prometheus/metrics
  scheme: http
  static_configs:
  - targets: [minio.bgbiao.top]

# åœ¨é…ç½®prometheusçš„scrapeæ—¶é…ç½®å¦‚ä¸Šç›¸å…³å‚æ•°&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;é€šå¸¸å¯¹äºå†…éƒ¨ç³»ç»Ÿé—´çš„è°ƒç”¨æ¥è¯´ï¼Œæƒé™å¯èƒ½æ²¡é‚£ä¹ˆé‡è¦ï¼Œå¯ä»¥å¢åŠ å¦‚ä¸‹ç¯å¢ƒå˜é‡æ¥å¼€å¯metricsçš„éè®¤è¯æ–¹å¼:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;MINIO_PROMETHEUS_AUTH_TYPE=&amp;#34;public&amp;#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œç›´æ¥è®¿é—®æ¥å£å¯ä»¥è·å–åˆ°å¦‚ä¸‹çš„Metricsæ•°æ®:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ curl -s  minio.bgbiao.top/minio/prometheus/metrics | head -10
# HELP disk_storage_available Total available space left on the disk
# TYPE disk_storage_available gauge
disk_storage_available{disk=&amp;#34;/data/minio&amp;#34;} 2.78376280064e+11
# HELP disk_storage_total Total space on the disk
# TYPE disk_storage_total gauge
disk_storage_total{disk=&amp;#34;/data/minio&amp;#34;} 3.00809048064e+11
# HELP disk_storage_used Total disk storage used on the disk
# TYPE disk_storage_used gauge
disk_storage_used{disk=&amp;#34;/data/minio&amp;#34;} 2.2432768e+10
# HELP go_gc_duration_seconds A summary of the GC invocation durations.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;minio-metricsç›¸å…³å®šä¹‰&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ ‡å‡†çš„è¿è¡Œæ—¶æŒ‡æ ‡ä½¿ç”¨ä»¥&lt;code&gt;go_&lt;/code&gt;å¼€å¤´&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹çº§åˆ«çš„æŒ‡æ ‡ä»¥&lt;code&gt;process_&lt;/code&gt;å¼€å¤´&lt;/li&gt;
&lt;li&gt;prometheusæš´éœ²çš„æŒ‡æ ‡&lt;code&gt;promhttp_&lt;/code&gt;å¼€å¤´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;disk_storage_used&lt;/code&gt;: ç£ç›˜ä½¿ç”¨ç©ºé—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;disk_storage_available&lt;/code&gt;: ç£ç›˜å¯ç”¨ç©ºé—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;disk_storage_total&lt;/code&gt;: ç£ç›˜æ€»ç©ºé—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;minio_disks_offline&lt;/code&gt;: å½“å‰minioå®ä¾‹ä¸­å¤„äºä¸‹çº¿çŠ¶æ€çš„ä¸ªæ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;minio_disks_total&lt;/code&gt;: å½“å‰minioå®ä¾‹çš„ç£ç›˜æ€»æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s3_requests_total&lt;/code&gt;: å½“å‰minioå®ä¾‹ä¸­s3æ¥å£æ€»è¯·æ±‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s3_errors_total&lt;/code&gt;: s3æ¥å£é”™è¯¯è¯·æ±‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s3_requests_current&lt;/code&gt;: æ´»åŠ¨çŠ¶æ€çš„s3è¯·æ±‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;internode_rx_bytes_total&lt;/code&gt;: å½“å‰MinIOæœåŠ¡å™¨å®ä¾‹æ¥æ”¶çš„èŠ‚ç‚¹é—´å­—èŠ‚çš„æ€»æ•°(bytes)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;internode_tx_bytes_total&lt;/code&gt;: å½“å‰MinIOæœåŠ¡å™¨å®ä¾‹å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹çš„å­—èŠ‚æ€»æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s3_rx_bytes_total&lt;/code&gt;: å½“å‰MinIOæœåŠ¡å™¨å®ä¾‹æ¥æ”¶çš„s3å­—èŠ‚æ€»æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s3_tx_bytes_total&lt;/code&gt;: å½“å‰MinIOæœåŠ¡å™¨å®ä¾‹å‘é€çš„s3å­—èŠ‚æ€»æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s3_ttfb_seconds_&lt;/code&gt;: ç»Ÿè®¡s3è¯·æ±‚çš„å»¶è¿Ÿä¿¡æ¯&lt;/li&gt;
&lt;li&gt;- bucket: bucketæ“ä½œç›¸å…³çš„å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;- count: å»¶è¿Ÿç»Ÿè®¡&lt;/li&gt;
&lt;li&gt;- sum: æ€»å»¶è¿Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; Minioä¸åŒçš„ç‰ˆæœ¬çš„Metricsæ•°æ®æœ‰åŒºåˆ«ï¼Œéœ€è¦æŸ¥çœ‹å…·ä½“æš´éœ²çš„æ•°æ®æŒ‡æ ‡&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ç¤ºä¾‹&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æ‰“å¼€æ–‡ä»¶æ•°
process_open_fds{job=&amp;#34;minio-metrics&amp;#34;}

# å¯åŠ¨æ—¶é—´(æ—¶é—´æˆ³)
process_start_time_seconds{job=&amp;#34;minio-metrics&amp;#34;}

# è™šæ‹Ÿå†…å­˜ä½¿ç”¨
process_virtual_memory_bytes{job=&amp;#34;minio-metrics&amp;#34;}

# cpuå ç”¨æ—¶é—´
process_cpu_seconds_total{job=&amp;#34;minio-metrics&amp;#34;}

# minioå¯¹å¤–çš„httpæ¥å£çŠ¶æ€
promhttp_metric_handler_requests_total{job=&amp;#34;minio-metrics&amp;#34;}

# é“¾æ¥ä¸­çš„httpè¯·æ±‚
promhttp_metric_handler_requests_in_flight{job=&amp;#34;minio-metrics&amp;#34;}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®prometheusæ•°æ®æŠ“å–&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; æˆ‘ä»¬çš„Prometheusæ˜¯ä½¿ç”¨CRDæ–¹å¼éƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸­çš„ï¼Œå› æ­¤æŠ“å–å¤–éƒ¨Metricsæ•°æ®éœ€è¦åšå¦‚ä¸‹çš„æ“ä½œ.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# æš´éœ²minioæœåŠ¡
$ cat endpoint-minio.yaml
apiVersion: v1
kind: Endpoints
metadata:
  name: minio-metrics
  namespace: monitoring
  labels:
    app: minio-metrics
subsets:
- addresses:
  - ip: 192.168.0.148
  - ip: 192.168.0.149
  - ip: 192.168.0.150
  - ip: 192.168.0.151
  ports:
  - port: 9000
    name: http-metrics
    protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  namespace: monitoring
  name: minio-metrics
  labels:
    app: minio-metrics
spec:
  ports:
  - name: http-metrics
    port: 9000
    targetPort: 9000
    protocol: TCP

# prometheus servicemonitor
$ cat prometheus-minio.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    app: minio-metrics
  name: minio-metrics
  namespace: monitoring
spec:
  # å¯¹åº”çš„ç«¯ç‚¹æ˜¯ä¸Šé¢åˆ›å»ºçš„svcçš„ports
  endpoints:
  # å¯ä»¥å®šä¹‰ä¸¤ä¸ªé‡‡é›†ç«¯ç‚¹ï¼Œä¸€ä¸ªæ˜¯minioæœåŠ¡æœ¬èº«çš„ç›‘æ§ï¼Œä¸€ä¸ªæ˜¯minioèŠ‚ç‚¹çš„åŸºç¡€ç›‘æ§
  - interval: 30s
    port: http-metrics
    path: /minio/prometheus/metrics
  jobLabel: app
  # åŒ¹é…monitoringå‘½åç©ºé—´çš„app=minio-metricsçš„svc
  namespaceSelector:
    matchNames:
    - monitoring
  selector:
    matchLabels:
      app: minio-metrics&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹prometheusç›‘æ§çš„minioç›¸å…³æ•°æ®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;PrometheusæˆåŠŸæŠ“å–minio metricsæ•°æ®åï¼Œå³å¯åœ¨prometheusä¸­æŸ¥çœ‹åˆ°å…ˆå…³æ•°æ®:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdnrt82rfpj324a0t47at.jpg&#34; alt=&#34;minio-prometheus-metrics&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨Grafanaä¸­é…ç½®å…³å¿ƒçš„æŒ‡æ ‡ä»¥åŠç›¸å…³å›¾è¡¨:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdofcrk9bbj31gr0u04a4.jpg&#34; alt=&#34;minio-grafanaç›‘æ§&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºäº†æ–¹ä¾¿å…¶ä»–è¿ç»´å°ä¼™ä¼´ä»¬ï¼Œæˆ‘å°†Minioçš„Grafanaæ¨¡æ¿å¼€æºå‡ºæ¥ï¼Œæœ‰éœ€æ±‚çš„å¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚ä¸‹æ¨¡æ¿:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://grafana.com/grafana/dashboards/12063&#34;&gt;minio-grafanaæ¨¡æ¿&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gai9amj2lcj30vu0b275p.jpg&#34; alt=&#34;çŸ¥è¯†æ˜Ÿçƒ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gdra6n69uhj30f00kkgot.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>Traefikçš„å¯è§‚æµ‹æ€§æ–¹æ¡ˆ</title>
      <link>https://bgbiao.top/post/traefik%E7%9A%84%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E6%96%B9%E6%A1%88/</link>
      <pubDate>Tue, 07 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/traefik%E7%9A%84%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E6%96%B9%E6%A1%88/</guid>
      
        <description>&lt;h2 id=&#34;traefikçš„å¯è§‚æµ‹æ€§æ”¯æŒ&#34;&gt;Traefikçš„å¯è§‚æµ‹æ€§æ”¯æŒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.traefik.io/observability/logs/&#34;&gt;traefik-observability&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨Traefik-2.Xçš„ç”Ÿæ€é‡Œï¼Œå°†å¯è§‚æµ‹æ€§åˆ†ä¸ºäº†å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼Œå¹¶æå‡åˆ°äº†ä¸“é—¨çš„åŠŸèƒ½è¯´æ˜ä¸­&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æœåŠ¡æ—¥å¿—: Traefikè¿›ç¨‹æœ¬èº«ç›¸å…³çš„æ“ä½œæ—¥å¿—&lt;/li&gt;
&lt;li&gt;è®¿é—®æ—¥å¿—: ç”±Traefikæ¥ç®¡çš„ä»£ç†æœåŠ¡çš„è®¿é—®æ—¥å¿—(access.log)&lt;/li&gt;
&lt;li&gt;Metrics: Traefikæä¾›çš„è‡ªèº«è¯¦ç»†çš„metricsæ•°æ®&lt;/li&gt;
&lt;li&gt;Tracing: Traefikä¹Ÿæä¾›äº†è¿½è¸ªç›¸å…³çš„æ¥å£ï¼Œç”¨æ¥å¯è§†åŒ–åˆ†å¸ƒå¼æˆ–å¾®æœåŠ¡ä¸­çš„è°ƒç”¨æƒ…å†µ&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;æœåŠ¡æ—¥å¿—&#34;&gt;æœåŠ¡æ—¥å¿—&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;é»˜è®¤çš„ç¯å¢ƒä¸­,Traefikä¼šå°†æ—¥å¿—ä»¥&lt;code&gt;text&lt;/code&gt;æ ¼å¼å†™å…¥åˆ°stdoutä¸­ï¼Œå¦‚æœä½¿ç”¨dockerçš„æ–¹å¼éƒ¨ç½²çš„è¯ï¼Œæƒ³è¦æŸ¥çœ‹æ—¥å¿—éœ€è¦ä½¿ç”¨&lt;code&gt;docker logs container_name&lt;/code&gt;æ–¹å¼æ¥æŸ¥çœ‹æ—¥å¿—ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ç›¸å…³é…ç½®&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®æ–‡ä»¶
$ cat traefik.toml
[log]
  filePath = &amp;#34;/path/to/traefik.log&amp;#34;   # é…ç½®traefikçš„è¿›ç¨‹æ—¥å¿—è·¯å¾„
  format = &amp;#34;json&amp;#34;                     # é…ç½®æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼[text(text|json)]
  level = &amp;#34;DEBUG&amp;#34;                     # æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„çº§åˆ«[ERROR(ERROR|DEBUG|INFO|PANIC|FATAL|WARN)]

# cli é…ç½®
--log.filePath=/path/to/traefik.log
--log.format=json
--log.level=DEBUG&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; å…·ä½“çš„æ—¥å¿—é…ç½®å‚æ•°éœ€è¦å’Œå½“å‰ç¯å¢ƒä¸­çš„traefikå¤§ç‰ˆæœ¬å…¼å®¹ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&#34;è®¿é—®æ—¥å¿—&#34;&gt;è®¿é—®æ—¥å¿—&lt;/h3&gt;

&lt;p&gt;è®¿é—®æ—¥å¿—ç”¨æ¥è®°å½•é€šè¿‡traefikè¿›æ¥çš„å„ä¸ªè¯·æ±‚çš„è®¿é—®è¯¦æƒ…ï¼ŒåŒ…å«HTTPè¯·æ±‚çš„å„ä¸ªheaderä»¥åŠå“åº”æ—¶é—´ç­‰æ•°æ®ï¼Œç±»ä¼¼äºNginxä¸­çš„&lt;code&gt;access.log&lt;/code&gt;ï¼Œé€šå¸¸æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®æ—¥å¿—æ¥åˆ†ææ•´ä¸ªtraefikçš„æ•´ä½“æµé‡ä»¥åŠå„ä¸ªæœåŠ¡æµé‡ä»¥åŠçŠ¶æ€è¯¦æƒ…ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; è®¿é—®æ—¥å¿—é»˜è®¤ä¹Ÿæ˜¯ä»¥&lt;code&gt;text&lt;/code&gt;æ ¼å¼è¢«å†™åˆ°æ ‡å‡†è¾“å‡ºçš„&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ç›¸å…³é…ç½®&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®æ–‡ä»¶
$ cat traefik.toml
[accessLog]
  filePath = &amp;#34;/path/to/traefik.log&amp;#34;
  format = &amp;#34;&amp;#34;                       # æŒ‡å®šè®¿é—®æ—¥å¿—çš„æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨CLF(Common Log Format)ï¼Œå¯ä»¥æŒ‡å®šä¸ºjsonæ ¼å¼
  bufferingSize = 100               # ä»¥å¼‚æ­¥æ–¹å¼å†™å…¥æ—¥å¿—éœ€è¦æŒ‡å®šè¯¥å‚æ•°ï¼Œè¡¨ç¤ºå†™å…¥åˆ°æŒ‡å®šè¾“å‡ºè®¾å¤‡å‰ä¿ç•™åœ¨å†…å­˜ä¸­çš„æ—¥å¿—è¡Œæ•°
  [accessLog.filters]               # æŒ‡å®šä¸€ç»„é€»è¾‘ä¸Šæ˜¯Orçš„è¿‡æ»¤è¿æ¥å™¨,æŒ‡å®šå¤šä¸ªè¿‡æ»¤å™¨å°†æ¯”åªæŒ‡å®šä¸€ä¸ªè¿‡æ»¤å™¨ä¿ç•™æ›´å¤šçš„è®¿é—®æ—¥å¿—
    statusCodes = [&amp;#34;200&amp;#34;, &amp;#34;300-302&amp;#34;] # è¿‡æ»¤æŒ‡å®šçŠ¶æ€ç èŒƒå›´çš„è¯·æ±‚æ—¥å¿—
    retryAttempts = true             # å½“æœ‰é‡è¯•æ—¶ä¿ç•™æ—¥å¿—
    minDuration = &amp;#34;10ms&amp;#34;             # å½“è¯·æ±‚èŠ±è´¹çš„æ—¶é—´è¶…è¿‡æŒ‡å®šçš„æŒç»­æ—¶é—´æ—¶ï¼Œä¿ç•™è®¿é—®æ—¥å¿—
    
  [accessLog.fields]                # é™åˆ¶è®¿é—®æ—¥å¿—ä¸­çš„å­—æ®µ(å¯ä»¥ä½¿ç”¨fields.nameså’Œfields.headeré€‰é¡¹æ¥å†³å®šå­—æ®µçš„è¾“å‡º)
    defaultMode = &amp;#34;keep&amp;#34;            # æ¯ç§å­—æ®µå¯ä»¥è®¾ç½®æˆå¦‚ä¸‹å­—æ®µ(keep:ä¿ç•™å­—æ®µ,drop:ä¸¢å¼ƒ,redact:ä½¿ç”¨redactedæ›¿æ¢å€¼)
    [accessLog.fields.names]        # æŒ‡å®šé™åˆ¶çš„å­—æ®µåç§°
      &amp;#34;ClientUsername&amp;#34; = &amp;#34;drop&amp;#34;     # è®¾ç½®ClientUsernameå­—æ®µä¸ºä¸¢å¼ƒ
    [accessLog.fields.headers]      # è®¾ç½®headersç›¸å…³å­—æ®µ
      defaultMode = &amp;#34;keep&amp;#34;          # å¯¹å…¨éƒ¨çš„headerè¿›è¡Œé»˜è®¤ä¿ç•™
      [accessLog.fields.headers.names] # å¯¹æŒ‡å®šçš„headerå­—æ®µè®¾ç½®ä¿ç•™è§„åˆ™
        &amp;#34;User-Agent&amp;#34; = &amp;#34;redact&amp;#34;
        &amp;#34;Authorization&amp;#34; = &amp;#34;drop&amp;#34;
        &amp;#34;Content-Type&amp;#34; = &amp;#34;keep&amp;#34;

# cli é…ç½®
--accesslog=true
--accesslog.filepath=/path/to/access.log
--accesslog.format=json
--accesslog.bufferingsize=100
--accesslog.filters.statuscodes=200,300-302
--accesslog.filters.retryattempts
--accesslog.filters.minduration=10ms
--accesslog.fields.defaultmode=keep
--accesslog.fields.names.ClientUsername=drop
--accesslog.fields.headers.defaultmode=keep
--accesslog.fields.headers.names.User-Agent=redact
--accesslog.fields.headers.names.Authorization=drop
--accesslog.fields.headers.names.Content-Type=keep&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; ç”±äºæˆ‘ä»¬æ˜¯å°†Traefikå½“åšKubernetesé›†ç¾¤ä¸­çš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œå»ä»£ç†å†…éƒ¨HTTPæœåŠ¡çš„ï¼Œå› æ­¤Traefikéƒ¨ç½²åœ¨é›†ç¾¤å†…éƒ¨,å°†è¿›ç¨‹æ—¥å¿—å’Œè®¿é—®æ—¥å¿—éƒ½ä»¥volumeçš„æ–¹å¼æŒ‚è½½åˆ°è¾¹ç¼˜èŠ‚ç‚¹çš„æ•°æ®ç›®å½•ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;DaemonSet&lt;/code&gt;æ–¹å¼å°†Traefikéƒ¨ç½²åœ¨k8sé›†ç¾¤å†…éƒ¨ï¼Œå…·ä½“çš„é…ç½®å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;97
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ cat traefik-ds.yml
---
kind: DaemonSet
apiVersion: extensions/v1beta1
metadata:
  name: traefik-ingress-controller
  namespace: kube-system
  labels:
    k8s-app: traefik-ingress-lb
spec:
  template:
    metadata:
      labels:
        k8s-app: traefik-ingress-lb
        name: traefik-ingress-lb
    spec:
      affinity:
        # å®šä¹‰nodeçš„äº²å’Œæ€§ï¼Œä¸å…è®¸è°ƒåº¦åˆ°masterèŠ‚ç‚¹
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-role.kubernetes.io/master
                operator: DoesNotExist
      serviceAccountName: traefik-ingress-controller
      terminationGracePeriodSeconds: 30
      hostNetwork: true
      containers:
      - image: traefik:v1.7.16
        name: traefik-ingress-lb
        ports:
        - name: http
          containerPort: 80
          hostPort: 80
        - name: admin
          containerPort: 8080
        securityContext:
          capabilities:
            drop:
            - ALL
            add:
            - NET_BIND_SERVICE
        args:
        - --api
        - --kubernetes
        - --logLevel=INFO
        - --traefikLog.filePath=/logdata/traefik.log
        - --configfile=/config/traefik.toml
        - --accesslog.filepath=/logdata/access.log
        - --accesslog.bufferingsize=100
        volumeMounts:
        - mountPath: /config
          name: config
        - mountPath: /logdata
          name: access-log
      volumes:
      - configMap:
          name: traefik-config
        name: config
      - name: access-log
        hostPath:
          path: /opt/logs/ingress/

# æŸ¥çœ‹traefik çš„çŠ¶æ€
$ kubectl  get pods -n kube-system  | grep traefik
traefik-ingress-controller-2dx7k   1/1     Running   0          5h28m
...
...

$ kubectl  get svc -n kube-system  | grep traefik
traefik-ingress-service   ClusterIP   10.253.132.216   &amp;lt;none&amp;gt;        80/TCP,8080/TCP          123d
traefik-web-ui            ClusterIP   10.253.54.184    &amp;lt;none&amp;gt;        80/TCP                   172d


# å¯ä»¥é€šè¿‡èŠ‚ç‚¹çš„pingæ¥å£å’Œadminæ¥å£æ¥æŸ¥çœ‹traefikæœåŠ¡æ˜¯å¦æ­£å¸¸
$ curl 10.253.132.216/ping
OK

$ curl 10.253.132.216:8080
&amp;lt;a href=&amp;#34;/dashboard/&amp;#34;&amp;gt;Found&amp;lt;/a&amp;gt;.


# åœ¨è°ƒåº¦åˆ°treafikçš„èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹è¿›ç¨‹æ—¥å¿—å’Œè®¿é—®æ—¥å¿—
$ tree -L 2 /opt/logs/ingress/
/opt/logs/ingress/
â”œâ”€â”€ access.log
â””â”€â”€ traefik.log

$ tail -n 10 /opt/logs/ingress/traefik.log
time=&amp;#34;2020-04-07T08:53:38Z&amp;#34; level=warning msg=&amp;#34;Endpoints not available for my-data/my-data-selfaccess-dev&amp;#34;
time=&amp;#34;2020-04-07T08:53:38Z&amp;#34; level=warning msg=&amp;#34;Endpoints not available for my-data/my-data-metadata-prod1&amp;#34;


$ tail -n 10 /opt/logs/ingress/access.log
172.16.21.28 - - [07/Apr/2020:08:52:54 +0000] &amp;#34;POST /.kibana/_search?ignore_unavailable=true&amp;amp;filter_path=aggregations.types.buckets HTTP/1.1&amp;#34; 503 161 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34; 491674 &amp;#34;prod-es-cluster.soulapp-inc.cn&amp;#34; &amp;#34;http://20.0.41.10:9200&amp;#34; 1ms
172.16.21.28 - - [07/Apr/2020:08:52:54 +0000] &amp;#34;POST /.kibana/_search?ignore_unavailable=true&amp;amp;filter_path=aggregations.types.buckets HTTP/1.1&amp;#34; 503 161 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34; 491671 &amp;#34;prod-es-cluster.soulapp-inc.cn&amp;#34; &amp;#34;http://20.0.26.20:9200&amp;#34; 1ms
172.16.21.28 - - [07/Apr/2020:08:52:54 +0000] &amp;#34;GET /.kibana/doc/config%3A6.4.0 HTTP/1.1&amp;#34; 503 301 &amp;#34;-&amp;#34; &amp;#34;-&amp;#34; 491675 &amp;#34;prod-es-cluster.soulapp-inc.cn&amp;#34; &amp;#34;http://20.0.14.6:9200&amp;#34; 1ms&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä»è®¿é—®æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œtraefikçš„è®¿é—®æ—¥å¿—å’ŒNginxçš„è®¿é—®æ—¥å¿—ä¼šæ¯”è¾ƒç›¸ä¼¼ï¼Œæœ‰äº†è¿™ä»½æ—¥å¿—åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›ELKä¹‹ç±»çš„æ—¥å¿—åˆ†ææ–¹æ¡ˆæ¥åˆ†æœŸç½‘ç«™çš„æ•´ä½“çŠ¶æ€ï¼Œæ¯”å¦‚UV,PV,åŒºåŸŸåˆ†å¸ƒï¼ŒçŠ¶æ€åˆ†å¸ƒä»¥åŠå“åº”æ—¶é—´ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œæˆ‘ä»¬æ˜¯å°†è®¿é—®æ—¥å¿—ç›´æ¥æŒä¹…åŒ–è¾“å‡ºåˆ°nodeèŠ‚ç‚¹ä¸Šï¼Œåé¢å¯ä»¥é€šè¿‡nodeä¸»æœºä¸Šçš„æ—¥å¿—é‡‡é›†æ’ä»¶ï¼Œå°†æ—¥å¿—å‘é€åˆ°ELK Stackä¸­ï¼Œè¿›è¡Œåˆ†æï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å°†ELK Stackçš„æ—¥å¿—é‡‡é›†ç«¯éƒ¨ç½²åˆ°traefikçš„podä¸­ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;metrics&#34;&gt;Metrics&lt;/h3&gt;

&lt;p&gt;Traefiké»˜è®¤æ”¯æŒå››ç§Metricsçš„åç«¯å®ç°:
- &lt;a href=&#34;https://docs.traefik.io/observability/metrics/datadog/&#34;&gt;Datadog&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/metrics/influxdb/&#34;&gt;Influxdb&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/metrics/prometheus/&#34;&gt;Prometheus&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/metrics/statsd/&#34;&gt;StatsD&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æƒ³è¦å¼€å¯&lt;code&gt;metrics&lt;/code&gt;çš„æ”¯æŒï¼Œåªéœ€è¦åšå¦‚ä¸‹é…ç½®:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®æ–‡ä»¶
    [metrics]
      [metrics.prometheus]
      buckets=[0.1,0.3,1.2,5.0]
      entryPoint = &amp;#34;traefik&amp;#34;

# yaml é…ç½®æ–‡ä»¶
metrics: {}

# cli é…ç½®
--metrics=true&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Datadogåç«¯æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é…ç½®è¯¦æƒ…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# tomlé…ç½®æ–‡ä»¶
[metrics]
  [metrics.datadog]
    address = &amp;#34;127.0.0.1:8125&amp;#34;
    addEntryPointsLabels = true   #åœ¨å…¥å£å¤„å¢åŠ metricsæ ‡ç­¾[true]
    addServicesLabels = true      #åœ¨serviceä¸­å¯ç”¨meirtcs[true]
    pushInterval = 10s            #push metricsåˆ°datalogçš„é—´éš”æ—¶é—´[10s]

# cli é…ç½®
--metrics.datadog=true
--metrics.datadog.address=127.0.0.1:8125
--metrics.datadog.addEntryPointsLabels=true
--metrics.datadog.addServicesLabels=true
--metrics.datadog.pushInterval=10s&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;InfluxDBåç«¯æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é…ç½®è¯¦æƒ…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# tomlé…ç½®
[metrics]
  [metrics.influxDB]
    address = &amp;#34;localhost:8089&amp;#34;     #æŒ‡å®šinfluxdbåœ°å€ [localhost:8089]
    protocol = &amp;#34;udp&amp;#34;               #influxdbçš„ä¼ è¾“åè®® [udp(udp|http)]
    database = &amp;#34;db&amp;#34;                #æŒ‡å®šmetricså†™å…¥çš„åº“[&amp;#34;&amp;#34;]
    retentionPolicy = &amp;#34;two_hours&amp;#34;  #metricsåœ¨influxdbä¸­çš„ä¿ç•™ç­–ç•¥ [&amp;#34;&amp;#34;]
    username = &amp;#34;&amp;#34;                  #influxdbç”¨æˆ·å
    password = &amp;#34;&amp;#34;                  #influxdbå¯†ç 
    addEntryPointsLabels = true    #å…¥å£å¤„å¢åŠ metricsæ ‡ç­¾[true]
    addServicesLabels = true       #åœ¨serviceä¸­å¯ç”¨meirtcs[true]
    pushInterval = 10s             #push metricsåˆ°datalogçš„é—´éš”æ—¶é—´[10s]

# cli é…ç½®
--metrics.influxdb=true
--metrics.influxdb.address=localhost:8089
--metrics.influxdb.protocol=udp
--metrics.influxdb.database=db
--metrics.influxdb.retentionPolicy=two_hours
--metrics.influxdb.username=john
--metrics.influxdb.password=secret
--metrics.influxdb.addEntryPointsLabels=true
--metrics.influxdb.addServicesLabels=true
--metrics.influxdb.pushInterval=10s&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Prometheusåç«¯æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é…ç½®è¯¦æƒ…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# tomlé…ç½®
[metrics]
  [metrics.prometheus]
    buckets = [0.1,0.3,1.2,5.0]      #å»¶è¿Ÿçš„metricsçš„bucketå­˜å‚¨[0.100000, 0.300000, 1.200000, 5.000000]
    addEntryPointsLabels = true      #å…¥å£å¤„å¢åŠ metricsæ ‡ç­¾[true]
    addServicesLabels = true         #åœ¨serviceä¸­å¯ç”¨meirtcs[true]
    entryPoint = &amp;#34;traefik&amp;#34;           #æŒ‡å®šmetricsçš„ç«¯ç‚¹[traefik(é»˜è®¤æ˜¯ç®¡ç†ç«¯å£8080/metrics)],ä¹Ÿå¯ä»¥è‡ªå®šä¹‰
    manualRouting = true             #æ˜¯å¦ç¦ç”¨å†…éƒ¨è·¯ç”±[false]

# clié…ç½®
--metrics.prometheus=true
--metrics.prometheus.buckets=0.100000, 0.300000, 1.200000, 5.000000
--metrics.prometheus.addEntryPointsLabels=true
--metrics.prometheus.addServicesLabels=true
## è‡ªå®šä¹‰äº†ä¸€ä¸ªmetricsç«¯ç‚¹ï¼Œå¹¶æŒ‡å®šäº†ç«¯å£
--metrics.prometheus.entryPoint=metrics
--entryPoints.metrics.address=:8082
--metrics.prometheus.manualrouting=true&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;å’Œå…¶ä»–ä¸¤ç§æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œprometheusä»…ä¼šæš´éœ²metricsï¼Œæ˜¯éœ€è¦ä½¿ç”¨prometheus-serverå®šæœŸè¿›è¡Œ&lt;code&gt;pull&lt;/code&gt;æ¥æ”¶é›†æ•°æ®çš„ã€‚&lt;/p&gt;

&lt;p&gt;é…ç½®ç”Ÿæ•ˆåï¼Œå¯ä»¥è®¿é—®å¦‚ä¸‹ç«¯å£è¿›è¡Œæµ‹è¯•:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# è‡ªå®šä¹‰äº†metricsç«¯ç‚¹
$ curl localhost:8082/metrics

# ä½¿ç”¨é»˜è®¤çš„traefikç«¯ç‚¹(ç”¨çš„æ˜¯adminçš„ç«¯å£)
$ curl localhost:8080/metrics&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;StatsDåç«¯æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¯¦ç»†é…ç½®:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®
[metrics]
  [metrics.statsD]
    address = &amp;#34;localhost:8125&amp;#34;          # æŒ‡å®šstatsDæœåŠ¡åœ°å€
    addEntryPointsLabels = true         # å…¥å£å¤„å¢åŠ metricsæ ‡ç­¾[true] 
    addServicesLabels = true            # åœ¨serviceä¸­å¯ç”¨meirtcs[true]
    pushInterval = 10s                  # pushé—´éš”
    prefix = &amp;#34;traefik&amp;#34;                  # å®šä¹‰metricsæ”¶é›†çš„å‰ç¼€[traefik]

# cli é…ç½®
--metrics.statsd=true
--metrics.statsd.address=localhost:8125
--metrics.statsd.addEntryPointsLabels=true
--metrics.statsd.addServicesLabels=true
--metrics.statsd.pushInterval=10s
--metrics.statsd.prefix=&amp;#34;traefik&amp;#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Prometheusåç«¯çš„Metricsç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; ç”±äºåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æ˜¯traefik-1.7.6ç‰ˆæœ¬ï¼Œå› æ­¤ä¸Šè¿°çš„ä¸€äº›é…ç½®å‚æ•°å¯èƒ½å¹¶ä¸é€‚ç”¨äºè¯¥ç‰ˆæœ¬ï¼Œè¯¦ç»†çš„å‚æ•°éœ€è¦æŸ¥çœ‹å…·ä½“ç‰ˆæœ¬çš„æ”¯æŒå‚æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬å°†traefikå½“åškubernetesé›†ç¾¤ä¸­çš„ingressæ–¹æ¡ˆï¼Œå› æ­¤å¦‚ä¸‹æ“ä½œåœ¨ä¸€ä¸ªå¯ç”¨çš„k8sé›†ç¾¤å†…éƒ¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.traefik.io/v1.7/configuration/metrics/&#34;&gt;traefik-1.7-metrics&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;1.traefikçš„metricsé…ç½®&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# traefik metrics é…ç½®
$ cat traefik-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: traefik-config
  namespace: kube-system
data:
  traefik.toml: |
    defaultEntryPoints = [&amp;#34;http&amp;#34;,&amp;#34;https&amp;#34;]
    debug = false
    logLevel = &amp;#34;INFO&amp;#34;

    InsecureSkipVerify = true
    [entryPoints]
      [entryPoints.http]
      address = &amp;#34;:80&amp;#34;
      compress = true
      [entryPoints.https]
      address = &amp;#34;:443&amp;#34;
        [entryPoints.https.tls]
    [web]
      address = &amp;#34;:8080&amp;#34;
    [kubernetes]
    # å®šä¹‰metricsç›¸å…³å‚æ•°
    [metrics]
      [metrics.prometheus]
      buckets=[0.1,0.3,1.2,5.0]
      entryPoint = &amp;#34;traefik&amp;#34;
    [ping]
    entryPoint = &amp;#34;http&amp;#34;

# é‡æ–°è°ƒåº¦podåï¼Œå³å¯æŸ¥çœ‹æš´éœ²çš„endpoint

$ kubectl  get ep -A | grep traefik
kube-system            traefik-ingress-service                    172.16.171.163:80,172.16.21.26:80,172.16.21.27:80 + 11 more...            122d
kube-system            traefik-web-ui                             172.16.171.163:8080,172.16.21.26:8080,172.16.21.27:8080 + 4 more...       171d

$ kubectl  get svc -n kube-system | grep traefik
traefik-ingress-service   ClusterIP   10.253.132.216   &amp;lt;none&amp;gt;        80/TCP,8080/TCP          122d
traefik-web-ui            ClusterIP   10.253.54.184    &amp;lt;none&amp;gt;        80/TCP                   171d

# æµ‹è¯•è®¿é—®metricsæœåŠ¡(å› ä¸ºå’Œtraefikç›¸å…³çš„ä¸¤ä¸ªserviceå‡è·¯ç”±åˆ°äº†traefil-ingressçš„podä¸Š,ä¸‹é¢ä¸¤ä¸ªæ•ˆæœæ˜¯ä¸€è‡´çš„)
$ curl -s  10.253.132.216:8080/metrics  | head -10
....
....
$ curl -s  10.253.54.184/metrics | head -10&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; æ¨èä½¿ç”¨traefik-web-uiæš´éœ²çš„svcåœ°å€&lt;/p&gt;

&lt;p&gt;æŒ‡æ ‡ä»¥åŠç›¸å…³å«ä¹‰:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æŒ‡æ ‡é¡¹&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;process_max_fds&lt;/td&gt;
&lt;td&gt;traefikè¿›ç¨‹æœ€å¤§çš„fd&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;process_open_fds&lt;/td&gt;
&lt;td&gt;è¿›ç¨‹æ‰“å¼€çš„fd&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;process_resident_memory_bytes&lt;/td&gt;
&lt;td&gt;è¿›ç¨‹å ç”¨å†…å­˜&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;process_start_time_seconds&lt;/td&gt;
&lt;td&gt;è¿›ç¨‹å¯åŠ¨æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;process_virtual_memory_bytes&lt;/td&gt;
&lt;td&gt;è¿›ç¨‹å ç”¨è™šæ‹Ÿå†…å­˜&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_backend_open_connections&lt;/td&gt;
&lt;td&gt;traefikåç«¯æ‰“å¼€é“¾æ¥&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_backend_request_duration_seconds_bucket&lt;/td&gt;
&lt;td&gt;traefikåç«¯è¯·æ±‚å¤„ç†æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_backend_request_duration_seconds_sum&lt;/td&gt;
&lt;td&gt;æ€»æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_backend_request_duration_seconds_count&lt;/td&gt;
&lt;td&gt;æ€»è¯·æ±‚æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_backend_requests_total&lt;/td&gt;
&lt;td&gt;ä¸€ä¸ªåç«¯å¤„ç†çš„æ€»è¯·æ±‚æ•°(æŒ‰status code, protocol, and methodåˆ’åˆ†)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_backend_server_up&lt;/td&gt;
&lt;td&gt;åç«¯æ˜¯å¦up(0&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_config_last_reload_failure&lt;/td&gt;
&lt;td&gt;traefikä¸Šæ¬¡å¤±è´¥reloadçš„æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_config_last_reload_success&lt;/td&gt;
&lt;td&gt;ä¸Šæ¬¡æˆåŠŸreloadçš„æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_config_reloads_failure_total&lt;/td&gt;
&lt;td&gt;å¤±è´¥æ¬¡æ•°&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_config_reloads_total&lt;/td&gt;
&lt;td&gt;æˆåŠŸæ¬¡æ•°&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_entrypoint_open_connections&lt;/td&gt;
&lt;td&gt;å…¥å£ç‚¹å­˜åœ¨æ‰“å¼€é“¾æ¥çš„æ•°é‡(method and protocolåˆ’åˆ†)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_entrypoint_request_duration_seconds_bucket&lt;/td&gt;
&lt;td&gt;åœ¨å…¥å£ç‚¹å¤„ç†è¯·æ±‚èŠ±è´¹çš„æ—¶é—´(status code, protocol, and method.)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;traefik_entrypoint_requests_total&lt;/td&gt;
&lt;td&gt;ä¸€ä¸ªå…¥å£ç‚¹å¤„ç†çš„æ€»è¯·æ±‚æ•°(çŠ¶æ€ç åˆ†å¸ƒ)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code&gt;2.é…ç½®prometheus-server&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æ³¨æ„ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦é…ç½®prometheus-serveræ¥å¯¹traefikæš´éœ²çš„metricsè¿›è¡Œå®šæœŸçš„pullé‡‡é›†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# åœ¨k8sä¸­åˆ›å»ºä¸€ä¸ªprometheus monitor service
$ cat prometheus-traefik.yml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    k8s-app: traefik-ingress-lb
  name: traefik-metrics
  namespace: monitoring
spec:
  # å¯¹åº”çš„ç«¯ç‚¹æ˜¯ä¸Šé¢åˆ›å»ºçš„svcçš„ports
  endpoints:
    # å®šä¹‰endpointé‡‡é›†çš„æ—¶é—´
  - interval: 30s
    port: admin
    path: /metrics
  jobLabel: k8s-app
  # åŒ¹é…monitoringå‘½åç©ºé—´çš„app=gpu-metricsçš„svc
  namespaceSelector:
    matchNames:
    - kube-system
  selector:
    matchLabels:
      k8s-app: traefik-ingress-lb

$ kubectl apply -f prometheus-traefik.yml&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;é…ç½®å®Œæˆåï¼Œå³å¯åœ¨prometheusä¸­æŸ¥çœ‹ç›¸å…³çš„metricsæ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdl4lcmvwsj32620o0ah5.jpg&#34; alt=&#34;prometheus-traefik-metrics&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;3.æ ¹æ®æŒ‡æ ‡é…ç½®Grafana&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://grafana.com/grafana/dashboards/12041&#34;&gt;grafanaæ¨¡æ¿&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdl6drdnotj31kw0u0gxk.jpg&#34; alt=&#34;Traefik-å…¨å±€ç›‘æ§è¯¦æƒ…&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æœ‰äº†Mericsçš„å¯è§†åŒ–åï¼Œé’ˆå¯¹äºHTTPæœåŠ¡æ¥è¯´åšå„ç§æ»šåŠ¨å‡çº§ä»¥åŠåˆ‡æµå‘å¸ƒæ—¶ï¼Œå°±å¾ˆå®¹æ˜“èƒ½å¤Ÿçœ‹åˆ°æ•´ä¸ªæµé‡çš„å˜åŒ–ã€‚&lt;/p&gt;

&lt;h3 id=&#34;tracing&#34;&gt;Tracing&lt;/h3&gt;

&lt;p&gt;è¿½è¸ªç³»ç»Ÿå¯ä»¥å¼€å‘äººå‘˜å¯è§†åŒ–å…¶åŸºç¡€æ¶æ„ä¸­çš„è°ƒç”¨æµç¨‹.&lt;/p&gt;

&lt;p&gt;Traefikéµå¾ªOpenTracingè§„èŒƒ(ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼è·Ÿè¸ªè€Œè®¾è®¡çš„å¼€æ”¾æ ‡å‡†)&lt;/p&gt;

&lt;p&gt;Traefikæ”¯æŒäº”ç§è¿½è¸ªç³»ç»Ÿåç«¯:
- &lt;a href=&#34;https://docs.traefik.io/observability/tracing/jaeger/&#34;&gt;Jaeger&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/tracing/zipkin/&#34;&gt;Zipkin&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/tracing/datadog/&#34;&gt;Datadog&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/tracing/instana/&#34;&gt;Instana&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/tracing/haystack/&#34;&gt;Haystack&lt;/a&gt;
- &lt;a href=&#34;https://docs.traefik.io/observability/tracing/elastic/&#34;&gt;Elastic&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; Datadog,Instana,Haystackä¸ºå•†ä¸šè§£å†³æ–¹æ¡ˆï¼Œä»¥ä¸‹ä¸åšä»‹ç»&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1.é…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; é»˜è®¤æƒ…å†µä¸‹ï¼Œtraefikä½¿ç”¨&lt;code&gt;Jaeger&lt;/code&gt;æ¥æœ€ä¸ºè¿½è¸ªç³»ç»Ÿçš„åç«¯å®ç°.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®æ–‡ä»¶
$ cat traefik.toml
[tracing]
  serviceName = &amp;#34;traefik&amp;#34;			# é€‰æ‹©è¿½è¸ªç³»ç»Ÿçš„åç«¯å®ç°[traefik(è¡¨ç¤ºä½¿ç”¨jaeger)]
  spanNameLimit = 150					# é™åˆ¶é•¿åç§°çš„åç§°é˜¶æ®µ(è¿™å¯ä»¥é˜²æ­¢æŸäº›è·Ÿè¸ªæä¾›ç¨‹åºåˆ é™¤è¶…è¿‡å…¶é•¿åº¦é™åˆ¶çš„è·Ÿè¸ª)

# cli é…ç½®
--tracing=true
--tracing.serviceName=traefik
--tracing.spanNameLimit=150&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;2.Jaeger&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›¸å…³é…ç½®:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®æ–‡ä»¶
$ cat traefik.toml
[tracing]
  [tracing.jaeger]					# å¼€å¯jaegerçš„è¿½è¸ªæ”¯æŒ
    samplingServerURL = &amp;#34;http://localhost:5778/sampling&amp;#34; 		# æŒ‡å®šjaeger-agentçš„httpé‡‡æ ·åœ°å€
    samplingType = &amp;#34;const&amp;#34;	# æŒ‡å®šé‡‡æ ·ç±»å‹[const(const|probabilistic|rateLimiting)]
    samplingParam = 1.0			# é‡‡æ ·å‚æ•°çš„å€¼[1.0(const:0|1,probabilistic:0-1,rateLimiting:æ¯ç§’çš„spanæ•°)]
    localAgentHostPort = &amp;#34;127.0.0.1:6831&amp;#34;										# æœ¬åœ°agentä¸»æœºå’Œç«¯å£(ä¼šå‘é€åˆ°jaeger-agent)
    gen128Bit = true				# ç”Ÿæˆ128ä½çš„traceId,å…¼å®¹OpenCensus
    propagation = &amp;#34;jaeger&amp;#34;  # è®¾ç½®æ•°æ®ä¼ è¾“çš„headerç±»å‹[jaeger(jaeger|b3å…¼å®¹OpenZipkin)]
    traceContextHeaderName = &amp;#34;uber-trace-id&amp;#34;  # è·Ÿè¸ªä¸Šä¸‹æ–‡çš„header,ç”¨äºä¼ è¾“è·Ÿè¸ªä¸Šä¸‹æ–‡çš„httpå¤´å
  [tracing.jaeger.collector]  # æŒ‡å®šjaegerçš„collectoræœåŠ¡
    endpoint = &amp;#34;http://127.0.0.1:14268/api/traces?format=jaeger.thrift&amp;#34;
    user = &amp;#34;my-user&amp;#34;          # å‘collectoræäº¤æ—¶çš„httpè®¤è¯ç”¨æˆ·[&amp;#34;&amp;#34;]
    password = &amp;#34;my-password&amp;#34;  # å‘collectoræäº¤æ—¶çš„httpè®¤è¯å¯†ç [&amp;#34;&amp;#34;]


# cli é…ç½®
--tracing.jaeger=true
--tracing.jaeger.samplingServerURL=http://localhost:5778/sampling
--tracing.jaeger.samplingType=const
--tracing.jaeger.samplingParam=1.0
--tracing.jaeger.localAgentHostPort=127.0.0.1:6831
--tracing.jaeger.gen128Bit
--tracing.jaeger.propagation=jaeger
--tracing.jaeger.traceContextHeaderName=uber-trace-id
--tracing.jaeger.collector.endpoint=http://127.0.0.1:14268/api/traces?format=jaeger.thrift
--tracing.jaeger.collector.user=my-user
--tracing.jaeger.collector.password=my-password&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3.Zipkin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›¸å…³é…ç½®:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®æ–‡ä»¶
[tracing]
  [tracing.zipkin]                  # æŒ‡å®šä½¿ç”¨zipkinè¿½è¸ªç³»ç»Ÿ
    httpEndpoint = &amp;#34;http://localhost:9411/api/v2/spans&amp;#34;   # æŒ‡å®šzipkipæ”¶é›†æ•°æ®çš„httpç«¯ç‚¹
    sameSpan = true                 # ä½¿ç”¨Zipkin SameSpan RPC ç±»å‹è¿½è¸ªæ–¹å¼
    id128Bit = true                 # ä½¿ç”¨Zipkin 128 bitçš„è¿½è¸ªid(true)
    sampleRate = 0.2                # æŒ‡å®šè¯·æ±‚traceç³»ç»Ÿçš„é¢‘ç‡[1.0(0.1-1.0)]

# cli é…ç½®
--tracing.zipkin=true
--tracing.zipkin.httpEndpoint=http://localhost:9411/api/v2/spans
--tracing.zipkin.sameSpan=true
--tracing.zipkin.id128Bit=false
--tracing.zipkin.sampleRate=0.2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;4.Elastic&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›¸å…³é…ç½®:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# toml é…ç½®æ–‡ä»¶
$ cat traefik.toml
[tracing]
  [tracing.elastic]
    serverURL = &amp;#34;http://apm:8200&amp;#34;     # æŒ‡å®šElastic APMæœåŠ¡åœ°å€
    secretToken = &amp;#34;&amp;#34;                  # æŒ‡å®šElastic APMæœåŠ¡çš„å®‰å…¨token
    serviceEnvironment = &amp;#34;&amp;#34;           # æŒ‡å®šAPM Serverçš„ç¯å¢ƒ

# cli é…ç½®
--tracing.elastic=true
--tracing.elastic.serverurl=&amp;#34;http://apm:8200&amp;#34;
--tracing.elastic.secrettoken=&amp;#34;mytoken&amp;#34;
--tracing.elastic.serviceenvironment=&amp;#34;production&amp;#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gai9amj2lcj30vu0b275p.jpg&#34; alt=&#34;çŸ¥è¯†æ˜Ÿçƒ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlly1gdra6n69uhj30f00kkgot.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>åŸºäºDCGMå’ŒPrometheusçš„GPUç›‘æ§æ–¹æ¡ˆ</title>
      <link>https://bgbiao.top/post/%E5%9F%BA%E4%BA%8Edcgm%E5%92%8Cprometheus%E7%9A%84gpu%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/</link>
      <pubDate>Sun, 05 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/%E5%9F%BA%E4%BA%8Edcgm%E5%92%8Cprometheus%E7%9A%84gpu%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/</guid>
      
        <description>&lt;h2 id=&#34;åŸºäºdcgmå’Œprometheusçš„gpuç›‘æ§æ–¹æ¡ˆ&#34;&gt;åŸºäºDCGMå’ŒPrometheusçš„GPUç›‘æ§æ–¹æ¡ˆ&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;èƒŒæ™¯: åœ¨æ—©æœŸçš„GPUç›‘æ§ä¸­æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€äº›NVMLå·¥å…·æ¥å¯¹GPUå¡çš„åŸºæœ¬ä¿¡æ¯è¿›è¡Œé‡‡é›†ï¼Œå¹¶æŒä¹…åŒ–åˆ°ç›‘æ§ç³»ç»Ÿçš„æ•°æ®å­˜å‚¨å±‚ã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œå…¶å®é€šè¿‡&lt;code&gt;nvidia-smi&lt;/code&gt;è¿™æ ·çš„å‘½ä»¤ä¹Ÿæ˜¯å¯ä»¥è·å–åˆ°GPUçš„åŸºæœ¬ä¿¡æ¯çš„ï¼Œä½†éšç€æ•´ä¸ªAIå¸‚åœºçš„å‘å±•å’Œæˆç†Ÿï¼Œå¯¹äºGPUçš„ç›‘æ§ä¹Ÿè¶Šæ¥è¶Šéœ€è¦ä¸€å¥—æ ‡å‡†åŒ–çš„å·¥å…·ä½“ç³»ï¼Œä¹Ÿå°±æ˜¯æœ¬ç¯‡æ–‡ç« è®²çš„å…³äº&lt;a href=&#34;https://developer.nvidia.com/dcgm&#34;&gt;DCGM&lt;/a&gt;ç›¸å…³çš„ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;DCGM(Data Center GPU Manager)å³æ•°æ®ä¸­å¿ƒGPUç®¡ç†å™¨ï¼Œæ˜¯ä¸€å¥—ç”¨äºåœ¨é›†ç¾¤ç¯å¢ƒä¸­ç®¡ç†å’Œç›‘è§†&lt;code&gt;Teslaâ„¢&lt;/code&gt;GPUçš„å·¥å…·ã€‚&lt;/p&gt;

&lt;p&gt;å®ƒåŒ…æ‹¬ä¸»åŠ¨å¥åº·ç›‘æ§ï¼Œå…¨é¢è¯Šæ–­ï¼Œç³»ç»Ÿè­¦æŠ¥ä»¥åŠåŒ…æ‹¬ç”µæºå’Œæ—¶é’Ÿç®¡ç†åœ¨å†…çš„æ²»ç†ç­–ç•¥ã€‚&lt;/p&gt;

&lt;p&gt;å®ƒå¯ä»¥ç”±ç³»ç»Ÿç®¡ç†å‘˜ç‹¬ç«‹ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°é›†æˆåˆ°NVIDIAåˆä½œä¼™ä¼´çš„é›†ç¾¤ç®¡ç†ï¼Œèµ„æºè°ƒåº¦å’Œç›‘è§†äº§å“ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;DCGMç®€åŒ–äº†æ•°æ®ä¸­å¿ƒä¸­çš„GPUç®¡ç†ï¼Œæé«˜äº†èµ„æºå¯é æ€§å’Œæ­£å¸¸è¿è¡Œæ—¶é—´ï¼Œè‡ªåŠ¨åŒ–äº†ç®¡ç†ä»»åŠ¡ï¼Œå¹¶æœ‰åŠ©äºæé«˜æ•´ä½“åŸºç¡€æ¶æ„æ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; è™½ç„¶å¯ä»¥é€šè¿‡&lt;code&gt;nvidia-smi&lt;/code&gt;å‘½ä»¤å°†ç›¸å…³çš„ä¿¡æ¯é‡‡é›†ï¼Œå¹¶å®šæœŸæ±‡æŠ¥åˆ°æ•°æ®å­˜å‚¨è¿›è¡Œæ•°æ®åˆ†æè®¡ç®—å’Œå±•ç°ï¼Œä½†æ˜¯æ¶‰åŠåˆ°ä¸€æ•´å¥—çš„ç›‘æ§ä½“ç³»çš„æ•´åˆï¼Œä»ç„¶éœ€è¦ä½¿ç”¨æ–¹è¿›è¡Œä¸€äº›åˆ—çš„æ”¹é€ ã€‚å› æ­¤è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨NVIDIAå®˜æ–¹æä¾›çš„DCGMæ–¹æ¡ˆæ¥è¿›è¡ŒGPUæ•°æ®é‡‡é›†ï¼Œå¹¶é€šè¿‡å£°ç§°ä¸‹ä¸€ä»£ç›‘æ§ç³»ç»Ÿçš„Prometheusè¿›è¡Œæ•´ä¸ªç›‘æ§å’Œå‘Šè­¦çš„é›†æˆã€‚&lt;/p&gt;

&lt;h3 id=&#34;dcgmå·¥å…·éƒ¨ç½²&#34;&gt;DCGMå·¥å…·éƒ¨ç½²&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ git clone https://github.com/NVIDIA/gpu-monitoring-tools.git

# æ„å»ºdcgm-exporterå·¥å…·ï¼Œå…¶å®å°±æ˜¯nvidiaå®˜æ–¹å¯¹äºnvidia-docker2.xæ¨å‡ºçš„ç”¨äºgpuæ•°æ®ç›‘æ§çš„å·¥å…·
# æœ€ç»ˆä¼šå°†gpuå¡çš„metricsåŸºæœ¬ä¿¡æ¯å­˜å‚¨ä»¥metricsçš„æ•°æ®æ ¼å¼å­˜å‚¨åˆ°æ–‡ä»¶ä¸­
$ cd dcgm-exporter
# nvidia/dcgm-exporter:latest
$ make 

$ docker run -d --runtime=nvidia --rm --name=nvidia-dcgm-exporter nvidia/dcgm-exporter

# æŸ¥çœ‹dcgm-exporteræ”¶é›†åˆ°çš„gpu metricsæ•°æ®
$ docker exec -it nvidia-dcgm-exporter tail -n 10  /run/prometheus/dcgm.prom
dcgm_ecc_dbe_aggregate_total{gpu=&amp;#34;0&amp;#34;,uuid=&amp;#34;GPU-b91e30ac-fe77-e236-11ea-078bc2d1f226&amp;#34;} 0
# HELP dcgm_retired_pages_sbe Total number of retired pages due to single-bit errors.
# TYPE dcgm_retired_pages_sbe counter
dcgm_retired_pages_sbe{gpu=&amp;#34;0&amp;#34;,uuid=&amp;#34;GPU-b91e30ac-fe77-e236-11ea-078bc2d1f226&amp;#34;} 0
# HELP dcgm_retired_pages_dbe Total number of retired pages due to double-bit errors.
# TYPE dcgm_retired_pages_dbe counter
dcgm_retired_pages_dbe{gpu=&amp;#34;0&amp;#34;,uuid=&amp;#34;GPU-b91e30ac-fe77-e236-11ea-078bc2d1f226&amp;#34;} 0
# HELP dcgm_retired_pages_pending Total number of pages pending retirement.
# TYPE dcgm_retired_pages_pending counter
dcgm_retired_pages_pending{gpu=&amp;#34;0&amp;#34;,uuid=&amp;#34;GPU-b91e30ac-fe77-e236-11ea-078bc2d1f226&amp;#34;} 0&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;dcgm-exporteré‡‡é›†æŒ‡æ ‡é¡¹ä»¥åŠå«ä¹‰:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æŒ‡æ ‡&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;dcgm_fan_speed_percent&lt;/td&gt;
&lt;td&gt;GPU é£æ‰‡è½¬é€Ÿå æ¯”ï¼ˆ%ï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_sm_clock&lt;/td&gt;
&lt;td&gt;GPU sm æ—¶é’Ÿ(MHz)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_memory_clock&lt;/td&gt;
&lt;td&gt;GPU å†…å­˜æ—¶é’Ÿ(MHz)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_gpu_temp&lt;/td&gt;
&lt;td&gt;GPU è¿è¡Œçš„æ¸©åº¦(â„ƒ)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_power_usage&lt;/td&gt;
&lt;td&gt;GPU çš„åŠŸç‡ï¼ˆwï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_pcie_tx_throughput&lt;/td&gt;
&lt;td&gt;GPU PCIe TXä¼ è¾“çš„å­—èŠ‚æ€»æ•° ï¼ˆkbï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_pcie_rx_throughput&lt;/td&gt;
&lt;td&gt;GPU PCIe RXæ¥æ”¶çš„å­—èŠ‚æ€»æ•°   ï¼ˆkbï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_pcie_replay_counter&lt;/td&gt;
&lt;td&gt;GPU PCIeé‡è¯•çš„æ€»æ•°&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_gpu_utilization&lt;/td&gt;
&lt;td&gt;GPU åˆ©ç”¨ç‡ï¼ˆ%ï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_mem_copy_utilization&lt;/td&gt;
&lt;td&gt;GPU å†…å­˜åˆ©ç”¨ç‡ï¼ˆ%ï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_enc_utilization&lt;/td&gt;
&lt;td&gt;GPU ç¼–ç å™¨åˆ©ç”¨ç‡ ï¼ˆ%ï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_dec_utilization&lt;/td&gt;
&lt;td&gt;GPU è§£ç å™¨åˆ©ç”¨ç‡ (%)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_xid_errors&lt;/td&gt;
&lt;td&gt;GPU ä¸Šä¸€ä¸ªxidé”™è¯¯çš„å€¼&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_power_violation&lt;/td&gt;
&lt;td&gt;GPU åŠŸç‡é™åˆ¶å¯¼è‡´çš„èŠ‚æµæŒç»­æ—¶é—´(us)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_thermal_violation&lt;/td&gt;
&lt;td&gt;GPU çƒ­çº¦æŸèŠ‚æµæŒç»­æ—¶é—´(us)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_sync_boost_violation&lt;/td&gt;
&lt;td&gt;GPU åŒæ­¥å¢å¼ºé™åˆ¶ï¼Œé™åˆ¶æŒç»­æ—¶é—´(us)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_fb_free&lt;/td&gt;
&lt;td&gt;GPU fbï¼ˆå¸§ç¼“å­˜ï¼‰çš„å‰©ä½™ï¼ˆMiBï¼‰&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;dcgm_fb_used&lt;/td&gt;
&lt;td&gt;GPU fb ï¼ˆå¸§ç¼“å­˜ï¼‰çš„ä½¿ç”¨ ï¼ˆMiBï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;å…¶å®åˆ°è¿™ï¼Œdcgmå·²ç»å®Œæ•´çš„å°†æˆ‘ä»¬éœ€è¦çš„gpuçš„metricsæ•°æ®é‡‡é›†å‡ºæ¥äº†ï¼Œå¹¶ä¸”æ˜¯ç¬¦åˆprometheusçš„æ•°æ®æ ¼å¼å’Œæ ‡å‡†çš„ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…çš„æƒ…å†µç¼–å†™ä¸€ä¸ªç®€å•çš„apiç¨‹åºï¼Œå°†é‡‡é›†åˆ°çš„æ•°æ®ä»¥apiçš„å½¢å¼æš´éœ²å‡ºå»ï¼Œå°±å¯ä»¥è®©æ•´ä¸ªprometheus serverå¯¹å„ä¸ªgpuä¸»æœºçš„metricsè¿›è¡Œé‡‡é›†å’Œç›‘æ§ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿‡å®˜æ–¹æä¾›äº†åŸºäºkubernetesé›†ç¾¤ä¸­podæ–¹å¼çš„apiæ¥å£ï¼Œé‡‡ç”¨golangè¯­è¨€å¼€å‘ï¼Œå…·ä½“ä½¿ç”¨æƒ…å†µå¯å‚è€ƒå¦‚ä¸‹æ–‡æ¡£ã€‚&lt;/p&gt;

&lt;h3 id=&#34;prometheus-gpu-metrics-exporter&#34;&gt;prometheus gpu metrics exporter&lt;/h3&gt;

&lt;p&gt;åœ¨&lt;code&gt;gpu-monitoring-tools&lt;/code&gt;é¡¹ç›®ä¸­ï¼Œé»˜è®¤æä¾›äº†ä¸€ä¸ª&lt;code&gt;pod-gpu-metrics-exporter&lt;/code&gt;æ¨¡å—ï¼Œç”¨äºåœ¨kubernetesé›†ç¾¤ä¸­çš„gpu-metricsçš„éƒ¨ç½²ï¼Œå®˜æ–¹çš„ç¤ºä¾‹æ­¥éª¤å¦‚ä¸‹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;nvidia-k8s-device-plugin&lt;/li&gt;
&lt;li&gt;Deploy GPU Pods&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; åœ¨ä½¿kubernetesé›†ç¾¤ä¸­éƒ¨ç½²çš„å‰ææ˜¯ä½ çš„GPUè¦æ‰˜ç®¡åœ¨k8sé›†ç¾¤å†…éƒ¨ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä½ å¾—å…ˆæˆåŠŸå°†å¸¦GPUçš„ä¸»æœºæˆåŠŸæ‰˜ç®¡åˆ°é›†ç¾¤ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿè°ƒåº¦GPUèµ„æº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# åˆ›å»ºä¸€ä¸ªç›‘æ§çš„å‘½åç©ºé—´
# Create the monitoring namespace
$ kubectl create namespace monitoring

# Add gpu metrics endpoint to prometheus
$ kubectl create -f prometheus/prometheus-configmap.yaml

# Deploy prometheus
$ kubectl create -f prometheus/prometheus-deployment.yaml

$ kubectl create -f pod-gpu-metrics-exporter-daemonset.yaml

# Open in browser: localhost:9090

# å…·ä½“çš„dockeré•œåƒæ„å»ºå’Œè¿è¡Œ
# ä¾ç„¶æ˜¯gpu-monitoring-toolsé¡¹ç›®
$ cd  pod-gpu-metrics-exporter
$ docker build -t pod-gpu-metrics-exporter .

# è¿è¡Œdcgm-exporter
$ docker run -d --runtime=nvidia --rm --name=nvidia-dcgm-exporter nvidia/dcgm-exporter

# è¿è¡Œgpu-metrics-exporter
$ docker run -d --privileged --rm -p 9400:9400 -v /var/lib/kubelet/pod-resources:/var/lib/kubelet/pod-resources --volumes-from nvidia-dcgm-exporter:ro nvidia/pod-gpu-metrics-exporter:v1.0.0-alpha

# æ­¤æ—¶å°±å°†ä¸Šè¿°çš„é‚£ä¸ªdcgm-exporterä¸­é‡‡é›†åˆ°æ•°æ®æˆåŠŸæš´éœ²åˆ°å¯¹å¤–çš„æ¥å£äº†
$ curl -s localhost:9400/gpu/metrics&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨&lt;code&gt;gpu-metrics-exporter&lt;/code&gt;çš„ç¨‹åºä¸­ï¼Œæ˜¯é’ˆå¯¹podçš„æ–¹å¼æ¥é‡‡é›†gpuçš„metricsçš„ä¿¡æ¯ï¼Œå¹¶ä¸”é™„å¸¦äº†podæœ¬èº«çš„åŸºæœ¬ä¿¡æ¯ï¼Œå› æ­¤å¦‚æœä½ çš„&lt;code&gt;gpu&lt;/code&gt;ä¸»æœºè¿˜æœªåœ¨kubernetesé›†ç¾¤ä¸­æ‰˜ç®¡ï¼Œå®˜æ–¹æä¾›çš„é•œåƒå¯èƒ½å¹¶ä¸èƒ½ä½¿ç”¨ï¼Œéœ€è¦å¯¹&lt;code&gt;src/http.go&lt;/code&gt;æ–‡ä»¶ä¸­é‡‡é›†çš„è·¯å¾„è¿›è¡Œæ”¹å˜ï¼Œå°†é»˜è®¤çš„&lt;code&gt;gpuPodMetrics&lt;/code&gt;æ”¹æˆ&lt;code&gt;gpuMetrics&lt;/code&gt;å³å¯ï¼Œä¸¤è€…ä¼šå»è¯»å–ä¸åŒçš„dcgm-exporteræš´éœ²å‡ºæ¥çš„metricsæ–‡ä»¶ï¼Œå¦åˆ™è®¿é—®apiæ¥å£æ—¶ä¼šå‘ç°æ— æ³•æ‰¾åˆ°metricsæ–‡ä»¶.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func getGPUmetrics(resp http.ResponseWriter, req *http.Request) {
	//metrics, err := ioutil.ReadFile(gpuPodMetrics)
	metrics, err := ioutil.ReadFile(gpuMetrics)
	if err != nil {
		http.Error(resp, err.Error(), http.StatusInternalServerError)
		glog.Errorf(&amp;#34;error responding to %v%v: %v&amp;#34;, req.Host, req.URL, err.Error())
		return
	}
	resp.Write(metrics)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://github.com/BGBiao/gpu-monitoring-tools/tree/master/gpu-metrics-exporter&#34;&gt;gpu-metrics-exporter&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å›¾çœäº‹çš„ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½å¦‚ä¸‹ä¸¤ä¸ªé•œåƒï¼Œåœ¨å·²ç»work çš„GPUä¸»æœºä¸Šç›´æ¥è¿è¡Œ.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;dcgm-exporter: &lt;code&gt;docker pull bgbiao/dcgm-exporter:latest&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;gpu-metrics-exporter: &lt;code&gt;docker pull bgbiao/gpu-metrics-exporter:latest&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# ç¡®å®šdcgm-exporteræ˜¯è¿è¡Œçš„
$ docker run -d --runtime=nvidia --rm --name=nvidia-dcgm-exporter bgbiao/dcgm-exporter

$ docker run -d --privileged --rm -p 9400:9400  --volumes-from nvidia-dcgm-exporter:ro bgbiao/gpu-metrics-exporter

# æ£€æŸ¥gpuæš´éœ²å‡ºæ¥çš„åŸºç¡€ä¿¡æ¯
$ curl -s localhost:9400/gpu/metrics
dcgm_ecc_dbe_aggregate_total{gpu=&amp;#34;0&amp;#34;,uuid=&amp;#34;GPU-b91e30ac-fe77-e236-11ea-078bc2d1f226&amp;#34;} 0
....
....&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;prometheusé‡‡é›†&#34;&gt;prometheusé‡‡é›†&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; æœ‰äº†ä¸Šè¿°çš„gpu-metrics-exporterä¹‹åï¼Œæˆ‘ä»¬çš„gpuç›¸å…³çš„è¿è¡Œæ•°æ®å°±å¯ä»¥ä»¥premetheuså…¼å®¹çš„æ–¹å¼è·å–äº†ï¼Œæ­¤æ—¶åœ¨prometheus-serverä¸Šé…ç½®ï¼Œå»å®šæœŸpull æ•°æ®å³å¯ï¼Œæˆ‘ä»¬çš„prometheus-serverç›®å‰éƒ¨ç½²åœ¨kubernetesé›†ç¾¤å†…éƒ¨ï¼Œå› æ­¤è¿™é‡Œåˆ†äº«å°†gpuçš„æ•°æ®é‡‡é›†åˆ°kubernetesé›†ç¾¤å†…éƒ¨çš„prometheusä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ›å»ºendpointä»¥åŠå¯¹åº”çš„service&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# gpu-metricsçš„endpointå’Œserviceé…ç½®

$ cat endpoint-gpus.yaml
apiVersion: v1
kind: Endpoints
metadata:
  name: gpu-metrics
  namespace: monitoring
  labels:
    app: gpu-metrics
subsets:
- addresses:
  - ip: 172.16.65.234
  ports:
  - port: 9400
    name: http-metrics
    protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  namespace: monitoring
  name: gpu-metrics
  labels:
    app: gpu-metrics
spec:
  ports:
  - name: http-metrics
    port: 19400
    targetPort: 9400
    protocol: TCP

$ kubectl  apply -f endpoint-gpus.yaml

# æŸ¥çœ‹åˆ›å»ºçš„ç›¸å…³èµ„æº
$ kubectl  get ep,svc -n monitoring  -l app=gpu-metrics
NAME                    ENDPOINTS            AGE
endpoints/gpu-metrics   172.16.65.234:9400   5m24s

NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)     AGE
service/gpu-metrics   ClusterIP   10.253.138.97   &amp;lt;none&amp;gt;        19400/TCP   5m24s

# æµ‹è¯•serviceæš´éœ²çš„ç«¯ç‚¹
# ç¡®ä¿é›†ç¾¤å†…éƒ¨å¯ä»¥è®¿é—®serviceæš´éœ²å‡ºæ¥çš„endpointå³å¯

$ curl 10.253.138.97:19400/gpu/metrics
# HELP dcgm_sm_clock SM clock frequency (in MHz).
# TYPE dcgm_sm_clock gauge
dcgm_sm_clock{gpu=&amp;#34;0&amp;#34;,uuid=&amp;#34;GPU-b91e30ac-fe77-e236-11ea-078bc2d1f226&amp;#34;} 1328
# HELP dcgm_memory_clock Memory clock frequency (in MHz).
# TYPE dcgm_memory_clock gauge
dcgm_memory_clock{gpu=&amp;#34;0&amp;#34;,uuid=&amp;#34;GPU-b91e30ac-fe77-e236-11ea-078bc2d1f226&amp;#34;} 715&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºprometheusæŠ“å–æ•°æ®çš„è§„åˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;$ cat prometheus-gpus.yml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    app: gpu-metrics
  name: gpu-metrics
  namespace: monitoring
spec:
  # å¯¹åº”çš„ç«¯ç‚¹æ˜¯ä¸Šé¢åˆ›å»ºçš„svcçš„ports
  endpoints:
    # å®šä¹‰endpointé‡‡é›†çš„æ—¶é—´å’Œé‡‡é›†çš„URI
  - interval: 30s
    port: http-metrics
    path: /gpu/metrics
  jobLabel: app
  # åŒ¹é…monitoringå‘½åç©ºé—´çš„app=gpu-metricsçš„svc
  namespaceSelector:
    matchNames:
    - monitoring
  selector:
    matchLabels:
      app: gpu-metrics

$ kubectl  apply -f prometheus-gpus.yml
servicemonitor.monitoring.coreos.com/gpu-metrics created

$ kubectl  get servicemonitor  -n monitoring gpu-metrics
NAME          AGE
gpu-metrics   69s&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å½“ä¸Šè¿°èµ„æºåˆ›å»ºå®Œæˆåï¼Œåœ¨é›†ç¾¤å†…éƒ¨çš„prometheus-serverä¸­å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„targetï¼Œç¡®è®¤çŠ¶æ€ä¸ºupå³è¡¨ç¤ºprometheuså·²æ­£å¸¸é‡‡é›†é›†ç¾¤å¤–gpuçš„metricsæ•°æ®äº†ï¼Œæ¥ä¸‹æ¥æ•°æ®å°±ä¼šä»¥30sä¸ºé—´éš”ï¼Œæºæºä¸æ–­çš„å°†æ•°æ®é‡‡é›†åˆ°prometheuså­˜å‚¨ä¸­.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdiuxv5l47j31pk0aegon.jpg&#34; alt=&#34;prometheus-gpu-targets&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;gpuç›‘æ§ä¿¡æ¯çš„å±•ç¤º&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»åˆ°ä¸‡é‡Œé•¿å¾çš„æœ€åä¸€æ­¥äº†ï¼Œå°±æ˜¯æŠŠprometheusä¸­gpuçš„ç›‘æ§æ•°æ®ç”¨grafanaå±•ç¤ºå‡ºæ¥ï¼Œä»¥å®æ—¶å»åˆ†æä¸€äº›gpuçš„åŸºæœ¬æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨grafanaå®˜ç½‘ä¸­ï¼Œå·²ç»æœ‰å¤§ä½¬åˆ¶ä½œäº†gpuç›‘æ§çš„ç›¸å…³æ¨¡æ¿ï¼Œæ¯”å¦‚&lt;code&gt;[GPU-Nodes-Metrics](https://grafana.com/grafana/dashboards/12027)&lt;/code&gt;,å› æ­¤ï¼Œå¯¹äºæˆ‘ä»¬ä½¿ç”¨è€…æ¥è¯´ï¼Œåœ¨grafanaçš„é¢æ¿ä¸­ï¼Œå°†è¯¥æ¨¡æ¿å¯¼å…¥å³å¯ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdiv4s5t9nj30ec0ek0tc.jpg&#34; alt=&#34;é€‰æ‹©å¯¼å…¥æ–¹å¼åˆ›å»º&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdj0dzwdmjj31ly0u041p.jpg&#34; alt=&#34;æŒ‡å®šæ¨¡æ¿(dashboard idæˆ–json)&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdj0ftc6d8j31nd0u0djg.jpg&#34; alt=&#34;æ³¨æ„:ç¡®è®¤prometheusåº“æ­£ç¡®åå³å¯å¯¼å…¥&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gdj0h15tp5j31oi0u0n5x.jpg&#34; alt=&#34;æœ€ç»ˆçš„GPUç›‘æ§å›¾&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å‚è€ƒé¡¹ç›®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/NVIDIA/gpu-monitoring-tools&#34;&gt;gpu-monitor-tools&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://grafana.com/grafana/dashboards/11752&#34;&gt;gpu-metrics-grafana&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gai9amj2lcj30vu0b275p.jpg&#34; alt=&#34;çŸ¥è¯†æ˜Ÿçƒ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>æ„å»ºæ›´å°Dockeré•œåƒçš„ä¸€äº›å»ºè®®</title>
      <link>https://bgbiao.top/post/%E6%9E%84%E5%BB%BA%E6%9B%B4%E5%B0%8Fdocker%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BB%BA%E8%AE%AE/</link>
      <pubDate>Sun, 22 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/%E6%9E%84%E5%BB%BA%E6%9B%B4%E5%B0%8Fdocker%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BB%BA%E8%AE%AE/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;èƒŒæ™¯: å‰ä¸¤å¤©åœ¨ç¾¤é‡Œçœ‹åˆ°æœ‰äººæåˆ°è¯´ï¼Œè‡ªå·±æ„å»ºäº†ä¸€ä¸ªé•œåƒï¼Œæ˜æ˜å°±åªå¾€baseé•œåƒä¸­å¢åŠ äº†tomcatï¼Œä½†æ˜¯æ„å»ºå¥½çš„é•œåƒå¤§å°æœ€ç»ˆå´æ˜¯ä¸¤å€çš„tomcatåŒ…çš„å¤§å°ï¼Œæœ€åçœ‹åˆ°Dockerfileåæ‰å‘ç°ä½œè€…åœ¨æŠŠtomcatåŒ…æ‹·è´è¿›å»ä¹‹åï¼Œåˆä½¿ç”¨&lt;code&gt;RUN&lt;/code&gt;æŒ‡ä»¤ï¼Œæ‰§è¡Œäº†ä¸€æ¬¡&lt;code&gt;chmod a+x tomcat&lt;/code&gt;ï¼Œæˆ‘æƒ³è¯´ï¼Œè¿™ä¹ˆæé•œåƒä¸å¤§é‚£æ˜¯ä¸å¯èƒ½çš„ã€‚å¦å¤–ä¸€ä»¶äº‹å°±æ˜¯å‰æ®µæ—¶é—´ï¼ŒåŒäº‹è¯´è®©æä¸€ä¸ªå…¬å¸çº§åˆ«çš„baseé•œåƒï¼Œè¦ç¨³å®šå¹¶ä¸”å°½é‡å°ï¼Œå€Ÿç€è¿™ä¸¤ä¸ªäº‹ï¼Œå’Œå¤§å®¶åˆ†äº«å‡ ç‚¹Dockeré•œåƒç›¸å…³çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;é¦–å…ˆï¼Œé•œåƒçš„å¤§å°æœ€ç»ˆå–å†³äºå¦‚ä¸‹å‡ ç‚¹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.ä¸šåŠ¡éœ€æ±‚å’Œdebugçš„ä¾¿åˆ©æ€§(æ¯”å¦‚ç§‘å­¦è®¡ç®—å’Œæ™®é€šçš„javaæˆ–è€…golangç¨‹åº)&lt;/li&gt;
&lt;li&gt;2.ä¸šåŠ¡é•œåƒæ„å»ºçš„ä¾èµ–ç‰¹æ€§(æ„å»ºè¿‡ç¨‹å’Œäº¤ä»˜ç‰©çš„ä¾èµ–å…³ç³»)&lt;/li&gt;
&lt;li&gt;3.äº¤ä»˜ç‰©çš„å®šä¹‰è¿‡ç¨‹(Dockerfileåˆ†å±‚è¿‡ç¨‹ä¸­çš„å˜æ›´å±‚)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œä»ä¸‰ä¸ªç‚¹æ¥è°ˆè°ˆæˆ‘ä¸ªäººçš„æƒ³æ³•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸€ã€å•ä»é•œåƒå¤§å°çš„è§’åº¦è€ƒè™‘&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä»…ä»é•œåƒçš„å¤§å°è§’åº¦æ¥è®²ï¼Œä¸ºäº†é•œåƒå°½å¯èƒ½çš„å°ï¼Œæœ‰å¦‚ä¸‹çš„baseé•œåƒå¯ä¾›é€‰æ‹©:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;alpine: ä¸“ä¸ºå®¹å™¨è€Œç”Ÿçš„åŸºç¡€é•œåƒï¼Œç¼ºç‚¹æ˜¯é»˜è®¤ä½¿ç”¨çš„&lt;code&gt;musl libc&lt;/code&gt;ï¼Œä½†æ˜¯å¤§å¤šæ•°è¿è¡Œåœ¨Linuxä¸‹çš„ç¨‹åºå‡ ä¹éƒ½æ˜¯&lt;code&gt;glibc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;scratch: æ²¡æœ‰ä»»ä½•&lt;code&gt;æ‚å¿µ&lt;/code&gt;çš„åŸºç¡€é•œåƒï¼Œä¼˜ç‚¹å°±æ˜¯æ²¡æœ‰æ‚å¿µï¼Œç¼ºç‚¹ä¹Ÿæ˜æ˜¾å°±æ˜¯å„ç§åŠ¨æ€é“¾æ¥åº“ï¼Œshellç­‰ç­‰éƒ½æ²¡æœ‰(æ‰€ä»¥å¯¹åº”é™æ€ä¾èµ–çš„ç¨‹åºè¿˜æ˜¯å¯ä»¥çš„)&lt;/li&gt;
&lt;li&gt;busybox: åŸºæœ¬ä¹Ÿæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤ªå¤š&lt;code&gt;æ‚å¿µ&lt;/code&gt;çš„åŸºç¡€é•œåƒï¼Œä¸è¿‡ç”Ÿæ€é‡ŒåŒ…å«äº†å¾ˆå¤šä¾èµ–é•œåƒï¼Œæ¯”å¦‚&lt;code&gt;busybox:glibc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;centos: centoså‘è¡Œç‰ˆçš„minié•œåƒï¼ŒåŸºç¡€çš„åº“å’Œå·¥å…·åŒ…åŸºæœ¬éƒ½æœ‰ï¼Œbaseç¨å¾®å¤§äº†ç‚¹(200Må·¦å³å§,ä¸è¿‡ä¹Ÿå¯ä»¥ç²¾ç®€)&lt;/li&gt;
&lt;li&gt;ubuntu: ubuntuå‘ç°ç‰ˆçš„minié•œåƒï¼ŒåŒä¸Šï¼Œbaseå¤§æ¦‚åœ¨120Må·¦å³ï¼Œä¸è¿‡ä¸¤è€…çš„ç¨³å®šæ€§å’ŒåŒ…çš„ç®¡ç†æœ‰å·®å¼‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½†ä»¥ä¸Šå‡ ç§çš„baseå‡æœ‰åˆ©å¼Šï¼Œè€Œä¸”ä¼ä¸šå†…éƒ¨é€šå¸¸ä¸šåŠ¡åœºæ™¯ä¹Ÿä¼šæœ‰ä¸€å®šçš„å˜åŒ–ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç»´æŠ¤å†…éƒ¨çš„åŸºç¡€baseé•œåƒæ—¶ä¸€èˆ¬ä¸ä¼šä¸ºäº†&lt;code&gt;é•œåƒå°&lt;/code&gt;è¿™ä¸ªä¼ªç›®æ ‡è€Œä½¿ç”¨å¤šç§baseæ¥æ„å»ºä¸åŒé•œåƒï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°åæœŸçš„ç»´æŠ¤æˆæœ¬è¾ƒé«˜(ç¨³å®šæ€§ï¼Œå¯æ“ä½œæ€§).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;äºŒã€è€ƒè™‘ä¸šåŠ¡çš„éœ€æ±‚å’Œdebugçš„ä¾¿åˆ©æ€§&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;java: ç¨‹åºä¾èµ–åŸºæœ¬åŒ…å«åœ¨ç¨‹åºä¸­ï¼Œä»…å¯¹javaä¾èµ–&lt;/li&gt;
&lt;li&gt;c: å¯èƒ½éœ€è¦æŒ‡å®šçš„libcåº“ä»¥åŠåŠ¨æ€é“¾æ¥åº“çš„ä¾èµ–&lt;/li&gt;
&lt;li&gt;golang: ç¼–è¯‘å¥½çš„ç¨‹åºå‡ ä¹ä¸éœ€è¦ä¾èµ–&lt;/li&gt;
&lt;li&gt;python: éœ€è¦ä¾èµ–pythonä»¥åŠå„ä¸ªåº“çš„æ”¯æŒï¼ŒåŒæ—¶åº“å¯èƒ½ä¾èµ–ç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥åº“&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€šå¸¸åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œç³»ç»Ÿä¸å¯èƒ½é•¿æœŸåªæœ‰ä¸€ç§è¯­è¨€æ¥å¼€å‘ï¼Œå› æ­¤ä¸åŒè¯­è¨€ç”Ÿæ€ä¸‹ä¹Ÿå°±è¯ç”Ÿäº†ä¸åŒçš„éœ€æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚ï¼Œå½“ä¸‹ä¸è®ºæ˜¯&lt;code&gt;DL(Deep Learning)&lt;/code&gt;è¿˜æ˜¯&lt;code&gt;ML(Machine Learning)&lt;/code&gt;å¤§éƒ¨åˆ†å¯¹å¤–çš„åº“åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨Pythonå¼€å‘çš„ï¼Œå› æ­¤åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œé€šå¸¸ä¸šåŠ¡æ‰€éœ€è¦çš„åŸºç¡€åº“æ˜¯ç›¸å½“å¤§ï¼Œå‡ ä¸ªGçš„ç«Ÿåƒä¹Ÿæ˜¯å¸ç©ºè§æƒ¯çš„ã€‚&lt;/p&gt;

&lt;p&gt;åŒæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æƒ…å†µï¼Œå°±æ˜¯æˆ‘ä»¬çš„æŠ€æœ¯äººå‘˜éƒ½æœ‰å¯èƒ½å»å®¹å™¨å†…éƒ¨è¿›è¡Œç®€å•çš„debugæ“ä½œ(æ¯”å¦‚ä½¿ç”¨curl,netstatç­‰å·¥å…·)ï¼Œæ­¤æ—¶ä¸åŒçš„baseé•œåƒä¼šåŒ…å«ä¸åŒçš„ç”Ÿæ€å·¥å…·ï¼Œæ— ç–‘ä¹Ÿä¼šå¢åŠ å¤§å®¶çš„å­¦ä¹ æˆæœ¬ï¼Œå¦‚æœå¯¹å¤–æ¨å¹¿å¯èƒ½ä¼šé­é‡ä¸€å®šéšœç¢ã€‚&lt;/p&gt;

&lt;p&gt;æœ€åï¼Œè¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ä¸šåŠ¡ä¸Šå±‚çš„baseç«Ÿåƒçš„ç²¾ç®€åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;å¾ˆå¤šæ—¶å€™baseç¯å¢ƒå†…éƒ¨å¯èƒ½å­˜åœ¨ä¸€äº›åŸºæœ¬å·¥å…·ï¼Œä»…æ˜¯ç¨‹åºæ„å»ºæ—¶éœ€è¦çš„å·¥å…·ï¼Œæ¯”å¦‚cç¨‹åºçš„gcc,golangç¨‹åºçš„go,javaç¨‹åºçš„jdk(å…¶å®ä»…jreå°±å¯ä»¥)ï¼Œå› æ­¤ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘ç©ºé—´ï¼Œå¯ä»¥å°†æ„å»ºè¿‡ç¨‹ç›¸å…³çš„å·¥å…·é˜‰å‰²æ‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸‰ã€äº¤ä»˜ç‰©çš„å®šä¹‰è¿‡ç¨‹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¼ ç»Ÿçš„CI/CDæµæ°´çº¿ä¸­ï¼Œäº¤ä»˜ç‰©é€šå¸¸æ˜¯ä¸€ä¸ªé™æ€çš„å‹ç¼©åŒ…ï¼Œè€Œåœ¨å¼•å…¥ä»¥Dockerä¸ºä»£è¡¨çš„å®¹å™¨æŠ€æœ¯ä¹‹åï¼Œäº¤ä»˜ç‰©å°±æ˜¯åŒ…å«ä¸šåŠ¡ä»£ç å’Œå…¶è¿è¡Œæ—¶ç¯å¢ƒçš„é•œåƒï¼Œå› æ­¤åœ¨äº¤ä»˜ç‰©çš„å®šä¹‰è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥åšä¸€äº›é•œåƒç²¾ç®€çš„ä¼˜åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œä¸»è¦æ˜¯Dockerçš„åˆ†å±‚æ€æƒ³ï¼Œåœ¨å¼€æºçš„å®¹å™¨å¸‚åœºä¸­ï¼ŒåŸºäº&lt;code&gt;overlay&lt;/code&gt;çš„å­˜å‚¨å¼•æ“å·²ç»æ˜¯ä¸äº‰çš„äº‹å®ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†å±‚è¿‡ç¨‹ä¸­è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œå¯¹overlayä¸å¤ªäº†è§£çš„å¯ä»¥é˜…è¯»ä»¥å‰çš„ä¸€ç¯‡æ–‡ç« &lt;a href=&#34;https://www.jianshu.com/p/959e8e3da4b2&#34;&gt;overlayfsçš„æ¢ç©¶ä»¥åŠåœ¨dockerçš„ä½¿ç”¨&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;FROM golang as golang-build
WORKDIR /
COPY hello.go .
RUN go build -ldflags &amp;#34;-s -w&amp;#34; -o hello hello.go

FROM alpine
COPY --from=golang-build hello .
RUN chmod a-x hello &amp;amp;&amp;amp; chmod a+x hello
CMD [&amp;#34;./hello&amp;#34;]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åˆ†å±‚çš„æ€æƒ³ä¸­ï¼Œæ¯ä¸€å±‚éƒ½æ˜¯ä¸Šä¸€å±‚çš„å¯å†™å åŠ ï¼Œè€Œåœ¨æœ€æ–°å±‚å˜æ›´çš„æ–‡ä»¶æ‰æ˜¯æ•´ä¸ªé•œåƒæˆ–è€…å®¹å™¨å¢åŠ çš„æ•°æ®ï¼Œæ‰€ä»¥å¦‚ä¸Šçš„Dockerfileä¸­ï¼Œæˆ‘ä»¬åœ¨&lt;code&gt;RUN&lt;/code&gt;æŒ‡ä»¤ä¸­å¢åŠ äº†æƒé™çš„æ“ä½œ(ä»…ç”¨æ¥è¯´æ˜é—®é¢˜)ï¼Œä½ ä¼šå‘ç°ï¼Œæœ€ç»ˆçš„é•œåƒä¼šæ¯”ä¸åŠ &lt;code&gt;RUN&lt;/code&gt;æŒ‡ä»¤æ•´æ•´å¤§äº†ä¸€ä¸ª&lt;code&gt;hello&lt;/code&gt;ç¨‹åºçš„ç©ºé—´ï¼Œè¿™å…¶å®å°±æ˜¯é•œåƒåˆ†å±‚ä¸­çš„ä¸€ä¸ªä¼˜åŒ–ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œåœ¨ä¼ä¸šå†…éƒ¨è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ å’Œä¸Šçº¿æ—¶ï¼Œé™¤äº†éœ€è¦è€ƒè™‘å„ä¸ªé€‚ç”¨æ–¹çš„åœºæ™¯é—®é¢˜å’Œæ“ä½œä¾¿åˆ©æ€§ï¼ŒåŒæ—¶åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦è¿›è¡Œä¸€å®šçš„æŠŠæ§ã€‚&lt;/p&gt;

&lt;p&gt;å½“ç„¶å•¦ï¼Œå°½å¯èƒ½çš„å°†é•œåƒå‹ç¼©åˆ°æœ€å°ï¼Œä¸ä»…å¯ä»¥å‡å°‘ç£ç›˜çš„ä½¿ç”¨ï¼ŒåŒæ—¶åœ¨å¤§è§„æ¨¡åˆ†å‘é•œåƒæ—¶ä¹Ÿä¼šè¡¨ç°çš„ç›¸å¯¹æœ‰æ•ˆç‡ï¼Œä½†åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é•œåƒè¶Šå°è¶Šå¥½ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦åœ¨é•œåƒçš„é€šç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ä¸Šè¿›è¡Œä¸€å®šæƒé‡çš„è€ƒé‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gai9amj2lcj30vu0b275p.jpg&#34; alt=&#34;çŸ¥è¯†æ˜Ÿçƒ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>ä½¿ç”¨jwt-goéªŒè¯API</title>
      <link>https://bgbiao.top/post/golang-jwt%E7%9A%84%E4%BD%BF%E7%94%A8/</link>
      <pubDate>Sun, 15 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://bgbiao.top/post/golang-jwt%E7%9A%84%E4%BD%BF%E7%94%A8/</guid>
      
        <description>

&lt;blockquote&gt;
&lt;p&gt;èƒŒæ™¯: åœ¨å¦‚ä»Šå‰åç«¯åˆ†ç¦»å¼€å‘çš„å¤§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³ä¸€äº›ç™»é™†ï¼ŒåæœŸèº«ä»½è®¤è¯ä»¥åŠé‰´æƒç›¸å…³çš„äº‹æƒ…ï¼Œé€šå¸¸çš„æ–¹æ¡ˆå°±æ˜¯é‡‡ç”¨è¯·æ±‚å¤´æºå¸¦tokençš„æ–¹å¼è¿›è¡Œå®ç°ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦åˆ†äº«ä¸‹åœ¨Golangè¯­è¨€ä¸‹ä½¿ç”¨&lt;a href=&#34;https://github.com/dgrijalva/jwt-go&#34;&gt;jwt-go&lt;/a&gt;æ¥å®ç°åç«¯çš„tokenè®¤è¯é€»è¾‘ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code&gt;JSON Web Token(JWT)&lt;/code&gt;æ˜¯ä¸€ä¸ªå¸¸ç”¨è¯­HTTPçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é—´è¿›è¡Œèº«ä»½è®¤è¯å’Œé‰´æƒçš„æ ‡å‡†è§„èŒƒï¼Œä½¿ç”¨JWTå¯ä»¥å…è®¸æˆ‘ä»¬åœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’å®‰å…¨å¯é çš„ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å¼€å§‹å­¦ä¹ &lt;a href=&#34;https://jwt.io/&#34;&gt;JWT&lt;/a&gt;ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆäº†è§£ä¸‹æ—©æœŸçš„å‡ ç§æ–¹æ¡ˆã€‚&lt;/p&gt;

&lt;h3 id=&#34;token-cookie-sessionçš„åŒºåˆ«&#34;&gt;tokenã€cookieã€sessionçš„åŒºåˆ«&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Cookie&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Cookieæ€»æ˜¯ä¿å­˜åœ¨å®¢æˆ·ç«¯ä¸­ï¼ŒæŒ‰åœ¨å®¢æˆ·ç«¯ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œå¯åˆ†ä¸º&lt;code&gt;å†…å­˜Cookie&lt;/code&gt;å’Œ&lt;code&gt;ç¡¬ç›˜Cookie&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å†…å­˜Cookieç”±æµè§ˆå™¨ç»´æŠ¤ï¼Œä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæµè§ˆå™¨å…³é—­åå°±æ¶ˆå¤±äº†ï¼Œå…¶å­˜åœ¨æ—¶é—´æ˜¯çŸ­æš‚çš„ã€‚ç¡¬ç›˜Cookieä¿å­˜åœ¨ç¡¬ç›˜é‡Œï¼Œæœ‰ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé™¤éç”¨æˆ·æ‰‹å·¥æ¸…ç†æˆ–åˆ°äº†è¿‡æœŸæ—¶é—´ï¼Œç¡¬ç›˜Cookieä¸ä¼šè¢«åˆ é™¤ï¼Œå…¶å­˜åœ¨æ—¶é—´æ˜¯é•¿æœŸçš„ã€‚æ‰€ä»¥ï¼ŒæŒ‰å­˜åœ¨æ—¶é—´ï¼Œå¯åˆ†ä¸º&lt;code&gt;éæŒä¹…Cookieå’ŒæŒä¹…Cookie&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;cookie æ˜¯ä¸€ä¸ªéå¸¸å…·ä½“çš„ä¸œè¥¿ï¼ŒæŒ‡çš„å°±æ˜¯æµè§ˆå™¨é‡Œé¢èƒ½æ°¸ä¹…å­˜å‚¨çš„ä¸€ç§æ•°æ®ï¼Œä»…ä»…æ˜¯æµè§ˆå™¨å®ç°çš„ä¸€ç§æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;cookieç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå‘é€ç»™æµè§ˆå™¨&lt;/code&gt;ï¼Œæµè§ˆå™¨æŠŠcookieä»¥key-valueå½¢å¼ä¿å­˜åˆ°æŸä¸ªç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶å†…ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚åŒä¸€ç½‘ç«™æ—¶ä¼šæŠŠè¯¥cookieå‘é€ç»™æœåŠ¡å™¨ã€‚ç”±äºcookieæ˜¯å­˜åœ¨å®¢æˆ·ç«¯ä¸Šçš„ï¼Œæ‰€ä»¥æµè§ˆå™¨åŠ å…¥äº†ä¸€äº›é™åˆ¶ç¡®ä¿cookieä¸ä¼šè¢«æ¶æ„ä½¿ç”¨ï¼ŒåŒæ—¶ä¸ä¼šå æ®å¤ªå¤šç£ç›˜ç©ºé—´ï¼Œæ‰€ä»¥æ¯ä¸ªåŸŸçš„cookieæ•°é‡æ˜¯æœ‰é™çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Session&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Sessionå­—é¢æ„æ€æ˜¯ä¼šè¯ï¼Œä¸»è¦ç”¨æ¥æ ‡è¯†è‡ªå·±çš„èº«ä»½ã€‚æ¯”å¦‚åœ¨æ— çŠ¶æ€çš„apiæœåŠ¡åœ¨å¤šæ¬¡è¯·æ±‚æ•°æ®åº“æ—¶ï¼Œå¦‚ä½•çŸ¥é“æ˜¯åŒä¸€ä¸ªç”¨æˆ·ï¼Œè¿™ä¸ªå°±å¯ä»¥é€šè¿‡sessionçš„æœºåˆ¶ï¼ŒæœåŠ¡å™¨è¦çŸ¥é“å½“å‰å‘è¯·æ±‚ç»™è‡ªå·±çš„æ˜¯è°&lt;/p&gt;

&lt;p&gt;ä¸ºäº†åŒºåˆ†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œ&lt;code&gt;æœåŠ¡ç«¯ä¼šç»™å…·ä½“çš„å®¢æˆ·ç«¯ç”Ÿæˆèº«ä»½æ ‡è¯†session&lt;/code&gt;ï¼Œç„¶åå®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡å™¨å‘è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½å¸¦ä¸Šè¿™ä¸ªâ€œèº«ä»½æ ‡è¯†â€ï¼ŒæœåŠ¡å™¨å°±çŸ¥é“è¿™ä¸ªè¯·æ±‚æ¥è‡ªäºè°äº†ã€‚&lt;/p&gt;

&lt;p&gt;è‡³äºå®¢æˆ·ç«¯å¦‚ä½•ä¿å­˜è¯¥æ ‡è¯†ï¼Œå¯ä»¥æœ‰å¾ˆå¤šæ–¹å¼ï¼Œå¯¹äºæµè§ˆå™¨è€Œè¨€ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨&lt;code&gt;cookie&lt;/code&gt;çš„æ–¹å¼&lt;/p&gt;

&lt;p&gt;æœåŠ¡å™¨ä½¿ç”¨sessionæŠŠç”¨æˆ·ä¿¡æ¯ä¸´æ—¶ä¿å­˜äº†æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·ç¦»å¼€ç½‘ç«™å°±ä¼šé”€æ¯ï¼Œè¿™ç§å‡­è¯å­˜å‚¨æ–¹å¼ç›¸å¯¹äºcookieæ¥è¯´æ›´åŠ å®‰å…¨ï¼Œä½†æ˜¯sessionä¼šæœ‰ä¸€ä¸ªç¼ºé™·: å¦‚æœwebæœåŠ¡å™¨åšäº†è´Ÿè½½å‡è¡¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ“ä½œè¯·æ±‚åˆ°äº†å¦ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™sessionä¼šä¸¢å¤±ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œé€šå¸¸ä¼ä¸šé‡Œä¼šä½¿ç”¨&lt;code&gt;redis,memcached&lt;/code&gt;ç¼“å­˜ä¸­é—´ä»¶æ¥å®ç°sessionçš„å…±äº«ï¼Œæ­¤æ—¶webæœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªå®Œå…¨æ— çŠ¶æ€çš„å­˜åœ¨ï¼Œæ‰€æœ‰çš„ç”¨æˆ·å‡­è¯å¯ä»¥é€šè¿‡å…±äº«sessionçš„æ–¹å¼å­˜å–ï¼Œå½“å‰sessionçš„è¿‡æœŸå’Œé”€æ¯æœºåˆ¶éœ€è¦ç”¨æˆ·åšæ§åˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Token&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;tokençš„æ„æ€æ˜¯â€œä»¤ç‰Œâ€ï¼Œæ˜¯ç”¨æˆ·èº«ä»½çš„éªŒè¯æ–¹å¼ï¼Œæœ€ç®€å•çš„tokenç»„æˆ: &lt;code&gt;uid(ç”¨æˆ·å”¯ä¸€æ ‡è¯†)&lt;/code&gt;+&lt;code&gt;time(å½“å‰æ—¶é—´æˆ³)&lt;/code&gt;+&lt;code&gt;sign(ç­¾å,ç”±tokençš„å‰å‡ ä½+ç›ä»¥å“ˆå¸Œç®—æ³•å‹ç¼©æˆä¸€å®šé•¿åº¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²)&lt;/code&gt;ï¼ŒåŒæ—¶è¿˜å¯ä»¥å°†ä¸å˜çš„å‚æ•°ä¹Ÿæ”¾è¿›token&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ä¸»è¦æƒ³è®²çš„å°±æ˜¯&lt;code&gt;Json Web Token&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯æœ¬ç¯‡çš„ä¸»é¢˜:JWT&lt;/p&gt;

&lt;h3 id=&#34;json-web-token-jwt-ä»‹ç»&#34;&gt;Json-Web-Token(JWT)ä»‹ç»&lt;/h3&gt;

&lt;p&gt;ä¸€èˆ¬è€Œè¨€ï¼Œç”¨æˆ·æ³¨å†Œç™»é™†åä¼šç”Ÿæˆä¸€ä¸ªjwt tokenè¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨å‘æœåŠ¡ç«¯è¯·æ±‚æ•°æ®æ—¶æºå¸¦&lt;code&gt;token&lt;/code&gt;ï¼ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨&lt;code&gt;signature&lt;/code&gt;ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œè§£ç ï¼Œè¿›è€Œå¯¹tokenè¿›è¡Œè§£æå’ŒéªŒè¯ã€‚&lt;/p&gt;

&lt;h4 id=&#34;jwt-tokenç»„æˆéƒ¨åˆ†&#34;&gt;JWT Tokenç»„æˆéƒ¨åˆ†&lt;/h4&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gcpwngvonhj30hx03xwf0.jpg&#34; alt=&#34;JWT-Tokenç»„æˆéƒ¨åˆ†&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;header: ç”¨æ¥æŒ‡å®šä½¿ç”¨çš„ç®—æ³•(HMAC SHA256 RSA)å’Œtokenç±»å‹(å¦‚JWT)&lt;/li&gt;
&lt;li&gt;payload: åŒ…å«å£°æ˜(è¦æ±‚)ï¼Œå£°æ˜é€šå¸¸æ˜¯ç”¨æˆ·ä¿¡æ¯æˆ–å…¶ä»–æ•°æ®çš„å£°æ˜ï¼Œæ¯”å¦‚ç”¨æˆ·idï¼Œåç§°ï¼Œé‚®ç®±ç­‰. å£°æ˜å¯åˆ†ä¸ºä¸‰ç§: registered,public,private&lt;/li&gt;
&lt;li&gt;signature: ç”¨æ¥ä¿è¯JWTçš„çœŸå®æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç®—æ³•&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;header&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;{
    &amp;#34;alg&amp;#34;: &amp;#34;HS256&amp;#34;,
    &amp;#34;typ&amp;#34;: &amp;#34;JWT&amp;#34;
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å¯¹ä¸Šé¢çš„jsonè¿›è¡Œbase64ç¼–ç å³å¯å¾—åˆ°JWTçš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;payload&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;registered claims: é¢„å®šä¹‰çš„å£°æ˜ï¼Œé€šå¸¸ä¼šæ”¾ç½®ä¸€äº›é¢„å®šä¹‰å­—æ®µï¼Œæ¯”å¦‚è¿‡æœŸæ—¶é—´ï¼Œä¸»é¢˜ç­‰(iss:issuer,exp:expiration time,sub:subject,aud:audience)&lt;/li&gt;
&lt;li&gt;public claims: å¯ä»¥è®¾ç½®å…¬å¼€å®šä¹‰çš„å­—æ®µ&lt;/li&gt;

&lt;li&gt;&lt;p&gt;private claims: ç”¨äºç»Ÿä¸€ä½¿ç”¨ä»–ä»¬çš„å„æ–¹ä¹‹é—´çš„å…±äº«ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;{
&amp;#34;sub&amp;#34;: &amp;#34;xxx-api&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;bgbiao.top&amp;#34;,
&amp;#34;admin&amp;#34;: true
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯¹payloadéƒ¨åˆ†çš„jsonè¿›è¡Œbase64ç¼–ç åå³å¯å¾—åˆ°JWTçš„ç¬¬äºŒä¸ªéƒ¨åˆ†&lt;/p&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt; ä¸è¦åœ¨headerå’Œpayloadä¸­æ”¾ç½®æ•æ„Ÿä¿¡æ¯ï¼Œé™¤éä¿¡æ¯æœ¬èº«å·²ç»åšè¿‡è„±æ•å¤„ç†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;signature&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºäº†å¾—åˆ°ç­¾åéƒ¨åˆ†ï¼Œå¿…é¡»æœ‰ç¼–ç è¿‡çš„headerå’Œpayloadï¼Œä»¥åŠä¸€ä¸ªç§˜é’¥ï¼Œç­¾åç®—æ³•ä½¿ç”¨headerä¸­æŒ‡å®šçš„é‚£ä¸ªï¼Œç„¶åå¯¹å…¶è¿›è¡Œç­¾åå³å¯&lt;/p&gt;

&lt;p&gt;&lt;code&gt;HMACSHA256(base64UrlEncode(header)+&amp;quot;.&amp;quot;+base64UrlEncode(payload),secret)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ç­¾åæ˜¯&lt;code&gt;ç”¨äºéªŒè¯æ¶ˆæ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰è¢«æ›´æ”¹&lt;/code&gt;ï¼Œå¹¶ä¸”ï¼Œå¯¹äºä½¿ç”¨ç§é’¥ç­¾åçš„tokenï¼Œå®ƒè¿˜å¯ä»¥éªŒè¯JWTçš„å‘é€æ–¹æ˜¯å¦ä¸ºå®ƒæ‰€ç§°çš„å‘é€æ–¹ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨&lt;a href=&#34;https://jwt.io&#34;&gt;jwt.io&lt;/a&gt;ç½‘ç«™ä¸­ï¼Œæä¾›äº†ä¸€äº›JWT tokençš„ç¼–ç ï¼ŒéªŒè¯ä»¥åŠç”Ÿæˆjwtçš„å·¥å…·ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„jwt-tokençš„ç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gcpxe1ungej30wq0mygo8.jpg&#34; alt=&#34;jwtå®˜æ–¹ç­¾åç»“æ„&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;ä»€ä¹ˆæ—¶å€™ç”¨jwt&#34;&gt;ä»€ä¹ˆæ—¶å€™ç”¨JWT&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;Authorization(æˆæƒ): å…¸å‹åœºæ™¯ï¼Œç”¨æˆ·è¯·æ±‚çš„tokenä¸­åŒ…å«äº†è¯¥ä»¤ç‰Œå…è®¸çš„è·¯ç”±ï¼ŒæœåŠ¡å’Œèµ„æºã€‚å•ç‚¹ç™»å½•å…¶å®å°±æ˜¯ç°åœ¨å¹¿æ³›ä½¿ç”¨JWTçš„ä¸€ä¸ªç‰¹æ€§&lt;/li&gt;
&lt;li&gt;Information Exchange(ä¿¡æ¯äº¤æ¢):  å¯¹äºå®‰å…¨çš„åœ¨å„æ–¹ä¹‹é—´ä¼ è¾“ä¿¡æ¯è€Œè¨€ï¼ŒJSON Web Tokensæ— ç–‘æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼.å› ä¸ºJWTså¯ä»¥è¢«ç­¾åï¼Œä¾‹å¦‚ï¼Œç”¨å…¬é’¥/ç§é’¥å¯¹ï¼Œä½ å¯ä»¥ç¡®å®šå‘é€äººå°±æ˜¯å®ƒä»¬æ‰€è¯´çš„é‚£ä¸ªäººã€‚å¦å¤–ï¼Œç”±äºç­¾åæ˜¯ä½¿ç”¨å¤´å’Œæœ‰æ•ˆè´Ÿè½½è®¡ç®—çš„ï¼Œæ‚¨è¿˜å¯ä»¥éªŒè¯å†…å®¹æ²¡æœ‰è¢«ç¯¡æ”¹&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;jwt-json-web-tokens-æ˜¯å¦‚ä½•å·¥ä½œçš„&#34;&gt;JWT(Json Web Tokens)æ˜¯å¦‚ä½•å·¥ä½œçš„&lt;/h4&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gcptxpqcrxj30ct0bsq3h.jpg&#34; alt=&#34;JWTè®¤è¯è¿‡ç¨‹&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼ŒåŸºæœ¬ä¸Šæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è·å–tokenï¼Œç¬¬äºŒé˜¶æ®µï¼Œå®¢æˆ·ç«¯å¸¦ç€è¯¥tokenå»è¯·æ±‚ç›¸å…³çš„èµ„æº.&lt;/p&gt;

&lt;p&gt;é€šå¸¸æ¯”è¾ƒé‡è¦çš„æ˜¯ï¼ŒæœåŠ¡ç«¯å¦‚ä½•æ ¹æ®æŒ‡å®šçš„è§„åˆ™è¿›è¡Œtokençš„ç”Ÿæˆã€‚&lt;/p&gt;

&lt;p&gt;åœ¨è®¤è¯çš„æ—¶å€™ï¼Œå½“ç”¨æˆ·ç”¨ä»–ä»¬çš„å‡­è¯æˆåŠŸç™»å½•ä»¥åï¼Œä¸€ä¸ªJSON Web Tokenå°†ä¼šè¢«è¿”å›ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤åï¼Œtokenå°±æ˜¯ç”¨æˆ·å‡­è¯äº†ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒä»¥é˜²æ­¢å‡ºç°å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬è€Œè¨€ï¼Œä½ ä¿å­˜ä»¤ç‰Œçš„æ—¶å€™ä¸åº”è¯¥è¶…è¿‡ä½ æ‰€éœ€è¦å®ƒçš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;æ— è®ºä½•æ—¶ç”¨æˆ·æƒ³è¦è®¿é—®å—ä¿æŠ¤çš„è·¯ç”±æˆ–è€…èµ„æºçš„æ—¶å€™ï¼Œç”¨æˆ·ä»£ç†ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰éƒ½åº”è¯¥å¸¦ä¸ŠJWTï¼Œå…¸å‹çš„ï¼Œé€šå¸¸æ”¾åœ¨Authorization headerä¸­ï¼Œç”¨Bearer schema:
&lt;code&gt;Authorization: Bearer &amp;lt;token&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æœåŠ¡å™¨ä¸Šçš„å—ä¿æŠ¤çš„è·¯ç”±å°†ä¼šæ£€æŸ¥Authorization headerä¸­çš„JWTæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™ç”¨æˆ·å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚å¦‚æœJWTåŒ…å«è¶³å¤Ÿå¤šçš„å¿…éœ€çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å°‘å¯¹æŸäº›æ“ä½œçš„æ•°æ®åº“æŸ¥è¯¢çš„éœ€è¦ï¼Œå°½ç®¡å¯èƒ½å¹¶ä¸æ€»æ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœtokenæ˜¯åœ¨æˆæƒå¤´ï¼ˆAuthorization headerï¼‰ä¸­å‘é€çš„ï¼Œé‚£ä¹ˆè·¨æºèµ„æºå…±äº«(CORS)å°†ä¸ä¼šæˆä¸ºé—®é¢˜ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨cookie.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gcpxi6z1dmj315o0fvab0.jpg&#34; alt=&#34;è·å–JWTä»¥åŠè®¿é—®APIsä»¥åŠèµ„æº&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘æˆæƒæ¥å£è¯·æ±‚æˆæƒ&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æˆæƒåè¿”å›ä¸€ä¸ªaccess tokenç»™å®¢æˆ·ç«¯&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä½¿ç”¨access tokenè®¿é—®å—ä¿æŠ¤çš„èµ„æº&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;åŸºäºtokençš„èº«ä»½è®¤è¯å’ŒåŸºäºæœåŠ¡å™¨çš„èº«ä»½è®¤è¯&#34;&gt;åŸºäºTokençš„èº«ä»½è®¤è¯å’ŒåŸºäºæœåŠ¡å™¨çš„èº«ä»½è®¤è¯&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;1.åŸºäºæœåŠ¡å™¨çš„è®¤è¯&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å‰é¢è¯´åˆ°è¿‡sessionï¼Œcookieä»¥åŠtokençš„åŒºåˆ«ï¼Œåœ¨ä¹‹å‰ä¼ ç»Ÿçš„åšæ³•å°±æ˜¯åŸºäºå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„sessionæ¥åšç”¨æˆ·çš„èº«ä»½è®¤è¯ï¼Œä½†æ˜¯é€šå¸¸ä¼šæœ‰å¦‚ä¸‹é—®é¢˜:
- Sessions: è®¤è¯é€šè¿‡åéœ€è¦å°†ç”¨æˆ·çš„sessionæ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œéšç€è®¤è¯ç”¨æˆ·çš„å¢åŠ ï¼Œå†…å­˜å¼€é”€ä¼šå¤§
- æ‰©å±•æ€§: ç”±äºsessionå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰©å±•æ€§ä¼šå—é™ï¼Œè™½ç„¶åæœŸå¯ä»¥ä½¿ç”¨redis,memcachedæ¥ç¼“å­˜æ•°æ®
- CORS: å½“å¤šä¸ªç»ˆç«¯è®¿é—®åŒä¸€ä»½æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ç¦æ­¢è¯·æ±‚çš„é—®é¢˜
- CSRF: ç”¨æˆ·å®¹æ˜“å—åˆ°CSRFæ”»å‡»&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2.Sessionå’ŒJWT Tokençš„å¼‚åŒ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;éƒ½å¯ä»¥å­˜å‚¨ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼Œä½†æ˜¯sessionå­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼ŒJWTå­˜å‚¨åœ¨å®¢æˆ·ç«¯&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/00831rSTly1gcpxunv5qcj30dd0gfgmp.jpg&#34; alt=&#34;sessionå’Œjwtæ•°æ®å­˜å‚¨ä½ç½®&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;3.åŸºäºTokençš„èº«ä»½è®¤è¯å¦‚ä½•å·¥ä½œ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŸºäºTokençš„èº«ä»½è®¤è¯æ˜¯æ— çŠ¶æ€çš„ï¼ŒæœåŠ¡å™¨æˆ–è€…sessionä¸­ä¸ä¼šå­˜å‚¨ä»»ä½•ç”¨æˆ·ä¿¡æ¯.(å¾ˆå¥½çš„è§£å†³äº†å…±äº«sessionçš„é—®é¢˜)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·æºå¸¦ç”¨æˆ·åå’Œå¯†ç è¯·æ±‚è·å–token(æ¥å£æ•°æ®ä¸­å¯ä½¿ç”¨appId,appKey)&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ ¡éªŒç”¨æˆ·å‡­è¯ï¼Œå¹¶è¿”å›ç”¨æˆ·æˆ–å®¢æˆ·ç«¯ä¸€ä¸ªToken&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å­˜å‚¨token,å¹¶åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Token&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ ¡éªŒtokenå¹¶è¿”å›æ•°æ®&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;æ³¨æ„:&lt;/code&gt;
- éšåå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨token
- tokenåº”è¯¥æ”¾åœ¨headerä¸­
- éœ€è¦å°†æœåŠ¡å™¨è®¾ç½®ä¸ºæ¥æ”¶æ‰€æœ‰åŸŸçš„è¯·æ±‚: &lt;code&gt;Access-Control-Allow-Origin: *&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;4.ç”¨Tokençš„å¥½å¤„&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ— çŠ¶æ€å’Œå¯æ‰©å±•æ€§&lt;/li&gt;
&lt;li&gt;å®‰å…¨: é˜²æ­¢CSRFæ”»å‡»;tokenè¿‡æœŸé‡æ–°è®¤è¯&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;5.JWTå’ŒOAuthçš„åŒºåˆ«&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.OAuth2æ˜¯ä¸€ç§æˆæƒæ¡†æ¶ ï¼ŒJWTæ˜¯ä¸€ç§è®¤è¯åè®®&lt;/li&gt;
&lt;li&gt;2.æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼åˆ‡è®°ç”¨HTTPSæ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§&lt;/li&gt;
&lt;li&gt;3.OAuth2ç”¨åœ¨&lt;code&gt;ä½¿ç”¨ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•çš„æƒ…å†µ&lt;/code&gt;(æ¯”å¦‚ä½¿ç”¨weibo, qq, githubç™»å½•æŸä¸ªapp)ï¼Œè€Œ&lt;code&gt;JWTæ˜¯ç”¨åœ¨å‰åç«¯åˆ†ç¦»&lt;/code&gt;, éœ€è¦ç®€å•çš„å¯¹åå°APIè¿›è¡Œä¿æŠ¤æ—¶ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ä½¿ç”¨ginæ¡†æ¶é›†æˆjwt&#34;&gt;ä½¿ç”¨Ginæ¡†æ¶é›†æˆJWT&lt;/h3&gt;

&lt;p&gt;åœ¨Golangè¯­è¨€ä¸­ï¼Œ&lt;a href=&#34;https://github.com/dgrijalva/jwt-go&#34;&gt;jwt-go&lt;/a&gt;åº“æä¾›äº†ä¸€äº›jwtç¼–ç å’ŒéªŒè¯çš„å·¥å…·ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨è¯¥åº“æ¥å®ç°tokenè®¤è¯ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“&lt;a href=&#34;https://github.com/gin-gonic/gin&#34;&gt;gin&lt;/a&gt;æ¡†æ¶ä¸­æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰middlewareï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„å°†jwtç›¸å…³çš„é€»è¾‘å°è£…åœ¨middlewareä¸­ï¼Œç„¶åå¯¹å…·ä½“çš„æ¥å£è¿›è¡Œè®¤è¯ã€‚&lt;/p&gt;

&lt;h4 id=&#34;è‡ªå®šä¹‰ä¸­é—´ä»¶&#34;&gt;è‡ªå®šä¹‰ä¸­é—´ä»¶&lt;/h4&gt;

&lt;p&gt;åœ¨ginæ¡†æ¶ä¸­ï¼Œè‡ªå®šä¹‰ä¸­é—´ä»¶æ¯”è¾ƒå®¹æ˜“ï¼Œåªè¦è¿”å›ä¸€ä¸ª&lt;code&gt;gin.HandlerFunc&lt;/code&gt;å³å®Œæˆä¸€ä¸ªä¸­é—´ä»¶å®šä¹‰ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªç”¨äºjwtè®¤è¯çš„ä¸­é—´ä»¶.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// å®šä¹‰ä¸€ä¸ªJWTAuthçš„ä¸­é—´ä»¶
func JWTAuth() gin.HandlerFunc {
	return func(c *gin.Context) {
		// é€šè¿‡http headerä¸­çš„tokenè§£ææ¥è®¤è¯
		token := c.Request.Header.Get(&amp;#34;token&amp;#34;)
		if token == &amp;#34;&amp;#34; {
			c.JSON(http.StatusOK, gin.H{
				&amp;#34;status&amp;#34;: -1,
				&amp;#34;msg&amp;#34;:    &amp;#34;è¯·æ±‚æœªæºå¸¦tokenï¼Œæ— æƒé™è®¿é—®&amp;#34;,
				&amp;#34;data&amp;#34;:   nil,
			})
			c.Abort()
			return
		}

		log.Print(&amp;#34;get token: &amp;#34;, token)

		// åˆå§‹åŒ–ä¸€ä¸ªJWTå¯¹è±¡å®ä¾‹ï¼Œå¹¶æ ¹æ®ç»“æ„ä½“æ–¹æ³•æ¥è§£ætoken
		j := NewJWT()
		// è§£ætokenä¸­åŒ…å«çš„ç›¸å…³ä¿¡æ¯(æœ‰æ•ˆè½½è·)
		claims, err := j.ParserToken(token)

		if err != nil {
			// tokenè¿‡æœŸ
			if err == TokenExpired {
				c.JSON(http.StatusOK, gin.H{
					&amp;#34;status&amp;#34;: -1,
					&amp;#34;msg&amp;#34;:    &amp;#34;tokenæˆæƒå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç”³è¯·æˆæƒ&amp;#34;,
					&amp;#34;data&amp;#34;:   nil,
				})
				c.Abort()
				return
			}
			// å…¶ä»–é”™è¯¯
			c.JSON(http.StatusOK, gin.H{
				&amp;#34;status&amp;#34;: -1,
				&amp;#34;msg&amp;#34;:    err.Error(),
				&amp;#34;data&amp;#34;:   nil,
			})
			c.Abort()
			return
		}

		// å°†è§£æåçš„æœ‰æ•ˆè½½è·claimsé‡æ–°å†™å…¥gin.Contextå¼•ç”¨å¯¹è±¡ä¸­
		c.Set(&amp;#34;claims&amp;#34;, claims)

	}
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;å®šä¹‰jwtç¼–ç å’Œè§£ç é€»è¾‘&#34;&gt;å®šä¹‰jwtç¼–ç å’Œè§£ç é€»è¾‘&lt;/h4&gt;

&lt;p&gt;æ ¹æ®å‰é¢æåˆ°çš„jwt-tokençš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠ&lt;code&gt;jwt-go&lt;/code&gt;ä¸­ç›¸å…³çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•è¿›è¡Œç”Ÿæˆtoken.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// å®šä¹‰ä¸€ä¸ªjwtå¯¹è±¡
type JWT struct {
	// å£°æ˜ç­¾åä¿¡æ¯
	SigningKey []byte
}

// åˆå§‹åŒ–jwtå¯¹è±¡
func NewJWT() *JWT {
	return &amp;amp;JWT{
		[]byte(&amp;#34;bgbiao.top&amp;#34;),
	}
}

// è‡ªå®šä¹‰æœ‰æ•ˆè½½è·(è¿™é‡Œé‡‡ç”¨è‡ªå®šä¹‰çš„Nameå’ŒEmailä½œä¸ºæœ‰æ•ˆè½½è·çš„ä¸€éƒ¨åˆ†)
type CustomClaims struct {
	Name  string `json:&amp;#34;name&amp;#34;`
	Email string `json:&amp;#34;email&amp;#34;`
	// StandardClaimsç»“æ„ä½“å®ç°äº†Claimsæ¥å£(Valid()å‡½æ•°)
	jwt.StandardClaims
}


// è°ƒç”¨jwt-goåº“ç”Ÿæˆtoken
// æŒ‡å®šç¼–ç çš„ç®—æ³•ä¸ºjwt.SigningMethodHS256
func (j *JWT) CreateToken(claims CustomClaims) (string, error) {
	// https://gowalker.org/github.com/dgrijalva/jwt-go#Token
	// è¿”å›ä¸€ä¸ªtokençš„ç»“æ„ä½“æŒ‡é’ˆ
	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
	return token.SignedString(j.SigningKey)
}


// tokenè§£ç 
func (j *JWT) ParserToken(tokenString string) (*CustomClaims, error) {
	// https://gowalker.org/github.com/dgrijalva/jwt-go#ParseWithClaims
	// è¾“å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„Claimsç»“æ„ä½“å¯¹è±¡,token,ä»¥åŠè‡ªå®šä¹‰å‡½æ•°æ¥è§£ætokenå­—ç¬¦ä¸²ä¸ºjwtçš„Tokenç»“æ„ä½“æŒ‡é’ˆ
	// Keyfuncæ˜¯åŒ¿åå‡½æ•°ç±»å‹: type Keyfunc func(*Token) (interface{}, error)
	// func ParseWithClaims(tokenString string, claims Claims, keyFunc Keyfunc) (*Token, error) {}
	token, err := jwt.ParseWithClaims(tokenString, &amp;amp;CustomClaims{}, func(token *jwt.Token) (interface{}, error) {
		return j.SigningKey, nil
	})

	if err != nil {
		// https://gowalker.org/github.com/dgrijalva/jwt-go#ValidationError
		// jwt.ValidationError æ˜¯ä¸€ä¸ªæ— æ•ˆtokençš„é”™è¯¯ç»“æ„
		if ve, ok := err.(*jwt.ValidationError); ok {
			// ValidationErrorMalformedæ˜¯ä¸€ä¸ªuintå¸¸é‡ï¼Œè¡¨ç¤ºtokenä¸å¯ç”¨
			if ve.Errors&amp;amp;jwt.ValidationErrorMalformed != 0 {
				return nil, fmt.Errorf(&amp;#34;tokenä¸å¯ç”¨&amp;#34;)
				// ValidationErrorExpiredè¡¨ç¤ºTokenè¿‡æœŸ
			} else if ve.Errors&amp;amp;jwt.ValidationErrorExpired != 0 {
				return nil, fmt.Errorf(&amp;#34;tokenè¿‡æœŸ&amp;#34;)
				// ValidationErrorNotValidYetè¡¨ç¤ºæ— æ•ˆtoken
			} else if ve.Errors&amp;amp;jwt.ValidationErrorNotValidYet != 0 {
				return nil, fmt.Errorf(&amp;#34;æ— æ•ˆçš„token&amp;#34;)
			} else {
				return nil, fmt.Errorf(&amp;#34;tokenä¸å¯ç”¨&amp;#34;)
			}

		}
	}

	// å°†tokenä¸­çš„claimsä¿¡æ¯è§£æå‡ºæ¥å¹¶æ–­è¨€æˆç”¨æˆ·è‡ªå®šä¹‰çš„æœ‰æ•ˆè½½è·ç»“æ„
	if claims, ok := token.Claims.(*CustomClaims); ok &amp;amp;&amp;amp; token.Valid {
		return claims, nil
	}

	return nil, fmt.Errorf(&amp;#34;tokenæ— æ•ˆ&amp;#34;)

}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;å®šä¹‰ç™»é™†éªŒè¯é€»è¾‘&#34;&gt;å®šä¹‰ç™»é™†éªŒè¯é€»è¾‘&lt;/h4&gt;

&lt;p&gt;æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±æ˜¯æ™®é€šapiçš„å…·ä½“é€»è¾‘äº†ï¼Œæ¯”å¦‚å¯ä»¥åœ¨ç™»é™†æ—¶è¿›è¡Œç”¨æˆ·æ ¡éªŒï¼ŒæˆåŠŸåæœªè¯¥æ¬¡è®¤è¯è¯·æ±‚ç”Ÿæˆtokenã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// å®šä¹‰ç™»é™†é€»è¾‘
// model.LoginReqä¸­å®šä¹‰äº†ç™»é™†çš„è¯·æ±‚ä½“(name,passwd)
func Login(c *gin.Context) {
	var loginReq model.LoginReq
	if c.BindJSON(&amp;amp;loginReq) == nil {
		// ç™»é™†é€»è¾‘æ ¡éªŒ(æŸ¥åº“ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨ä»¥åŠç™»é™†ä¿¡æ¯æ˜¯å¦æ­£ç¡®)
		isPass, user, err := model.LoginCheck(loginReq)
		// éªŒè¯é€šè¿‡åä¸ºè¯¥æ¬¡è¯·æ±‚ç”Ÿæˆtoken
		if isPass {
			generateToken(c, user)
		} else {
			c.JSON(http.StatusOK, gin.H{
				&amp;#34;status&amp;#34;: -1,
				&amp;#34;msg&amp;#34;:    &amp;#34;éªŒè¯å¤±è´¥&amp;#34; + err.Error(),
				&amp;#34;data&amp;#34;:   nil,
			})
		}

	} else {
		c.JSON(http.StatusOK, gin.H{
			&amp;#34;status&amp;#34;: -1,
			&amp;#34;msg&amp;#34;:    &amp;#34;ç”¨æˆ·æ•°æ®è§£æå¤±è´¥&amp;#34;,
			&amp;#34;data&amp;#34;:   nil,
		})
	}
}

// tokenç”Ÿæˆå™¨
// md ä¸ºä¸Šé¢å®šä¹‰å¥½çš„middlewareä¸­é—´ä»¶
func generateToken(c *gin.Context, user model.User) {
	// æ„é€ SignKey: ç­¾åå’Œè§£ç­¾åéœ€è¦ä½¿ç”¨ä¸€ä¸ªå€¼
	j := md.NewJWT()

	// æ„é€ ç”¨æˆ·claimsä¿¡æ¯(è´Ÿè·)
	claims := md.CustomClaims{
		user.Name,
		user.Email,
		jwtgo.StandardClaims{
			NotBefore: int64(time.Now().Unix() - 1000), // ç­¾åç”Ÿæ•ˆæ—¶é—´
			ExpiresAt: int64(time.Now().Unix() + 3600), // ç­¾åè¿‡æœŸæ—¶é—´
			Issuer:    &amp;#34;bgbiao.top&amp;#34;,                    // ç­¾åé¢å‘è€…
		},
	}

	// æ ¹æ®claimsç”Ÿæˆtokenå¯¹è±¡
	token, err := j.CreateToken(claims)

	if err != nil {
		c.JSON(http.StatusOK, gin.H{
			&amp;#34;status&amp;#34;: -1,
			&amp;#34;msg&amp;#34;:    err.Error(),
			&amp;#34;data&amp;#34;:   nil,
		})
	}

	log.Println(token)
	// å°è£…ä¸€ä¸ªå“åº”æ•°æ®,è¿”å›ç”¨æˆ·åå’Œtoken
	data := LoginResult{
		Name:  user.Name,
		Token: token,
	}

	c.JSON(http.StatusOK, gin.H{
		&amp;#34;status&amp;#34;: 0,
		&amp;#34;msg&amp;#34;:    &amp;#34;ç™»é™†æˆåŠŸ&amp;#34;,
		&amp;#34;data&amp;#34;:   data,
	})
	return

}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;å®šä¹‰æ™®é€šå¾…éªŒè¯æ¥å£&#34;&gt;å®šä¹‰æ™®é€šå¾…éªŒè¯æ¥å£&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// å®šä¹‰ä¸€ä¸ªæ™®é€šcontrollerå‡½æ•°ï¼Œä½œä¸ºä¸€ä¸ªéªŒè¯æ¥å£é€»è¾‘
func GetDataByTime(c *gin.Context) {
	// ä¸Šé¢æˆ‘ä»¬åœ¨JWTAuth()ä¸­é—´ä¸­å°†&amp;#39;claims&amp;#39;å†™å…¥åˆ°gin.Contextçš„æŒ‡é’ˆå¯¹è±¡ä¸­ï¼Œå› æ­¤åœ¨è¿™é‡Œå¯ä»¥å°†ä¹‹è§£æå‡ºæ¥
	claims := c.MustGet(&amp;#34;claims&amp;#34;).(*md.CustomClaims)
	if claims != nil {
		c.JSON(http.StatusOK, gin.H{
			&amp;#34;status&amp;#34;: 0,
			&amp;#34;msg&amp;#34;:    &amp;#34;tokenæœ‰æ•ˆ&amp;#34;,
			&amp;#34;data&amp;#34;:   claims,
		})
	}
}


// åœ¨ä¸»å‡½æ•°ä¸­å®šä¹‰è·¯ç”±è§„åˆ™
	router := gin.Default()
	v1 := router.Group(&amp;#34;/apis/v1/&amp;#34;)
	{
		v1.POST(&amp;#34;/register&amp;#34;, controller.RegisterUser)
		v1.POST(&amp;#34;/login&amp;#34;, controller.Login)
	}

	// secure v1
	sv1 := router.Group(&amp;#34;/apis/v1/auth/&amp;#34;)
	// åŠ è½½è‡ªå®šä¹‰çš„JWTAuth()ä¸­é—´ä»¶,åœ¨æ•´ä¸ªsv1çš„è·¯ç”±ç»„ä¸­éƒ½ç”Ÿæ•ˆ
	sv1.Use(md.JWTAuth())
	{
		sv1.GET(&amp;#34;/time&amp;#34;, controller.GetDataByTime)

	}
	router.Run(&amp;#34;:8081&amp;#34;)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;éªŒè¯ä½¿ç”¨jwtåçš„æ¥å£&#34;&gt;éªŒè¯ä½¿ç”¨JWTåçš„æ¥å£&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# è¿è¡Œé¡¹ç›®
$ go run main.go
127.0.0.1
13306
root:bgbiao.top@tcp(127.0.0.1:13306)/test_api?charset=utf8mb4&amp;amp;parseTime=True&amp;amp;loc=Local
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in &amp;#34;debug&amp;#34; mode. Switch to &amp;#34;release&amp;#34; mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] POST   /apis/v1/register         --&amp;gt; warnning-trigger/controller.RegisterUser (3 handlers)
[GIN-debug] POST   /apis/v1/login            --&amp;gt; warnning-trigger/controller.Login (3 handlers)
[GIN-debug] GET    /apis/v1/auth/time        --&amp;gt; warnning-trigger/controller.GetDataByTime (4 handlers)
[GIN-debug] Listening and serving HTTP on :8081

# æ³¨å†Œç”¨æˆ·
$ curl -i -X POST \
   -H &amp;#34;Content-Type:application/json&amp;#34; \
   -d \
&amp;#39;{
  &amp;#34;name&amp;#34;: &amp;#34;hahaha1&amp;#34;,
  &amp;#34;password&amp;#34;: &amp;#34;hahaha1&amp;#34;,
  &amp;#34;email&amp;#34;: &amp;#34;hahaha1@bgbiao.top&amp;#34;,
  &amp;#34;phone&amp;#34;: 10000000000
}&amp;#39; \
 &amp;#39;http://localhost:8081/apis/v1/register&amp;#39;
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Date: Sun, 15 Mar 2020 07:09:28 GMT
Content-Length: 41

{&amp;#34;data&amp;#34;:null,&amp;#34;msg&amp;#34;:&amp;#34;success &amp;#34;,&amp;#34;status&amp;#34;:0}%


# ç™»é™†ç”¨æˆ·ä»¥è·å–token
$ curl -i -X POST \
   -H &amp;#34;Content-Type:application/json&amp;#34; \
   -d \
&amp;#39;{
  &amp;#34;name&amp;#34;:&amp;#34;hahaha1&amp;#34;,
  &amp;#34;password&amp;#34;:&amp;#34;hahaha1&amp;#34;
}&amp;#39; \
 &amp;#39;http://localhost:8081/apis/v1/login&amp;#39;
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Date: Sun, 15 Mar 2020 07:10:41 GMT
Content-Length: 290

{&amp;#34;data&amp;#34;:{&amp;#34;token&amp;#34;:&amp;#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyTmFtZSI6ImhhaGFoYTEiLCJlbWFpbCI6ImhhaGFoYTFAYmdiaWFvLnRvcCIsImV4cCI6MTU4NDI1OTg0MSwiaXNzIjoiYmdiaWFvLnRvcCIsIm5iZiI6MTU4NDI1NTI0MX0.HNXSKISZTqzjKd705BOSARmgI8FGGe4Sv-Ma3_iK1Xw&amp;#34;,&amp;#34;name&amp;#34;:&amp;#34;hahaha1&amp;#34;},&amp;#34;msg&amp;#34;:&amp;#34;ç™»é™†æˆåŠŸ&amp;#34;,&amp;#34;status&amp;#34;:0}


# è®¿é—®éœ€è¦è®¤è¯çš„æ¥å£
# å› ä¸ºæˆ‘ä»¬å¯¹/apis/v1/auth/çš„åˆ†ç»„è·¯ç”±ä¸­åŠ è½½äº†jwtçš„middlewareï¼Œå› æ­¤è¯¥åˆ†ç»„ä¸‹çš„apiéƒ½éœ€è¦ä½¿ç”¨jwt-tokenè®¤è¯
$ curl http://localhost:8081/apis/v1/auth/time
{&amp;#34;data&amp;#34;:null,&amp;#34;msg&amp;#34;:&amp;#34;è¯·æ±‚æœªæºå¸¦tokenï¼Œæ— æƒé™è®¿é—®&amp;#34;,&amp;#34;status&amp;#34;:-1}%

# ä½¿ç”¨tokenè®¤è¯
$ curl http://localhost:8081/apis/v1/auth/time -H &amp;#39;token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyTmFtZSI6ImhhaGFoYTEiLCJlbWFpbCI6ImhhaGFoYTFAYmdiaWFvLnRvcCIsImV4cCI6MTU4NDI1OTg0MSwiaXNzIjoiYmdiaWFvLnRvcCIsIm5iZiI6MTU4NDI1NTI0MX0.HNXSKISZTqzjKd705BOSARmgI8FGGe4Sv-Ma3_iK1Xw&amp;#39;
{&amp;#34;data&amp;#34;:{&amp;#34;userName&amp;#34;:&amp;#34;hahaha1&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;hahaha1@bgbiao.top&amp;#34;,&amp;#34;exp&amp;#34;:1584259841,&amp;#34;iss&amp;#34;:&amp;#34;bgbiao.top&amp;#34;,&amp;#34;nbf&amp;#34;:1584255241},&amp;#34;msg&amp;#34;:&amp;#34;tokenæœ‰æ•ˆ&amp;#34;,&amp;#34;status&amp;#34;:0}%&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/BGBiao/gin-jwt-token&#34;&gt;gin-jwt-goæºç &lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gai9amj2lcj30vu0b275p.jpg&#34; alt=&#34;çŸ¥è¯†æ˜Ÿçƒ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/006tNbRwly1gaexte72s7j31bi0hc418.jpg&#34; alt=&#34;å…¬ä¼—å·&#34; /&gt;&lt;/p&gt;
</description>
      
    </item>
    
  </channel>
</rss>
